"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=8207,exports.ids=[8207],exports.modules={88207:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{BitstreamPageModule:()=>BitstreamPageModule});var common=__webpack_require__(10210),shared_module=__webpack_require__(66004),router=__webpack_require__(37895),operators=__webpack_require__(5796),cjs=__webpack_require__(39942),core=__webpack_require__(65737),custom_switch_model=__webpack_require__(81637),lodash=__webpack_require__(61001),bitstream_data_service=__webpack_require__(93132),shared_operators=__webpack_require__(63281),notifications_service=__webpack_require__(16228),bitstream_format_data_service=__webpack_require__(65820),bitstream_format_support_level=__webpack_require__(43963),empty_util=__webpack_require__(25839),metadata_utils=__webpack_require__(59874),item_page_routing_paths=__webpack_require__(96007),dso_name_service=__webpack_require__(53043),ds_dynamic_input_model=__webpack_require__(92361),ds_dynamic_textarea_model=__webpack_require__(75607),fesm2015_core=__webpack_require__(70074),ngx_translate_core=__webpack_require__(47241),var_directive=__webpack_require__(41633),thumbnail_component=__webpack_require__(7553),form_component=__webpack_require__(61792),fesm2015_forms=__webpack_require__(45028),error_component=__webpack_require__(61206),themed_loading_component=__webpack_require__(76924),file_size_pipe=__webpack_require__(69748);const _c0=__name(function(a1){return["/bitstreams",a1,"authorizations"]},"_c0");function EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template(rf,ctx){if(1&rf){const _r9=fesm2015_core.EpF();fesm2015_core.TgZ(0,"ds-form",12),fesm2015_core.NdJ("submitForm",__name(function(){return fesm2015_core.CHM(_r9),fesm2015_core.oxw(4).onSubmit()},"EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template_ds_form_submitForm_0_listener"))("cancel",__name(function(){return fesm2015_core.CHM(_r9),fesm2015_core.oxw(4).onCancel()},"EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template_ds_form_cancel_0_listener"))("dfChange",__name(function($event){return fesm2015_core.CHM(_r9),fesm2015_core.oxw(4).onChange($event)},"EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template_ds_form_dfChange_0_listener")),fesm2015_core.TgZ(1,"div",13)(2,"a",14),fesm2015_core._uU(3),fesm2015_core.ALo(4,"translate"),fesm2015_core.qZA()()()}if(2&rf){const bitstreamRD_r1=fesm2015_core.oxw(3).ngVar,ctx_r7=fesm2015_core.oxw();fesm2015_core.Q6J("formId","edit-bitstream-form-id")("formGroup",ctx_r7.formGroup)("formModel",ctx_r7.formModel)("formLayout",ctx_r7.formLayout)("submitLabel","form.save"),fesm2015_core.xp6(2),fesm2015_core.Q6J("routerLink",fesm2015_core.VKq(9,_c0,null==bitstreamRD_r1||null==bitstreamRD_r1.payload?null:bitstreamRD_r1.payload.id)),fesm2015_core.xp6(1),fesm2015_core.Oqu(fesm2015_core.lcZ(4,7,"bitstream.edit.authorizations.link"))}}function EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template(rf,ctx){if(1&rf&&(fesm2015_core.TgZ(0,"div",5)(1,"div",6),fesm2015_core._UZ(2,"ds-thumbnail",7),fesm2015_core.qZA(),fesm2015_core.TgZ(3,"div",8)(4,"div",2)(5,"div",5)(6,"div",9)(7,"h3"),fesm2015_core._uU(8),fesm2015_core.TgZ(9,"span",10),fesm2015_core._uU(10),fesm2015_core.ALo(11,"dsFileSize"),fesm2015_core.qZA()()()()(),fesm2015_core.YNc(12,EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template,5,11,"ds-form",11),fesm2015_core.qZA()()),2&rf){const bitstreamRD_r1=fesm2015_core.oxw(2).ngVar,ctx_r4=fesm2015_core.oxw();fesm2015_core.xp6(2),fesm2015_core.Q6J("thumbnail",null==bitstreamRD_r1?null:bitstreamRD_r1.payload),fesm2015_core.xp6(6),fesm2015_core.hij("",null==bitstreamRD_r1||null==bitstreamRD_r1.payload?null:bitstreamRD_r1.payload.name," "),fesm2015_core.xp6(2),fesm2015_core.hij("(",fesm2015_core.lcZ(11,4,null==bitstreamRD_r1||null==bitstreamRD_r1.payload?null:bitstreamRD_r1.payload.sizeBytes),")"),fesm2015_core.xp6(2),fesm2015_core.Q6J("ngIf",ctx_r4.formGroup)}}function EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template(rf,ctx){1&rf&&(fesm2015_core._UZ(0,"ds-error",15),fesm2015_core.ALo(1,"translate")),2&rf&&fesm2015_core.s9C("message",fesm2015_core.lcZ(1,1,"error.bitstream"))}function EditBitstreamPageComponent_ng_container_0_div_1_ds_themed_loading_3_Template(rf,ctx){1&rf&&(fesm2015_core._UZ(0,"ds-themed-loading",15),fesm2015_core.ALo(1,"translate")),2&rf&&fesm2015_core.s9C("message",fesm2015_core.lcZ(1,1,"loading.bitstream"))}function EditBitstreamPageComponent_ng_container_0_div_1_Template(rf,ctx){if(1&rf&&(fesm2015_core.TgZ(0,"div",2),fesm2015_core.YNc(1,EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template,13,6,"div",3),fesm2015_core.YNc(2,EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template,2,3,"ds-error",4),fesm2015_core.YNc(3,EditBitstreamPageComponent_ng_container_0_div_1_ds_themed_loading_3_Template,2,3,"ds-themed-loading",4),fesm2015_core.qZA()),2&rf){const formatsRD_r3=ctx.ngVar,bitstreamRD_r1=fesm2015_core.oxw().ngVar;fesm2015_core.xp6(1),fesm2015_core.Q6J("ngIf",(null==bitstreamRD_r1?null:bitstreamRD_r1.hasSucceeded)&&(null==formatsRD_r3?null:formatsRD_r3.hasSucceeded)),fesm2015_core.xp6(1),fesm2015_core.Q6J("ngIf",null==bitstreamRD_r1?null:bitstreamRD_r1.hasFailed),fesm2015_core.xp6(1),fesm2015_core.Q6J("ngIf",!bitstreamRD_r1||!formatsRD_r3||(null==bitstreamRD_r1?null:bitstreamRD_r1.isLoading)||(null==formatsRD_r3?null:formatsRD_r3.isLoading))}}function EditBitstreamPageComponent_ng_container_0_Template(rf,ctx){if(1&rf&&(fesm2015_core.ynx(0),fesm2015_core.YNc(1,EditBitstreamPageComponent_ng_container_0_div_1_Template,4,3,"div",1),fesm2015_core.ALo(2,"async"),fesm2015_core.BQk()),2&rf){const ctx_r0=fesm2015_core.oxw();fesm2015_core.xp6(1),fesm2015_core.Q6J("ngVar",fesm2015_core.lcZ(2,1,ctx_r0.bitstreamFormatsRD$))}}__name(EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template,"EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template"),__name(EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template,"EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template"),__name(EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template,"EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template"),__name(EditBitstreamPageComponent_ng_container_0_div_1_ds_themed_loading_3_Template,"EditBitstreamPageComponent_ng_container_0_div_1_ds_themed_loading_3_Template"),__name(EditBitstreamPageComponent_ng_container_0_div_1_Template,"EditBitstreamPageComponent_ng_container_0_div_1_Template"),__name(EditBitstreamPageComponent_ng_container_0_Template,"EditBitstreamPageComponent_ng_container_0_Template");class EditBitstreamPageComponent{constructor(route,router2,changeDetectorRef,location,formService,translate,bitstreamService,dsoNameService,notificationsService,bitstreamFormatService){this.route=route,this.router=router2,this.changeDetectorRef=changeDetectorRef,this.location=location,this.formService=formService,this.translate=translate,this.bitstreamService=bitstreamService,this.dsoNameService=dsoNameService,this.notificationsService=notificationsService,this.bitstreamFormatService=bitstreamFormatService,this.KEY_PREFIX="bitstream.edit.form.",this.LABEL_KEY_SUFFIX=".label",this.HINT_KEY_SUFFIX=".hint",this.NOTIFICATIONS_PREFIX="bitstream.edit.notifications.",this.IMAGE_WIDTH_METADATA="iiif.image.width",this.IMAGE_HEIGHT_METADATA="iiif.image.height",this.IIIF_TOC_METADATA="iiif.toc",this.IIIF_LABEL_METADATA="iiif.label",this.findAllOptions={elementsPerPage:9999},this.fileNameModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"fileName",name:"fileName",required:!0,validators:{required:null},errorMessages:{required:"You must provide a file name for the bitstream"}}),this.primaryBitstreamModel=new custom_switch_model.p({id:"primaryBitstream",name:"primaryBitstream"}),this.descriptionModel=new ds_dynamic_textarea_model.D({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"description",name:"description",rows:10}),this.selectedFormatModel=new core.nMt({id:"selectedFormat",name:"selectedFormat"}),this.newFormatModel=new core.b1u({id:"newFormat",name:"newFormat"}),this.iiifLabelModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifLabel",name:"iiifLabel"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifLabelContainer=new core.S_O({id:"iiifLabelContainer",group:[this.iiifLabelModel]},{grid:{host:"form-row"}}),this.iiifTocModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifToc",name:"iiifToc"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifTocContainer=new core.S_O({id:"iiifTocContainer",group:[this.iiifTocModel]},{grid:{host:"form-row"}}),this.iiifWidthModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifWidth",name:"iiifWidth"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifWidthContainer=new core.S_O({id:"iiifWidthContainer",group:[this.iiifWidthModel]},{grid:{host:"form-row"}}),this.iiifHeightModel=new ds_dynamic_input_model.u({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifHeight",name:"iiifHeight"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifHeightContainer=new core.S_O({id:"iiifHeightContainer",group:[this.iiifHeightModel]},{grid:{host:"form-row"}}),this.inputModels=[this.fileNameModel,this.primaryBitstreamModel,this.descriptionModel,this.selectedFormatModel,this.newFormatModel],this.formModel=[new core.S_O({id:"fileNamePrimaryContainer",group:[this.fileNameModel,this.primaryBitstreamModel]},{grid:{host:"form-row"}}),new core.S_O({id:"descriptionContainer",group:[this.descriptionModel]}),new core.S_O({id:"formatContainer",group:[this.selectedFormatModel,this.newFormatModel]})],this.newFormatBaseLayout="col col-sm-6 d-inline-block",this.formLayout={fileName:{grid:{host:"col col-sm-8 d-inline-block"}},primaryBitstream:{grid:{host:"col col-sm-4 d-inline-block switch"}},description:{grid:{host:"col-12 d-inline-block"}},embargo:{grid:{host:"col-12 d-inline-block"}},selectedFormat:{grid:{host:"col col-sm-6 d-inline-block"}},newFormat:{grid:{host:this.newFormatBaseLayout+" invisible"}},fileNamePrimaryContainer:{grid:{host:"row position-relative"}},descriptionContainer:{grid:{host:"row"}},formatContainer:{grid:{host:"row"}}},this.isIIIF=!1,this.subs=[]}ngOnInit(){this.itemId=this.route.snapshot.queryParams.itemId,this.entityType=this.route.snapshot.queryParams.entityType,this.bitstreamRD$=this.route.data.pipe((0,operators.UI)(data=>data.bitstream)),this.bitstreamFormatsRD$=this.bitstreamFormatService.findAll(this.findAllOptions);const bitstream$=this.bitstreamRD$.pipe((0,shared_operators.xw)(),(0,shared_operators.xe)()),allFormats$=this.bitstreamFormatsRD$.pipe((0,shared_operators.xw)(),(0,shared_operators.xe)());this.subs.push((0,cjs.combineLatest)(bitstream$,allFormats$).subscribe(([bitstream,allFormats])=>{this.bitstream=bitstream,this.formats=allFormats.page,this.setIiifStatus(this.bitstream)})),this.subs.push(this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()}))}setForm(){this.formGroup=this.formService.createFormGroup(this.formModel),this.updateFormatModel(),this.updateForm(this.bitstream),this.updateFieldTranslations()}updateForm(bitstream){this.formGroup.patchValue({fileNamePrimaryContainer:{fileName:bitstream.name,primaryBitstream:!1},descriptionContainer:{description:bitstream.firstMetadataValue("dc.description")},formatContainer:{newFormat:(0,empty_util.Uh)(bitstream.firstMetadata("dc.format"))?bitstream.firstMetadata("dc.format").value:void 0}}),this.isIIIF&&this.formGroup.patchValue({iiifLabelContainer:{iiifLabel:bitstream.firstMetadataValue(this.IIIF_LABEL_METADATA)},iiifTocContainer:{iiifToc:bitstream.firstMetadataValue(this.IIIF_TOC_METADATA)},iiifWidthContainer:{iiifWidth:bitstream.firstMetadataValue(this.IMAGE_WIDTH_METADATA)},iiifHeightContainer:{iiifHeight:bitstream.firstMetadataValue(this.IMAGE_HEIGHT_METADATA)}}),this.bitstream.format.pipe((0,shared_operators.mc)()).subscribe(format=>{this.originalFormat=format,this.formGroup.patchValue({formatContainer:{selectedFormat:format.id}}),this.updateNewFormatLayout(format.id)})}updateFormatModel(){this.selectedFormatModel.options=this.formats.map(format=>Object.assign({value:format.id,label:this.isUnknownFormat(format.id)?this.translate.instant(this.KEY_PREFIX+"selectedFormat.unknown"):format.shortDescription}))}updateNewFormatLayout(selectedId){this.isUnknownFormat(selectedId)?this.formLayout.newFormat.grid.host=this.newFormatBaseLayout:this.formLayout.newFormat.grid.host=this.newFormatBaseLayout+" invisible"}isUnknownFormat(id){const format=this.formats.find(f=>f.id===id);return(0,empty_util.Uh)(format)&&format.supportLevel===bitstream_format_support_level.o.Unknown}updateFieldTranslations(){this.inputModels.forEach(fieldModel=>{this.updateFieldTranslation(fieldModel)})}updateFieldTranslation(fieldModel){fieldModel.label=this.translate.instant(this.KEY_PREFIX+fieldModel.id+this.LABEL_KEY_SUFFIX),fieldModel.id!==this.primaryBitstreamModel.id&&(fieldModel.hint=this.translate.instant(this.KEY_PREFIX+fieldModel.id+this.HINT_KEY_SUFFIX))}onChange(event){const model=event.model;model.id===this.selectedFormatModel.id&&this.updateNewFormatLayout(model.value)}onSubmit(){const updatedValues=this.formGroup.getRawValue(),updatedBitstream=this.formToBitstream(updatedValues),selectedFormat=this.formats.find(f=>f.id===updatedValues.formatContainer.selectedFormat);let bitstream$;bitstream$=selectedFormat.id!==this.originalFormat.id?this.bitstreamService.updateFormat(this.bitstream,selectedFormat).pipe((0,shared_operators.hC)(),(0,operators.UI)(formatResponse=>{if(!(0,empty_util.Uh)(formatResponse)||!formatResponse.hasFailed)return formatResponse.payload;this.notificationsService.error(this.translate.instant(this.NOTIFICATIONS_PREFIX+"error.format.title"),formatResponse.errorMessage)})):(0,cjs.of)(this.bitstream),bitstream$.pipe((0,operators.wt)(()=>this.bitstreamService.update(updatedBitstream).pipe((0,shared_operators.Gp)()))).subscribe(()=>{this.bitstreamService.commitUpdates(),this.notificationsService.success(this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.content")),this.navigateToItemEditBitstreams()})}formToBitstream(rawForm){const updatedBitstream=(0,lodash.cloneDeep)(this.bitstream),newMetadata=updatedBitstream.metadata;rawForm.fileNamePrimaryContainer.primaryBitstream;return metadata_utils.S.setFirstValue(newMetadata,"dc.title",rawForm.fileNamePrimaryContainer.fileName),metadata_utils.S.setFirstValue(newMetadata,"dc.description",rawForm.descriptionContainer.description),this.isIIIF&&((0,empty_util.xb)(rawForm.iiifLabelContainer.iiifLabel)?delete newMetadata[this.IIIF_LABEL_METADATA]:metadata_utils.S.setFirstValue(newMetadata,this.IIIF_LABEL_METADATA,rawForm.iiifLabelContainer.iiifLabel),(0,empty_util.xb)(rawForm.iiifTocContainer.iiifToc)?delete newMetadata[this.IIIF_TOC_METADATA]:metadata_utils.S.setFirstValue(newMetadata,this.IIIF_TOC_METADATA,rawForm.iiifTocContainer.iiifToc),(0,empty_util.xb)(rawForm.iiifWidthContainer.iiifWidth)?delete newMetadata[this.IMAGE_WIDTH_METADATA]:metadata_utils.S.setFirstValue(newMetadata,this.IMAGE_WIDTH_METADATA,rawForm.iiifWidthContainer.iiifWidth),(0,empty_util.xb)(rawForm.iiifHeightContainer.iiifHeight)?delete newMetadata[this.IMAGE_HEIGHT_METADATA]:metadata_utils.S.setFirstValue(newMetadata,this.IMAGE_HEIGHT_METADATA,rawForm.iiifHeightContainer.iiifHeight)),(0,empty_util.UE)(rawForm.formatContainer.newFormat)&&metadata_utils.S.setFirstValue(newMetadata,"dc.format",rawForm.formatContainer.newFormat),updatedBitstream.metadata=newMetadata,updatedBitstream}onCancel(){this.navigateToItemEditBitstreams()}navigateToItemEditBitstreams(){(0,empty_util.Uh)(this.itemId)?this.router.navigate([(0,item_page_routing_paths.dZ)(this.entityType,this.itemId),"bitstreams"]):this.bitstream.bundle.pipe((0,shared_operators.Gp)(),(0,operators.zg)(bundle=>bundle.item.pipe((0,shared_operators.Gp)()))).subscribe(item=>{this.router.navigate([(0,item_page_routing_paths.tn)(item),"bitstreams"])})}setIiifStatus(bitstream){const regexExcludeBundles=/OTHERCONTENT|THUMBNAIL|LICENSE/,regexIIIFItem=/true|yes/i,isImage$=this.bitstream.format.pipe((0,shared_operators.xw)(),(0,operators.UI)(format=>format.payload.mimetype.includes("image/"))),isIIIFBundle$=this.bitstream.bundle.pipe((0,shared_operators.xw)(),(0,operators.UI)(bundle=>null==this.dsoNameService.getName(bundle.payload).match(regexExcludeBundles))),isEnabled$=this.bitstream.bundle.pipe((0,shared_operators.xw)(),(0,operators.UI)(bundle=>bundle.payload.item.pipe((0,shared_operators.xw)(),(0,operators.UI)(item=>item.payload.firstMetadataValue("dspace.iiif.enabled")&&null!==item.payload.firstMetadataValue("dspace.iiif.enabled").match(regexIIIFItem))))),iiifSub=(0,cjs.combineLatest)(isImage$,isIIIFBundle$,isEnabled$).subscribe(([isImage,isIIIFBundle,isEnabled])=>{isImage&&isIIIFBundle&&isEnabled&&(this.isIIIF=!0,this.inputModels.push(this.iiifLabelModel),this.formModel.push(this.iiifLabelContainer),this.inputModels.push(this.iiifTocModel),this.formModel.push(this.iiifTocContainer),this.inputModels.push(this.iiifWidthModel),this.formModel.push(this.iiifWidthContainer),this.inputModels.push(this.iiifHeightModel),this.formModel.push(this.iiifHeightContainer)),this.setForm(),this.changeDetectorRef.detectChanges()});this.subs.push(iiifSub)}ngOnDestroy(){this.subs.filter(subscription=>(0,empty_util.Uh)(subscription)).forEach(subscription=>subscription.unsubscribe())}}__name(EditBitstreamPageComponent,"EditBitstreamPageComponent"),EditBitstreamPageComponent.\u0275fac=__name(function(t){return new(t||EditBitstreamPageComponent)(fesm2015_core.Y36(router.gz),fesm2015_core.Y36(router.F0),fesm2015_core.Y36(fesm2015_core.sBO),fesm2015_core.Y36(common.Ye),fesm2015_core.Y36(core.w1X),fesm2015_core.Y36(ngx_translate_core.sK),fesm2015_core.Y36(bitstream_data_service.J),fesm2015_core.Y36(dso_name_service._),fesm2015_core.Y36(notifications_service.T),fesm2015_core.Y36(bitstream_format_data_service.O))},"EditBitstreamPageComponent_Factory"),EditBitstreamPageComponent.\u0275cmp=fesm2015_core.Xpm({type:EditBitstreamPageComponent,selectors:[["ds-edit-bitstream-page"]],decls:2,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngVar"],[1,"container"],["class","row",4,"ngIf"],[3,"message",4,"ngIf"],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"col-12"],[1,"text-muted"],[3,"formId","formGroup","formModel","formLayout","submitLabel","submitForm","cancel","dfChange",4,"ngIf"],[3,"formId","formGroup","formModel","formLayout","submitLabel","submitForm","cancel","dfChange"],["additional","",1,"container","py-3"],[3,"routerLink"],[3,"message"]],template:__name(function(rf,ctx){1&rf&&(fesm2015_core.YNc(0,EditBitstreamPageComponent_ng_container_0_Template,3,3,"ng-container",0),fesm2015_core.ALo(1,"async")),2&rf&&fesm2015_core.Q6J("ngVar",fesm2015_core.lcZ(1,1,ctx.bitstreamRD$))},"EditBitstreamPageComponent_Template"),directives:[var_directive.g,common.O5,thumbnail_component.Z,form_component.U,fesm2015_forms.JL,fesm2015_forms.sg,router.yS,error_component.q,themed_loading_component.Z],pipes:[common.Ov,file_size_pipe.p,ngx_translate_core.X$],styles:["[_nghost-%COMP%]     .switch{position:absolute;top:calc(var(--bs-spacer) * 2.5)}[_nghost-%COMP%]     ds-dynamic-form-control-container>div>label{margin-top:1.75rem}"],changeDetection:0});var authenticated_guard=__webpack_require__(54818),follow_link_config_model=__webpack_require__(8183);const BITSTREAM_PAGE_LINKS_TO_FOLLOW=[(0,follow_link_config_model.l)("bundle",{},(0,follow_link_config_model.l)("item")),(0,follow_link_config_model.l)("format")];class BitstreamPageResolver{constructor(bitstreamService){this.bitstreamService=bitstreamService}resolve(route,state){return this.bitstreamService.findById(route.params.id,!0,!1,...this.followLinks).pipe((0,shared_operators.hC)())}get followLinks(){return BITSTREAM_PAGE_LINKS_TO_FOLLOW}}__name(BitstreamPageResolver,"BitstreamPageResolver"),BitstreamPageResolver.\u0275fac=__name(function(t){return new(t||BitstreamPageResolver)(fesm2015_core.LFG(bitstream_data_service.J))},"BitstreamPageResolver_Factory"),BitstreamPageResolver.\u0275prov=fesm2015_core.Yz7({token:BitstreamPageResolver,factory:BitstreamPageResolver.\u0275fac});var bitstream_download_page_component=__webpack_require__(30723),resource_policy_target_resolver=__webpack_require__(37443),resource_policy_create_component=__webpack_require__(91870),resource_policy_resolver=__webpack_require__(66057),resource_policy_edit_component=__webpack_require__(40279),resource_policies_component=__webpack_require__(45452);const bitstream_authorizations_component_c0=__name(function(a1){return["/bitstreams",a1,"edit"]},"bitstream_authorizations_component_c0");class BitstreamAuthorizationsComponent{constructor(route){this.route=route}ngOnInit(){this.dsoRD$=this.route.data.pipe((0,operators.Ps)(),(0,operators.UI)(data=>data.bitstream))}}__name(BitstreamAuthorizationsComponent,"BitstreamAuthorizationsComponent"),BitstreamAuthorizationsComponent.\u0275fac=__name(function(t){return new(t||BitstreamAuthorizationsComponent)(fesm2015_core.Y36(router.gz))},"BitstreamAuthorizationsComponent_Factory"),BitstreamAuthorizationsComponent.\u0275cmp=fesm2015_core.Xpm({type:BitstreamAuthorizationsComponent,selectors:[["ds-collection-authorizations"]],decls:10,vars:12,consts:[[1,"container"],[3,"resourceType","resourceUUID"],[1,"button-row","bottom"],[1,"text-right"],["role","button",1,"btn","btn-outline-secondary","mr-1",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:__name(function(rf,ctx){if(1&rf&&(fesm2015_core.TgZ(0,"div",0),fesm2015_core._UZ(1,"ds-resource-policies",1),fesm2015_core.ALo(2,"async"),fesm2015_core.TgZ(3,"div",2)(4,"div",3)(5,"a",4),fesm2015_core.ALo(6,"async"),fesm2015_core._UZ(7,"i",5),fesm2015_core._uU(8),fesm2015_core.ALo(9,"translate"),fesm2015_core.qZA()()()()),2&rf){let tmp_1_0,tmp_2_0;fesm2015_core.xp6(1),fesm2015_core.Q6J("resourceType","bitstream")("resourceUUID",null==(tmp_1_0=fesm2015_core.lcZ(2,4,ctx.dsoRD$))||null==tmp_1_0.payload?null:tmp_1_0.payload.id),fesm2015_core.xp6(4),fesm2015_core.Q6J("routerLink",fesm2015_core.VKq(10,bitstream_authorizations_component_c0,null==(tmp_2_0=fesm2015_core.lcZ(6,6,ctx.dsoRD$))||null==tmp_2_0.payload?null:tmp_2_0.payload.id)),fesm2015_core.xp6(3),fesm2015_core.hij(" ",fesm2015_core.lcZ(9,8,"bitstream.edit.return")," ")}},"BitstreamAuthorizationsComponent_Template"),directives:[resource_policies_component.F,router.yS],pipes:[common.Ov,ngx_translate_core.X$],encapsulation:2});class LegacyBitstreamUrlResolver{constructor(bitstreamDataService){this.bitstreamDataService=bitstreamDataService}resolve(route,state){const prefix=route.params.prefix,suffix=route.params.suffix,filename=route.params.filename;let sequenceId=route.params.sequence_id;return(0,empty_util.xI)(sequenceId)&&(sequenceId=route.queryParams.sequenceId),this.bitstreamDataService.findByItemHandle(`${prefix}/${suffix}`,sequenceId,filename).pipe((0,shared_operators.hC)())}}__name(LegacyBitstreamUrlResolver,"LegacyBitstreamUrlResolver"),LegacyBitstreamUrlResolver.\u0275fac=__name(function(t){return new(t||LegacyBitstreamUrlResolver)(fesm2015_core.LFG(bitstream_data_service.J))},"LegacyBitstreamUrlResolver_Factory"),LegacyBitstreamUrlResolver.\u0275prov=fesm2015_core.Yz7({token:LegacyBitstreamUrlResolver,factory:LegacyBitstreamUrlResolver.\u0275fac,providedIn:"root"});var dso_breadcrumb_resolver=__webpack_require__(23679),breadcrumb_model=__webpack_require__(74388),link_service=__webpack_require__(72564),app_routing_paths=__webpack_require__(61562),dso_breadcrumbs_service=__webpack_require__(45234);class BitstreamBreadcrumbsService extends dso_breadcrumbs_service.B{constructor(bitstreamService,linkService,dsoNameService){super(linkService,dsoNameService),this.bitstreamService=bitstreamService,this.linkService=linkService,this.dsoNameService=dsoNameService}getBreadcrumbs(key,url){const label=this.dsoNameService.getName(key),crumb=new breadcrumb_model.a(label,url);return this.getOwningItem(key.uuid).pipe((0,operators.wt)(parentRD=>{if((0,empty_util.UE)(parentRD)&&(0,empty_util.Uh)(parentRD.payload)){const parent=parentRD.payload;return super.getBreadcrumbs(parent,(0,app_routing_paths.Y4)(parent))}return(0,cjs.of)([])}),(0,operators.UI)(breadcrumbs=>[...breadcrumbs,crumb]))}getOwningItem(uuid){return this.bitstreamService.findById(uuid,!0,!0,...BITSTREAM_PAGE_LINKS_TO_FOLLOW).pipe((0,shared_operators.hC)(),(0,shared_operators.xe)(),(0,operators.wt)(bitstream=>(0,empty_util.Uh)(bitstream)?bitstream.bundle.pipe((0,shared_operators.hC)(),(0,shared_operators.xe)(),(0,operators.wt)(bundle=>(0,empty_util.Uh)(bundle)?bundle.item.pipe((0,shared_operators.hC)()):(0,cjs.of)(void 0))):(0,cjs.of)(void 0)))}}__name(BitstreamBreadcrumbsService,"BitstreamBreadcrumbsService"),BitstreamBreadcrumbsService.\u0275fac=__name(function(t){return new(t||BitstreamBreadcrumbsService)(fesm2015_core.LFG(bitstream_data_service.J),fesm2015_core.LFG(link_service.M),fesm2015_core.LFG(dso_name_service._))},"BitstreamBreadcrumbsService_Factory"),BitstreamBreadcrumbsService.\u0275prov=fesm2015_core.Yz7({token:BitstreamBreadcrumbsService,factory:BitstreamBreadcrumbsService.\u0275fac,providedIn:"root"});class BitstreamBreadcrumbResolver extends dso_breadcrumb_resolver.t{constructor(breadcrumbService,dataService){super(breadcrumbService,dataService),this.breadcrumbService=breadcrumbService,this.dataService=dataService}get followLinks(){return BITSTREAM_PAGE_LINKS_TO_FOLLOW}}__name(BitstreamBreadcrumbResolver,"BitstreamBreadcrumbResolver"),BitstreamBreadcrumbResolver.\u0275fac=__name(function(t){return new(t||BitstreamBreadcrumbResolver)(fesm2015_core.LFG(BitstreamBreadcrumbsService),fesm2015_core.LFG(bitstream_data_service.J))},"BitstreamBreadcrumbResolver_Factory"),BitstreamBreadcrumbResolver.\u0275prov=fesm2015_core.Yz7({token:BitstreamBreadcrumbResolver,factory:BitstreamBreadcrumbResolver.\u0275fac,providedIn:"root"});var i18n_breadcrumb_resolver=__webpack_require__(64561);class BitstreamPageRoutingModule{}__name(BitstreamPageRoutingModule,"BitstreamPageRoutingModule"),BitstreamPageRoutingModule.\u0275fac=__name(function(t){return new(t||BitstreamPageRoutingModule)},"BitstreamPageRoutingModule_Factory"),BitstreamPageRoutingModule.\u0275mod=fesm2015_core.oAB({type:BitstreamPageRoutingModule}),BitstreamPageRoutingModule.\u0275inj=fesm2015_core.cJS({providers:[BitstreamPageResolver,BitstreamBreadcrumbResolver,BitstreamBreadcrumbsService],imports:[[router.Bz.forChild([{path:"handle/:prefix/:suffix/:filename",component:bitstream_download_page_component.h,resolve:{bitstream:LegacyBitstreamUrlResolver}},{path:":prefix/:suffix/:sequence_id/:filename",component:bitstream_download_page_component.h,resolve:{bitstream:LegacyBitstreamUrlResolver}},{path:":id/download",component:bitstream_download_page_component.h,resolve:{bitstream:BitstreamPageResolver}},{path:":id/edit",component:EditBitstreamPageComponent,resolve:{bitstream:BitstreamPageResolver,breadcrumb:BitstreamBreadcrumbResolver},canActivate:[authenticated_guard.J]},{path:":id/authorizations",children:[{path:"create",resolve:{resourcePolicyTarget:resource_policy_target_resolver.a},component:resource_policy_create_component.v,data:{title:"resource-policies.create.page.title",showBreadcrumbs:!0}},{path:"edit",resolve:{breadcrumb:i18n_breadcrumb_resolver.t,resourcePolicy:resource_policy_resolver.b},component:resource_policy_edit_component.x,data:{breadcrumbKey:"item.edit",title:"resource-policies.edit.page.title",showBreadcrumbs:!0}},{path:"",resolve:{bitstream:BitstreamPageResolver,breadcrumb:BitstreamBreadcrumbResolver},component:BitstreamAuthorizationsComponent,data:{title:"bitstream.edit.authorizations.title",showBreadcrumbs:!0}}]}])]]});var form_module=__webpack_require__(48197),resource_policies_module=__webpack_require__(36331);class BitstreamPageModule{}__name(BitstreamPageModule,"BitstreamPageModule"),BitstreamPageModule.\u0275fac=__name(function(t){return new(t||BitstreamPageModule)},"BitstreamPageModule_Factory"),BitstreamPageModule.\u0275mod=fesm2015_core.oAB({type:BitstreamPageModule}),BitstreamPageModule.\u0275inj=fesm2015_core.cJS({imports:[[common.ez,shared_module.m,BitstreamPageRoutingModule,form_module.e,resource_policies_module.q]]})}};