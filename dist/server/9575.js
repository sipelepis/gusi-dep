"use strict";var __defProp=Object.defineProperty,__name=(target,value)=>__defProp(target,"name",{value,configurable:!0});exports.id=9575,exports.ids=[9575],exports.modules={59575:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{AccessControlModule:()=>AccessControlModule});var common=__webpack_require__(10210),router=__webpack_require__(37895),shared_module=__webpack_require__(66004),cjs=__webpack_require__(39942),operators=__webpack_require__(5796),paginated_list_model=__webpack_require__(73535),eperson_data_service=__webpack_require__(53019),empty_util=__webpack_require__(25839),notifications_service=__webpack_require__(16228),pagination_component_options_model=__webpack_require__(98865);class EpersonDtoModel{}__name(EpersonDtoModel,"EpersonDtoModel");var feature_id=__webpack_require__(84705),authorization_data_service=__webpack_require__(30835),shared_operators=__webpack_require__(63281),confirmation_modal_component=__webpack_require__(25366),request_service=__webpack_require__(37958),page_info_model=__webpack_require__(45419),pagination_service=__webpack_require__(57854),core=__webpack_require__(70074),ngx_translate_core=__webpack_require__(47241),fesm2015_forms=__webpack_require__(45028),ng_bootstrap=__webpack_require__(63742),fesm2015_core=__webpack_require__(65737),group_data_service=__webpack_require__(96652),eperson_model=__webpack_require__(62610),form_builder_service=__webpack_require__(24656),auth_service=__webpack_require__(28709),follow_link_config_model=__webpack_require__(8183);class ValidateEmailNotTaken{static createValidator(ePersonDataService){return control=>ePersonDataService.getEPersonByEmail(control.value).pipe((0,shared_operators.xw)(),(0,operators.UI)(res=>res.payload?{emailTaken:!0}:null))}}__name(ValidateEmailNotTaken,"ValidateEmailNotTaken");var eperson_registration_service=__webpack_require__(37188),form_component=__webpack_require__(61792),themed_loading_component=__webpack_require__(76924),pagination_component=__webpack_require__(99292);function EPersonFormComponent_div_0_Template(rf,ctx){1&rf&&core._UZ(0,"div")}function EPersonFormComponent_ng_template_2_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"h4"),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r2=core.oxw();core.xp6(1),core.Oqu(core.lcZ(2,1,ctx_r2.messagePrefix+".create"))}}function EPersonFormComponent_ng_template_4_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"h4"),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r4=core.oxw();core.xp6(1),core.Oqu(core.lcZ(2,1,ctx_r4.messagePrefix+".edit"))}}__name(EPersonFormComponent_div_0_Template,"EPersonFormComponent_div_0_Template"),__name(EPersonFormComponent_ng_template_2_Template,"EPersonFormComponent_ng_template_2_Template"),__name(EPersonFormComponent_ng_template_4_Template,"EPersonFormComponent_ng_template_4_Template");const _c0=__name(function(a0){return{"d-none":a0}},"_c0");function EPersonFormComponent_button_19_Template(rf,ctx){if(1&rf){const _r10=core.EpF();core.TgZ(0,"button",17),core.NdJ("click",__name(function(){return core.CHM(_r10),core.oxw().impersonate()},"EPersonFormComponent_button_19_Template_button_click_0_listener")),core.ALo(1,"async"),core._UZ(2,"i",18),core._uU(3),core.ALo(4,"translate"),core.qZA()}if(2&rf){const ctx_r5=core.oxw();core.Q6J("ngClass",core.VKq(6,_c0,!core.lcZ(1,2,ctx_r5.canImpersonate$))),core.xp6(3),core.hij(" ",core.lcZ(4,4,"admin.access-control.epeople.actions.impersonate")," ")}}function EPersonFormComponent_button_20_Template(rf,ctx){if(1&rf){const _r12=core.EpF();core.TgZ(0,"button",19),core.NdJ("click",__name(function(){return core.CHM(_r12),core.oxw().stopImpersonating()},"EPersonFormComponent_button_20_Template_button_click_0_listener")),core._UZ(1,"i",18),core._uU(2),core.ALo(3,"translate"),core.qZA()}2&rf&&(core.xp6(2),core.hij(" ",core.lcZ(3,1,"admin.access-control.epeople.actions.stop-impersonating")," "))}function EPersonFormComponent_ds_themed_loading_26_Template(rf,ctx){1&rf&&core._UZ(0,"ds-themed-loading",20),2&rf&&core.Q6J("showMessage",!1)}function EPersonFormComponent_div_27_ds_themed_loading_4_Template(rf,ctx){1&rf&&core._UZ(0,"ds-themed-loading",20),2&rf&&core.Q6J("showMessage",!1)}__name(EPersonFormComponent_button_19_Template,"EPersonFormComponent_button_19_Template"),__name(EPersonFormComponent_button_20_Template,"EPersonFormComponent_button_20_Template"),__name(EPersonFormComponent_ds_themed_loading_26_Template,"EPersonFormComponent_ds_themed_loading_26_Template"),__name(EPersonFormComponent_div_27_ds_themed_loading_4_Template,"EPersonFormComponent_div_27_ds_themed_loading_4_Template");const _c1=__name(function(a0){return[a0]},"_c1");function EPersonFormComponent_div_27_ds_pagination_6_tr_17_Template(rf,ctx){if(1&rf){const _r19=core.EpF();core.TgZ(0,"tr")(1,"td",28),core._uU(2),core.qZA(),core.TgZ(3,"td",28)(4,"a",29),core.NdJ("click",__name(function(){const group_r17=core.CHM(_r19).$implicit;return core.oxw(3).groupsDataService.startEditingNewGroup(group_r17)},"EPersonFormComponent_div_27_ds_pagination_6_tr_17_Template_a_click_4_listener")),core._uU(5),core.qZA()(),core.TgZ(6,"td",28),core._uU(7),core.ALo(8,"async"),core.qZA()()}if(2&rf){const group_r17=ctx.$implicit,ctx_r16=core.oxw(3);let tmp_3_0;core.xp6(2),core.Oqu(group_r17.id),core.xp6(2),core.Q6J("routerLink",core.VKq(6,_c1,ctx_r16.groupsDataService.getGroupEditPageRouterLink(group_r17))),core.xp6(1),core.Oqu(group_r17.name),core.xp6(2),core.Oqu(null==(tmp_3_0=core.lcZ(8,4,group_r17.object))||null==tmp_3_0.payload?null:tmp_3_0.payload.name)}}function EPersonFormComponent_div_27_ds_pagination_6_Template(rf,ctx){if(1&rf){const _r21=core.EpF();core.TgZ(0,"ds-pagination",23),core.NdJ("pageChange",__name(function($event){return core.CHM(_r21),core.oxw(2).onPageChange($event)},"EPersonFormComponent_div_27_ds_pagination_6_Template_ds_pagination_pageChange_0_listener")),core.ALo(1,"async"),core.ALo(2,"async"),core.TgZ(3,"div",24)(4,"table",25)(5,"thead")(6,"tr")(7,"th",26),core._uU(8),core.ALo(9,"translate"),core.qZA(),core.TgZ(10,"th",26),core._uU(11),core.ALo(12,"translate"),core.qZA(),core.TgZ(13,"th",26),core._uU(14),core.ALo(15,"translate"),core.qZA()()(),core.TgZ(16,"tbody"),core.YNc(17,EPersonFormComponent_div_27_ds_pagination_6_tr_17_Template,9,8,"tr",27),core.ALo(18,"async"),core.qZA()()()()}if(2&rf){const ctx_r14=core.oxw(2);let tmp_1_0,tmp_2_0,tmp_8_0;core.Q6J("paginationOptions",ctx_r14.config)("pageInfoState",null==(tmp_1_0=core.lcZ(1,9,ctx_r14.groups))?null:tmp_1_0.payload)("collectionSize",null==(tmp_2_0=core.lcZ(2,11,ctx_r14.groups))||null==tmp_2_0.payload?null:tmp_2_0.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),core.xp6(8),core.Oqu(core.lcZ(9,13,ctx_r14.messagePrefix+".table.id")),core.xp6(3),core.Oqu(core.lcZ(12,15,ctx_r14.messagePrefix+".table.name")),core.xp6(3),core.Oqu(core.lcZ(15,17,ctx_r14.messagePrefix+".table.collectionOrCommunity")),core.xp6(3),core.Q6J("ngForOf",null==(tmp_8_0=core.lcZ(18,19,ctx_r14.groups))||null==tmp_8_0.payload?null:tmp_8_0.payload.page)}}function EPersonFormComponent_div_27_div_8_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",30)(1,"div"),core._uU(2),core.ALo(3,"translate"),core.qZA(),core.TgZ(4,"div")(5,"button",31),core._uU(6),core.ALo(7,"translate"),core.qZA()()()),2&rf){const ctx_r15=core.oxw(2);core.xp6(2),core.Oqu(core.lcZ(3,3,ctx_r15.messagePrefix+".memberOfNoGroups")),core.xp6(3),core.Q6J("routerLink",core.VKq(7,_c1,ctx_r15.groupsDataService.getGroupRegistryRouterLink())),core.xp6(1),core.Oqu(core.lcZ(7,5,ctx_r15.messagePrefix+".goToGroups"))}}function EPersonFormComponent_div_27_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div")(1,"h5"),core._uU(2),core.ALo(3,"translate"),core.qZA(),core.YNc(4,EPersonFormComponent_div_27_ds_themed_loading_4_Template,1,1,"ds-themed-loading",15),core.ALo(5,"async"),core.YNc(6,EPersonFormComponent_div_27_ds_pagination_6_Template,19,21,"ds-pagination",21),core.ALo(7,"async"),core.YNc(8,EPersonFormComponent_div_27_div_8_Template,8,9,"div",22),core.ALo(9,"async"),core.qZA()),2&rf){const ctx_r8=core.oxw();let tmp_2_0,tmp_3_0;core.xp6(2),core.Oqu(core.lcZ(3,4,ctx_r8.messagePrefix+".groupsEPersonIsMemberOf")),core.xp6(2),core.Q6J("ngIf",!core.lcZ(5,6,ctx_r8.groups)),core.xp6(2),core.Q6J("ngIf",(null==(tmp_2_0=core.lcZ(7,8,ctx_r8.groups))||null==tmp_2_0.payload?null:tmp_2_0.payload.totalElements)>0),core.xp6(2),core.Q6J("ngIf",0==(null==(tmp_3_0=core.lcZ(9,10,ctx_r8.groups))||null==tmp_3_0.payload?null:tmp_3_0.payload.totalElements))}}__name(EPersonFormComponent_div_27_ds_pagination_6_tr_17_Template,"EPersonFormComponent_div_27_ds_pagination_6_tr_17_Template"),__name(EPersonFormComponent_div_27_ds_pagination_6_Template,"EPersonFormComponent_div_27_ds_pagination_6_Template"),__name(EPersonFormComponent_div_27_div_8_Template,"EPersonFormComponent_div_27_div_8_Template"),__name(EPersonFormComponent_div_27_Template,"EPersonFormComponent_div_27_Template");class EPersonFormComponent{constructor(changeDetectorRef,epersonService,groupsDataService,formBuilderService,translateService,notificationsService,authService,authorizationService,modalService,paginationService,requestService,epersonRegistrationService){this.changeDetectorRef=changeDetectorRef,this.epersonService=epersonService,this.groupsDataService=groupsDataService,this.formBuilderService=formBuilderService,this.translateService=translateService,this.notificationsService=notificationsService,this.authService=authService,this.authorizationService=authorizationService,this.modalService=modalService,this.paginationService=paginationService,this.requestService=requestService,this.epersonRegistrationService=epersonRegistrationService,this.labelPrefix="admin.access-control.epeople.form.",this.formId="eperson-form",this.messagePrefix="admin.access-control.epeople.form",this.formLayout={firstName:{grid:{host:"row"}},lastName:{grid:{host:"row"}},email:{grid:{host:"row"}},canLogIn:{grid:{host:"col col-sm-6 d-inline-block"}},requireCertificate:{grid:{host:"col col-sm-6 d-inline-block"}}},this.submitForm=new core.vpe,this.cancelForm=new core.vpe,this.subs=[],this.config=Object.assign(new pagination_component_options_model.r,{id:"gem",pageSize:5,currentPage:1}),this.isImpersonated=!1,this.subs.push(this.epersonService.getActiveEPerson().subscribe(eperson=>{this.epersonInitial=eperson,(0,empty_util.Uh)(eperson)&&(this.isImpersonated=this.authService.isImpersonatingUser(eperson.id))}))}ngOnInit(){this.initialisePage()}initialisePage(){(0,cjs.combineLatest)(this.translateService.get(`${this.messagePrefix}.firstName`),this.translateService.get(`${this.messagePrefix}.lastName`),this.translateService.get(`${this.messagePrefix}.email`),this.translateService.get(`${this.messagePrefix}.canLogIn`),this.translateService.get(`${this.messagePrefix}.requireCertificate`),this.translateService.get(`${this.messagePrefix}.emailHint`)).subscribe(([firstName,lastName,email,canLogIn,requireCertificate,emailHint])=>{this.firstName=new fesm2015_core.b1u({id:"firstName",label:firstName,name:"firstName",validators:{required:null},required:!0}),this.lastName=new fesm2015_core.b1u({id:"lastName",label:lastName,name:"lastName",validators:{required:null},required:!0}),this.email=new fesm2015_core.b1u({id:"email",label:email,name:"email",validators:{required:null,pattern:"^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$"},required:!0,errorMessages:{emailTaken:"error.validation.emailTaken",pattern:"error.validation.NotValidEmail"},hint:emailHint}),this.canLogIn=new fesm2015_core.dwp({id:"canLogIn",label:canLogIn,name:"canLogIn",value:null==this.epersonInitial||this.epersonInitial.canLogIn}),this.requireCertificate=new fesm2015_core.dwp({id:"requireCertificate",label:requireCertificate,name:"requireCertificate",value:null!=this.epersonInitial&&this.epersonInitial.requireCertificate}),this.formModel=[this.firstName,this.lastName,this.email,this.canLogIn,this.requireCertificate],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.subs.push(this.epersonService.getActiveEPerson().subscribe(eperson=>{null!=eperson&&(this.groups=this.groupsDataService.findListByHref(eperson._links.groups.href,{currentPage:1,elementsPerPage:this.config.pageSize})),this.formGroup.patchValue({firstName:null!=eperson?eperson.firstMetadataValue("eperson.firstname"):"",lastName:null!=eperson?eperson.firstMetadataValue("eperson.lastname"):"",email:null!=eperson?eperson.email:"",canLogIn:null==eperson||eperson.canLogIn,requireCertificate:null!=eperson&&eperson.requireCertificate}),null===eperson&&this.formGroup.controls.email&&(this.formGroup.controls.email.setAsyncValidators(ValidateEmailNotTaken.createValidator(this.epersonService)),this.emailValueChangeSubscribe=this.email.valueChanges.pipe((0,operators.bh)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()}))}));const activeEPerson$=this.epersonService.getActiveEPerson();this.groups=activeEPerson$.pipe((0,operators.wt)(eperson=>(0,cjs.combineLatest)([(0,cjs.of)(eperson),this.paginationService.getFindListOptions(this.config.id,{currentPage:1,elementsPerPage:this.config.pageSize})])),(0,operators.wt)(([eperson,findListOptions])=>null!=eperson?this.groupsDataService.findListByHref(eperson._links.groups.href,findListOptions,!0,!0,(0,follow_link_config_model.l)("object")):(0,cjs.of)(void 0))),this.canImpersonate$=activeEPerson$.pipe((0,operators.wt)(eperson=>(0,empty_util.Uh)(eperson)?this.authorizationService.isAuthorized(feature_id.i.LoginOnBehalfOf,eperson.self):(0,cjs.of)(!1))),this.canDelete$=activeEPerson$.pipe((0,operators.wt)(eperson=>this.authorizationService.isAuthorized(feature_id.i.CanDelete,(0,empty_util.Uh)(eperson)?eperson.self:void 0))),this.canReset$=(0,cjs.of)(!0)})}onCancel(){this.epersonService.cancelEditEPerson(),this.cancelForm.emit()}onSubmit(){this.epersonService.getActiveEPerson().pipe((0,operators.qn)(1)).subscribe(ePerson=>{const values={metadata:{"eperson.firstname":[{value:this.firstName.value}],"eperson.lastname":[{value:this.lastName.value}]},email:this.email.value,canLogIn:this.canLogIn.value,requireCertificate:this.requireCertificate.value};null==ePerson?this.createNewEPerson(values):this.editEPerson(ePerson,values)})}createNewEPerson(values){const ePersonToCreate=Object.assign(new eperson_model.T,values);this.epersonService.create(ePersonToCreate).pipe((0,shared_operators.hC)()).subscribe(rd=>{rd.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.created.success",{name:ePersonToCreate.name})),this.submitForm.emit(ePersonToCreate)):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.created.failure",{name:ePersonToCreate.name})),this.cancelForm.emit())}),this.showNotificationIfEmailInUse(ePersonToCreate,"created")}editEPerson(ePerson,values){const editedEperson=Object.assign(new eperson_model.T,{id:ePerson.id,metadata:{"eperson.firstname":[{value:this.firstName.value?this.firstName.value:ePerson.firstMetadataValue("eperson.firstname")}],"eperson.lastname":[{value:this.lastName.value?this.lastName.value:ePerson.firstMetadataValue("eperson.lastname")}]},email:(0,empty_util.Uh)(values.email)?values.email:ePerson.email,canLogIn:(0,empty_util.Uh)(values.canLogIn)?values.canLogIn:ePerson.canLogIn,requireCertificate:(0,empty_util.Uh)(values.requireCertificate)?values.requireCertificate:ePerson.requireCertificate,_links:ePerson._links});this.epersonService.updateEPerson(editedEperson).pipe((0,shared_operators.hC)()).subscribe(rd=>{rd.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.edited.success",{name:editedEperson.name})),this.submitForm.emit(editedEperson)):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.edited.failure",{name:editedEperson.name})),this.cancelForm.emit())}),null!=values.email&&values.email!==ePerson.email&&this.showNotificationIfEmailInUse(editedEperson,"edited")}onPageChange(event){this.updateGroups({currentPage:event,elementsPerPage:this.config.pageSize})}impersonate(){this.authService.impersonate(this.epersonInitial.id),this.isImpersonated=!0}delete(){this.epersonService.getActiveEPerson().pipe((0,operators.qn)(1)).subscribe(eperson=>{const modalRef=this.modalService.open(confirmation_modal_component.Y);modalRef.componentInstance.dso=eperson,modalRef.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",modalRef.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",modalRef.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",modalRef.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",modalRef.componentInstance.brandColor="danger",modalRef.componentInstance.confirmIcon="fas fa-trash",modalRef.componentInstance.response.pipe((0,operators.qn)(1)).subscribe(confirm=>{confirm&&(0,empty_util.Uh)(eperson.id)&&this.epersonService.deleteEPerson(eperson).pipe((0,shared_operators.hC)()).subscribe(restResponse=>{restResponse.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:eperson.name})),this.submitForm.emit()):this.notificationsService.error("Error occured when trying to delete EPerson with id: "+eperson.id+" with code: "+restResponse.statusCode+" and message: "+restResponse.errorMessage),this.cancelForm.emit()})})})}stopImpersonating(){this.authService.stopImpersonatingAndRefresh(),this.isImpersonated=!1}resetPassword(){(0,empty_util.Uh)(this.epersonInitial.email)&&this.epersonRegistrationService.registerEmail(this.epersonInitial.email).pipe((0,shared_operators.hC)()).subscribe(response=>{response.hasSucceeded?this.notificationsService.success(this.translateService.get("admin.access-control.epeople.actions.reset"),this.translateService.get("forgot-email.form.success.content",{email:this.epersonInitial.email})):this.notificationsService.error(this.translateService.get("forgot-email.form.error.head"),this.translateService.get("forgot-email.form.error.content",{email:this.epersonInitial.email}))})}ngOnDestroy(){this.onCancel(),this.subs.filter(sub=>(0,empty_util.Uh)(sub)).forEach(sub=>sub.unsubscribe()),this.paginationService.clearPagination(this.config.id),(0,empty_util.Uh)(this.emailValueChangeSubscribe)&&this.emailValueChangeSubscribe.unsubscribe()}reset(){this.epersonService.getActiveEPerson().pipe((0,operators.qn)(1)).subscribe(eperson=>{this.requestService.removeByHrefSubstring(eperson.self)}),this.initialisePage()}showNotificationIfEmailInUse(ePerson,notificationSection){this.subs.push(this.epersonService.searchByScope("email",ePerson.email,{currentPage:1,elementsPerPage:0}).pipe((0,shared_operators.xw)(),(0,shared_operators.xe)()).subscribe(list=>{list.totalElements>0&&this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification."+notificationSection+".failure.emailInUse",{name:ePerson.name,email:ePerson.email}))}))}updateGroups(options){this.subs.push(this.epersonService.getActiveEPerson().subscribe(eperson=>{this.groups=this.groupsDataService.findListByHref(eperson._links.groups.href,options)}))}}function EPeopleRegistryComponent_div_7_Template(rf,ctx){if(1&rf){const _r4=core.EpF();core.TgZ(0,"div")(1,"button",7),core.NdJ("click",__name(function(){core.CHM(_r4);return core.oxw().isEPersonFormShown=!0},"EPeopleRegistryComponent_div_7_Template_button_click_1_listener")),core._UZ(2,"i",8),core.TgZ(3,"span",9),core._uU(4),core.ALo(5,"translate"),core.qZA()()()}if(2&rf){const ctx_r0=core.oxw();core.xp6(4),core.Oqu(core.lcZ(5,1,ctx_r0.labelPrefix+"button.add"))}}function EPeopleRegistryComponent_ds_eperson_form_8_Template(rf,ctx){if(1&rf){const _r6=core.EpF();core.TgZ(0,"ds-eperson-form",10),core.NdJ("submitForm",__name(function(){return core.CHM(_r6),core.oxw().reset()},"EPeopleRegistryComponent_ds_eperson_form_8_Template_ds_eperson_form_submitForm_0_listener"))("cancelForm",__name(function(){core.CHM(_r6);return core.oxw().isEPersonFormShown=!1},"EPeopleRegistryComponent_ds_eperson_form_8_Template_ds_eperson_form_cancelForm_0_listener")),core.qZA()}}function EPeopleRegistryComponent_div_9_ds_themed_loading_27_Template(rf,ctx){1&rf&&core._UZ(0,"ds-themed-loading")}__name(EPersonFormComponent,"EPersonFormComponent"),EPersonFormComponent.\u0275fac=__name(function(t){return new(t||EPersonFormComponent)(core.Y36(core.sBO),core.Y36(eperson_data_service.k),core.Y36(group_data_service.O),core.Y36(form_builder_service.c),core.Y36(ngx_translate_core.sK),core.Y36(notifications_service.T),core.Y36(auth_service.e8),core.Y36(authorization_data_service._),core.Y36(ng_bootstrap.FF),core.Y36(pagination_service.N),core.Y36(request_service.s),core.Y36(eperson_registration_service.m))},"EPersonFormComponent_Factory"),EPersonFormComponent.\u0275cmp=core.Xpm({type:EPersonFormComponent,selectors:[["ds-eperson-form"]],outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},decls:29,vars:31,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["createHeader",""],["editheader",""],[3,"formId","formModel","formGroup","formLayout","displayCancel","submitForm"],["before","",1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["between","",1,"btn-group"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fa","fa-key"],["between","",1,"btn-group","ml-1"],["class","btn btn-primary",3,"ngClass","click",4,"ngIf"],["class","btn btn-primary",3,"click",4,"ngIf"],["after","",1,"btn","btn-danger","delete-button",3,"disabled","click"],[1,"fas","fa-trash"],[3,"showMessage",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-primary",3,"ngClass","click"],[1,"fa","fa-user-secret"],[1,"btn","btn-primary",3,"click"],[3,"showMessage"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[4,"ngFor","ngForOf"],[1,"align-middle"],[3,"routerLink","click"],["role","alert",1,"alert","alert-info","w-100","mb-2"],[1,"btn","btn-primary",3,"routerLink"]],template:__name(function(rf,ctx){if(1&rf&&(core.YNc(0,EPersonFormComponent_div_0_Template,1,0,"div",0),core.ALo(1,"async"),core.YNc(2,EPersonFormComponent_ng_template_2_Template,3,3,"ng-template",null,1,core.W1O),core.YNc(4,EPersonFormComponent_ng_template_4_Template,3,3,"ng-template",null,2,core.W1O),core.TgZ(6,"ds-form",3),core.NdJ("submitForm",__name(function(){return ctx.onSubmit()},"EPersonFormComponent_Template_ds_form_submitForm_6_listener")),core.TgZ(7,"div",4)(8,"button",5),core.NdJ("click",__name(function(){return ctx.onCancel()},"EPersonFormComponent_Template_button_click_8_listener")),core._UZ(9,"i",6),core._uU(10),core.ALo(11,"translate"),core.qZA()(),core.TgZ(12,"div",7)(13,"button",8),core.NdJ("click",__name(function(){return ctx.resetPassword()},"EPersonFormComponent_Template_button_click_13_listener")),core.ALo(14,"async"),core._UZ(15,"i",9),core._uU(16),core.ALo(17,"translate"),core.qZA()(),core.TgZ(18,"div",10),core.YNc(19,EPersonFormComponent_button_19_Template,5,8,"button",11),core.YNc(20,EPersonFormComponent_button_20_Template,4,3,"button",12),core.qZA(),core.TgZ(21,"button",13),core.NdJ("click",__name(function(){return ctx.delete()},"EPersonFormComponent_Template_button_click_21_listener")),core.ALo(22,"async"),core._UZ(23,"i",14),core._uU(24),core.ALo(25,"translate"),core.qZA()(),core.YNc(26,EPersonFormComponent_ds_themed_loading_26_Template,1,1,"ds-themed-loading",15),core.YNc(27,EPersonFormComponent_div_27_Template,10,12,"div",16),core.ALo(28,"async")),2&rf){const _r1=core.MAs(3),_r3=core.MAs(5);core.Q6J("ngIf",core.lcZ(1,17,ctx.epersonService.getActiveEPerson()))("ngIfThen",_r3)("ngIfElse",_r1),core.xp6(6),core.Q6J("formId",ctx.formId)("formModel",ctx.formModel)("formGroup",ctx.formGroup)("formLayout",ctx.formLayout)("displayCancel",!1),core.xp6(4),core.hij(" ",core.lcZ(11,19,ctx.messagePrefix+".return"),""),core.xp6(3),core.Q6J("disabled",!core.lcZ(14,21,ctx.canReset$)),core.xp6(3),core.hij(" ",core.lcZ(17,23,"admin.access-control.epeople.actions.reset")," "),core.xp6(3),core.Q6J("ngIf",!ctx.isImpersonated),core.xp6(1),core.Q6J("ngIf",ctx.isImpersonated),core.xp6(1),core.Q6J("disabled",!core.lcZ(22,25,ctx.canDelete$)),core.xp6(3),core.hij(" ",core.lcZ(25,27,"admin.access-control.epeople.actions.delete")," "),core.xp6(2),core.Q6J("ngIf",!ctx.formGroup),core.xp6(1),core.Q6J("ngIf",core.lcZ(28,29,ctx.epersonService.getActiveEPerson()))}},"EPersonFormComponent_Template"),directives:[common.O5,form_component.U,fesm2015_forms.JL,fesm2015_forms.sg,common.mk,themed_loading_component.Z,pagination_component.Q,common.sg,router.yS,router.rH],pipes:[common.Ov,ngx_translate_core.X$],encapsulation:2}),__name(EPeopleRegistryComponent_div_7_Template,"EPeopleRegistryComponent_div_7_Template"),__name(EPeopleRegistryComponent_ds_eperson_form_8_Template,"EPeopleRegistryComponent_ds_eperson_form_8_Template"),__name(EPeopleRegistryComponent_div_9_ds_themed_loading_27_Template,"EPeopleRegistryComponent_div_9_ds_themed_loading_27_Template");const epeople_registry_component_c0=__name(function(a0){return{"table-primary":a0}},"epeople_registry_component_c0"),epeople_registry_component_c1=__name(function(a0){return{name:a0}},"epeople_registry_component_c1");function EPeopleRegistryComponent_div_9_ds_pagination_29_tr_19_Template(rf,ctx){if(1&rf){const _r14=core.EpF();core.TgZ(0,"tr",30),core.ALo(1,"async"),core.TgZ(2,"td"),core._uU(3),core.qZA(),core.TgZ(4,"td"),core._uU(5),core.qZA(),core.TgZ(6,"td"),core._uU(7),core.qZA(),core.TgZ(8,"td")(9,"div",31)(10,"button",32),core.NdJ("click",__name(function(){const epersonDto_r12=core.CHM(_r14).$implicit;return core.oxw(3).toggleEditEPerson(epersonDto_r12.eperson)},"EPeopleRegistryComponent_div_9_ds_pagination_29_tr_19_Template_button_click_10_listener")),core.ALo(11,"translate"),core._UZ(12,"i",33),core.qZA(),core.TgZ(13,"button",34),core.NdJ("click",__name(function(){const epersonDto_r12=core.CHM(_r14).$implicit;return core.oxw(3).deleteEPerson(epersonDto_r12.eperson)},"EPeopleRegistryComponent_div_9_ds_pagination_29_tr_19_Template_button_click_13_listener")),core.ALo(14,"translate"),core._UZ(15,"i",35),core.qZA()()()()}if(2&rf){const epersonDto_r12=ctx.$implicit,ctx_r11=core.oxw(3);core.Q6J("ngClass",core.VKq(15,epeople_registry_component_c0,core.lcZ(1,7,ctx_r11.isActive(epersonDto_r12.eperson)))),core.xp6(3),core.Oqu(epersonDto_r12.eperson.id),core.xp6(2),core.Oqu(epersonDto_r12.eperson.name),core.xp6(2),core.Oqu(epersonDto_r12.eperson.email),core.xp6(3),core.s9C("title",core.xi3(11,9,ctx_r11.labelPrefix+"table.edit.buttons.edit",core.VKq(17,epeople_registry_component_c1,epersonDto_r12.eperson.name))),core.xp6(3),core.s9C("title",core.xi3(14,12,ctx_r11.labelPrefix+"table.edit.buttons.remove",core.VKq(19,epeople_registry_component_c1,epersonDto_r12.eperson.name))),core.Q6J("disabled",!epersonDto_r12.ableToDelete)}}function EPeopleRegistryComponent_div_9_ds_pagination_29_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"ds-pagination",25),core.ALo(1,"async"),core.TgZ(2,"div",26)(3,"table",27)(4,"thead")(5,"tr")(6,"th",28),core._uU(7),core.ALo(8,"translate"),core.qZA(),core.TgZ(9,"th",28),core._uU(10),core.ALo(11,"translate"),core.qZA(),core.TgZ(12,"th",28),core._uU(13),core.ALo(14,"translate"),core.qZA(),core.TgZ(15,"th"),core._uU(16),core.ALo(17,"translate"),core.qZA()()(),core.TgZ(18,"tbody"),core.YNc(19,EPeopleRegistryComponent_div_9_ds_pagination_29_tr_19_Template,16,21,"tr",29),core.ALo(20,"async"),core.qZA()()()()),2&rf){const ctx_r9=core.oxw(2);let tmp_2_0,tmp_9_0;core.Q6J("paginationOptions",ctx_r9.config)("pageInfoState",ctx_r9.pageInfoState$)("collectionSize",null==(tmp_2_0=core.lcZ(1,10,ctx_r9.pageInfoState$))?null:tmp_2_0.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),core.xp6(7),core.Oqu(core.lcZ(8,12,ctx_r9.labelPrefix+"table.id")),core.xp6(3),core.Oqu(core.lcZ(11,14,ctx_r9.labelPrefix+"table.name")),core.xp6(3),core.Oqu(core.lcZ(14,16,ctx_r9.labelPrefix+"table.email")),core.xp6(3),core.Oqu(core.lcZ(17,18,ctx_r9.labelPrefix+"table.edit")),core.xp6(3),core.Q6J("ngForOf",null==(tmp_9_0=core.lcZ(20,20,ctx_r9.ePeopleDto$))?null:tmp_9_0.page)}}function EPeopleRegistryComponent_div_9_div_32_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",36),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r10=core.oxw(2);core.xp6(1),core.hij(" ",core.lcZ(2,1,ctx_r10.labelPrefix+"no-items")," ")}}function EPeopleRegistryComponent_div_9_Template(rf,ctx){if(1&rf){const _r17=core.EpF();core.TgZ(0,"div")(1,"h3",11),core._uU(2),core.ALo(3,"translate"),core.qZA(),core.TgZ(4,"form",12),core.NdJ("ngSubmit",__name(function(){core.CHM(_r17);const ctx_r16=core.oxw();return ctx_r16.search(ctx_r16.searchForm.value)},"EPeopleRegistryComponent_div_9_Template_form_ngSubmit_4_listener")),core.TgZ(5,"div")(6,"select",13)(7,"option",14),core._uU(8),core.ALo(9,"translate"),core.qZA(),core.TgZ(10,"option",15),core._uU(11),core.ALo(12,"translate"),core.qZA()()(),core.TgZ(13,"div",16)(14,"div",17),core._UZ(15,"input",18),core.ALo(16,"translate"),core.ALo(17,"translate"),core.TgZ(18,"span",19)(19,"button",20),core._UZ(20,"i",21),core._uU(21),core.ALo(22,"translate"),core.qZA()()()(),core.TgZ(23,"div")(24,"button",22),core.NdJ("click",__name(function(){return core.CHM(_r17),core.oxw().clearFormAndResetResult()},"EPeopleRegistryComponent_div_9_Template_button_click_24_listener")),core._uU(25),core.ALo(26,"translate"),core.qZA()()(),core.YNc(27,EPeopleRegistryComponent_div_9_ds_themed_loading_27_Template,1,0,"ds-themed-loading",5),core.ALo(28,"async"),core.YNc(29,EPeopleRegistryComponent_div_9_ds_pagination_29_Template,21,22,"ds-pagination",23),core.ALo(30,"async"),core.ALo(31,"async"),core.YNc(32,EPeopleRegistryComponent_div_9_div_32_Template,3,3,"div",24),core.ALo(33,"async"),core.qZA()}if(2&rf){const ctx_r2=core.oxw();let tmp_9_0,tmp_10_0;core.xp6(2),core.hij("",core.lcZ(3,11,ctx_r2.labelPrefix+"search.head")," "),core.xp6(2),core.Q6J("formGroup",ctx_r2.searchForm),core.xp6(4),core.Oqu(core.lcZ(9,13,ctx_r2.labelPrefix+"search.scope.metadata")),core.xp6(3),core.Oqu(core.lcZ(12,15,ctx_r2.labelPrefix+"search.scope.email")),core.xp6(4),core.Q6J("placeholder",core.lcZ(17,19,ctx_r2.labelPrefix+"search.placeholder")),core.uIk("aria-label",core.lcZ(16,17,ctx_r2.labelPrefix+"search.placeholder")),core.xp6(6),core.hij(" ",core.lcZ(22,21,ctx_r2.labelPrefix+"search.button")," "),core.xp6(4),core.Oqu(core.lcZ(26,23,ctx_r2.labelPrefix+"button.see-all")),core.xp6(2),core.Q6J("ngIf",core.lcZ(28,25,ctx_r2.searching$)),core.xp6(2),core.Q6J("ngIf",(null==(tmp_9_0=core.lcZ(30,27,ctx_r2.pageInfoState$))?null:tmp_9_0.totalElements)>0&&!core.lcZ(31,29,ctx_r2.searching$)),core.xp6(3),core.Q6J("ngIf",0==(null==(tmp_10_0=core.lcZ(33,31,ctx_r2.pageInfoState$))?null:tmp_10_0.totalElements))}}__name(EPeopleRegistryComponent_div_9_ds_pagination_29_tr_19_Template,"EPeopleRegistryComponent_div_9_ds_pagination_29_tr_19_Template"),__name(EPeopleRegistryComponent_div_9_ds_pagination_29_Template,"EPeopleRegistryComponent_div_9_ds_pagination_29_Template"),__name(EPeopleRegistryComponent_div_9_div_32_Template,"EPeopleRegistryComponent_div_9_div_32_Template"),__name(EPeopleRegistryComponent_div_9_Template,"EPeopleRegistryComponent_div_9_Template");class EPeopleRegistryComponent{constructor(epersonService,translateService,notificationsService,authorizationService,formBuilder,router2,modalService,paginationService,requestService){this.epersonService=epersonService,this.translateService=translateService,this.notificationsService=notificationsService,this.authorizationService=authorizationService,this.formBuilder=formBuilder,this.router=router2,this.modalService=modalService,this.paginationService=paginationService,this.requestService=requestService,this.labelPrefix="admin.access-control.epeople.",this.ePeople$=new cjs.BehaviorSubject((0,paginated_list_model.b)(new page_info_model.S,[])),this.ePeopleDto$=new cjs.BehaviorSubject({}),this.pageInfoState$=new cjs.BehaviorSubject(void 0),this.searching$=new cjs.BehaviorSubject(!1),this.config=Object.assign(new pagination_component_options_model.r,{id:"elp",pageSize:5,currentPage:1}),this.subs=[],this.currentSearchQuery="",this.currentSearchScope="metadata",this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}ngOnInit(){this.initialisePage()}initialisePage(){this.searching$.next(!0),this.isEPersonFormShown=!1,this.search({scope:this.currentSearchScope,query:this.currentSearchQuery}),this.subs.push(this.epersonService.getActiveEPerson().subscribe(eperson=>{null!=eperson&&eperson.id&&(this.isEPersonFormShown=!0)})),this.subs.push(this.ePeople$.pipe((0,operators.wt)(epeople=>epeople.pageInfo.totalElements>0?(0,cjs.combineLatest)(...epeople.page.map(eperson=>this.authorizationService.isAuthorized(feature_id.i.CanDelete,(0,empty_util.Uh)(eperson)?eperson.self:void 0).pipe((0,operators.UI)(authorized=>{const epersonDtoModel=new EpersonDtoModel;return epersonDtoModel.ableToDelete=authorized,epersonDtoModel.eperson=eperson,epersonDtoModel})))).pipe((0,operators.UI)(dtos=>(0,paginated_list_model.b)(epeople.pageInfo,dtos))):[epeople])).subscribe(value=>{this.searching$.next(!1),this.ePeopleDto$.next(value),this.pageInfoState$.next(value.pageInfo)}))}search(data){this.searching$.next(!0),(0,empty_util.Uh)(this.findListOptionsSub)&&this.findListOptionsSub.unsubscribe(),this.findListOptionsSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,operators.wt)(findListOptions=>{const query=data.query,scope=data.scope;return null!=query&&this.currentSearchQuery!==query&&(this.router.navigate([this.epersonService.getEPeoplePageRouterLink()],{queryParamsHandling:"merge"}),this.currentSearchQuery=query,this.paginationService.resetPage(this.config.id)),null!=scope&&this.currentSearchScope!==scope&&(this.router.navigate([this.epersonService.getEPeoplePageRouterLink()],{queryParamsHandling:"merge"}),this.currentSearchScope=scope,this.paginationService.resetPage(this.config.id)),this.epersonService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:findListOptions.currentPage,elementsPerPage:findListOptions.pageSize})}),(0,shared_operators.g1)()).subscribe(peopleRD=>{this.ePeople$.next(peopleRD.payload),this.pageInfoState$.next(peopleRD.payload.pageInfo)})}isActive(eperson){return this.getActiveEPerson().pipe((0,operators.UI)(activeEPerson=>eperson===activeEPerson))}getActiveEPerson(){return this.epersonService.getActiveEPerson()}toggleEditEPerson(ePerson){this.getActiveEPerson().pipe((0,operators.qn)(1)).subscribe(activeEPerson=>{ePerson===activeEPerson?(this.epersonService.cancelEditEPerson(),this.isEPersonFormShown=!1):(this.epersonService.editEPerson(ePerson),this.isEPersonFormShown=!0)}),this.scrollToTop()}deleteEPerson(ePerson){if((0,empty_util.Uh)(ePerson.id)){const modalRef=this.modalService.open(confirmation_modal_component.Y);modalRef.componentInstance.dso=ePerson,modalRef.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",modalRef.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",modalRef.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",modalRef.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",modalRef.componentInstance.brandColor="danger",modalRef.componentInstance.confirmIcon="fas fa-trash",modalRef.componentInstance.response.pipe((0,operators.qn)(1)).subscribe(confirm=>{confirm&&(0,empty_util.Uh)(ePerson.id)&&this.epersonService.deleteEPerson(ePerson).pipe((0,shared_operators.hC)()).subscribe(restResponse=>{restResponse.hasSucceeded?this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:ePerson.name})):this.notificationsService.error("Error occured when trying to delete EPerson with id: "+ePerson.id+" with code: "+restResponse.statusCode+" and message: "+restResponse.errorMessage)})})}}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){this.subs.filter(sub=>(0,empty_util.Uh)(sub)).forEach(sub=>sub.unsubscribe())}scrollToTop(){__name(function smoothscroll(){const currentScroll=document.documentElement.scrollTop||document.body.scrollTop;currentScroll>0&&(window.requestAnimationFrame(smoothscroll),window.scrollTo(0,currentScroll-currentScroll/8))},"smoothscroll")()}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}reset(){this.epersonService.getBrowseEndpoint().pipe((0,operators.qn)(1)).subscribe(href=>{this.requestService.setStaleByHrefSubstring(href).pipe((0,operators.qn)(1)).subscribe(()=>{this.epersonService.cancelEditEPerson(),this.isEPersonFormShown=!1})})}}__name(EPeopleRegistryComponent,"EPeopleRegistryComponent"),EPeopleRegistryComponent.\u0275fac=__name(function(t){return new(t||EPeopleRegistryComponent)(core.Y36(eperson_data_service.k),core.Y36(ngx_translate_core.sK),core.Y36(notifications_service.T),core.Y36(authorization_data_service._),core.Y36(fesm2015_forms.qu),core.Y36(router.F0),core.Y36(ng_bootstrap.FF),core.Y36(pagination_service.N),core.Y36(request_service.s))},"EPeopleRegistryComponent_Factory"),EPeopleRegistryComponent.\u0275cmp=core.Xpm({type:EPeopleRegistryComponent,selectors:[["ds-epeople-registry"]],decls:10,vars:6,consts:[[1,"container"],[1,"epeople-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[4,"ngIf"],[3,"submitForm","cancelForm",4,"ngIf"],[1,"mr-auto","btn","btn-success","addEPerson-button",3,"click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[3,"submitForm","cancelForm"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"search-button","btn","btn-secondary",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epeople",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm","access-control-editEPersonButton",3,"title","click"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-danger","btn-sm","access-control-deleteEPersonButton",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:__name(function(rf,ctx){1&rf&&(core.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),core._uU(5),core.ALo(6,"translate"),core.qZA(),core.YNc(7,EPeopleRegistryComponent_div_7_Template,6,3,"div",5),core.qZA(),core.YNc(8,EPeopleRegistryComponent_ds_eperson_form_8_Template,1,0,"ds-eperson-form",6),core.YNc(9,EPeopleRegistryComponent_div_9_Template,34,33,"div",5),core.qZA()()()),2&rf&&(core.xp6(5),core.Oqu(core.lcZ(6,4,ctx.labelPrefix+"head")),core.xp6(2),core.Q6J("ngIf",!ctx.isEPersonFormShown),core.xp6(1),core.Q6J("ngIf",ctx.isEPersonFormShown),core.xp6(1),core.Q6J("ngIf",!ctx.isEPersonFormShown))},"EPeopleRegistryComponent_Template"),directives:[common.O5,EPersonFormComponent,fesm2015_forms._Y,fesm2015_forms.JL,fesm2015_forms.sg,fesm2015_forms.EJ,fesm2015_forms.JJ,fesm2015_forms.u,fesm2015_forms.YN,fesm2015_forms.Kr,fesm2015_forms.Fj,themed_loading_component.Z,pagination_component.Q,common.sg,common.mk],pipes:[ngx_translate_core.X$,common.Ov],encapsulation:2});var collection_page_routing_paths=__webpack_require__(10954),community_page_routing_paths=__webpack_require__(18595),dspace_object_data_service=__webpack_require__(51163),group_model=__webpack_require__(15010),collection_model=__webpack_require__(34269),community_model=__webpack_require__(70920),aletr_type=__webpack_require__(338);class ValidateGroupExists{static createValidator(groupDataService){return control=>groupDataService.searchGroups(control.value,{currentPage:1,elementsPerPage:100}).pipe((0,shared_operators.LQ)(),(0,operators.UI)(groups=>groups.filter(group=>group.name===control.value)),(0,operators.UI)(groups=>groups.length>0?{groupExists:!0}:null))}}__name(ValidateGroupExists,"ValidateGroupExists");var alert_component=__webpack_require__(7519);const members_list_component_c0=__name(function(a0){return{name:a0}},"members_list_component_c0");function MembersListComponent_ds_pagination_28_tr_20_button_14_Template(rf,ctx){if(1&rf){const _r10=core.EpF();core.TgZ(0,"button",25),core.NdJ("click",__name(function(){core.CHM(_r10);const ePerson_r5=core.oxw().$implicit;return core.oxw(2).deleteMemberFromGroup(ePerson_r5)},"MembersListComponent_ds_pagination_28_tr_20_button_14_Template_button_click_0_listener")),core.ALo(1,"translate"),core._UZ(2,"i",26),core.qZA()}if(2&rf){const ePerson_r5=core.oxw().$implicit,ctx_r6=core.oxw(2);core.s9C("title",core.xi3(1,1,ctx_r6.messagePrefix+".table.edit.buttons.remove",core.VKq(4,members_list_component_c0,ePerson_r5.eperson.name)))}}function MembersListComponent_ds_pagination_28_tr_20_button_15_Template(rf,ctx){if(1&rf){const _r14=core.EpF();core.TgZ(0,"button",27),core.NdJ("click",__name(function(){core.CHM(_r14);const ePerson_r5=core.oxw().$implicit;return core.oxw(2).addMemberToGroup(ePerson_r5)},"MembersListComponent_ds_pagination_28_tr_20_button_15_Template_button_click_0_listener")),core.ALo(1,"translate"),core._UZ(2,"i",28),core.qZA()}if(2&rf){const ePerson_r5=core.oxw().$implicit,ctx_r7=core.oxw(2);core.s9C("title",core.xi3(1,1,ctx_r7.messagePrefix+".table.edit.buttons.add",core.VKq(4,members_list_component_c0,ePerson_r5.eperson.name)))}}__name(MembersListComponent_ds_pagination_28_tr_20_button_14_Template,"MembersListComponent_ds_pagination_28_tr_20_button_14_Template"),__name(MembersListComponent_ds_pagination_28_tr_20_button_15_Template,"MembersListComponent_ds_pagination_28_tr_20_button_15_Template");const members_list_component_c1=__name(function(a0){return[a0]},"members_list_component_c1");function MembersListComponent_ds_pagination_28_tr_20_Template(rf,ctx){if(1&rf){const _r17=core.EpF();core.TgZ(0,"tr")(1,"td",19),core._uU(2),core.qZA(),core.TgZ(3,"td",19)(4,"a",21),core.NdJ("click",__name(function(){const ePerson_r5=core.CHM(_r17).$implicit;return core.oxw(2).ePersonDataService.startEditingNewEPerson(ePerson_r5.eperson)},"MembersListComponent_ds_pagination_28_tr_20_Template_a_click_4_listener")),core._uU(5),core.qZA()(),core.TgZ(6,"td",19),core._uU(7),core.ALo(8,"translate"),core._UZ(9,"br"),core._uU(10),core.ALo(11,"translate"),core.qZA(),core.TgZ(12,"td",19)(13,"div",22),core.YNc(14,MembersListComponent_ds_pagination_28_tr_20_button_14_Template,3,6,"button",23),core.YNc(15,MembersListComponent_ds_pagination_28_tr_20_button_15_Template,3,6,"button",24),core.qZA()()()}if(2&rf){const ePerson_r5=ctx.$implicit,ctx_r4=core.oxw(2);core.xp6(2),core.Oqu(ePerson_r5.eperson.id),core.xp6(2),core.Q6J("routerLink",core.VKq(13,members_list_component_c1,ctx_r4.ePersonDataService.getEPeoplePageRouterLink())),core.xp6(1),core.Oqu(ePerson_r5.eperson.name),core.xp6(2),core.AsE(" ",core.lcZ(8,9,ctx_r4.messagePrefix+".table.email"),": ",ePerson_r5.eperson.email?ePerson_r5.eperson.email:"-",""),core.xp6(3),core.AsE(" ",core.lcZ(11,11,ctx_r4.messagePrefix+".table.netid"),": ",ePerson_r5.eperson.netid?ePerson_r5.eperson.netid:"-"," "),core.xp6(4),core.Q6J("ngIf",ePerson_r5.memberOfGroup),core.xp6(1),core.Q6J("ngIf",!ePerson_r5.memberOfGroup)}}function MembersListComponent_ds_pagination_28_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"ds-pagination",15),core.ALo(1,"async"),core.ALo(2,"async"),core.TgZ(3,"div",16)(4,"table",17)(5,"thead")(6,"tr")(7,"th",18),core._uU(8),core.ALo(9,"translate"),core.qZA(),core.TgZ(10,"th",18),core._uU(11),core.ALo(12,"translate"),core.qZA(),core.TgZ(13,"th",18),core._uU(14),core.ALo(15,"translate"),core.qZA(),core.TgZ(16,"th",19),core._uU(17),core.ALo(18,"translate"),core.qZA()()(),core.TgZ(19,"tbody"),core.YNc(20,MembersListComponent_ds_pagination_28_tr_20_Template,16,15,"tr",20),core.ALo(21,"async"),core.qZA()()()()),2&rf){const ctx_r0=core.oxw();let tmp_2_0,tmp_9_0;core.Q6J("paginationOptions",ctx_r0.configSearch)("pageInfoState",core.lcZ(1,10,ctx_r0.ePeopleSearchDtos))("collectionSize",null==(tmp_2_0=core.lcZ(2,12,ctx_r0.ePeopleSearchDtos))?null:tmp_2_0.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),core.xp6(8),core.Oqu(core.lcZ(9,14,ctx_r0.messagePrefix+".table.id")),core.xp6(3),core.Oqu(core.lcZ(12,16,ctx_r0.messagePrefix+".table.name")),core.xp6(3),core.Oqu(core.lcZ(15,18,ctx_r0.messagePrefix+".table.identity")),core.xp6(3),core.Oqu(core.lcZ(18,20,ctx_r0.messagePrefix+".table.edit")),core.xp6(3),core.Q6J("ngForOf",null==(tmp_9_0=core.lcZ(21,22,ctx_r0.ePeopleSearchDtos))?null:tmp_9_0.page)}}function MembersListComponent_div_30_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",29),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r1=core.oxw();core.xp6(1),core.hij(" ",core.lcZ(2,1,ctx_r1.messagePrefix+".no-items")," ")}}function MembersListComponent_ds_pagination_35_tr_20_Template(rf,ctx){if(1&rf){const _r21=core.EpF();core.TgZ(0,"tr")(1,"td",19),core._uU(2),core.qZA(),core.TgZ(3,"td",19)(4,"a",21),core.NdJ("click",__name(function(){const ePerson_r19=core.CHM(_r21).$implicit;return core.oxw(2).ePersonDataService.startEditingNewEPerson(ePerson_r19.eperson)},"MembersListComponent_ds_pagination_35_tr_20_Template_a_click_4_listener")),core._uU(5),core.qZA()(),core.TgZ(6,"td",19),core._uU(7),core.ALo(8,"translate"),core._UZ(9,"br"),core._uU(10),core.ALo(11,"translate"),core.qZA(),core.TgZ(12,"td",19)(13,"div",22)(14,"button",25),core.NdJ("click",__name(function(){const ePerson_r19=core.CHM(_r21).$implicit;return core.oxw(2).deleteMemberFromGroup(ePerson_r19)},"MembersListComponent_ds_pagination_35_tr_20_Template_button_click_14_listener")),core.ALo(15,"translate"),core._UZ(16,"i",26),core.qZA()()()()}if(2&rf){const ePerson_r19=ctx.$implicit,ctx_r18=core.oxw(2);core.xp6(2),core.Oqu(ePerson_r19.eperson.id),core.xp6(2),core.Q6J("routerLink",core.VKq(15,members_list_component_c1,ctx_r18.ePersonDataService.getEPeoplePageRouterLink())),core.xp6(1),core.Oqu(ePerson_r19.eperson.name),core.xp6(2),core.AsE(" ",core.lcZ(8,8,ctx_r18.messagePrefix+".table.email"),": ",ePerson_r19.eperson.email?ePerson_r19.eperson.email:"-",""),core.xp6(3),core.AsE(" ",core.lcZ(11,10,ctx_r18.messagePrefix+".table.netid"),": ",ePerson_r19.eperson.netid?ePerson_r19.eperson.netid:"-"," "),core.xp6(4),core.s9C("title",core.xi3(15,12,ctx_r18.messagePrefix+".table.edit.buttons.remove",core.VKq(17,members_list_component_c0,ePerson_r19.eperson.name)))}}function MembersListComponent_ds_pagination_35_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"ds-pagination",15),core.ALo(1,"async"),core.ALo(2,"async"),core.TgZ(3,"div",16)(4,"table",30)(5,"thead")(6,"tr")(7,"th",18),core._uU(8),core.ALo(9,"translate"),core.qZA(),core.TgZ(10,"th",18),core._uU(11),core.ALo(12,"translate"),core.qZA(),core.TgZ(13,"th",18),core._uU(14),core.ALo(15,"translate"),core.qZA(),core.TgZ(16,"th",19),core._uU(17),core.ALo(18,"translate"),core.qZA()()(),core.TgZ(19,"tbody"),core.YNc(20,MembersListComponent_ds_pagination_35_tr_20_Template,17,19,"tr",20),core.ALo(21,"async"),core.qZA()()()()),2&rf){const ctx_r2=core.oxw();let tmp_2_0,tmp_9_0;core.Q6J("paginationOptions",ctx_r2.config)("pageInfoState",core.lcZ(1,10,ctx_r2.ePeopleMembersOfGroupDtos))("collectionSize",null==(tmp_2_0=core.lcZ(2,12,ctx_r2.ePeopleMembersOfGroupDtos))?null:tmp_2_0.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),core.xp6(8),core.Oqu(core.lcZ(9,14,ctx_r2.messagePrefix+".table.id")),core.xp6(3),core.Oqu(core.lcZ(12,16,ctx_r2.messagePrefix+".table.name")),core.xp6(3),core.Oqu(core.lcZ(15,18,ctx_r2.messagePrefix+".table.identity")),core.xp6(3),core.Oqu(core.lcZ(18,20,ctx_r2.messagePrefix+".table.edit")),core.xp6(3),core.Q6J("ngForOf",null==(tmp_9_0=core.lcZ(21,22,ctx_r2.ePeopleMembersOfGroupDtos))?null:tmp_9_0.page)}}function MembersListComponent_div_37_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",29),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r3=core.oxw();core.xp6(1),core.hij(" ",core.lcZ(2,1,ctx_r3.messagePrefix+".no-members-yet")," ")}}var SubKey,SubKey2;__name(MembersListComponent_ds_pagination_28_tr_20_Template,"MembersListComponent_ds_pagination_28_tr_20_Template"),__name(MembersListComponent_ds_pagination_28_Template,"MembersListComponent_ds_pagination_28_Template"),__name(MembersListComponent_div_30_Template,"MembersListComponent_div_30_Template"),__name(MembersListComponent_ds_pagination_35_tr_20_Template,"MembersListComponent_ds_pagination_35_tr_20_Template"),__name(MembersListComponent_ds_pagination_35_Template,"MembersListComponent_ds_pagination_35_Template"),__name(MembersListComponent_div_37_Template,"MembersListComponent_div_37_Template"),(SubKey2=SubKey||(SubKey={}))[SubKey2.ActiveGroup=0]="ActiveGroup",SubKey2[SubKey2.MembersDTO=1]="MembersDTO",SubKey2[SubKey2.SearchResultsDTO=2]="SearchResultsDTO";class MembersListComponent{constructor(groupDataService,ePersonDataService,translateService,notificationsService,formBuilder,paginationService,router2){this.groupDataService=groupDataService,this.ePersonDataService=ePersonDataService,this.translateService=translateService,this.notificationsService=notificationsService,this.formBuilder=formBuilder,this.paginationService=paginationService,this.router=router2,this.ePeopleSearchDtos=new cjs.BehaviorSubject(void 0),this.ePeopleMembersOfGroupDtos=new cjs.BehaviorSubject(void 0),this.configSearch=Object.assign(new pagination_component_options_model.r,{id:"sml",pageSize:5,currentPage:1}),this.config=Object.assign(new pagination_component_options_model.r,{id:"ml",pageSize:5,currentPage:1}),this.subs=new Map,this.currentSearchQuery="",this.currentSearchScope="metadata"}ngOnInit(){this.searchForm=this.formBuilder.group({scope:"metadata",query:""}),this.subs.set(SubKey.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(activeGroup=>{null!=activeGroup&&(this.groupBeingEdited=activeGroup,this.retrieveMembers(this.config.currentPage))}))}retrieveMembers(page){this.unsubFrom(SubKey.MembersDTO),this.subs.set(SubKey.MembersDTO,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,operators.wt)(currentPagination=>this.ePersonDataService.findListByHref(this.groupBeingEdited._links.epersons.href,{currentPage:currentPagination.currentPage,elementsPerPage:currentPagination.pageSize})),(0,shared_operators.f1)(),(0,operators.UI)(rd=>{if(!rd.hasFailed)return rd;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:rd.errorMessage}))}),(0,operators.wt)(epersonListRD=>(0,cjs.combineLatest)([...epersonListRD.payload.page.map(member=>(0,cjs.combineLatest)(this.isMemberOfGroup(member),isMember=>{const epersonDtoModel=new EpersonDtoModel;return epersonDtoModel.eperson=member,epersonDtoModel.memberOfGroup=isMember,epersonDtoModel}))]).pipe((0,operators.dL)([]),(0,operators.UI)(dtos=>(0,paginated_list_model.b)(epersonListRD.payload.pageInfo,dtos))))).subscribe(paginatedListOfDTOs=>{this.ePeopleMembersOfGroupDtos.next(paginatedListOfDTOs)}))}isMemberOfGroup(possibleMember){return this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1),(0,operators.zg)(group=>null!=group?this.ePersonDataService.findListByHref(group._links.epersons.href,{currentPage:1,elementsPerPage:9999}).pipe((0,shared_operators.xw)(),(0,shared_operators.xe)(),(0,operators.UI)(listEPeopleInGroup=>listEPeopleInGroup.page.filter(ePersonInList=>ePersonInList.id===possibleMember.id)),(0,operators.UI)(epeople=>epeople.length>0)):(0,cjs.of)(!1)))}unsubFrom(key){this.subs.has(key)&&(this.subs.get(key).unsubscribe(),this.subs.delete(key))}deleteMemberFromGroup(ePerson){this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1)).subscribe(activeGroup=>{if(null!=activeGroup){const response=this.groupDataService.deleteMemberFromGroup(activeGroup,ePerson.eperson);this.showNotifications("deleteMember",response,ePerson.eperson.name,activeGroup)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addMemberToGroup(ePerson){ePerson.memberOfGroup=!0,this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1)).subscribe(activeGroup=>{if(null!=activeGroup){const response=this.groupDataService.addMemberToGroup(activeGroup,ePerson.eperson);this.showNotifications("addMember",response,ePerson.eperson.name,activeGroup)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(data){this.unsubFrom(SubKey.SearchResultsDTO),this.subs.set(SubKey.SearchResultsDTO,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,operators.wt)(paginationOptions=>{const query=data.query,scope=data.scope;return null!=query&&this.currentSearchQuery!==query&&this.groupBeingEdited&&(this.router.navigate([],{queryParamsHandling:"merge"}),this.currentSearchQuery=query,this.paginationService.resetPage(this.configSearch.id)),null!=scope&&this.currentSearchScope!==scope&&this.groupBeingEdited&&(this.router.navigate([],{queryParamsHandling:"merge"}),this.currentSearchScope=scope,this.paginationService.resetPage(this.configSearch.id)),this.searchDone=!0,this.ePersonDataService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:paginationOptions.currentPage,elementsPerPage:paginationOptions.pageSize})}),(0,shared_operators.f1)(),(0,operators.UI)(rd=>{if(!rd.hasFailed)return rd;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:rd.errorMessage}))}),(0,operators.wt)(epersonListRD=>(0,cjs.combineLatest)([...epersonListRD.payload.page.map(member=>(0,cjs.combineLatest)(this.isMemberOfGroup(member),isMember=>{const epersonDtoModel=new EpersonDtoModel;return epersonDtoModel.eperson=member,epersonDtoModel.memberOfGroup=isMember,epersonDtoModel}))]).pipe((0,operators.dL)([]),(0,operators.UI)(dtos=>(0,paginated_list_model.b)(epersonListRD.payload.pageInfo,dtos))))).subscribe(paginatedListOfDTOs=>{this.ePeopleSearchDtos.next(paginatedListOfDTOs)}))}ngOnDestroy(){for(const key of this.subs.keys())this.unsubFrom(key);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(messageSuffix,response,nameObject,activeGroup){response.pipe((0,shared_operators.hC)()).subscribe(rd=>{rd.hasSucceeded?this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+messageSuffix,{name:nameObject})):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+messageSuffix,{name:nameObject}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}}__name(MembersListComponent,"MembersListComponent"),MembersListComponent.\u0275fac=__name(function(t){return new(t||MembersListComponent)(core.Y36(group_data_service.O),core.Y36(eperson_data_service.k),core.Y36(ngx_translate_core.sK),core.Y36(notifications_service.T),core.Y36(fesm2015_forms.qu),core.Y36(pagination_service.N),core.Y36(router.F0))},"MembersListComponent_Factory"),MembersListComponent.\u0275cmp=core.Xpm({type:MembersListComponent,selectors:[["ds-members-list"]],inputs:{messagePrefix:"messagePrefix"},decls:40,vars:36,consts:[[1,"border-bottom","pb-2"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epersonsSearch",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[1,"align-middle"],[4,"ngFor","ngForOf"],[3,"routerLink","click"],[1,"btn-group","edit-field"],["class","btn btn-outline-danger btn-sm",3,"title","click",4,"ngIf"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm",3,"title","click"],[1,"fas","fa-plus","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","ePeopleMembersOfGroup",1,"table","table-striped","table-hover","table-bordered"]],template:__name(function(rf,ctx){if(1&rf&&(core.ynx(0),core.TgZ(1,"h3",0),core._uU(2),core.ALo(3,"translate"),core.qZA(),core.TgZ(4,"h4",1),core._uU(5),core.ALo(6,"translate"),core.qZA(),core.TgZ(7,"form",2),core.NdJ("ngSubmit",__name(function(){return ctx.search(ctx.searchForm.value)},"MembersListComponent_Template_form_ngSubmit_7_listener")),core.TgZ(8,"div")(9,"select",3)(10,"option",4),core._uU(11),core.ALo(12,"translate"),core.qZA(),core.TgZ(13,"option",5),core._uU(14),core.ALo(15,"translate"),core.qZA()()(),core.TgZ(16,"div",6)(17,"div",7),core._UZ(18,"input",8),core.TgZ(19,"span",9)(20,"button",10),core._UZ(21,"i",11),core._uU(22),core.ALo(23,"translate"),core.qZA()()()(),core.TgZ(24,"div")(25,"button",12),core.NdJ("click",__name(function(){return ctx.clearFormAndResetResult()},"MembersListComponent_Template_button_click_25_listener")),core._uU(26),core.ALo(27,"translate"),core.qZA()()(),core.YNc(28,MembersListComponent_ds_pagination_28_Template,22,24,"ds-pagination",13),core.ALo(29,"async"),core.YNc(30,MembersListComponent_div_30_Template,3,3,"div",14),core.ALo(31,"async"),core.TgZ(32,"h4"),core._uU(33),core.ALo(34,"translate"),core.qZA(),core.YNc(35,MembersListComponent_ds_pagination_35_Template,22,24,"ds-pagination",13),core.ALo(36,"async"),core.YNc(37,MembersListComponent_div_37_Template,3,3,"div",14),core.ALo(38,"async"),core.ALo(39,"async"),core.BQk()),2&rf){let tmp_7_0,tmp_8_0,tmp_10_0,tmp_11_0;core.xp6(2),core.Oqu(core.lcZ(3,12,ctx.messagePrefix+".head")),core.xp6(3),core.hij("",core.lcZ(6,14,ctx.messagePrefix+".search.head")," "),core.xp6(2),core.Q6J("formGroup",ctx.searchForm),core.xp6(4),core.Oqu(core.lcZ(12,16,ctx.messagePrefix+".search.scope.metadata")),core.xp6(3),core.Oqu(core.lcZ(15,18,ctx.messagePrefix+".search.scope.email")),core.xp6(8),core.hij(" ",core.lcZ(23,20,ctx.messagePrefix+".search.button"),""),core.xp6(4),core.Oqu(core.lcZ(27,22,ctx.messagePrefix+".button.see-all")),core.xp6(2),core.Q6J("ngIf",(null==(tmp_7_0=core.lcZ(29,24,ctx.ePeopleSearchDtos))?null:tmp_7_0.totalElements)>0),core.xp6(2),core.Q6J("ngIf",0==(null==(tmp_8_0=core.lcZ(31,26,ctx.ePeopleSearchDtos))?null:tmp_8_0.totalElements)&&ctx.searchDone),core.xp6(3),core.Oqu(core.lcZ(34,28,ctx.messagePrefix+".headMembers")),core.xp6(2),core.Q6J("ngIf",(null==(tmp_10_0=core.lcZ(36,30,ctx.ePeopleMembersOfGroupDtos))?null:tmp_10_0.totalElements)>0),core.xp6(2),core.Q6J("ngIf",null==core.lcZ(38,32,ctx.ePeopleMembersOfGroupDtos)||0==(null==(tmp_11_0=core.lcZ(39,34,ctx.ePeopleMembersOfGroupDtos))?null:tmp_11_0.totalElements))}},"MembersListComponent_Template"),directives:[fesm2015_forms._Y,fesm2015_forms.JL,fesm2015_forms.sg,fesm2015_forms.EJ,fesm2015_forms.JJ,fesm2015_forms.u,fesm2015_forms.YN,fesm2015_forms.Kr,fesm2015_forms.Fj,common.O5,pagination_component.Q,common.sg,router.yS],pipes:[ngx_translate_core.X$,common.Ov],encapsulation:2});const subgroups_list_component_c0=__name(function(a0){return{name:a0}},"subgroups_list_component_c0");function SubgroupsListComponent_ds_pagination_20_tr_20_button_11_Template(rf,ctx){if(1&rf){const _r11=core.EpF();core.TgZ(0,"button",23),core.NdJ("click",__name(function(){core.CHM(_r11);const group_r5=core.oxw().$implicit;return core.oxw(2).deleteSubgroupFromGroup(group_r5)},"SubgroupsListComponent_ds_pagination_20_tr_20_button_11_Template_button_click_0_listener")),core.ALo(1,"translate"),core._UZ(2,"i",24),core.qZA()}if(2&rf){const group_r5=core.oxw().$implicit,ctx_r6=core.oxw(2);core.s9C("title",core.xi3(1,1,ctx_r6.messagePrefix+".table.edit.buttons.remove",core.VKq(4,subgroups_list_component_c0,group_r5.name)))}}function SubgroupsListComponent_ds_pagination_20_tr_20_p_14_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"p"),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r7=core.oxw(3);core.xp6(1),core.Oqu(core.lcZ(2,1,ctx_r7.messagePrefix+".table.edit.currentGroup"))}}function SubgroupsListComponent_ds_pagination_20_tr_20_button_16_Template(rf,ctx){if(1&rf){const _r15=core.EpF();core.TgZ(0,"button",25),core.NdJ("click",__name(function(){core.CHM(_r15);const group_r5=core.oxw().$implicit;return core.oxw(2).addSubgroupToGroup(group_r5)},"SubgroupsListComponent_ds_pagination_20_tr_20_button_16_Template_button_click_0_listener")),core.ALo(1,"translate"),core._UZ(2,"i",26),core.qZA()}if(2&rf){const group_r5=core.oxw().$implicit,ctx_r8=core.oxw(2);core.s9C("title",core.xi3(1,1,ctx_r8.messagePrefix+".table.edit.buttons.add",core.VKq(4,subgroups_list_component_c0,group_r5.name)))}}__name(SubgroupsListComponent_ds_pagination_20_tr_20_button_11_Template,"SubgroupsListComponent_ds_pagination_20_tr_20_button_11_Template"),__name(SubgroupsListComponent_ds_pagination_20_tr_20_p_14_Template,"SubgroupsListComponent_ds_pagination_20_tr_20_p_14_Template"),__name(SubgroupsListComponent_ds_pagination_20_tr_20_button_16_Template,"SubgroupsListComponent_ds_pagination_20_tr_20_button_16_Template");const subgroups_list_component_c1=__name(function(a0){return[a0]},"subgroups_list_component_c1");function SubgroupsListComponent_ds_pagination_20_tr_20_Template(rf,ctx){if(1&rf){const _r18=core.EpF();core.TgZ(0,"tr")(1,"td",16),core._uU(2),core.qZA(),core.TgZ(3,"td",16)(4,"a",18),core.NdJ("click",__name(function(){const group_r5=core.CHM(_r18).$implicit;return core.oxw(2).groupDataService.startEditingNewGroup(group_r5)},"SubgroupsListComponent_ds_pagination_20_tr_20_Template_a_click_4_listener")),core._uU(5),core.qZA()(),core.TgZ(6,"td",16),core._uU(7),core.ALo(8,"async"),core.qZA(),core.TgZ(9,"td",16)(10,"div",19),core.YNc(11,SubgroupsListComponent_ds_pagination_20_tr_20_button_11_Template,3,6,"button",20),core.ALo(12,"async"),core.ALo(13,"async"),core.YNc(14,SubgroupsListComponent_ds_pagination_20_tr_20_p_14_Template,3,3,"p",21),core.ALo(15,"async"),core.YNc(16,SubgroupsListComponent_ds_pagination_20_tr_20_button_16_Template,3,6,"button",22),core.ALo(17,"async"),core.ALo(18,"async"),core.qZA()()()}if(2&rf){const group_r5=ctx.$implicit,ctx_r4=core.oxw(2);let tmp_3_0;core.xp6(2),core.Oqu(group_r5.id),core.xp6(2),core.Q6J("routerLink",core.VKq(19,subgroups_list_component_c1,ctx_r4.groupDataService.getGroupEditPageRouterLink(group_r5))),core.xp6(1),core.Oqu(group_r5.name),core.xp6(2),core.Oqu(null==(tmp_3_0=core.lcZ(8,7,group_r5.object))||null==tmp_3_0.payload?null:tmp_3_0.payload.name),core.xp6(4),core.Q6J("ngIf",core.lcZ(12,9,ctx_r4.isSubgroupOfGroup(group_r5))&&!core.lcZ(13,11,ctx_r4.isActiveGroup(group_r5))),core.xp6(3),core.Q6J("ngIf",core.lcZ(15,13,ctx_r4.isActiveGroup(group_r5))),core.xp6(2),core.Q6J("ngIf",!core.lcZ(17,15,ctx_r4.isSubgroupOfGroup(group_r5))&&!core.lcZ(18,17,ctx_r4.isActiveGroup(group_r5)))}}function SubgroupsListComponent_ds_pagination_20_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"ds-pagination",12),core.ALo(1,"async"),core.ALo(2,"async"),core.TgZ(3,"div",13)(4,"table",14)(5,"thead")(6,"tr")(7,"th",15),core._uU(8),core.ALo(9,"translate"),core.qZA(),core.TgZ(10,"th",15),core._uU(11),core.ALo(12,"translate"),core.qZA(),core.TgZ(13,"th",15),core._uU(14),core.ALo(15,"translate"),core.qZA(),core.TgZ(16,"th",16),core._uU(17),core.ALo(18,"translate"),core.qZA()()(),core.TgZ(19,"tbody"),core.YNc(20,SubgroupsListComponent_ds_pagination_20_tr_20_Template,19,21,"tr",17),core.ALo(21,"async"),core.qZA()()()()),2&rf){const ctx_r0=core.oxw();let tmp_1_0,tmp_2_0,tmp_9_0;core.Q6J("paginationOptions",ctx_r0.configSearch)("pageInfoState",null==(tmp_1_0=core.lcZ(1,10,ctx_r0.searchResults$))?null:tmp_1_0.payload)("collectionSize",null==(tmp_2_0=core.lcZ(2,12,ctx_r0.searchResults$))||null==tmp_2_0.payload?null:tmp_2_0.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),core.xp6(8),core.Oqu(core.lcZ(9,14,ctx_r0.messagePrefix+".table.id")),core.xp6(3),core.Oqu(core.lcZ(12,16,ctx_r0.messagePrefix+".table.name")),core.xp6(3),core.Oqu(core.lcZ(15,18,ctx_r0.messagePrefix+".table.collectionOrCommunity")),core.xp6(3),core.Oqu(core.lcZ(18,20,ctx_r0.messagePrefix+".table.edit")),core.xp6(3),core.Q6J("ngForOf",null==(tmp_9_0=core.lcZ(21,22,ctx_r0.searchResults$))||null==tmp_9_0.payload?null:tmp_9_0.payload.page)}}function SubgroupsListComponent_div_22_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",27),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r1=core.oxw();core.xp6(1),core.hij(" ",core.lcZ(2,1,ctx_r1.messagePrefix+".no-items")," ")}}function SubgroupsListComponent_ds_pagination_27_tr_20_Template(rf,ctx){if(1&rf){const _r22=core.EpF();core.TgZ(0,"tr")(1,"td",16),core._uU(2),core.qZA(),core.TgZ(3,"td",16)(4,"a",18),core.NdJ("click",__name(function(){const group_r20=core.CHM(_r22).$implicit;return core.oxw(2).groupDataService.startEditingNewGroup(group_r20)},"SubgroupsListComponent_ds_pagination_27_tr_20_Template_a_click_4_listener")),core._uU(5),core.qZA()(),core.TgZ(6,"td",16),core._uU(7),core.ALo(8,"async"),core.qZA(),core.TgZ(9,"td",16)(10,"div",19)(11,"button",23),core.NdJ("click",__name(function(){const group_r20=core.CHM(_r22).$implicit;return core.oxw(2).deleteSubgroupFromGroup(group_r20)},"SubgroupsListComponent_ds_pagination_27_tr_20_Template_button_click_11_listener")),core.ALo(12,"translate"),core._UZ(13,"i",24),core.qZA()()()()}if(2&rf){const group_r20=ctx.$implicit,ctx_r19=core.oxw(2);let tmp_3_0;core.xp6(2),core.Oqu(group_r20.id),core.xp6(2),core.Q6J("routerLink",core.VKq(10,subgroups_list_component_c1,ctx_r19.groupDataService.getGroupEditPageRouterLink(group_r20))),core.xp6(1),core.Oqu(group_r20.name),core.xp6(2),core.Oqu(null==(tmp_3_0=core.lcZ(8,5,group_r20.object))||null==tmp_3_0.payload?null:tmp_3_0.payload.name),core.xp6(4),core.s9C("title",core.xi3(12,7,ctx_r19.messagePrefix+".table.edit.buttons.remove",core.VKq(12,subgroups_list_component_c0,group_r20.name)))}}function SubgroupsListComponent_ds_pagination_27_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"ds-pagination",12),core.ALo(1,"async"),core.ALo(2,"async"),core.TgZ(3,"div",13)(4,"table",28)(5,"thead")(6,"tr")(7,"th",15),core._uU(8),core.ALo(9,"translate"),core.qZA(),core.TgZ(10,"th",15),core._uU(11),core.ALo(12,"translate"),core.qZA(),core.TgZ(13,"th",15),core._uU(14),core.ALo(15,"translate"),core.qZA(),core.TgZ(16,"th"),core._uU(17),core.ALo(18,"translate"),core.qZA()()(),core.TgZ(19,"tbody"),core.YNc(20,SubgroupsListComponent_ds_pagination_27_tr_20_Template,14,14,"tr",17),core.ALo(21,"async"),core.qZA()()()()),2&rf){const ctx_r2=core.oxw();let tmp_1_0,tmp_2_0,tmp_9_0;core.Q6J("paginationOptions",ctx_r2.config)("pageInfoState",null==(tmp_1_0=core.lcZ(1,10,ctx_r2.subGroups$))?null:tmp_1_0.payload)("collectionSize",null==(tmp_2_0=core.lcZ(2,12,ctx_r2.subGroups$))||null==tmp_2_0.payload?null:tmp_2_0.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),core.xp6(8),core.Oqu(core.lcZ(9,14,ctx_r2.messagePrefix+".table.id")),core.xp6(3),core.Oqu(core.lcZ(12,16,ctx_r2.messagePrefix+".table.name")),core.xp6(3),core.Oqu(core.lcZ(15,18,ctx_r2.messagePrefix+".table.collectionOrCommunity")),core.xp6(3),core.Oqu(core.lcZ(18,20,ctx_r2.messagePrefix+".table.edit")),core.xp6(3),core.Q6J("ngForOf",null==(tmp_9_0=core.lcZ(21,22,ctx_r2.subGroups$))||null==tmp_9_0.payload?null:tmp_9_0.payload.page)}}function SubgroupsListComponent_div_29_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",27),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r3=core.oxw();core.xp6(1),core.hij(" ",core.lcZ(2,1,ctx_r3.messagePrefix+".no-subgroups-yet")," ")}}var subgroups_list_component_SubKey;__name(SubgroupsListComponent_ds_pagination_20_tr_20_Template,"SubgroupsListComponent_ds_pagination_20_tr_20_Template"),__name(SubgroupsListComponent_ds_pagination_20_Template,"SubgroupsListComponent_ds_pagination_20_Template"),__name(SubgroupsListComponent_div_22_Template,"SubgroupsListComponent_div_22_Template"),__name(SubgroupsListComponent_ds_pagination_27_tr_20_Template,"SubgroupsListComponent_ds_pagination_27_tr_20_Template"),__name(SubgroupsListComponent_ds_pagination_27_Template,"SubgroupsListComponent_ds_pagination_27_Template"),__name(SubgroupsListComponent_div_29_Template,"SubgroupsListComponent_div_29_Template"),function(SubKey2){SubKey2[SubKey2.Members=0]="Members",SubKey2[SubKey2.ActiveGroup=1]="ActiveGroup",SubKey2[SubKey2.SearchResults=2]="SearchResults"}(subgroups_list_component_SubKey||(subgroups_list_component_SubKey={}));class SubgroupsListComponent{constructor(groupDataService,translateService,notificationsService,formBuilder,paginationService,router2){this.groupDataService=groupDataService,this.translateService=translateService,this.notificationsService=notificationsService,this.formBuilder=formBuilder,this.paginationService=paginationService,this.router=router2,this.searchResults$=new cjs.BehaviorSubject(void 0),this.subGroups$=new cjs.BehaviorSubject(void 0),this.subs=new Map,this.configSearch=Object.assign(new pagination_component_options_model.r,{id:"ssgl",pageSize:5,currentPage:1}),this.config=Object.assign(new pagination_component_options_model.r,{id:"sgl",pageSize:5,currentPage:1}),this.currentSearchQuery=""}ngOnInit(){this.searchForm=this.formBuilder.group({query:""}),this.subs.set(subgroups_list_component_SubKey.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(activeGroup=>{null!=activeGroup&&(this.groupBeingEdited=activeGroup,this.retrieveSubGroups())}))}retrieveSubGroups(){this.unsubFrom(subgroups_list_component_SubKey.Members),this.subs.set(subgroups_list_component_SubKey.Members,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,operators.wt)(config=>this.groupDataService.findListByHref(this.groupBeingEdited._links.subgroups.href,{currentPage:config.currentPage,elementsPerPage:config.pageSize},!0,!0,(0,follow_link_config_model.l)("object")))).subscribe(rd=>{this.subGroups$.next(rd)}))}isSubgroupOfGroup(possibleSubgroup){return this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1),(0,operators.zg)(activeGroup=>null!=activeGroup?activeGroup.uuid===possibleSubgroup.uuid?(0,cjs.of)(!1):this.groupDataService.findListByHref(activeGroup._links.subgroups.href,{currentPage:1,elementsPerPage:9999}).pipe((0,shared_operators.xw)(),(0,shared_operators.xe)(),(0,operators.UI)(listTotalGroups=>listTotalGroups.page.filter(groupInList=>groupInList.id===possibleSubgroup.id)),(0,operators.UI)(groups=>groups.length>0)):(0,cjs.of)(!1)))}isActiveGroup(group){return this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1),(0,operators.zg)(activeGroup=>null!=activeGroup&&activeGroup.uuid===group.uuid?(0,cjs.of)(!0):(0,cjs.of)(!1)))}deleteSubgroupFromGroup(subgroup){this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1)).subscribe(activeGroup=>{if(null!=activeGroup){const response=this.groupDataService.deleteSubGroupFromGroup(activeGroup,subgroup);this.showNotifications("deleteSubgroup",response,subgroup.name,activeGroup)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addSubgroupToGroup(subgroup){this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1)).subscribe(activeGroup=>{if(null!=activeGroup)if(activeGroup.uuid!==subgroup.uuid){const response=this.groupDataService.addSubGroupToGroup(activeGroup,subgroup);this.showNotifications("addSubgroup",response,subgroup.name,activeGroup)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.subgroupToAddIsActiveGroup"));else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(data){const query=data.query;null!=query&&this.currentSearchQuery!==query&&(this.router.navigateByUrl(this.groupDataService.getGroupEditPageRouterLink(this.groupBeingEdited)),this.currentSearchQuery=query,this.configSearch.currentPage=1),this.searchDone=!0,this.unsubFrom(subgroups_list_component_SubKey.SearchResults),this.subs.set(subgroups_list_component_SubKey.SearchResults,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,operators.wt)(config=>this.groupDataService.searchGroups(this.currentSearchQuery,{currentPage:config.currentPage,elementsPerPage:config.pageSize},!0,!0,(0,follow_link_config_model.l)("object")))).subscribe(rd=>{this.searchResults$.next(rd)}))}unsubFrom(key){this.subs.has(key)&&(this.subs.get(key).unsubscribe(),this.subs.delete(key))}ngOnDestroy(){for(const key of this.subs.keys())this.unsubFrom(key);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(messageSuffix,response,nameObject,activeGroup){response.pipe((0,shared_operators.hC)()).subscribe(rd=>{rd.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+messageSuffix,{name:nameObject})),this.groupDataService.clearGroupLinkRequests(activeGroup._links.subgroups.href)):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+messageSuffix,{name:nameObject}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}}function GroupFormComponent_div_3_Template(rf,ctx){1&rf&&core._UZ(0,"div")}function GroupFormComponent_ng_template_5_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"h2",14),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r2=core.oxw();core.xp6(1),core.Oqu(core.lcZ(2,1,ctx_r2.messagePrefix+".head.create"))}}function GroupFormComponent_ng_template_7_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"h2",14),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r4=core.oxw();core.xp6(1),core.Oqu(core.lcZ(2,1,ctx_r4.messagePrefix+".head.edit"))}}function GroupFormComponent_ds_alert_9_Template(rf,ctx){if(1&rf&&core._UZ(0,"ds-alert",15),2&rf){const ctx_r5=core.oxw();core.Q6J("type",ctx_r5.AlertTypeEnum.Warning)("content",ctx_r5.messagePrefix+".alert.permanent")}}__name(SubgroupsListComponent,"SubgroupsListComponent"),SubgroupsListComponent.\u0275fac=__name(function(t){return new(t||SubgroupsListComponent)(core.Y36(group_data_service.O),core.Y36(ngx_translate_core.sK),core.Y36(notifications_service.T),core.Y36(fesm2015_forms.qu),core.Y36(pagination_service.N),core.Y36(router.F0))},"SubgroupsListComponent_Factory"),SubgroupsListComponent.\u0275cmp=core.Xpm({type:SubgroupsListComponent,selectors:[["ds-subgroups-list"]],inputs:{messagePrefix:"messagePrefix"},decls:31,vars:28,consts:[[1,"border-bottom","pb-2"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group","mr-3"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary","float-right",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groupsSearch",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[1,"align-middle"],[4,"ngFor","ngForOf"],[3,"routerLink","click"],[1,"btn-group","edit-field"],["class","btn btn-outline-danger btn-sm deleteButton",3,"title","click",4,"ngIf"],[4,"ngIf"],["class","btn btn-outline-primary btn-sm addButton",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm","deleteButton",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm","addButton",3,"title","click"],[1,"fas","fa-plus","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","subgroupsOfGroup",1,"table","table-striped","table-hover","table-bordered"]],template:__name(function(rf,ctx){if(1&rf&&(core.ynx(0),core.TgZ(1,"h3",0),core._uU(2),core.ALo(3,"translate"),core.qZA(),core.TgZ(4,"h4",1),core._uU(5),core.ALo(6,"translate"),core.qZA(),core.TgZ(7,"form",2),core.NdJ("ngSubmit",__name(function(){return ctx.search(ctx.searchForm.value)},"SubgroupsListComponent_Template_form_ngSubmit_7_listener")),core.TgZ(8,"div",3)(9,"div",4),core._UZ(10,"input",5),core.TgZ(11,"span",6)(12,"button",7),core._UZ(13,"i",8),core._uU(14),core.ALo(15,"translate"),core.qZA()()()(),core.TgZ(16,"div")(17,"button",9),core.NdJ("click",__name(function(){return ctx.clearFormAndResetResult()},"SubgroupsListComponent_Template_button_click_17_listener")),core._uU(18),core.ALo(19,"translate"),core.qZA()()(),core.YNc(20,SubgroupsListComponent_ds_pagination_20_Template,22,24,"ds-pagination",10),core.ALo(21,"async"),core.YNc(22,SubgroupsListComponent_div_22_Template,3,3,"div",11),core.ALo(23,"async"),core.TgZ(24,"h4"),core._uU(25),core.ALo(26,"translate"),core.qZA(),core.YNc(27,SubgroupsListComponent_ds_pagination_27_Template,22,24,"ds-pagination",10),core.ALo(28,"async"),core.YNc(29,SubgroupsListComponent_div_29_Template,3,3,"div",11),core.ALo(30,"async"),core.BQk()),2&rf){let tmp_5_0,tmp_6_0,tmp_8_0,tmp_9_0;core.xp6(2),core.Oqu(core.lcZ(3,10,ctx.messagePrefix+".head")),core.xp6(3),core.hij("",core.lcZ(6,12,ctx.messagePrefix+".search.head")," "),core.xp6(2),core.Q6J("formGroup",ctx.searchForm),core.xp6(7),core.hij(" ",core.lcZ(15,14,ctx.messagePrefix+".search.button")," "),core.xp6(4),core.hij(" ",core.lcZ(19,16,ctx.messagePrefix+".button.see-all")," "),core.xp6(2),core.Q6J("ngIf",(null==(tmp_5_0=core.lcZ(21,18,ctx.searchResults$))||null==tmp_5_0.payload?null:tmp_5_0.payload.totalElements)>0),core.xp6(2),core.Q6J("ngIf",0==(null==(tmp_6_0=core.lcZ(23,20,ctx.searchResults$))||null==tmp_6_0.payload?null:tmp_6_0.payload.totalElements)&&ctx.searchDone),core.xp6(3),core.Oqu(core.lcZ(26,22,ctx.messagePrefix+".headSubgroups")),core.xp6(2),core.Q6J("ngIf",(null==(tmp_8_0=core.lcZ(28,24,ctx.subGroups$))||null==tmp_8_0.payload?null:tmp_8_0.payload.totalElements)>0),core.xp6(2),core.Q6J("ngIf",0==(null==(tmp_9_0=core.lcZ(30,26,ctx.subGroups$))||null==tmp_9_0.payload?null:tmp_9_0.payload.totalElements))}},"SubgroupsListComponent_Template"),directives:[fesm2015_forms._Y,fesm2015_forms.JL,fesm2015_forms.sg,fesm2015_forms.Fj,fesm2015_forms.JJ,fesm2015_forms.u,common.O5,pagination_component.Q,common.sg,router.yS],pipes:[ngx_translate_core.X$,common.Ov],encapsulation:2}),__name(GroupFormComponent_div_3_Template,"GroupFormComponent_div_3_Template"),__name(GroupFormComponent_ng_template_5_Template,"GroupFormComponent_ng_template_5_Template"),__name(GroupFormComponent_ng_template_7_Template,"GroupFormComponent_ng_template_7_Template"),__name(GroupFormComponent_ds_alert_9_Template,"GroupFormComponent_ds_alert_9_Template");const group_form_component_c0=__name(function(a0,a1,a2){return{name:a0,comcol:a1,comcolEditRolesRoute:a2}},"group_form_component_c0");function GroupFormComponent_ds_alert_10_Template(rf,ctx){if(1&rf&&(core._UZ(0,"ds-alert",15),core.ALo(1,"translate"),core.ALo(2,"async"),core.ALo(3,"async"),core.ALo(4,"async")),2&rf){const ctx_r6=core.oxw();let tmp_1_0;core.Q6J("type",ctx_r6.AlertTypeEnum.Warning)("content",core.xi3(1,2,ctx_r6.messagePrefix+".alert.workflowGroup",core.kEZ(11,group_form_component_c0,null==(tmp_1_0=core.lcZ(2,5,ctx_r6.getLinkedDSO(ctx_r6.groupBeingEdited)))||null==tmp_1_0.payload?null:tmp_1_0.payload.name,null==(tmp_1_0=core.lcZ(3,7,ctx_r6.getLinkedDSO(ctx_r6.groupBeingEdited)))||null==tmp_1_0.payload?null:tmp_1_0.payload.type,core.lcZ(4,9,ctx_r6.getLinkedEditRolesRoute(ctx_r6.groupBeingEdited)))))}}function GroupFormComponent_div_19_Template(rf,ctx){if(1&rf){const _r11=core.EpF();core.TgZ(0,"div",16)(1,"button",17),core.NdJ("click",__name(function(){return core.CHM(_r11),core.oxw().delete()},"GroupFormComponent_div_19_Template_button_click_1_listener")),core.ALo(2,"async"),core._UZ(3,"i",18),core._uU(4),core.ALo(5,"translate"),core.qZA()()}if(2&rf){const ctx_r7=core.oxw();core.xp6(1),core.Q6J("disabled",!core.lcZ(2,2,ctx_r7.canEdit$)||ctx_r7.groupBeingEdited.permanent),core.xp6(3),core.hij(" ",core.lcZ(5,4,ctx_r7.messagePrefix+".actions.delete")," ")}}function GroupFormComponent_ds_members_list_21_Template(rf,ctx){if(1&rf&&core._UZ(0,"ds-members-list",19),2&rf){const ctx_r8=core.oxw();core.Q6J("messagePrefix",ctx_r8.messagePrefix+".members-list")}}function GroupFormComponent_ds_subgroups_list_22_Template(rf,ctx){if(1&rf&&core._UZ(0,"ds-subgroups-list",19),2&rf){const ctx_r9=core.oxw();core.Q6J("messagePrefix",ctx_r9.messagePrefix+".subgroups-list")}}__name(GroupFormComponent_ds_alert_10_Template,"GroupFormComponent_ds_alert_10_Template"),__name(GroupFormComponent_div_19_Template,"GroupFormComponent_div_19_Template"),__name(GroupFormComponent_ds_members_list_21_Template,"GroupFormComponent_ds_members_list_21_Template"),__name(GroupFormComponent_ds_subgroups_list_22_Template,"GroupFormComponent_ds_subgroups_list_22_Template");class GroupFormComponent{constructor(groupDataService,ePersonDataService,dSpaceObjectDataService,formBuilderService,translateService,notificationsService,route,router2,authorizationService,modalService,requestService,changeDetectorRef){this.groupDataService=groupDataService,this.ePersonDataService=ePersonDataService,this.dSpaceObjectDataService=dSpaceObjectDataService,this.formBuilderService=formBuilderService,this.translateService=translateService,this.notificationsService=notificationsService,this.route=route,this.router=router2,this.authorizationService=authorizationService,this.modalService=modalService,this.requestService=requestService,this.changeDetectorRef=changeDetectorRef,this.messagePrefix="admin.access-control.groups.form",this.formId="group-form",this.formLayout={groupName:{grid:{host:"row"}},groupDescription:{grid:{host:"row"}}},this.submitForm=new core.vpe,this.cancelForm=new core.vpe,this.subs=[],this.AlertTypeEnum=aletr_type.N}ngOnInit(){this.initialisePage()}initialisePage(){this.subs.push(this.route.params.subscribe(params=>{"newGroup"!==params.groupId&&this.setActiveGroup(params.groupId)})),this.canEdit$=this.groupDataService.getActiveGroup().pipe((0,empty_util.tz)(),(0,operators.wt)(group=>(0,cjs.combineLatest)(this.authorizationService.isAuthorized(feature_id.i.CanDelete,(0,empty_util.UE)(group)?group.self:void 0),this.hasLinkedDSO(group),(isAuthorized,hasLinkedDSO)=>isAuthorized&&!hasLinkedDSO))),(0,cjs.combineLatest)(this.translateService.get(`${this.messagePrefix}.groupName`),this.translateService.get(`${this.messagePrefix}.groupCommunity`),this.translateService.get(`${this.messagePrefix}.groupDescription`)).subscribe(([groupName,groupCommunity,groupDescription])=>{this.groupName=new fesm2015_core.b1u({id:"groupName",label:groupName,name:"groupName",validators:{required:null},required:!0}),this.groupCommunity=new fesm2015_core.b1u({id:"groupCommunity",label:groupCommunity,name:"groupCommunity",required:!1,readOnly:!0}),this.groupDescription=new fesm2015_core.HBf({id:"groupDescription",label:groupDescription,name:"groupDescription",required:!1}),this.formModel=[this.groupName,this.groupDescription],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.formGroup.controls.groupName&&(this.formGroup.controls.groupName.setAsyncValidators(ValidateGroupExists.createValidator(this.groupDataService)),this.groupNameValueChangeSubscribe=this.groupName.valueChanges.pipe((0,operators.bh)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()})),this.subs.push((0,cjs.combineLatest)(this.groupDataService.getActiveGroup(),this.canEdit$,this.groupDataService.getActiveGroup().pipe((0,operators.hX)(activeGroup=>(0,empty_util.Uh)(activeGroup)),(0,operators.wt)(activeGroup=>this.getLinkedDSO(activeGroup).pipe((0,shared_operators.Gp)())))).subscribe(([activeGroup,canEdit,linkedObject])=>{var _a;null!=activeGroup&&(this.formGroup.controls.groupName.clearAsyncValidators(),this.groupBeingEdited=activeGroup,(null==linkedObject?void 0:linkedObject.name)?(this.formBuilderService.insertFormGroupControl(1,this.formGroup,this.formModel,this.groupCommunity),this.formGroup.patchValue({groupName:activeGroup.name,groupCommunity:null!==(_a=null==linkedObject?void 0:linkedObject.name)&&void 0!==_a?_a:"",groupDescription:activeGroup.firstMetadataValue("dc.description")})):(this.formModel=[this.groupName,this.groupDescription],this.formGroup.patchValue({groupName:activeGroup.name,groupDescription:activeGroup.firstMetadataValue("dc.description")})),setTimeout(()=>{(!canEdit||activeGroup.permanent)&&this.formGroup.disable()},200))}))})}onCancel(){this.groupDataService.cancelEditGroup(),this.cancelForm.emit(),this.router.navigate([this.groupDataService.getGroupRegistryRouterLink()])}onSubmit(){this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1)).subscribe(group=>{const values={name:this.groupName.value,metadata:{"dc.description":[{value:this.groupDescription.value}]}};null===group?this.createNewGroup(values):this.editGroup(group)})}createNewGroup(values){const groupToCreate=Object.assign(new group_model.Z,values);this.groupDataService.create(groupToCreate).pipe((0,shared_operators.hC)()).subscribe(rd=>{if(rd.hasSucceeded){if(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.created.success",{name:groupToCreate.name})),this.submitForm.emit(groupToCreate),(0,empty_util.UE)(rd.payload)){const groupSelfLink=rd.payload._links.self.href;this.setActiveGroupWithLink(groupSelfLink),this.groupDataService.clearGroupsRequests(),this.router.navigateByUrl(this.groupDataService.getGroupEditPageRouterLinkWithID(rd.payload.uuid))}}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.created.failure",{name:groupToCreate.name})),this.showNotificationIfNameInUse(groupToCreate,"created"),this.cancelForm.emit()})}showNotificationIfNameInUse(group,notificationSection){this.subs.push(this.groupDataService.searchGroups(group.name,{currentPage:1,elementsPerPage:0}).pipe((0,shared_operators.xw)(),(0,shared_operators.xe)()).subscribe(list=>{list.totalElements>0&&this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification."+notificationSection+".failure.groupNameInUse",{name:group.name}))}))}editGroup(group){let operations=[];(0,empty_util.Uh)(this.groupDescription.value)&&(operations=[...operations,{op:"replace",path:"/metadata/dc.description/0/value",value:this.groupDescription.value}]),(0,empty_util.Uh)(this.groupName.value)&&(operations=[...operations,{op:"replace",path:"/name",value:this.groupName.value}]),this.groupDataService.patch(group,operations).pipe((0,shared_operators.hC)()).subscribe(rd=>{rd.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.edited.success",{name:rd.payload.name})),this.submitForm.emit(rd.payload)):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.edited.failure",{name:group.name})),this.cancelForm.emit())})}setActiveGroup(groupId){this.groupDataService.cancelEditGroup(),this.groupDataService.findById(groupId).pipe((0,shared_operators.xw)(),(0,shared_operators.xe)()).subscribe(group=>{this.groupDataService.editGroup(group)})}setActiveGroupWithLink(groupSelfLink){this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1)).subscribe(activeGroup=>{null===activeGroup&&(this.groupDataService.cancelEditGroup(),this.groupDataService.findByHref(groupSelfLink,!1,!1,(0,follow_link_config_model.l)("subgroups"),(0,follow_link_config_model.l)("epersons"),(0,follow_link_config_model.l)("object")).pipe((0,shared_operators.xw)(),(0,shared_operators.xe)()).subscribe(group=>{this.groupDataService.editGroup(group)}))})}delete(){this.groupDataService.getActiveGroup().pipe((0,operators.qn)(1)).subscribe(group=>{const modalRef=this.modalService.open(confirmation_modal_component.Y);modalRef.componentInstance.dso=group,modalRef.componentInstance.headerLabel=this.messagePrefix+".delete-group.modal.header",modalRef.componentInstance.infoLabel=this.messagePrefix+".delete-group.modal.info",modalRef.componentInstance.cancelLabel=this.messagePrefix+".delete-group.modal.cancel",modalRef.componentInstance.confirmLabel=this.messagePrefix+".delete-group.modal.confirm",modalRef.componentInstance.brandColor="danger",modalRef.componentInstance.confirmIcon="fas fa-trash",modalRef.componentInstance.response.pipe((0,operators.qn)(1)).subscribe(confirm=>{confirm&&(0,empty_util.Uh)(group.id)&&this.groupDataService.delete(group.id).pipe((0,shared_operators.hC)()).subscribe(rd=>{rd.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.deleted.success",{name:group.name})),this.onCancel()):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.deleted.failure.title",{name:group.name}),this.translateService.get(this.messagePrefix+".notification.deleted.failure.content",{cause:rd.errorMessage}))})})})}ngOnDestroy(){this.groupDataService.cancelEditGroup(),this.subs.filter(sub=>(0,empty_util.Uh)(sub)).forEach(sub=>sub.unsubscribe()),(0,empty_util.Uh)(this.groupNameValueChangeSubscribe)&&this.groupNameValueChangeSubscribe.unsubscribe()}hasLinkedDSO(group){if((0,empty_util.Uh)(group)&&(0,empty_util.Uh)(group._links.object.href))return this.getLinkedDSO(group).pipe((0,operators.UI)(rd=>(0,empty_util.Uh)(rd)&&(0,empty_util.Uh)(rd.payload)),(0,operators.KQ)(()=>(0,cjs.of)(!1)))}getLinkedDSO(group){if((0,empty_util.Uh)(group)&&(0,empty_util.Uh)(group._links.object.href))return void 0===group.object?this.dSpaceObjectDataService.findByHref(group._links.object.href):group.object}getLinkedEditRolesRoute(group){if((0,empty_util.Uh)(group)&&(0,empty_util.Uh)(group._links.object.href))return this.getLinkedDSO(group).pipe((0,operators.UI)(rd=>{if((0,empty_util.Uh)(rd)&&(0,empty_util.Uh)(rd.payload))switch(rd.payload.type){case community_model.S.type.value:return(0,community_page_routing_paths.eq)(rd.payload.id);case collection_model.F.type.value:return(0,collection_page_routing_paths.Po)(rd.payload.id)}}))}}__name(GroupFormComponent,"GroupFormComponent"),GroupFormComponent.\u0275fac=__name(function(t){return new(t||GroupFormComponent)(core.Y36(group_data_service.O),core.Y36(eperson_data_service.k),core.Y36(dspace_object_data_service.D),core.Y36(form_builder_service.c),core.Y36(ngx_translate_core.sK),core.Y36(notifications_service.T),core.Y36(router.gz),core.Y36(router.F0),core.Y36(authorization_data_service._),core.Y36(ng_bootstrap.FF),core.Y36(request_service.s),core.Y36(core.sBO))},"GroupFormComponent_Factory"),GroupFormComponent.\u0275cmp=core.Xpm({type:GroupFormComponent,selectors:[["ds-group-form"]],hostBindings:__name(function(rf,ctx){1&rf&&core.NdJ("beforeunload",__name(function(){return ctx.ngOnDestroy()},"GroupFormComponent_beforeunload_HostBindingHandler"),!1,core.Jf7)},"GroupFormComponent_HostBindings"),outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},decls:23,vars:22,consts:[[1,"container"],[1,"group-form","row"],[1,"col-12"],[4,"ngIf","ngIfThen","ngIfElse"],["createHeader",""],["editheader",""],[3,"type","content",4,"ngIf"],[3,"formId","formModel","formGroup","formLayout","displayCancel","submitForm"],["before","",1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["after","","class","btn-group",4,"ngIf"],[1,"mb-5"],[3,"messagePrefix",4,"ngIf"],[1,"border-bottom","pb-2"],[3,"type","content"],["after","",1,"btn-group"],[1,"btn","btn-danger","delete-button",3,"disabled","click"],[1,"fa","fa-trash"],[3,"messagePrefix"]],template:__name(function(rf,ctx){if(1&rf&&(core.TgZ(0,"div",0)(1,"div",1)(2,"div",2),core.YNc(3,GroupFormComponent_div_3_Template,1,0,"div",3),core.ALo(4,"async"),core.YNc(5,GroupFormComponent_ng_template_5_Template,3,3,"ng-template",null,4,core.W1O),core.YNc(7,GroupFormComponent_ng_template_7_Template,3,3,"ng-template",null,5,core.W1O),core.YNc(9,GroupFormComponent_ds_alert_9_Template,1,2,"ds-alert",6),core.YNc(10,GroupFormComponent_ds_alert_10_Template,5,15,"ds-alert",6),core.ALo(11,"async"),core.ALo(12,"async"),core.TgZ(13,"ds-form",7),core.NdJ("submitForm",__name(function(){return ctx.onSubmit()},"GroupFormComponent_Template_ds_form_submitForm_13_listener")),core.TgZ(14,"div",8)(15,"button",9),core.NdJ("click",__name(function(){return ctx.onCancel()},"GroupFormComponent_Template_button_click_15_listener")),core._UZ(16,"i",10),core._uU(17),core.ALo(18,"translate"),core.qZA()(),core.YNc(19,GroupFormComponent_div_19_Template,6,6,"div",11),core.qZA(),core.TgZ(20,"div",12),core.YNc(21,GroupFormComponent_ds_members_list_21_Template,1,1,"ds-members-list",13),core.qZA(),core.YNc(22,GroupFormComponent_ds_subgroups_list_22_Template,1,1,"ds-subgroups-list",13),core.qZA()()()),2&rf){const _r1=core.MAs(6),_r3=core.MAs(8);core.xp6(3),core.Q6J("ngIf",core.lcZ(4,14,ctx.groupDataService.getActiveGroup()))("ngIfThen",_r3)("ngIfElse",_r1),core.xp6(6),core.Q6J("ngIf",null==ctx.groupBeingEdited?null:ctx.groupBeingEdited.permanent),core.xp6(1),core.Q6J("ngIf",!core.lcZ(11,16,ctx.canEdit$)&&core.lcZ(12,18,ctx.groupDataService.getActiveGroup())),core.xp6(3),core.Q6J("formId",ctx.formId)("formModel",ctx.formModel)("formGroup",ctx.formGroup)("formLayout",ctx.formLayout)("displayCancel",!1),core.xp6(4),core.hij(" ",core.lcZ(18,20,ctx.messagePrefix+".return"),""),core.xp6(2),core.Q6J("ngIf",null!=ctx.groupBeingEdited),core.xp6(2),core.Q6J("ngIf",null!=ctx.groupBeingEdited),core.xp6(1),core.Q6J("ngIf",null!=ctx.groupBeingEdited)}},"GroupFormComponent_Template"),directives:[common.O5,alert_component.w,form_component.U,fesm2015_forms.JL,fesm2015_forms.sg,MembersListComponent,SubgroupsListComponent],pipes:[common.Ov,ngx_translate_core.X$],encapsulation:2});class GroupDtoModel{}__name(GroupDtoModel,"GroupDtoModel");var route_service=__webpack_require__(43685);function GroupsRegistryComponent_ds_themed_loading_31_Template(rf,ctx){1&rf&&core._UZ(0,"ds-themed-loading")}__name(GroupsRegistryComponent_ds_themed_loading_31_Template,"GroupsRegistryComponent_ds_themed_loading_31_Template");const groups_registry_component_c0=__name(function(a0){return{name:a0}},"groups_registry_component_c0");function GroupsRegistryComponent_ds_pagination_33_tr_22_button_13_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"button",30),core.ALo(1,"translate"),core._UZ(2,"i",31),core.qZA()),2&rf){const groupDto_r4=core.oxw().$implicit,ctx_r5=core.oxw(2);core.s9C("title",core.xi3(1,2,ctx_r5.messagePrefix+"table.edit.buttons.edit",core.VKq(5,groups_registry_component_c0,groupDto_r4.group.name))),core.Q6J("routerLink",ctx_r5.groupService.getGroupEditPageRouterLink(groupDto_r4.group))}}function GroupsRegistryComponent_ds_pagination_33_tr_22_button_14_Template(rf,ctx){1&rf&&(core.TgZ(0,"button",32),core.ALo(1,"translate"),core._UZ(2,"i",31),core.qZA()),2&rf&&core.Q6J("disabled",!0)("ngbTooltip",core.lcZ(1,2,"admin.access-control.epeople.table.edit.buttons.edit-disabled"))}function GroupsRegistryComponent_ds_pagination_33_tr_22_button_15_Template(rf,ctx){if(1&rf){const _r11=core.EpF();core.TgZ(0,"button",33),core.NdJ("click",__name(function(){core.CHM(_r11);const groupDto_r4=core.oxw().$implicit;return core.oxw(2).deleteGroup(groupDto_r4)},"GroupsRegistryComponent_ds_pagination_33_tr_22_button_15_Template_button_click_0_listener")),core.ALo(1,"translate"),core._UZ(2,"i",34),core.qZA()}if(2&rf){const groupDto_r4=core.oxw().$implicit,ctx_r7=core.oxw(2);core.s9C("title",core.xi3(1,1,ctx_r7.messagePrefix+"table.edit.buttons.remove",core.VKq(4,groups_registry_component_c0,groupDto_r4.group.name)))}}function GroupsRegistryComponent_ds_pagination_33_tr_22_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"tr")(1,"td"),core._uU(2),core.qZA(),core.TgZ(3,"td"),core._uU(4),core.qZA(),core.TgZ(5,"td"),core._uU(6),core.ALo(7,"async"),core.qZA(),core.TgZ(8,"td"),core._uU(9),core.qZA(),core.TgZ(10,"td")(11,"div",25),core.ynx(12,26),core.YNc(13,GroupsRegistryComponent_ds_pagination_33_tr_22_button_13_Template,3,7,"button",27),core.YNc(14,GroupsRegistryComponent_ds_pagination_33_tr_22_button_14_Template,3,4,"button",28),core.BQk(),core.YNc(15,GroupsRegistryComponent_ds_pagination_33_tr_22_button_15_Template,3,6,"button",29),core.qZA()()()),2&rf){const groupDto_r4=ctx.$implicit;let tmp_2_0;core.xp6(2),core.Oqu(groupDto_r4.group.id),core.xp6(2),core.Oqu(groupDto_r4.group.name),core.xp6(2),core.Oqu(null==(tmp_2_0=core.lcZ(7,8,groupDto_r4.group.object))||null==tmp_2_0.payload?null:tmp_2_0.payload.name),core.xp6(3),core.Oqu((null==groupDto_r4.epersons?null:groupDto_r4.epersons.totalElements)+(null==groupDto_r4.subgroups?null:groupDto_r4.subgroups.totalElements)),core.xp6(3),core.Q6J("ngSwitch",groupDto_r4.ableToEdit),core.xp6(1),core.Q6J("ngSwitchCase",!0),core.xp6(1),core.Q6J("ngSwitchCase",!1),core.xp6(1),core.Q6J("ngIf",!(null!=groupDto_r4.group&&groupDto_r4.group.permanent)&&groupDto_r4.ableToDelete)}}function GroupsRegistryComponent_ds_pagination_33_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"ds-pagination",20),core.ALo(1,"async"),core.TgZ(2,"div",21)(3,"table",22)(4,"thead")(5,"tr")(6,"th",23),core._uU(7),core.ALo(8,"translate"),core.qZA(),core.TgZ(9,"th",23),core._uU(10),core.ALo(11,"translate"),core.qZA(),core.TgZ(12,"th",23),core._uU(13),core.ALo(14,"translate"),core.qZA(),core.TgZ(15,"th",23),core._uU(16),core.ALo(17,"translate"),core.qZA(),core.TgZ(18,"th"),core._uU(19),core.ALo(20,"translate"),core.qZA()()(),core.TgZ(21,"tbody"),core.YNc(22,GroupsRegistryComponent_ds_pagination_33_tr_22_Template,16,10,"tr",24),core.ALo(23,"async"),core.qZA()()()()),2&rf){const ctx_r1=core.oxw();let tmp_2_0,tmp_10_0;core.Q6J("paginationOptions",ctx_r1.config)("pageInfoState",ctx_r1.pageInfoState$)("collectionSize",null==(tmp_2_0=core.lcZ(1,11,ctx_r1.pageInfoState$))?null:tmp_2_0.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),core.xp6(7),core.Oqu(core.lcZ(8,13,ctx_r1.messagePrefix+"table.id")),core.xp6(3),core.Oqu(core.lcZ(11,15,ctx_r1.messagePrefix+"table.name")),core.xp6(3),core.Oqu(core.lcZ(14,17,ctx_r1.messagePrefix+"table.collectionOrCommunity")),core.xp6(3),core.Oqu(core.lcZ(17,19,ctx_r1.messagePrefix+"table.members")),core.xp6(3),core.Oqu(core.lcZ(20,21,ctx_r1.messagePrefix+"table.edit")),core.xp6(3),core.Q6J("ngForOf",null==(tmp_10_0=core.lcZ(23,23,ctx_r1.groupsDto$))?null:tmp_10_0.page)}}function GroupsRegistryComponent_div_36_Template(rf,ctx){if(1&rf&&(core.TgZ(0,"div",35),core._uU(1),core.ALo(2,"translate"),core.qZA()),2&rf){const ctx_r2=core.oxw();core.xp6(1),core.hij(" ",core.lcZ(2,1,ctx_r2.messagePrefix+"no-items")," ")}}__name(GroupsRegistryComponent_ds_pagination_33_tr_22_button_13_Template,"GroupsRegistryComponent_ds_pagination_33_tr_22_button_13_Template"),__name(GroupsRegistryComponent_ds_pagination_33_tr_22_button_14_Template,"GroupsRegistryComponent_ds_pagination_33_tr_22_button_14_Template"),__name(GroupsRegistryComponent_ds_pagination_33_tr_22_button_15_Template,"GroupsRegistryComponent_ds_pagination_33_tr_22_button_15_Template"),__name(GroupsRegistryComponent_ds_pagination_33_tr_22_Template,"GroupsRegistryComponent_ds_pagination_33_tr_22_Template"),__name(GroupsRegistryComponent_ds_pagination_33_Template,"GroupsRegistryComponent_ds_pagination_33_Template"),__name(GroupsRegistryComponent_div_36_Template,"GroupsRegistryComponent_div_36_Template");const groups_registry_component_c1=__name(function(){return["newGroup"]},"groups_registry_component_c1");class GroupsRegistryComponent{constructor(groupService,ePersonDataService,dSpaceObjectDataService,translateService,notificationsService,formBuilder,routeService,router2,authorizationService,paginationService,requestService){this.groupService=groupService,this.ePersonDataService=ePersonDataService,this.dSpaceObjectDataService=dSpaceObjectDataService,this.translateService=translateService,this.notificationsService=notificationsService,this.formBuilder=formBuilder,this.routeService=routeService,this.router=router2,this.authorizationService=authorizationService,this.paginationService=paginationService,this.requestService=requestService,this.messagePrefix="admin.access-control.groups.",this.config=Object.assign(new pagination_component_options_model.r,{id:"gl",pageSize:5,currentPage:1}),this.groupsDto$=new cjs.BehaviorSubject({}),this.deletedGroupsIds=[],this.pageInfoState$=new cjs.BehaviorSubject(void 0),this.loading$=new cjs.BehaviorSubject(!1),this.subs=[],this.currentSearchQuery="",this.searchForm=this.formBuilder.group({query:this.currentSearchQuery})}ngOnInit(){this.search({query:this.currentSearchQuery})}search(data){(0,empty_util.Uh)(this.searchSub)&&(this.searchSub.unsubscribe(),this.subs=this.subs.filter(sub=>sub!==this.searchSub)),this.searchSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,operators.bw)(()=>this.loading$.next(!0)),(0,operators.wt)(paginationOptions=>{const query=data.query;return null!=query&&this.currentSearchQuery!==query&&(this.currentSearchQuery=query,this.paginationService.updateRouteWithUrl(this.config.id,[],{page:1})),this.groupService.searchGroups(this.currentSearchQuery.trim(),{currentPage:paginationOptions.currentPage,elementsPerPage:paginationOptions.pageSize},!0,!0,(0,follow_link_config_model.l)("object"))}),(0,shared_operators.g1)(),(0,shared_operators.xe)(),(0,operators.wt)(groups=>0===groups.page.length?(0,cjs.of)((0,paginated_list_model.b)(groups.pageInfo,[])):this.authorizationService.isAuthorized(feature_id.i.AdministratorOf).pipe((0,operators.wt)(isSiteAdmin=>(0,cjs.combineLatest)([...groups.page.map(group=>(0,empty_util.Uh)(group)&&!this.deletedGroupsIds.includes(group.id)?(0,cjs.combineLatest)([this.authorizationService.isAuthorized(feature_id.i.CanDelete,group.self),this.canManageGroup$(isSiteAdmin,group),this.hasLinkedDSO(group),this.getSubgroups(group),this.getMembers(group)]).pipe((0,operators.UI)(([canDelete,canManageGroup,hasLinkedDSO,subgroups,members])=>{const groupDtoModel=new GroupDtoModel;return groupDtoModel.ableToDelete=canDelete&&!hasLinkedDSO,groupDtoModel.ableToEdit=canManageGroup,groupDtoModel.group=group,groupDtoModel.subgroups=subgroups.payload,groupDtoModel.epersons=members.payload,groupDtoModel})):cjs.EMPTY)]).pipe((0,operators.dL)([]),(0,operators.UI)(dtos=>(0,paginated_list_model.b)(groups.pageInfo,dtos))))))).subscribe(value=>{this.groupsDto$.next(value),this.pageInfoState$.next(value.pageInfo),this.loading$.next(!1)}),this.subs.push(this.searchSub)}canManageGroup$(isSiteAdmin,group){return isSiteAdmin?(0,cjs.of)(!0):this.authorizationService.isAuthorized(feature_id.i.CanManageGroup,group.self)}deleteGroup(group){(0,empty_util.Uh)(group.group.id)&&this.groupService.delete(group.group.id).pipe((0,shared_operators.hC)()).subscribe(rd=>{rd.hasSucceeded?(this.deletedGroupsIds=[...this.deletedGroupsIds,group.group.id],this.notificationsService.success(this.translateService.get(this.messagePrefix+"notification.deleted.success",{name:group.group.name}))):this.notificationsService.error(this.translateService.get(this.messagePrefix+"notification.deleted.failure.title",{name:group.group.name}),this.translateService.get(this.messagePrefix+"notification.deleted.failure.content",{cause:rd.errorMessage}))})}getMembers(group){return this.ePersonDataService.findListByHref(group._links.epersons.href).pipe((0,shared_operators.xw)())}getSubgroups(group){return this.groupService.findListByHref(group._links.subgroups.href).pipe((0,shared_operators.xw)())}hasLinkedDSO(group){return this.dSpaceObjectDataService.findByHref(group._links.object.href).pipe((0,shared_operators.xw)(),(0,operators.UI)(rd=>(0,empty_util.Uh)(rd)&&(0,empty_util.Uh)(rd.payload)),(0,operators.KQ)(()=>(0,cjs.of)(!1)))}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){(0,empty_util.Uh)(this.paginationSub)&&this.paginationSub.unsubscribe(),this.subs.filter(sub=>(0,empty_util.Uh)(sub)).forEach(sub=>sub.unsubscribe()),this.paginationService.clearPagination(this.config.id)}}__name(GroupsRegistryComponent,"GroupsRegistryComponent"),GroupsRegistryComponent.\u0275fac=__name(function(t){return new(t||GroupsRegistryComponent)(core.Y36(group_data_service.O),core.Y36(eperson_data_service.k),core.Y36(dspace_object_data_service.D),core.Y36(ngx_translate_core.sK),core.Y36(notifications_service.T),core.Y36(fesm2015_forms.qu),core.Y36(route_service.MZ),core.Y36(router.F0),core.Y36(authorization_data_service._),core.Y36(pagination_service.N),core.Y36(request_service.s))},"GroupsRegistryComponent_Factory"),GroupsRegistryComponent.\u0275cmp=core.Xpm({type:GroupsRegistryComponent,selectors:[["ds-groups-registry"]],decls:38,vars:35,consts:[[1,"container"],[1,"groups-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn-group","edit-field"],[3,"ngSwitch"],["class","btn btn-outline-primary btn-sm btn-edit",3,"routerLink","title",4,"ngSwitchCase"],["class","btn btn-outline-primary btn-sm btn-edit","placement","left",3,"disabled","ngbTooltip",4,"ngSwitchCase"],["class","btn btn-outline-danger btn-sm btn-delete",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],["placement","left",1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"disabled","ngbTooltip"],[1,"btn","btn-outline-danger","btn-sm","btn-delete",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:__name(function(rf,ctx){if(1&rf&&(core.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),core._uU(5),core.ALo(6,"translate"),core.qZA(),core.TgZ(7,"div")(8,"button",5),core._UZ(9,"i",6),core.TgZ(10,"span",7),core._uU(11),core.ALo(12,"translate"),core.qZA()()()(),core.TgZ(13,"h3",8),core._uU(14),core.ALo(15,"translate"),core.qZA(),core.TgZ(16,"form",9),core.NdJ("ngSubmit",__name(function(){return ctx.search(ctx.searchForm.value)},"GroupsRegistryComponent_Template_form_ngSubmit_16_listener")),core.TgZ(17,"div",10)(18,"div",11),core._UZ(19,"input",12),core.ALo(20,"translate"),core.ALo(21,"translate"),core.TgZ(22,"span",13)(23,"button",14),core._UZ(24,"i",15),core._uU(25),core.ALo(26,"translate"),core.qZA()()()(),core.TgZ(27,"div")(28,"button",16),core.NdJ("click",__name(function(){return ctx.clearFormAndResetResult()},"GroupsRegistryComponent_Template_button_click_28_listener")),core._uU(29),core.ALo(30,"translate"),core.qZA()()(),core.YNc(31,GroupsRegistryComponent_ds_themed_loading_31_Template,1,0,"ds-themed-loading",17),core.ALo(32,"async"),core.YNc(33,GroupsRegistryComponent_ds_pagination_33_Template,24,25,"ds-pagination",18),core.ALo(34,"async"),core.ALo(35,"async"),core.YNc(36,GroupsRegistryComponent_div_36_Template,3,3,"div",19),core.ALo(37,"async"),core.qZA()()()),2&rf){let tmp_10_0,tmp_11_0;core.xp6(5),core.Oqu(core.lcZ(6,12,ctx.messagePrefix+"head")),core.xp6(3),core.Q6J("routerLink",core.DdM(34,groups_registry_component_c1)),core.xp6(3),core.Oqu(core.lcZ(12,14,ctx.messagePrefix+"button.add")),core.xp6(3),core.Oqu(core.lcZ(15,16,ctx.messagePrefix+"search.head")),core.xp6(2),core.Q6J("formGroup",ctx.searchForm),core.xp6(3),core.Q6J("placeholder",core.lcZ(21,20,ctx.messagePrefix+"search.placeholder")),core.uIk("aria-label",core.lcZ(20,18,ctx.messagePrefix+"search.placeholder")),core.xp6(6),core.hij(" ",core.lcZ(26,22,ctx.messagePrefix+"search.button")," "),core.xp6(4),core.hij(" ",core.lcZ(30,24,ctx.messagePrefix+"button.see-all")," "),core.xp6(2),core.Q6J("ngIf",core.lcZ(32,26,ctx.loading$)),core.xp6(2),core.Q6J("ngIf",(null==(tmp_10_0=core.lcZ(34,28,ctx.pageInfoState$))?null:tmp_10_0.totalElements)>0&&!core.lcZ(35,30,ctx.loading$)),core.xp6(3),core.Q6J("ngIf",0==(null==(tmp_11_0=core.lcZ(37,32,ctx.pageInfoState$))?null:tmp_11_0.totalElements))}},"GroupsRegistryComponent_Template"),directives:[router.rH,fesm2015_forms._Y,fesm2015_forms.JL,fesm2015_forms.sg,fesm2015_forms.Fj,fesm2015_forms.JJ,fesm2015_forms.u,common.O5,themed_loading_component.Z,pagination_component.Q,common.sg,common.RF,common.n9,ng_bootstrap._L],pipes:[ngx_translate_core.X$,common.Ov],encapsulation:2});var access_control_routing_paths=__webpack_require__(12838),i18n_breadcrumb_resolver=__webpack_require__(64561),some_feature_authorization_guard=__webpack_require__(65913),hal_endpoint_service=__webpack_require__(19339);class GroupPageGuard extends some_feature_authorization_guard.I{constructor(halEndpointService,authorizationService,router2,authService){super(authorizationService,router2,authService),this.halEndpointService=halEndpointService,this.authorizationService=authorizationService,this.router=router2,this.authService=authService,this.groupsEndpoint="groups"}getFeatureIDs(route,state){return(0,cjs.of)([feature_id.i.CanManageGroup])}getObjectUrl(route,state){return this.halEndpointService.getEndpoint(this.groupsEndpoint).pipe((0,operators.UI)(groupsUrl=>{var _a;return`${groupsUrl}/${null===(_a=null==route?void 0:route.params)||void 0===_a?void 0:_a.groupId}`}))}}__name(GroupPageGuard,"GroupPageGuard"),GroupPageGuard.\u0275fac=__name(function(t){return new(t||GroupPageGuard)(core.LFG(hal_endpoint_service.q),core.LFG(authorization_data_service._),core.LFG(router.F0),core.LFG(auth_service.e8))},"GroupPageGuard_Factory"),GroupPageGuard.\u0275prov=core.Yz7({token:GroupPageGuard,factory:GroupPageGuard.\u0275fac,providedIn:"root"});var group_administrator_guard=__webpack_require__(41461),site_administrator_guard=__webpack_require__(2092);class AccessControlRoutingModule{}__name(AccessControlRoutingModule,"AccessControlRoutingModule"),AccessControlRoutingModule.\u0275fac=__name(function(t){return new(t||AccessControlRoutingModule)},"AccessControlRoutingModule_Factory"),AccessControlRoutingModule.\u0275mod=core.oAB({type:AccessControlRoutingModule}),AccessControlRoutingModule.\u0275inj=core.cJS({imports:[[router.Bz.forChild([{path:"epeople",component:EPeopleRegistryComponent,resolve:{breadcrumb:i18n_breadcrumb_resolver.t},data:{title:"admin.access-control.epeople.title",breadcrumbKey:"admin.access-control.epeople"},canActivate:[site_administrator_guard.X]},{path:access_control_routing_paths.CH,component:GroupsRegistryComponent,resolve:{breadcrumb:i18n_breadcrumb_resolver.t},data:{title:"admin.access-control.groups.title",breadcrumbKey:"admin.access-control.groups"},canActivate:[group_administrator_guard.E]},{path:`${access_control_routing_paths.CH}/newGroup`,component:GroupFormComponent,resolve:{breadcrumb:i18n_breadcrumb_resolver.t},data:{title:"admin.access-control.groups.title.addGroup",breadcrumbKey:"admin.access-control.groups.addGroup"},canActivate:[group_administrator_guard.E]},{path:`${access_control_routing_paths.CH}/:groupId`,component:GroupFormComponent,resolve:{breadcrumb:i18n_breadcrumb_resolver.t},data:{title:"admin.access-control.groups.title.singleGroup",breadcrumbKey:"admin.access-control.groups.singleGroup"},canActivate:[GroupPageGuard]}])]]});var form_module=__webpack_require__(48197);class AccessControlModule{}__name(AccessControlModule,"AccessControlModule"),AccessControlModule.\u0275fac=__name(function(t){return new(t||AccessControlModule)},"AccessControlModule_Factory"),AccessControlModule.\u0275mod=core.oAB({type:AccessControlModule}),AccessControlModule.\u0275inj=core.cJS({imports:[[common.ez,shared_module.m,router.Bz,AccessControlRoutingModule,form_module.e]]})},37188:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{m:()=>EpersonRegistrationService});var request_service=__webpack_require__(37958),hal_endpoint_service=__webpack_require__(19339),request_models=__webpack_require__(61449),operators=__webpack_require__(5796),empty_util=__webpack_require__(25839),registration_model=__webpack_require__(53116),shared_operators=__webpack_require__(63281),response_models=__webpack_require__(47820),core=__webpack_require__(70074);class RegistrationResponseParsingService{parse(request,data){const payload=data.payload,registration=Object.assign(new registration_model.Y,payload);return new response_models.tp(data.statusCode,void 0,registration)}}__name(RegistrationResponseParsingService,"RegistrationResponseParsingService"),RegistrationResponseParsingService.\u0275fac=__name(function(t){return new(t||RegistrationResponseParsingService)},"RegistrationResponseParsingService_Factory"),RegistrationResponseParsingService.\u0275prov=core.Yz7({token:RegistrationResponseParsingService,factory:RegistrationResponseParsingService.\u0275fac,providedIn:"root"});var remote_data_build_service=__webpack_require__(10303),http=__webpack_require__(78819);class EpersonRegistrationService{constructor(requestService,rdbService,halService){this.requestService=requestService,this.rdbService=rdbService,this.halService=halService,this.linkPath="registrations",this.searchByTokenPath="/search/findByToken?token="}getRegistrationEndpoint(){return this.halService.getEndpoint(this.linkPath)}getTokenSearchEndpoint(token){return this.halService.getEndpoint(this.linkPath).pipe((0,operators.hX)(href=>(0,empty_util.UE)(href)),(0,operators.UI)(href=>`${href}${this.searchByTokenPath}${token}`))}registerEmail(email,captchaToken=null){const registration=new registration_model.Y;registration.email=email;const requestId=this.requestService.generateRequestId(),href$=this.getRegistrationEndpoint(),options=Object.create({});let headers=new http.WM;return captchaToken&&(headers=headers.append("x-recaptcha-token",captchaToken)),options.headers=headers,href$.pipe((0,operators.sE)(href=>(0,empty_util.Uh)(href)),(0,operators.UI)(href=>{const request=new request_models.xo(requestId,href,registration,options);this.requestService.send(request)})).subscribe(),this.rdbService.buildFromRequestUUID(requestId).pipe((0,shared_operators.hC)())}searchByToken(token){const requestId=this.requestService.generateRequestId(),href$=this.getTokenSearchEndpoint(token).pipe((0,operators.sE)(href=>(0,empty_util.Uh)(href)));return href$.subscribe(href=>{const request=new request_models.Gl(requestId,href);Object.assign(request,{getResponseParser:()=>RegistrationResponseParsingService}),this.requestService.send(request,!0)}),this.rdbService.buildSingle(href$).pipe((0,operators.UI)(rd=>rd.hasSucceeded&&(0,empty_util.Uh)(rd.payload)?Object.assign(rd,{payload:Object.assign(rd.payload,{token})}):rd))}}__name(EpersonRegistrationService,"EpersonRegistrationService"),EpersonRegistrationService.\u0275fac=__name(function(t){return new(t||EpersonRegistrationService)(core.LFG(request_service.s),core.LFG(remote_data_build_service.Q),core.LFG(hal_endpoint_service.q))},"EpersonRegistrationService_Factory"),EpersonRegistrationService.\u0275prov=core.Yz7({token:EpersonRegistrationService,factory:EpersonRegistrationService.\u0275fac,providedIn:"root"})}};