"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[9575],{59575:(fe,q,s)=>{s.r(q),s.d(q,{AccessControlModule:()=>Vt});var f=s(10210),P=s(37895),H=s(66004),B=s(35841),I=s(53426),b=s(21160),h=s(48358),v=s(77176),O=s(73535),k=s(53019),l=s(25839),$=s(16228),L=s(98865);class U{}var w=s(84705),x=s(30835),u=s(5496),y=s(25366),_=s(37958),G=s(45419),S=s(57854),e=s(70074),E=s(86553),p=s(45028),R=s(35053),T=s(59492),C=s(9237),ne=s(3358),N=s(96652),ie=s(62610),re=s(24656),ae=s(28709),A=s(8183),be=s(37188),oe=s(61792),W=s(76924),V=s(99292);function Se(i,o){1&i&&e.\u0275\u0275element(0,"div")}function xe(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"h4"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".create"))}}function _e(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"h4"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".edit"))}}const ye=function(i){return{"d-none":i}};function Pe(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().impersonate()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",18),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(6,ye,!e.\u0275\u0275pipeBind1(1,2,t.canImpersonate$))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,4,"admin.access-control.epeople.actions.impersonate")," ")}}function Ie(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",19),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().stopImpersonating()}),e.\u0275\u0275element(1,"i",18),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"admin.access-control.epeople.actions.stop-impersonating")," "))}function Ee(i,o){1&i&&e.\u0275\u0275element(0,"ds-themed-loading",20),2&i&&e.\u0275\u0275property("showMessage",!1)}function Ce(i,o){1&i&&e.\u0275\u0275element(0,"ds-themed-loading",20),2&i&&e.\u0275\u0275property("showMessage",!1)}const se=function(i){return[i]};function Be(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",28),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",28)(4,"a",29),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).groupsDataService.startEditingNewGroup(a)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",28),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=o.$implicit,n=e.\u0275\u0275nextContext(3);let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(6,se,n.groupsDataService.getGroupEditPageRouterLink(t))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(r=e.\u0275\u0275pipeBind1(8,4,t.object))||null==r.payload?null:r.payload.name)}}function Fe(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-pagination",23),e.\u0275\u0275listener("pageChange",function(r){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).onPageChange(r)}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",24)(4,"table",25)(5,"thead")(6,"tr")(7,"th",26),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",26),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",26),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"tbody"),e.\u0275\u0275template(17,Be,9,8,"tr",27),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext(2);let n,r,a;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,9,t.groups))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,11,t.groups))||null==r.payload?null:r.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,13,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,15,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,17,t.messagePrefix+".table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(a=e.\u0275\u0275pipeBind1(18,19,t.groups))||null==a.payload?null:a.payload.page)}}function Ge(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"div",30)(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"button",31),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,3,t.messagePrefix+".memberOfNoGroups")),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(7,se,t.groupsDataService.getGroupRegistryRouterLink())),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,5,t.messagePrefix+".goToGroups"))}}function De(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Ce,1,1,"ds-themed-loading",15),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275template(6,Fe,19,21,"ds-pagination",21),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275template(8,Ge,8,9,"div",22),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,4,t.messagePrefix+".groupsEPersonIsMemberOf")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(5,6,t.groups)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(n=e.\u0275\u0275pipeBind1(7,8,t.groups))||null==n.payload?null:n.payload.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(r=e.\u0275\u0275pipeBind1(9,10,t.groups))||null==r.payload?null:r.payload.totalElements))}}let we=(()=>{class i{constructor(t,n,r,a,c,m,g,d,D,F,z,ee){this.changeDetectorRef=t,this.epersonService=n,this.groupsDataService=r,this.formBuilderService=a,this.translateService=c,this.notificationsService=m,this.authService=g,this.authorizationService=d,this.modalService=D,this.paginationService=F,this.requestService=z,this.epersonRegistrationService=ee,this.labelPrefix="admin.access-control.epeople.form.",this.formId="eperson-form",this.messagePrefix="admin.access-control.epeople.form",this.formLayout={firstName:{grid:{host:"row"}},lastName:{grid:{host:"row"}},email:{grid:{host:"row"}},canLogIn:{grid:{host:"col col-sm-6 d-inline-block"}},requireCertificate:{grid:{host:"col col-sm-6 d-inline-block"}}},this.submitForm=new e.EventEmitter,this.cancelForm=new e.EventEmitter,this.subs=[],this.config=Object.assign(new L.r,{id:"gem",pageSize:5,currentPage:1}),this.isImpersonated=!1,this.subs.push(this.epersonService.getActiveEPerson().subscribe(te=>{this.epersonInitial=te,(0,l.Uh)(te)&&(this.isImpersonated=this.authService.isImpersonatingUser(te.id))}))}ngOnInit(){this.initialisePage()}initialisePage(){(0,I.a)(this.translateService.get(`${this.messagePrefix}.firstName`),this.translateService.get(`${this.messagePrefix}.lastName`),this.translateService.get(`${this.messagePrefix}.email`),this.translateService.get(`${this.messagePrefix}.canLogIn`),this.translateService.get(`${this.messagePrefix}.requireCertificate`),this.translateService.get(`${this.messagePrefix}.emailHint`)).subscribe(([t,n,r,a,c,m])=>{this.firstName=new T.b1u({id:"firstName",label:t,name:"firstName",validators:{required:null},required:!0}),this.lastName=new T.b1u({id:"lastName",label:n,name:"lastName",validators:{required:null},required:!0}),this.email=new T.b1u({id:"email",label:r,name:"email",validators:{required:null,pattern:"^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$"},required:!0,errorMessages:{emailTaken:"error.validation.emailTaken",pattern:"error.validation.NotValidEmail"},hint:m}),this.canLogIn=new T.dwp({id:"canLogIn",label:a,name:"canLogIn",value:null==this.epersonInitial||this.epersonInitial.canLogIn}),this.requireCertificate=new T.dwp({id:"requireCertificate",label:c,name:"requireCertificate",value:null!=this.epersonInitial&&this.epersonInitial.requireCertificate}),this.formModel=[this.firstName,this.lastName,this.email,this.canLogIn,this.requireCertificate],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.subs.push(this.epersonService.getActiveEPerson().subscribe(d=>{null!=d&&(this.groups=this.groupsDataService.findListByHref(d._links.groups.href,{currentPage:1,elementsPerPage:this.config.pageSize})),this.formGroup.patchValue({firstName:null!=d?d.firstMetadataValue("eperson.firstname"):"",lastName:null!=d?d.firstMetadataValue("eperson.lastname"):"",email:null!=d?d.email:"",canLogIn:null==d||d.canLogIn,requireCertificate:null!=d&&d.requireCertificate}),null===d&&this.formGroup.controls.email&&(this.formGroup.controls.email.setAsyncValidators(class ve{static createValidator(o){return t=>o.getEPersonByEmail(t.value).pipe((0,u.xw)(),(0,h.U)(n=>n.payload?{emailTaken:!0}:null))}}.createValidator(this.epersonService)),this.emailValueChangeSubscribe=this.email.valueChanges.pipe((0,ne.b)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()}))}));const g=this.epersonService.getActiveEPerson();this.groups=g.pipe((0,b.w)(d=>(0,I.a)([(0,C.of)(d),this.paginationService.getFindListOptions(this.config.id,{currentPage:1,elementsPerPage:this.config.pageSize})])),(0,b.w)(([d,D])=>null!=d?this.groupsDataService.findListByHref(d._links.groups.href,D,!0,!0,(0,A.l)("object")):(0,C.of)(void 0))),this.canImpersonate$=g.pipe((0,b.w)(d=>(0,l.Uh)(d)?this.authorizationService.isAuthorized(w.i.LoginOnBehalfOf,d.self):(0,C.of)(!1))),this.canDelete$=g.pipe((0,b.w)(d=>this.authorizationService.isAuthorized(w.i.CanDelete,(0,l.Uh)(d)?d.self:void 0))),this.canReset$=(0,C.of)(!0)})}onCancel(){this.epersonService.cancelEditEPerson(),this.cancelForm.emit()}onSubmit(){this.epersonService.getActiveEPerson().pipe((0,v.q)(1)).subscribe(t=>{const n={metadata:{"eperson.firstname":[{value:this.firstName.value}],"eperson.lastname":[{value:this.lastName.value}]},email:this.email.value,canLogIn:this.canLogIn.value,requireCertificate:this.requireCertificate.value};null==t?this.createNewEPerson(n):this.editEPerson(t,n)})}createNewEPerson(t){const n=Object.assign(new ie.T,t);this.epersonService.create(n).pipe((0,u.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.created.success",{name:n.name})),this.submitForm.emit(n)):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.created.failure",{name:n.name})),this.cancelForm.emit())}),this.showNotificationIfEmailInUse(n,"created")}editEPerson(t,n){const r=Object.assign(new ie.T,{id:t.id,metadata:{"eperson.firstname":[{value:this.firstName.value?this.firstName.value:t.firstMetadataValue("eperson.firstname")}],"eperson.lastname":[{value:this.lastName.value?this.lastName.value:t.firstMetadataValue("eperson.lastname")}]},email:(0,l.Uh)(n.email)?n.email:t.email,canLogIn:(0,l.Uh)(n.canLogIn)?n.canLogIn:t.canLogIn,requireCertificate:(0,l.Uh)(n.requireCertificate)?n.requireCertificate:t.requireCertificate,_links:t._links});this.epersonService.updateEPerson(r).pipe((0,u.hC)()).subscribe(c=>{c.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.edited.success",{name:r.name})),this.submitForm.emit(r)):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.edited.failure",{name:r.name})),this.cancelForm.emit())}),null!=n.email&&n.email!==t.email&&this.showNotificationIfEmailInUse(r,"edited")}onPageChange(t){this.updateGroups({currentPage:t,elementsPerPage:this.config.pageSize})}impersonate(){this.authService.impersonate(this.epersonInitial.id),this.isImpersonated=!0}delete(){this.epersonService.getActiveEPerson().pipe((0,v.q)(1)).subscribe(t=>{const n=this.modalService.open(y.Y);n.componentInstance.dso=t,n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,v.q)(1)).subscribe(r=>{r&&(0,l.Uh)(t.id)&&this.epersonService.deleteEPerson(t).pipe((0,u.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:t.name})),this.submitForm.emit()):this.notificationsService.error("Error occured when trying to delete EPerson with id: "+t.id+" with code: "+a.statusCode+" and message: "+a.errorMessage),this.cancelForm.emit()})})})}stopImpersonating(){this.authService.stopImpersonatingAndRefresh(),this.isImpersonated=!1}resetPassword(){(0,l.Uh)(this.epersonInitial.email)&&this.epersonRegistrationService.registerEmail(this.epersonInitial.email).pipe((0,u.hC)()).subscribe(t=>{t.hasSucceeded?this.notificationsService.success(this.translateService.get("admin.access-control.epeople.actions.reset"),this.translateService.get("forgot-email.form.success.content",{email:this.epersonInitial.email})):this.notificationsService.error(this.translateService.get("forgot-email.form.error.head"),this.translateService.get("forgot-email.form.error.content",{email:this.epersonInitial.email}))})}ngOnDestroy(){this.onCancel(),this.subs.filter(t=>(0,l.Uh)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id),(0,l.Uh)(this.emailValueChangeSubscribe)&&this.emailValueChangeSubscribe.unsubscribe()}reset(){this.epersonService.getActiveEPerson().pipe((0,v.q)(1)).subscribe(t=>{this.requestService.removeByHrefSubstring(t.self)}),this.initialisePage()}showNotificationIfEmailInUse(t,n){this.subs.push(this.epersonService.searchByScope("email",t.email,{currentPage:1,elementsPerPage:0}).pipe((0,u.xw)(),(0,u.xe)()).subscribe(r=>{r.totalElements>0&&this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification."+n+".failure.emailInUse",{name:t.name,email:t.email}))}))}updateGroups(t){this.subs.push(this.epersonService.getActiveEPerson().subscribe(n=>{this.groups=this.groupsDataService.findListByHref(n._links.groups.href,t)}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(k.k),e.\u0275\u0275directiveInject(N.O),e.\u0275\u0275directiveInject(re.c),e.\u0275\u0275directiveInject(E.sK),e.\u0275\u0275directiveInject($.T),e.\u0275\u0275directiveInject(ae.e8),e.\u0275\u0275directiveInject(x._),e.\u0275\u0275directiveInject(R.FF),e.\u0275\u0275directiveInject(S.N),e.\u0275\u0275directiveInject(_.s),e.\u0275\u0275directiveInject(be.m))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-eperson-form"]],outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},decls:29,vars:31,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["createHeader",""],["editheader",""],[3,"formId","formModel","formGroup","formLayout","displayCancel","submitForm"],["before","",1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["between","",1,"btn-group"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fa","fa-key"],["between","",1,"btn-group","ml-1"],["class","btn btn-primary",3,"ngClass","click",4,"ngIf"],["class","btn btn-primary",3,"click",4,"ngIf"],["after","",1,"btn","btn-danger","delete-button",3,"disabled","click"],[1,"fas","fa-trash"],[3,"showMessage",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-primary",3,"ngClass","click"],[1,"fa","fa-user-secret"],[1,"btn","btn-primary",3,"click"],[3,"showMessage"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[4,"ngFor","ngForOf"],[1,"align-middle"],[3,"routerLink","click"],["role","alert",1,"alert","alert-info","w-100","mb-2"],[1,"btn","btn-primary",3,"routerLink"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,Se,1,0,"div",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,xe,3,3,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(4,_e,3,3,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(6,"ds-form",3),e.\u0275\u0275listener("submitForm",function(){return n.onSubmit()}),e.\u0275\u0275elementStart(7,"div",4)(8,"button",5),e.\u0275\u0275listener("click",function(){return n.onCancel()}),e.\u0275\u0275element(9,"i",6),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",7)(13,"button",8),e.\u0275\u0275listener("click",function(){return n.resetPassword()}),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275element(15,"i",9),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"div",10),e.\u0275\u0275template(19,Pe,5,8,"button",11),e.\u0275\u0275template(20,Ie,4,3,"button",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",13),e.\u0275\u0275listener("click",function(){return n.delete()}),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275element(23,"i",14),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(26,Ee,1,1,"ds-themed-loading",15),e.\u0275\u0275template(27,De,10,12,"div",16),e.\u0275\u0275pipe(28,"async")),2&t){const r=e.\u0275\u0275reference(3),a=e.\u0275\u0275reference(5);e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,17,n.epersonService.getActiveEPerson()))("ngIfThen",a)("ngIfElse",r),e.\u0275\u0275advance(6),e.\u0275\u0275property("formId",n.formId)("formModel",n.formModel)("formGroup",n.formGroup)("formLayout",n.formLayout)("displayCancel",!1),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(11,19,n.messagePrefix+".return"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(14,21,n.canReset$)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(17,23,"admin.access-control.epeople.actions.reset")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!n.isImpersonated),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.isImpersonated),e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(22,25,n.canDelete$)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(25,27,"admin.access-control.epeople.actions.delete")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.formGroup),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(28,29,n.epersonService.getActiveEPerson()))}},directives:[f.O5,oe.U,p.JL,p.sg,f.mk,W.Z,V.Q,f.sg,P.yS,P.rH],pipes:[f.Ov,E.X$],encapsulation:2}),i})();function Te(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().isEPersonFormShown=!0}),e.\u0275\u0275element(2,"i",8),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,1,t.labelPrefix+"button.add"))}}function Le(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-eperson-form",10),e.\u0275\u0275listener("submitForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().reset()})("cancelForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().isEPersonFormShown=!1}),e.\u0275\u0275elementEnd()}}function Oe(i,o){1&i&&e.\u0275\u0275element(0,"ds-themed-loading")}const $e=function(i){return{"table-primary":i}},le=function(i){return{name:i}};function Re(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr",30),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"td"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"td"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"td"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"td")(9,"div",31)(10,"button",32),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).toggleEditEPerson(a.eperson)}),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275element(12,"i",33),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",34),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).deleteEPerson(a.eperson)}),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275element(15,"i",35),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=o.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(15,$e,e.\u0275\u0275pipeBind1(1,7,n.isActive(t.eperson)))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(t.eperson.id),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.email),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(11,9,n.labelPrefix+"table.edit.buttons.edit",e.\u0275\u0275pureFunction1(17,le,t.eperson.name))),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(14,12,n.labelPrefix+"table.edit.buttons.remove",e.\u0275\u0275pureFunction1(19,le,t.eperson.name))),e.\u0275\u0275property("disabled",!t.ableToDelete)}}function je(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",25),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"div",26)(3,"table",27)(4,"thead")(5,"tr")(6,"th",28),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"th",28),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"th",28),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"th"),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(18,"tbody"),e.\u0275\u0275template(19,Re,16,21,"tr",29),e.\u0275\u0275pipe(20,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext(2);let n,r;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",t.pageInfoState$)("collectionSize",null==(n=e.\u0275\u0275pipeBind1(1,10,t.pageInfoState$))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,12,t.labelPrefix+"table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,14,t.labelPrefix+"table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,16,t.labelPrefix+"table.email")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,18,t.labelPrefix+"table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(20,20,t.ePeopleDto$))?null:r.page)}}function Me(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"div",36),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.labelPrefix+"no-items")," ")}}function ke(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"h3",11),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"form",12),e.\u0275\u0275listener("ngSubmit",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return r.search(r.searchForm.value)}),e.\u0275\u0275elementStart(5,"div")(6,"select",13)(7,"option",14),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"option",15),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(13,"div",16)(14,"div",17),e.\u0275\u0275element(15,"input",18),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementStart(18,"span",19)(19,"button",20),e.\u0275\u0275element(20,"i",21),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(23,"div")(24,"button",22),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().clearFormAndResetResult()}),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(27,Oe,1,0,"ds-themed-loading",5),e.\u0275\u0275pipe(28,"async"),e.\u0275\u0275template(29,je,21,22,"ds-pagination",23),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275template(32,Me,3,3,"div",24),e.\u0275\u0275pipe(33,"async"),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,11,t.labelPrefix+"search.head")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",t.searchForm),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,13,t.labelPrefix+"search.scope.metadata")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,15,t.labelPrefix+"search.scope.email")),e.\u0275\u0275advance(4),e.\u0275\u0275property("placeholder",e.\u0275\u0275pipeBind1(17,19,t.labelPrefix+"search.placeholder")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(16,17,t.labelPrefix+"search.placeholder")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(22,21,t.labelPrefix+"search.button")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(26,23,t.labelPrefix+"button.see-all")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(28,25,t.searching$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(n=e.\u0275\u0275pipeBind1(30,27,t.pageInfoState$))?null:n.totalElements)>0&&!e.\u0275\u0275pipeBind1(31,29,t.searching$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0==(null==(r=e.\u0275\u0275pipeBind1(33,31,t.pageInfoState$))?null:r.totalElements))}}let Ae=(()=>{class i{constructor(t,n,r,a,c,m,g,d,D){this.epersonService=t,this.translateService=n,this.notificationsService=r,this.authorizationService=a,this.formBuilder=c,this.router=m,this.modalService=g,this.paginationService=d,this.requestService=D,this.labelPrefix="admin.access-control.epeople.",this.ePeople$=new B.X((0,O.b)(new G.S,[])),this.ePeopleDto$=new B.X({}),this.pageInfoState$=new B.X(void 0),this.searching$=new B.X(!1),this.config=Object.assign(new L.r,{id:"elp",pageSize:5,currentPage:1}),this.subs=[],this.currentSearchQuery="",this.currentSearchScope="metadata",this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}ngOnInit(){this.initialisePage()}initialisePage(){this.searching$.next(!0),this.isEPersonFormShown=!1,this.search({scope:this.currentSearchScope,query:this.currentSearchQuery}),this.subs.push(this.epersonService.getActiveEPerson().subscribe(t=>{null!=t&&t.id&&(this.isEPersonFormShown=!0)})),this.subs.push(this.ePeople$.pipe((0,b.w)(t=>t.pageInfo.totalElements>0?(0,I.a)(...t.page.map(n=>this.authorizationService.isAuthorized(w.i.CanDelete,(0,l.Uh)(n)?n.self:void 0).pipe((0,h.U)(r=>{const a=new U;return a.ableToDelete=r,a.eperson=n,a})))).pipe((0,h.U)(n=>(0,O.b)(t.pageInfo,n))):[t])).subscribe(t=>{this.searching$.next(!1),this.ePeopleDto$.next(t),this.pageInfoState$.next(t.pageInfo)}))}search(t){this.searching$.next(!0),(0,l.Uh)(this.findListOptionsSub)&&this.findListOptionsSub.unsubscribe(),this.findListOptionsSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,b.w)(n=>{const r=t.query,a=t.scope;return null!=r&&this.currentSearchQuery!==r&&(this.router.navigate([this.epersonService.getEPeoplePageRouterLink()],{queryParamsHandling:"merge"}),this.currentSearchQuery=r,this.paginationService.resetPage(this.config.id)),null!=a&&this.currentSearchScope!==a&&(this.router.navigate([this.epersonService.getEPeoplePageRouterLink()],{queryParamsHandling:"merge"}),this.currentSearchScope=a,this.paginationService.resetPage(this.config.id)),this.epersonService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:n.currentPage,elementsPerPage:n.pageSize})}),(0,u.g1)()).subscribe(n=>{this.ePeople$.next(n.payload),this.pageInfoState$.next(n.payload.pageInfo)})}isActive(t){return this.getActiveEPerson().pipe((0,h.U)(n=>t===n))}getActiveEPerson(){return this.epersonService.getActiveEPerson()}toggleEditEPerson(t){this.getActiveEPerson().pipe((0,v.q)(1)).subscribe(n=>{t===n?(this.epersonService.cancelEditEPerson(),this.isEPersonFormShown=!1):(this.epersonService.editEPerson(t),this.isEPersonFormShown=!0)}),this.scrollToTop()}deleteEPerson(t){if((0,l.Uh)(t.id)){const n=this.modalService.open(y.Y);n.componentInstance.dso=t,n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,v.q)(1)).subscribe(r=>{r&&(0,l.Uh)(t.id)&&this.epersonService.deleteEPerson(t).pipe((0,u.hC)()).subscribe(a=>{a.hasSucceeded?this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:t.name})):this.notificationsService.error("Error occured when trying to delete EPerson with id: "+t.id+" with code: "+a.statusCode+" and message: "+a.errorMessage)})})}}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){this.subs.filter(t=>(0,l.Uh)(t)).forEach(t=>t.unsubscribe())}scrollToTop(){!function t(){const n=document.documentElement.scrollTop||document.body.scrollTop;n>0&&(window.requestAnimationFrame(t),window.scrollTo(0,n-n/8))}()}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}reset(){this.epersonService.getBrowseEndpoint().pipe((0,v.q)(1)).subscribe(t=>{this.requestService.setStaleByHrefSubstring(t).pipe((0,v.q)(1)).subscribe(()=>{this.epersonService.cancelEditEPerson(),this.isEPersonFormShown=!1})})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(k.k),e.\u0275\u0275directiveInject(E.sK),e.\u0275\u0275directiveInject($.T),e.\u0275\u0275directiveInject(x._),e.\u0275\u0275directiveInject(p.qu),e.\u0275\u0275directiveInject(P.F0),e.\u0275\u0275directiveInject(R.FF),e.\u0275\u0275directiveInject(S.N),e.\u0275\u0275directiveInject(_.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-epeople-registry"]],decls:10,vars:6,consts:[[1,"container"],[1,"epeople-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[4,"ngIf"],[3,"submitForm","cancelForm",4,"ngIf"],[1,"mr-auto","btn","btn-success","addEPerson-button",3,"click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[3,"submitForm","cancelForm"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"search-button","btn","btn-secondary",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epeople",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm","access-control-editEPersonButton",3,"title","click"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-danger","btn-sm","access-control-deleteEPersonButton",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,Te,6,3,"div",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,Le,1,0,"ds-eperson-form",6),e.\u0275\u0275template(9,ke,34,33,"div",5),e.\u0275\u0275elementEnd()()()),2&t&&(e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,4,n.labelPrefix+"head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.isEPersonFormShown),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.isEPersonFormShown),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.isEPersonFormShown))},directives:[f.O5,we,p._Y,p.JL,p.sg,p.EJ,p.JJ,p.u,p.YN,p.Kr,p.Fj,W.Z,V.Q,f.sg,f.mk],pipes:[E.X$,f.Ov],encapsulation:2}),i})();var Ue=s(77007),pe=s(9249),Ne=s(10954),Ve=s(18595),ce=s(51163),ze=s(15010),qe=s(34269),He=s(70920),Qe=s(338),Xe=s(7519),X=s(71891),J=s(69637);const Y=function(i){return{name:i}};function Je(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",25),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).deleteMemberFromGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",26),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(4,Y,t.eperson.name)))}}function Ye(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",27),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).addMemberToGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",28),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.add",e.\u0275\u0275pureFunction1(4,Y,t.eperson.name)))}}const ue=function(i){return[i]};function Ke(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",19),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",19)(4,"a",21),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).ePersonDataService.startEditingNewEPerson(a.eperson)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",19),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275element(9,"br"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"td",19)(13,"div",22),e.\u0275\u0275template(14,Je,3,6,"button",23),e.\u0275\u0275template(15,Ye,3,6,"button",24),e.\u0275\u0275elementEnd()()()}if(2&i){const t=o.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(13,ue,n.ePersonDataService.getEPeoplePageRouterLink())),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.eperson.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(8,9,n.messagePrefix+".table.email"),": ",t.eperson.email?t.eperson.email:"-",""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(11,11,n.messagePrefix+".table.netid"),": ",t.eperson.netid?t.eperson.netid:"-"," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.memberOfGroup),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.memberOfGroup)}}function Ze(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",15),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",16)(4,"table",17)(5,"thead")(6,"tr")(7,"th",18),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",18),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",18),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th",19),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,Ke,16,15,"tr",20),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("paginationOptions",t.configSearch)("pageInfoState",e.\u0275\u0275pipeBind1(1,10,t.ePeopleSearchDtos))("collectionSize",null==(n=e.\u0275\u0275pipeBind1(2,12,t.ePeopleSearchDtos))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.identity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(21,22,t.ePeopleSearchDtos))?null:r.page)}}function et(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"div",29),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-items")," ")}}function tt(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",19),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",19)(4,"a",21),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).ePersonDataService.startEditingNewEPerson(a.eperson)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",19),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275element(9,"br"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"td",19)(13,"div",22)(14,"button",25),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).deleteMemberFromGroup(a)}),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275element(16,"i",26),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=o.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(15,ue,n.ePersonDataService.getEPeoplePageRouterLink())),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.eperson.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(8,8,n.messagePrefix+".table.email"),": ",t.eperson.email?t.eperson.email:"-",""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(11,10,n.messagePrefix+".table.netid"),": ",t.eperson.netid?t.eperson.netid:"-"," "),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(15,12,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(17,Y,t.eperson.name)))}}function nt(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",15),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",16)(4,"table",30)(5,"thead")(6,"tr")(7,"th",18),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",18),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",18),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th",19),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,tt,17,19,"tr",20),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",e.\u0275\u0275pipeBind1(1,10,t.ePeopleMembersOfGroupDtos))("collectionSize",null==(n=e.\u0275\u0275pipeBind1(2,12,t.ePeopleMembersOfGroupDtos))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.identity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(21,22,t.ePeopleMembersOfGroupDtos))?null:r.page)}}function it(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"div",29),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-members-yet")," ")}}var j=(()=>{return(i=j||(j={}))[i.ActiveGroup=0]="ActiveGroup",i[i.MembersDTO=1]="MembersDTO",i[i.SearchResultsDTO=2]="SearchResultsDTO",j;var i})();let rt=(()=>{class i{constructor(t,n,r,a,c,m,g){this.groupDataService=t,this.ePersonDataService=n,this.translateService=r,this.notificationsService=a,this.formBuilder=c,this.paginationService=m,this.router=g,this.ePeopleSearchDtos=new B.X(void 0),this.ePeopleMembersOfGroupDtos=new B.X(void 0),this.configSearch=Object.assign(new L.r,{id:"sml",pageSize:5,currentPage:1}),this.config=Object.assign(new L.r,{id:"ml",pageSize:5,currentPage:1}),this.subs=new Map,this.currentSearchQuery="",this.currentSearchScope="metadata"}ngOnInit(){this.searchForm=this.formBuilder.group({scope:"metadata",query:""}),this.subs.set(j.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(t=>{null!=t&&(this.groupBeingEdited=t,this.retrieveMembers(this.config.currentPage))}))}retrieveMembers(t){this.unsubFrom(j.MembersDTO),this.subs.set(j.MembersDTO,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,b.w)(n=>this.ePersonDataService.findListByHref(this.groupBeingEdited._links.epersons.href,{currentPage:n.currentPage,elementsPerPage:n.pageSize})),(0,u.f1)(),(0,h.U)(n=>{if(!n.hasFailed)return n;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:n.errorMessage}))}),(0,b.w)(n=>(0,I.a)([...n.payload.page.map(a=>(0,I.a)(this.isMemberOfGroup(a),m=>{const g=new U;return g.eperson=a,g.memberOfGroup=m,g}))]).pipe((0,X.d)([]),(0,h.U)(a=>(0,O.b)(n.payload.pageInfo,a))))).subscribe(n=>{this.ePeopleMembersOfGroupDtos.next(n)}))}isMemberOfGroup(t){return this.groupDataService.getActiveGroup().pipe((0,v.q)(1),(0,J.z)(n=>null!=n?this.ePersonDataService.findListByHref(n._links.epersons.href,{currentPage:1,elementsPerPage:9999}).pipe((0,u.xw)(),(0,u.xe)(),(0,h.U)(r=>r.page.filter(a=>a.id===t.id)),(0,h.U)(r=>r.length>0)):(0,C.of)(!1)))}unsubFrom(t){this.subs.has(t)&&(this.subs.get(t).unsubscribe(),this.subs.delete(t))}deleteMemberFromGroup(t){this.groupDataService.getActiveGroup().pipe((0,v.q)(1)).subscribe(n=>{if(null!=n){const r=this.groupDataService.deleteMemberFromGroup(n,t.eperson);this.showNotifications("deleteMember",r,t.eperson.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addMemberToGroup(t){t.memberOfGroup=!0,this.groupDataService.getActiveGroup().pipe((0,v.q)(1)).subscribe(n=>{if(null!=n){const r=this.groupDataService.addMemberToGroup(n,t.eperson);this.showNotifications("addMember",r,t.eperson.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(t){this.unsubFrom(j.SearchResultsDTO),this.subs.set(j.SearchResultsDTO,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,b.w)(n=>{const r=t.query,a=t.scope;return null!=r&&this.currentSearchQuery!==r&&this.groupBeingEdited&&(this.router.navigate([],{queryParamsHandling:"merge"}),this.currentSearchQuery=r,this.paginationService.resetPage(this.configSearch.id)),null!=a&&this.currentSearchScope!==a&&this.groupBeingEdited&&(this.router.navigate([],{queryParamsHandling:"merge"}),this.currentSearchScope=a,this.paginationService.resetPage(this.configSearch.id)),this.searchDone=!0,this.ePersonDataService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:n.currentPage,elementsPerPage:n.pageSize})}),(0,u.f1)(),(0,h.U)(n=>{if(!n.hasFailed)return n;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:n.errorMessage}))}),(0,b.w)(n=>(0,I.a)([...n.payload.page.map(a=>(0,I.a)(this.isMemberOfGroup(a),m=>{const g=new U;return g.eperson=a,g.memberOfGroup=m,g}))]).pipe((0,X.d)([]),(0,h.U)(a=>(0,O.b)(n.payload.pageInfo,a))))).subscribe(n=>{this.ePeopleSearchDtos.next(n)}))}ngOnDestroy(){for(const t of this.subs.keys())this.unsubFrom(t);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(t,n,r,a){n.pipe((0,u.hC)()).subscribe(c=>{c.hasSucceeded?this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+t,{name:r})):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+t,{name:r}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(N.O),e.\u0275\u0275directiveInject(k.k),e.\u0275\u0275directiveInject(E.sK),e.\u0275\u0275directiveInject($.T),e.\u0275\u0275directiveInject(p.qu),e.\u0275\u0275directiveInject(S.N),e.\u0275\u0275directiveInject(P.F0))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-members-list"]],inputs:{messagePrefix:"messagePrefix"},decls:40,vars:36,consts:[[1,"border-bottom","pb-2"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epersonsSearch",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[1,"align-middle"],[4,"ngFor","ngForOf"],[3,"routerLink","click"],[1,"btn-group","edit-field"],["class","btn btn-outline-danger btn-sm",3,"title","click",4,"ngIf"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm",3,"title","click"],[1,"fas","fa-plus","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","ePeopleMembersOfGroup",1,"table","table-striped","table-hover","table-bordered"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"h3",0),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"h4",1),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"form",2),e.\u0275\u0275listener("ngSubmit",function(){return n.search(n.searchForm.value)}),e.\u0275\u0275elementStart(8,"div")(9,"select",3)(10,"option",4),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"option",5),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"div",6)(17,"div",7),e.\u0275\u0275element(18,"input",8),e.\u0275\u0275elementStart(19,"span",9)(20,"button",10),e.\u0275\u0275element(21,"i",11),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(24,"div")(25,"button",12),e.\u0275\u0275listener("click",function(){return n.clearFormAndResetResult()}),e.\u0275\u0275text(26),e.\u0275\u0275pipe(27,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(28,Ze,22,24,"ds-pagination",13),e.\u0275\u0275pipe(29,"async"),e.\u0275\u0275template(30,et,3,3,"div",14),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275elementStart(32,"h4"),e.\u0275\u0275text(33),e.\u0275\u0275pipe(34,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(35,nt,22,24,"ds-pagination",13),e.\u0275\u0275pipe(36,"async"),e.\u0275\u0275template(37,it,3,3,"div",14),e.\u0275\u0275pipe(38,"async"),e.\u0275\u0275pipe(39,"async"),e.\u0275\u0275elementContainerEnd()),2&t){let r,a,c,m;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,12,n.messagePrefix+".head")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(6,14,n.messagePrefix+".search.head")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.searchForm),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,n.messagePrefix+".search.scope.metadata")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,n.messagePrefix+".search.scope.email")),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(23,20,n.messagePrefix+".search.button"),""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(27,22,n.messagePrefix+".button.see-all")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(29,24,n.ePeopleSearchDtos))?null:r.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(a=e.\u0275\u0275pipeBind1(31,26,n.ePeopleSearchDtos))?null:a.totalElements)&&n.searchDone),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(34,28,n.messagePrefix+".headMembers")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(c=e.\u0275\u0275pipeBind1(36,30,n.ePeopleMembersOfGroupDtos))?null:c.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null==e.\u0275\u0275pipeBind1(38,32,n.ePeopleMembersOfGroupDtos)||0==(null==(m=e.\u0275\u0275pipeBind1(39,34,n.ePeopleMembersOfGroupDtos))?null:m.totalElements))}},directives:[p._Y,p.JL,p.sg,p.EJ,p.JJ,p.u,p.YN,p.Kr,p.Fj,f.O5,V.Q,f.sg,P.yS],pipes:[E.X$,f.Ov],encapsulation:2}),i})();const K=function(i){return{name:i}};function at(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",23),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).deleteSubgroupFromGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",24),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(4,K,t.name)))}}function ot(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".table.edit.currentGroup"))}}function st(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",25),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).addSubgroupToGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",26),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.add",e.\u0275\u0275pureFunction1(4,K,t.name)))}}const de=function(i){return[i]};function lt(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",16),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",16)(4,"a",18),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).groupDataService.startEditingNewGroup(a)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",16),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"td",16)(10,"div",19),e.\u0275\u0275template(11,at,3,6,"button",20),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275template(14,ot,3,3,"p",21),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275template(16,st,3,6,"button",22),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275elementEnd()()()}if(2&i){const t=o.$implicit,n=e.\u0275\u0275nextContext(2);let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(19,de,n.groupDataService.getGroupEditPageRouterLink(t))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(r=e.\u0275\u0275pipeBind1(8,7,t.object))||null==r.payload?null:r.payload.name),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(12,9,n.isSubgroupOfGroup(t))&&!e.\u0275\u0275pipeBind1(13,11,n.isActiveGroup(t))),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(15,13,n.isActiveGroup(t))),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(17,15,n.isSubgroupOfGroup(t))&&!e.\u0275\u0275pipeBind1(18,17,n.isActiveGroup(t)))}}function pt(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",12),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",13)(4,"table",14)(5,"thead")(6,"tr")(7,"th",15),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",15),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",15),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th",16),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,lt,19,21,"tr",17),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r,a;e.\u0275\u0275property("paginationOptions",t.configSearch)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,10,t.searchResults$))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,12,t.searchResults$))||null==r.payload?null:r.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(a=e.\u0275\u0275pipeBind1(21,22,t.searchResults$))||null==a.payload?null:a.payload.page)}}function ct(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"div",27),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-items")," ")}}function ut(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",16),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",16)(4,"a",18),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).groupDataService.startEditingNewGroup(a)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",16),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"td",16)(10,"div",19)(11,"button",23),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).deleteSubgroupFromGroup(a)}),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275element(13,"i",24),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=o.$implicit,n=e.\u0275\u0275nextContext(2);let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(10,de,n.groupDataService.getGroupEditPageRouterLink(t))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(r=e.\u0275\u0275pipeBind1(8,5,t.object))||null==r.payload?null:r.payload.name),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(12,7,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(12,K,t.name)))}}function dt(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",12),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",13)(4,"table",28)(5,"thead")(6,"tr")(7,"th",15),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",15),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",15),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th"),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,ut,14,14,"tr",17),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r,a;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,10,t.subGroups$))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,12,t.subGroups$))||null==r.payload?null:r.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(a=e.\u0275\u0275pipeBind1(21,22,t.subGroups$))||null==a.payload?null:a.payload.page)}}function mt(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"div",27),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-subgroups-yet")," ")}}var M=(()=>{return(i=M||(M={}))[i.Members=0]="Members",i[i.ActiveGroup=1]="ActiveGroup",i[i.SearchResults=2]="SearchResults",M;var i})();let gt=(()=>{class i{constructor(t,n,r,a,c,m){this.groupDataService=t,this.translateService=n,this.notificationsService=r,this.formBuilder=a,this.paginationService=c,this.router=m,this.searchResults$=new B.X(void 0),this.subGroups$=new B.X(void 0),this.subs=new Map,this.configSearch=Object.assign(new L.r,{id:"ssgl",pageSize:5,currentPage:1}),this.config=Object.assign(new L.r,{id:"sgl",pageSize:5,currentPage:1}),this.currentSearchQuery=""}ngOnInit(){this.searchForm=this.formBuilder.group({query:""}),this.subs.set(M.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(t=>{null!=t&&(this.groupBeingEdited=t,this.retrieveSubGroups())}))}retrieveSubGroups(){this.unsubFrom(M.Members),this.subs.set(M.Members,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,b.w)(t=>this.groupDataService.findListByHref(this.groupBeingEdited._links.subgroups.href,{currentPage:t.currentPage,elementsPerPage:t.pageSize},!0,!0,(0,A.l)("object")))).subscribe(t=>{this.subGroups$.next(t)}))}isSubgroupOfGroup(t){return this.groupDataService.getActiveGroup().pipe((0,v.q)(1),(0,J.z)(n=>null!=n?n.uuid===t.uuid?(0,C.of)(!1):this.groupDataService.findListByHref(n._links.subgroups.href,{currentPage:1,elementsPerPage:9999}).pipe((0,u.xw)(),(0,u.xe)(),(0,h.U)(r=>r.page.filter(a=>a.id===t.id)),(0,h.U)(r=>r.length>0)):(0,C.of)(!1)))}isActiveGroup(t){return this.groupDataService.getActiveGroup().pipe((0,v.q)(1),(0,J.z)(n=>(0,C.of)(null!=n&&n.uuid===t.uuid)))}deleteSubgroupFromGroup(t){this.groupDataService.getActiveGroup().pipe((0,v.q)(1)).subscribe(n=>{if(null!=n){const r=this.groupDataService.deleteSubGroupFromGroup(n,t);this.showNotifications("deleteSubgroup",r,t.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addSubgroupToGroup(t){this.groupDataService.getActiveGroup().pipe((0,v.q)(1)).subscribe(n=>{if(null!=n)if(n.uuid!==t.uuid){const r=this.groupDataService.addSubGroupToGroup(n,t);this.showNotifications("addSubgroup",r,t.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.subgroupToAddIsActiveGroup"));else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(t){const n=t.query;null!=n&&this.currentSearchQuery!==n&&(this.router.navigateByUrl(this.groupDataService.getGroupEditPageRouterLink(this.groupBeingEdited)),this.currentSearchQuery=n,this.configSearch.currentPage=1),this.searchDone=!0,this.unsubFrom(M.SearchResults),this.subs.set(M.SearchResults,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,b.w)(r=>this.groupDataService.searchGroups(this.currentSearchQuery,{currentPage:r.currentPage,elementsPerPage:r.pageSize},!0,!0,(0,A.l)("object")))).subscribe(r=>{this.searchResults$.next(r)}))}unsubFrom(t){this.subs.has(t)&&(this.subs.get(t).unsubscribe(),this.subs.delete(t))}ngOnDestroy(){for(const t of this.subs.keys())this.unsubFrom(t);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(t,n,r,a){n.pipe((0,u.hC)()).subscribe(c=>{c.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+t,{name:r})),this.groupDataService.clearGroupLinkRequests(a._links.subgroups.href)):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+t,{name:r}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(N.O),e.\u0275\u0275directiveInject(E.sK),e.\u0275\u0275directiveInject($.T),e.\u0275\u0275directiveInject(p.qu),e.\u0275\u0275directiveInject(S.N),e.\u0275\u0275directiveInject(P.F0))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-subgroups-list"]],inputs:{messagePrefix:"messagePrefix"},decls:31,vars:28,consts:[[1,"border-bottom","pb-2"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group","mr-3"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary","float-right",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groupsSearch",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[1,"align-middle"],[4,"ngFor","ngForOf"],[3,"routerLink","click"],[1,"btn-group","edit-field"],["class","btn btn-outline-danger btn-sm deleteButton",3,"title","click",4,"ngIf"],[4,"ngIf"],["class","btn btn-outline-primary btn-sm addButton",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm","deleteButton",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm","addButton",3,"title","click"],[1,"fas","fa-plus","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","subgroupsOfGroup",1,"table","table-striped","table-hover","table-bordered"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"h3",0),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"h4",1),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"form",2),e.\u0275\u0275listener("ngSubmit",function(){return n.search(n.searchForm.value)}),e.\u0275\u0275elementStart(8,"div",3)(9,"div",4),e.\u0275\u0275element(10,"input",5),e.\u0275\u0275elementStart(11,"span",6)(12,"button",7),e.\u0275\u0275element(13,"i",8),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(16,"div")(17,"button",9),e.\u0275\u0275listener("click",function(){return n.clearFormAndResetResult()}),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(20,pt,22,24,"ds-pagination",10),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275template(22,ct,3,3,"div",11),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275elementStart(24,"h4"),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(27,dt,22,24,"ds-pagination",10),e.\u0275\u0275pipe(28,"async"),e.\u0275\u0275template(29,mt,3,3,"div",11),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275elementContainerEnd()),2&t){let r,a,c,m;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,10,n.messagePrefix+".head")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(6,12,n.messagePrefix+".search.head")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.searchForm),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(15,14,n.messagePrefix+".search.button")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(19,16,n.messagePrefix+".button.see-all")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(21,18,n.searchResults$))||null==r.payload?null:r.payload.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(a=e.\u0275\u0275pipeBind1(23,20,n.searchResults$))||null==a.payload?null:a.payload.totalElements)&&n.searchDone),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(26,22,n.messagePrefix+".headSubgroups")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(c=e.\u0275\u0275pipeBind1(28,24,n.subGroups$))||null==c.payload?null:c.payload.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(m=e.\u0275\u0275pipeBind1(30,26,n.subGroups$))||null==m.payload?null:m.payload.totalElements))}},directives:[p._Y,p.JL,p.sg,p.Fj,p.JJ,p.u,f.O5,V.Q,f.sg,P.yS],pipes:[E.X$,f.Ov],encapsulation:2}),i})();function ht(i,o){1&i&&e.\u0275\u0275element(0,"div")}function ft(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"h2",14),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".head.create"))}}function vt(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"h2",14),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".head.edit"))}}function bt(i,o){if(1&i&&e.\u0275\u0275element(0,"ds-alert",15),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("type",t.AlertTypeEnum.Warning)("content",t.messagePrefix+".alert.permanent")}}const St=function(i,o,t){return{name:i,comcol:o,comcolEditRolesRoute:t}};function xt(i,o){if(1&i&&(e.\u0275\u0275element(0,"ds-alert",15),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async")),2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275property("type",t.AlertTypeEnum.Warning)("content",e.\u0275\u0275pipeBind2(1,2,t.messagePrefix+".alert.workflowGroup",e.\u0275\u0275pureFunction3(11,St,null==(n=e.\u0275\u0275pipeBind1(2,5,t.getLinkedDSO(t.groupBeingEdited)))||null==n.payload?null:n.payload.name,null==(n=e.\u0275\u0275pipeBind1(3,7,t.getLinkedDSO(t.groupBeingEdited)))||null==n.payload?null:n.payload.type,e.\u0275\u0275pipeBind1(4,9,t.getLinkedEditRolesRoute(t.groupBeingEdited)))))}}function _t(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",16)(1,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().delete()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275element(3,"i",18),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(2,2,t.canEdit$)||t.groupBeingEdited.permanent),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,4,t.messagePrefix+".actions.delete")," ")}}function yt(i,o){if(1&i&&e.\u0275\u0275element(0,"ds-members-list",19),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("messagePrefix",t.messagePrefix+".members-list")}}function Pt(i,o){if(1&i&&e.\u0275\u0275element(0,"ds-subgroups-list",19),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("messagePrefix",t.messagePrefix+".subgroups-list")}}let me=(()=>{class i{constructor(t,n,r,a,c,m,g,d,D,F,z,ee){this.groupDataService=t,this.ePersonDataService=n,this.dSpaceObjectDataService=r,this.formBuilderService=a,this.translateService=c,this.notificationsService=m,this.route=g,this.router=d,this.authorizationService=D,this.modalService=F,this.requestService=z,this.changeDetectorRef=ee,this.messagePrefix="admin.access-control.groups.form",this.formId="group-form",this.formLayout={groupName:{grid:{host:"row"}},groupDescription:{grid:{host:"row"}}},this.submitForm=new e.EventEmitter,this.cancelForm=new e.EventEmitter,this.subs=[],this.AlertTypeEnum=Qe.N}ngOnInit(){this.initialisePage()}initialisePage(){this.subs.push(this.route.params.subscribe(t=>{"newGroup"!==t.groupId&&this.setActiveGroup(t.groupId)})),this.canEdit$=this.groupDataService.getActiveGroup().pipe((0,l.tz)(),(0,b.w)(t=>(0,I.a)(this.authorizationService.isAuthorized(w.i.CanDelete,(0,l.UE)(t)?t.self:void 0),this.hasLinkedDSO(t),(n,r)=>n&&!r))),(0,I.a)(this.translateService.get(`${this.messagePrefix}.groupName`),this.translateService.get(`${this.messagePrefix}.groupCommunity`),this.translateService.get(`${this.messagePrefix}.groupDescription`)).subscribe(([t,n,r])=>{this.groupName=new T.b1u({id:"groupName",label:t,name:"groupName",validators:{required:null},required:!0}),this.groupCommunity=new T.b1u({id:"groupCommunity",label:n,name:"groupCommunity",required:!1,readOnly:!0}),this.groupDescription=new T.HBf({id:"groupDescription",label:r,name:"groupDescription",required:!1}),this.formModel=[this.groupName,this.groupDescription],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.formGroup.controls.groupName&&(this.formGroup.controls.groupName.setAsyncValidators(class We{static createValidator(o){return t=>o.searchGroups(t.value,{currentPage:1,elementsPerPage:100}).pipe((0,u.LQ)(),(0,h.U)(n=>n.filter(r=>r.name===t.value)),(0,h.U)(n=>n.length>0?{groupExists:!0}:null))}}.createValidator(this.groupDataService)),this.groupNameValueChangeSubscribe=this.groupName.valueChanges.pipe((0,ne.b)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()})),this.subs.push((0,I.a)(this.groupDataService.getActiveGroup(),this.canEdit$,this.groupDataService.getActiveGroup().pipe((0,Ue.h)(a=>(0,l.Uh)(a)),(0,b.w)(a=>this.getLinkedDSO(a).pipe((0,u.Gp)())))).subscribe(([a,c,m])=>{var g;null!=a&&(this.formGroup.controls.groupName.clearAsyncValidators(),this.groupBeingEdited=a,(null==m?void 0:m.name)?(this.formBuilderService.insertFormGroupControl(1,this.formGroup,this.formModel,this.groupCommunity),this.formGroup.patchValue({groupName:a.name,groupCommunity:null!==(g=null==m?void 0:m.name)&&void 0!==g?g:"",groupDescription:a.firstMetadataValue("dc.description")})):(this.formModel=[this.groupName,this.groupDescription],this.formGroup.patchValue({groupName:a.name,groupDescription:a.firstMetadataValue("dc.description")})),setTimeout(()=>{(!c||a.permanent)&&this.formGroup.disable()},200))}))})}onCancel(){this.groupDataService.cancelEditGroup(),this.cancelForm.emit(),this.router.navigate([this.groupDataService.getGroupRegistryRouterLink()])}onSubmit(){this.groupDataService.getActiveGroup().pipe((0,v.q)(1)).subscribe(t=>{null===t?this.createNewGroup({name:this.groupName.value,metadata:{"dc.description":[{value:this.groupDescription.value}]}}):this.editGroup(t)})}createNewGroup(t){const n=Object.assign(new ze.Z,t);this.groupDataService.create(n).pipe((0,u.hC)()).subscribe(r=>{r.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.created.success",{name:n.name})),this.submitForm.emit(n),(0,l.UE)(r.payload)&&(this.setActiveGroupWithLink(r.payload._links.self.href),this.groupDataService.clearGroupsRequests(),this.router.navigateByUrl(this.groupDataService.getGroupEditPageRouterLinkWithID(r.payload.uuid)))):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.created.failure",{name:n.name})),this.showNotificationIfNameInUse(n,"created"),this.cancelForm.emit())})}showNotificationIfNameInUse(t,n){this.subs.push(this.groupDataService.searchGroups(t.name,{currentPage:1,elementsPerPage:0}).pipe((0,u.xw)(),(0,u.xe)()).subscribe(r=>{r.totalElements>0&&this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification."+n+".failure.groupNameInUse",{name:t.name}))}))}editGroup(t){let n=[];(0,l.Uh)(this.groupDescription.value)&&(n=[...n,{op:"replace",path:"/metadata/dc.description/0/value",value:this.groupDescription.value}]),(0,l.Uh)(this.groupName.value)&&(n=[...n,{op:"replace",path:"/name",value:this.groupName.value}]),this.groupDataService.patch(t,n).pipe((0,u.hC)()).subscribe(r=>{r.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.edited.success",{name:r.payload.name})),this.submitForm.emit(r.payload)):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.edited.failure",{name:t.name})),this.cancelForm.emit())})}setActiveGroup(t){this.groupDataService.cancelEditGroup(),this.groupDataService.findById(t).pipe((0,u.xw)(),(0,u.xe)()).subscribe(n=>{this.groupDataService.editGroup(n)})}setActiveGroupWithLink(t){this.groupDataService.getActiveGroup().pipe((0,v.q)(1)).subscribe(n=>{null===n&&(this.groupDataService.cancelEditGroup(),this.groupDataService.findByHref(t,!1,!1,(0,A.l)("subgroups"),(0,A.l)("epersons"),(0,A.l)("object")).pipe((0,u.xw)(),(0,u.xe)()).subscribe(r=>{this.groupDataService.editGroup(r)}))})}delete(){this.groupDataService.getActiveGroup().pipe((0,v.q)(1)).subscribe(t=>{const n=this.modalService.open(y.Y);n.componentInstance.dso=t,n.componentInstance.headerLabel=this.messagePrefix+".delete-group.modal.header",n.componentInstance.infoLabel=this.messagePrefix+".delete-group.modal.info",n.componentInstance.cancelLabel=this.messagePrefix+".delete-group.modal.cancel",n.componentInstance.confirmLabel=this.messagePrefix+".delete-group.modal.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,v.q)(1)).subscribe(r=>{r&&(0,l.Uh)(t.id)&&this.groupDataService.delete(t.id).pipe((0,u.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.deleted.success",{name:t.name})),this.onCancel()):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.deleted.failure.title",{name:t.name}),this.translateService.get(this.messagePrefix+".notification.deleted.failure.content",{cause:a.errorMessage}))})})})}ngOnDestroy(){this.groupDataService.cancelEditGroup(),this.subs.filter(t=>(0,l.Uh)(t)).forEach(t=>t.unsubscribe()),(0,l.Uh)(this.groupNameValueChangeSubscribe)&&this.groupNameValueChangeSubscribe.unsubscribe()}hasLinkedDSO(t){if((0,l.Uh)(t)&&(0,l.Uh)(t._links.object.href))return this.getLinkedDSO(t).pipe((0,h.U)(n=>(0,l.Uh)(n)&&(0,l.Uh)(n.payload)),(0,pe.K)(()=>(0,C.of)(!1)))}getLinkedDSO(t){if((0,l.Uh)(t)&&(0,l.Uh)(t._links.object.href))return void 0===t.object?this.dSpaceObjectDataService.findByHref(t._links.object.href):t.object}getLinkedEditRolesRoute(t){if((0,l.Uh)(t)&&(0,l.Uh)(t._links.object.href))return this.getLinkedDSO(t).pipe((0,h.U)(n=>{if((0,l.Uh)(n)&&(0,l.Uh)(n.payload))switch(n.payload.type){case He.S.type.value:return(0,Ve.eq)(n.payload.id);case qe.F.type.value:return(0,Ne.Po)(n.payload.id)}}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(N.O),e.\u0275\u0275directiveInject(k.k),e.\u0275\u0275directiveInject(ce.D),e.\u0275\u0275directiveInject(re.c),e.\u0275\u0275directiveInject(E.sK),e.\u0275\u0275directiveInject($.T),e.\u0275\u0275directiveInject(P.gz),e.\u0275\u0275directiveInject(P.F0),e.\u0275\u0275directiveInject(x._),e.\u0275\u0275directiveInject(R.FF),e.\u0275\u0275directiveInject(_.s),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-group-form"]],hostBindings:function(t,n){1&t&&e.\u0275\u0275listener("beforeunload",function(){return n.ngOnDestroy()},!1,e.\u0275\u0275resolveWindow)},outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},decls:23,vars:22,consts:[[1,"container"],[1,"group-form","row"],[1,"col-12"],[4,"ngIf","ngIfThen","ngIfElse"],["createHeader",""],["editheader",""],[3,"type","content",4,"ngIf"],[3,"formId","formModel","formGroup","formLayout","displayCancel","submitForm"],["before","",1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["after","","class","btn-group",4,"ngIf"],[1,"mb-5"],[3,"messagePrefix",4,"ngIf"],[1,"border-bottom","pb-2"],[3,"type","content"],["after","",1,"btn-group"],[1,"btn","btn-danger","delete-button",3,"disabled","click"],[1,"fa","fa-trash"],[3,"messagePrefix"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275template(3,ht,1,0,"div",3),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,ft,3,3,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(7,vt,3,3,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(9,bt,1,2,"ds-alert",6),e.\u0275\u0275template(10,xt,5,15,"ds-alert",6),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275elementStart(13,"ds-form",7),e.\u0275\u0275listener("submitForm",function(){return n.onSubmit()}),e.\u0275\u0275elementStart(14,"div",8)(15,"button",9),e.\u0275\u0275listener("click",function(){return n.onCancel()}),e.\u0275\u0275element(16,"i",10),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(19,_t,6,6,"div",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",12),e.\u0275\u0275template(21,yt,1,1,"ds-members-list",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(22,Pt,1,1,"ds-subgroups-list",13),e.\u0275\u0275elementEnd()()()),2&t){const r=e.\u0275\u0275reference(6),a=e.\u0275\u0275reference(8);e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,14,n.groupDataService.getActiveGroup()))("ngIfThen",a)("ngIfElse",r),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",null==n.groupBeingEdited?null:n.groupBeingEdited.permanent),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(11,16,n.canEdit$)&&e.\u0275\u0275pipeBind1(12,18,n.groupDataService.getActiveGroup())),e.\u0275\u0275advance(3),e.\u0275\u0275property("formId",n.formId)("formModel",n.formModel)("formGroup",n.formGroup)("formLayout",n.formLayout)("displayCancel",!1),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,20,n.messagePrefix+".return"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null!=n.groupBeingEdited),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null!=n.groupBeingEdited),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null!=n.groupBeingEdited)}},directives:[f.O5,Xe.w,oe.U,p.JL,p.sg,rt,gt],pipes:[f.Ov,E.X$],encapsulation:2}),i})();var It=s(27164),Et=s(27303);class Ct{}var Bt=s(43685);function Ft(i,o){1&i&&e.\u0275\u0275element(0,"ds-themed-loading")}const ge=function(i){return{name:i}};function Gt(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"button",30),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",31),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,2,n.messagePrefix+"table.edit.buttons.edit",e.\u0275\u0275pureFunction1(5,ge,t.group.name))),e.\u0275\u0275property("routerLink",n.groupService.getGroupEditPageRouterLink(t.group))}}function Dt(i,o){1&i&&(e.\u0275\u0275elementStart(0,"button",32),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",31),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("disabled",!0)("ngbTooltip",e.\u0275\u0275pipeBind1(1,2,"admin.access-control.epeople.table.edit.buttons.edit-disabled"))}function wt(i,o){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",33),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).deleteGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",34),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+"table.edit.buttons.remove",e.\u0275\u0275pureFunction1(4,ge,t.group.name)))}}function Tt(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"tr")(1,"td"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"td"),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"td"),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"td")(11,"div",25),e.\u0275\u0275elementContainerStart(12,26),e.\u0275\u0275template(13,Gt,3,7,"button",27),e.\u0275\u0275template(14,Dt,3,4,"button",28),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(15,wt,3,6,"button",29),e.\u0275\u0275elementEnd()()()),2&i){const t=o.$implicit;let n;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.group.id),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.group.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(n=e.\u0275\u0275pipeBind1(7,8,t.group.object))||null==n.payload?null:n.payload.name),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate((null==t.epersons?null:t.epersons.totalElements)+(null==t.subgroups?null:t.subgroups.totalElements)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngSwitch",t.ableToEdit),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",!0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",!1),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null!=t.group&&t.group.permanent)&&t.ableToDelete)}}function Lt(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",20),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"div",21)(3,"table",22)(4,"thead")(5,"tr")(6,"th",23),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"th",23),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"th",23),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"th",23),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"th"),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(21,"tbody"),e.\u0275\u0275template(22,Tt,16,10,"tr",24),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",t.pageInfoState$)("collectionSize",null==(n=e.\u0275\u0275pipeBind1(1,11,t.pageInfoState$))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,13,t.messagePrefix+"table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,15,t.messagePrefix+"table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,17,t.messagePrefix+"table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,19,t.messagePrefix+"table.members")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(20,21,t.messagePrefix+"table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(23,23,t.groupsDto$))?null:r.page)}}function Ot(i,o){if(1&i&&(e.\u0275\u0275elementStart(0,"div",35),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+"no-items")," ")}}const $t=function(){return["newGroup"]};let Rt=(()=>{class i{constructor(t,n,r,a,c,m,g,d,D,F,z){this.groupService=t,this.ePersonDataService=n,this.dSpaceObjectDataService=r,this.translateService=a,this.notificationsService=c,this.formBuilder=m,this.routeService=g,this.router=d,this.authorizationService=D,this.paginationService=F,this.requestService=z,this.messagePrefix="admin.access-control.groups.",this.config=Object.assign(new L.r,{id:"gl",pageSize:5,currentPage:1}),this.groupsDto$=new B.X({}),this.deletedGroupsIds=[],this.pageInfoState$=new B.X(void 0),this.loading$=new B.X(!1),this.subs=[],this.currentSearchQuery="",this.searchForm=this.formBuilder.group({query:this.currentSearchQuery})}ngOnInit(){this.search({query:this.currentSearchQuery})}search(t){(0,l.Uh)(this.searchSub)&&(this.searchSub.unsubscribe(),this.subs=this.subs.filter(n=>n!==this.searchSub)),this.searchSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,Et.b)(()=>this.loading$.next(!0)),(0,b.w)(n=>{const r=t.query;return null!=r&&this.currentSearchQuery!==r&&(this.currentSearchQuery=r,this.paginationService.updateRouteWithUrl(this.config.id,[],{page:1})),this.groupService.searchGroups(this.currentSearchQuery.trim(),{currentPage:n.currentPage,elementsPerPage:n.pageSize},!0,!0,(0,A.l)("object"))}),(0,u.g1)(),(0,u.xe)(),(0,b.w)(n=>0===n.page.length?(0,C.of)((0,O.b)(n.pageInfo,[])):this.authorizationService.isAuthorized(w.i.AdministratorOf).pipe((0,b.w)(r=>(0,I.a)([...n.page.map(a=>(0,l.Uh)(a)&&!this.deletedGroupsIds.includes(a.id)?(0,I.a)([this.authorizationService.isAuthorized(w.i.CanDelete,a.self),this.canManageGroup$(r,a),this.hasLinkedDSO(a),this.getSubgroups(a),this.getMembers(a)]).pipe((0,h.U)(([c,m,g,d,D])=>{const F=new Ct;return F.ableToDelete=c&&!g,F.ableToEdit=m,F.group=a,F.subgroups=d.payload,F.epersons=D.payload,F})):It.E)]).pipe((0,X.d)([]),(0,h.U)(a=>(0,O.b)(n.pageInfo,a))))))).subscribe(n=>{this.groupsDto$.next(n),this.pageInfoState$.next(n.pageInfo),this.loading$.next(!1)}),this.subs.push(this.searchSub)}canManageGroup$(t,n){return t?(0,C.of)(!0):this.authorizationService.isAuthorized(w.i.CanManageGroup,n.self)}deleteGroup(t){(0,l.Uh)(t.group.id)&&this.groupService.delete(t.group.id).pipe((0,u.hC)()).subscribe(n=>{n.hasSucceeded?(this.deletedGroupsIds=[...this.deletedGroupsIds,t.group.id],this.notificationsService.success(this.translateService.get(this.messagePrefix+"notification.deleted.success",{name:t.group.name}))):this.notificationsService.error(this.translateService.get(this.messagePrefix+"notification.deleted.failure.title",{name:t.group.name}),this.translateService.get(this.messagePrefix+"notification.deleted.failure.content",{cause:n.errorMessage}))})}getMembers(t){return this.ePersonDataService.findListByHref(t._links.epersons.href).pipe((0,u.xw)())}getSubgroups(t){return this.groupService.findListByHref(t._links.subgroups.href).pipe((0,u.xw)())}hasLinkedDSO(t){return this.dSpaceObjectDataService.findByHref(t._links.object.href).pipe((0,u.xw)(),(0,h.U)(n=>(0,l.Uh)(n)&&(0,l.Uh)(n.payload)),(0,pe.K)(()=>(0,C.of)(!1)))}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){(0,l.Uh)(this.paginationSub)&&this.paginationSub.unsubscribe(),this.subs.filter(t=>(0,l.Uh)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(N.O),e.\u0275\u0275directiveInject(k.k),e.\u0275\u0275directiveInject(ce.D),e.\u0275\u0275directiveInject(E.sK),e.\u0275\u0275directiveInject($.T),e.\u0275\u0275directiveInject(p.qu),e.\u0275\u0275directiveInject(Bt.MZ),e.\u0275\u0275directiveInject(P.F0),e.\u0275\u0275directiveInject(x._),e.\u0275\u0275directiveInject(S.N),e.\u0275\u0275directiveInject(_.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-groups-registry"]],decls:38,vars:35,consts:[[1,"container"],[1,"groups-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn-group","edit-field"],[3,"ngSwitch"],["class","btn btn-outline-primary btn-sm btn-edit",3,"routerLink","title",4,"ngSwitchCase"],["class","btn btn-outline-primary btn-sm btn-edit","placement","left",3,"disabled","ngbTooltip",4,"ngSwitchCase"],["class","btn btn-outline-danger btn-sm btn-delete",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],["placement","left",1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"disabled","ngbTooltip"],[1,"btn","btn-outline-danger","btn-sm","btn-delete",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div")(8,"button",5),e.\u0275\u0275element(9,"i",6),e.\u0275\u0275elementStart(10,"span",7),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(13,"h3",8),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"form",9),e.\u0275\u0275listener("ngSubmit",function(){return n.search(n.searchForm.value)}),e.\u0275\u0275elementStart(17,"div",10)(18,"div",11),e.\u0275\u0275element(19,"input",12),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275elementStart(22,"span",13)(23,"button",14),e.\u0275\u0275element(24,"i",15),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(27,"div")(28,"button",16),e.\u0275\u0275listener("click",function(){return n.clearFormAndResetResult()}),e.\u0275\u0275text(29),e.\u0275\u0275pipe(30,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(31,Ft,1,0,"ds-themed-loading",17),e.\u0275\u0275pipe(32,"async"),e.\u0275\u0275template(33,Lt,24,25,"ds-pagination",18),e.\u0275\u0275pipe(34,"async"),e.\u0275\u0275pipe(35,"async"),e.\u0275\u0275template(36,Ot,3,3,"div",19),e.\u0275\u0275pipe(37,"async"),e.\u0275\u0275elementEnd()()()),2&t){let r,a;e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,12,n.messagePrefix+"head")),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction0(34,$t)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,14,n.messagePrefix+"button.add")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,16,n.messagePrefix+"search.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.searchForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("placeholder",e.\u0275\u0275pipeBind1(21,20,n.messagePrefix+"search.placeholder")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(20,18,n.messagePrefix+"search.placeholder")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,22,n.messagePrefix+"search.button")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(30,24,n.messagePrefix+"button.see-all")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(32,26,n.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(34,28,n.pageInfoState$))?null:r.totalElements)>0&&!e.\u0275\u0275pipeBind1(35,30,n.loading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0==(null==(a=e.\u0275\u0275pipeBind1(37,32,n.pageInfoState$))?null:a.totalElements))}},directives:[P.rH,p._Y,p.JL,p.sg,p.Fj,p.JJ,p.u,f.O5,W.Z,V.Q,f.sg,f.RF,f.n9,R._L],pipes:[E.X$,f.Ov],encapsulation:2}),i})();var Z=s(12838),Q=s(64561),jt=s(65913),Mt=s(19339);let kt=(()=>{class i extends jt.I{constructor(t,n,r,a){super(n,r,a),this.halEndpointService=t,this.authorizationService=n,this.router=r,this.authService=a,this.groupsEndpoint="groups"}getFeatureIDs(t,n){return(0,C.of)([w.i.CanManageGroup])}getObjectUrl(t,n){return this.halEndpointService.getEndpoint(this.groupsEndpoint).pipe((0,h.U)(r=>{var a;return`${r}/${null===(a=null==t?void 0:t.params)||void 0===a?void 0:a.groupId}`}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(Mt.q),e.\u0275\u0275inject(x._),e.\u0275\u0275inject(P.F0),e.\u0275\u0275inject(ae.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var he=s(41461),At=s(2092);let Ut=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({imports:[[P.Bz.forChild([{path:"epeople",component:Ae,resolve:{breadcrumb:Q.t},data:{title:"admin.access-control.epeople.title",breadcrumbKey:"admin.access-control.epeople"},canActivate:[At.X]},{path:Z.CH,component:Rt,resolve:{breadcrumb:Q.t},data:{title:"admin.access-control.groups.title",breadcrumbKey:"admin.access-control.groups"},canActivate:[he.E]},{path:`${Z.CH}/newGroup`,component:me,resolve:{breadcrumb:Q.t},data:{title:"admin.access-control.groups.title.addGroup",breadcrumbKey:"admin.access-control.groups.addGroup"},canActivate:[he.E]},{path:`${Z.CH}/:groupId`,component:me,resolve:{breadcrumb:Q.t},data:{title:"admin.access-control.groups.title.singleGroup",breadcrumbKey:"admin.access-control.groups.singleGroup"},canActivate:[kt]}])]]}),i})();var Nt=s(48197);let Vt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({imports:[[f.ez,H.m,P.Bz,Ut,Nt.e]]}),i})()},37188:(fe,q,s)=>{s.d(q,{m:()=>w});var f=s(37958),P=s(19339),H=s(61449),B=s(77007),I=s(48358),b=s(66154),h=s(25839),v=s(53116),O=s(5496),k=s(47820),l=s(70074);let $=(()=>{class x{parse(y,_){const G=_.payload,S=Object.assign(new v.Y,G);return new k.tp(_.statusCode,void 0,S)}}return x.\u0275fac=function(y){return new(y||x)},x.\u0275prov=l.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"}),x})();var L=s(41881),U=s(78819);let w=(()=>{class x{constructor(y,_,G){this.requestService=y,this.rdbService=_,this.halService=G,this.linkPath="registrations",this.searchByTokenPath="/search/findByToken?token="}getRegistrationEndpoint(){return this.halService.getEndpoint(this.linkPath)}getTokenSearchEndpoint(y){return this.halService.getEndpoint(this.linkPath).pipe((0,B.h)(_=>(0,h.UE)(_)),(0,I.U)(_=>`${_}${this.searchByTokenPath}${y}`))}registerEmail(y,_=null){const G=new v.Y;G.email=y;const S=this.requestService.generateRequestId(),e=this.getRegistrationEndpoint(),E=Object.create({});let p=new U.WM;return _&&(p=p.append("x-recaptcha-token",_)),E.headers=p,e.pipe((0,b.s)(R=>(0,h.Uh)(R)),(0,I.U)(R=>{const T=new H.xo(S,R,G,E);this.requestService.send(T)})).subscribe(),this.rdbService.buildFromRequestUUID(S).pipe((0,O.hC)())}searchByToken(y){const _=this.requestService.generateRequestId(),G=this.getTokenSearchEndpoint(y).pipe((0,b.s)(S=>(0,h.Uh)(S)));return G.subscribe(S=>{const e=new H.Gl(_,S);Object.assign(e,{getResponseParser:()=>$}),this.requestService.send(e,!0)}),this.rdbService.buildSingle(G).pipe((0,I.U)(S=>S.hasSucceeded&&(0,h.Uh)(S.payload)?Object.assign(S,{payload:Object.assign(S.payload,{token:y})}):S))}}return x.\u0275fac=function(y){return new(y||x)(l.\u0275\u0275inject(f.s),l.\u0275\u0275inject(L.Q),l.\u0275\u0275inject(P.q))},x.\u0275prov=l.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()}}]);