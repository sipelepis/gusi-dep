"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[8412,8723],{20069:(U,M,r)=>{r.d(M,{u:()=>d});var a=r(59492),O=(r(62610),r(25839)),B=r(53019),y=r(61001),I=r(5496),e=r(24656),R=r(16228),b=r(57017),E=r(70074),F=r(86553),D=r(10210),A=r(61792),t=r(45028);function S(f,s){if(1&f&&E.\u0275\u0275element(0,"ds-form",1),2&f){const o=E.\u0275\u0275nextContext();E.\u0275\u0275property("formId","profile-page-metadata-form-id")("formModel",o.formModel)("formGroup",o.formGroup)("displaySubmit",!1)("displayCancel",!1)}}let d=(()=>{class f{constructor(o,m,_,V){this.formBuilderService=o,this.translate=m,this.epersonService=_,this.notificationsService=V,this.formModel=[new a.b1u({id:"email",name:"email",readOnly:!0}),new a.b1u({id:"firstname",name:"eperson.firstname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new a.b1u({id:"lastname",name:"eperson.lastname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"}}),new a.b1u({id:"phone",name:"eperson.phone"}),new a.nMt({id:"language",name:"eperson.language"})],this.LABEL_PREFIX="profile.metadata.form.label.",this.ERROR_PREFIX="profile.metadata.form.error.",this.NOTIFICATION_PREFIX="profile.metadata.form.notifications."}ngOnInit(){this.activeLangs=b.N.languages.filter(o=>!0===o.active),this.setFormValues(),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}setFormValues(){this.formModel.forEach(o=>{o.value="email"===o.name?this.user.email:this.user.firstMetadataValue(o.name),"language"===o.id&&(o.options=this.activeLangs.map(m=>Object.assign({value:m.code,label:m.label})))}),this.formGroup=this.formBuilderService.createFormGroup(this.formModel)}updateFieldTranslations(){this.formModel.forEach(o=>{o.label=this.translate.instant(this.LABEL_PREFIX+o.id),(0,O.UE)(o.validators)&&(o.errorMessages={},Object.keys(o.validators).forEach(m=>{o.errorMessages[m]=this.translate.instant(this.ERROR_PREFIX+o.id+"."+m)}))})}updateProfile(){if(!this.formGroup.valid)return!1;const o=(0,y.cloneDeep)(this.user.metadata);let m=!1;return this.formModel.filter(_=>"email"!==_.id).forEach(_=>{o.hasOwnProperty(_.name)&&o[_.name].length>0?(0,O.Uh)(_.value)?o[_.name][0].value!==_.value&&(o[_.name][0].value=_.value,m=!0):(o[_.name]=[],m=!0):(0,O.Uh)(_.value)&&(o[_.name]=[{value:_.value,language:null}],m=!0)}),m&&this.epersonService.update(Object.assign((0,y.cloneDeep)(this.user),{metadata:o})).pipe((0,I.xw)(),(0,I.xe)()).subscribe(_=>{this.user=_,this.setFormValues(),this.notificationsService.success(this.translate.instant(this.NOTIFICATION_PREFIX+"success.title"),this.translate.instant(this.NOTIFICATION_PREFIX+"success.content"))}),m}}return f.\u0275fac=function(o){return new(o||f)(E.\u0275\u0275directiveInject(e.c),E.\u0275\u0275directiveInject(F.sK),E.\u0275\u0275directiveInject(B.k),E.\u0275\u0275directiveInject(R.T))},f.\u0275cmp=E.\u0275\u0275defineComponent({type:f,selectors:[["ds-profile-page-metadata-form"]],inputs:{user:"user"},decls:1,vars:1,consts:[[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"]],template:function(o,m){1&o&&E.\u0275\u0275template(0,S,1,5,"ds-form",0),2&o&&E.\u0275\u0275property("ngIf",m.formModel)},directives:[D.O5,A.U,t.JL,t.sg],encapsulation:2}),f})()},25619:(U,M,r)=>{r.d(M,{V:()=>Y});var a=r(35841),C=r(77176),O=r(21160),B=r(48358),y=r(27303),L=r(69637),I=r(5496),e=r(70074),R=r(15007),b=r(96007),F=(r(44661),r(84484)),D=r(72262),A=r(91351),t=r(35053),S=r(37895),d=r(10210),f=r(99967),s=r(86553);function o(l,g){if(1&l){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",8)(1,"button",15,16),e.\u0275\u0275listener("click",function(){const x=e.\u0275\u0275restoreView(n).$implicit;return e.\u0275\u0275nextContext().selectItem(x.indexableObject)}),e.\u0275\u0275element(3,"ds-listable-object-component-loader",17),e.\u0275\u0275elementEnd()()}if(2&l){const n=g.$implicit,c=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",n.indexableObject.name),e.\u0275\u0275advance(2),e.\u0275\u0275property("object",n)("viewMode",c.viewMode)("linkType",c.linkTypes.None)}}let m=(()=>{class l extends R.q{constructor(n,c,P,x){super(n,c),this.activeModal=n,this.route=c,this.router=P,this.profileClaimService=x,this.listEntries$=new a.X(null),this.viewMode=F.w.ListElement,this.linkTypes=A.m,this.checked=!1,this.create=new e.EventEmitter}ngOnInit(){this.profileClaimService.searchForSuggestions(this.dso).pipe((0,I.hC)()).subscribe(n=>this.listEntries$.next(n))}selectItem(n){this.close(),this.navigate(n)}navigate(n){this.router.navigate([(0,b.Tt)(n)])}toggleCheckbox(){this.checked=!this.checked}createFromScratch(){this.create.emit(),this.close()}}return l.\u0275fac=function(n){return new(n||l)(e.\u0275\u0275directiveInject(t.Kz),e.\u0275\u0275directiveInject(S.gz),e.\u0275\u0275directiveInject(S.F0),e.\u0275\u0275directiveInject(D.n))},l.\u0275cmp=e.\u0275\u0275defineComponent({type:l,selectors:[["ds-profile-claim-item-modal"]],inputs:{dso:"dso"},outputs:{create:"create"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:27,vars:17,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["role","alert",1,"alert","alert-info"],[1,"dropdown-divider"],[1,"scrollable-menu","list-group","container"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md","mt-2"],[1,"modal-footer"],[1,"mr-5"],["type","checkbox",3,"checked","change"],["type","submit",1,"btn","btn-primary","ml-5","mr-2",3,"disabled","click"],[1,"fas","fa-plus"],[1,"list-group-item","list-group-item-action","border-0","list-entry",3,"title","click"],["listEntryElement",""],[3,"object","viewMode","linkType"]],template:function(n,c){if(1&n&&(e.\u0275\u0275elementStart(0,"div")(1,"div",0)(2,"h4"),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",1),e.\u0275\u0275listener("click",function(){return c.close()}),e.\u0275\u0275elementStart(6,"span",2),e.\u0275\u0275text(7,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(8,"div",3)(9,"div",4),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(12,"div",5),e.\u0275\u0275elementStart(13,"div",6),e.\u0275\u0275template(14,o,4,4,"div",7),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275elementStart(16,"div",8),e.\u0275\u0275element(17,"div",9),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(18,"div",10)(19,"div",11)(20,"input",12),e.\u0275\u0275listener("change",function(){return c.toggleCheckbox()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"button",13),e.\u0275\u0275listener("click",function(){return c.createFromScratch()}),e.\u0275\u0275element(24,"i",14),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()()),2&n){let P;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,7,"dso-selector.claim.item.head")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(11,9,"dso-selector.claim.item.body")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",null==(P=e.\u0275\u0275pipeBind1(15,11,c.listEntries$))?null:P.payload.page),e.\u0275\u0275advance(6),e.\u0275\u0275property("checked",c.checked),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(22,13,"dso-selector.claim.item.not-mine-label")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!c.checked),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,15,"dso-selector.claim.item.create-from-scratch")," ")}},directives:[d.sg,f.p],pipes:[s.X$,d.Ov],encapsulation:2}),l})();var _=r(16228),V=r(28709),w=(r(62610),r(7261)),W=r(25839),K=r(8183),j=r(25366),$=r(41633),X=r(27739);function G(l,g){if(1&l){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"p",3)(5,"span",4),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"ui-switch",5),e.\u0275\u0275listener("change",function(){e.\u0275\u0275restoreView(n);const P=e.\u0275\u0275nextContext().ngVar;return e.\u0275\u0275nextContext().toggleProfileVisibility(P)}),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd()()()}if(2&l){const n=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,5,"researcher.profile.associated")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,7,"researcher.profile.status")),e.\u0275\u0275advance(2),e.\u0275\u0275property("checkedLabel",e.\u0275\u0275pipeBind1(9,9,"researcher.profile.public.visibility"))("uncheckedLabel",e.\u0275\u0275pipeBind1(10,11,"researcher.profile.private.visibility"))("checked",n.visible)}}function p(l,g){1&l&&(e.\u0275\u0275elementStart(0,"div")(1,"p"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&l&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,1,"researcher.profile.not.associated")))}function u(l,g){1&l&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",7),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&l&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"researcher.profile.action.processing")," "))}function i(l,g){1&l&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",8),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&l&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" \xa0",e.\u0275\u0275pipeBind1(3,1,"researcher.profile.create.new")," "))}function h(l,g){if(1&l){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",6),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(n),e.\u0275\u0275nextContext(2).createProfile()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,u,4,3,"span",1),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275template(4,i,4,3,"span",1),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementEnd()}if(2&l){const n=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(1,3,n.isProcessingCreate())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(3,5,n.isProcessingCreate())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(5,7,n.isProcessingCreate()))}}function v(l,g){1&l&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",7),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&l&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"researcher.profile.action.processing")," "))}function T(l,g){1&l&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",11),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&l&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" \xa0",e.\u0275\u0275pipeBind1(3,1,"researcher.profile.delete")," "))}function N(l,g){if(1&l){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"button",6),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const P=e.\u0275\u0275nextContext().ngVar;return e.\u0275\u0275nextContext().viewProfile(P)}),e.\u0275\u0275element(2,"i",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",10),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(n);const P=e.\u0275\u0275nextContext().ngVar;return e.\u0275\u0275nextContext().deleteProfile(P)}),e.\u0275\u0275template(6,v,4,3,"span",1),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275template(8,T,4,3,"span",1),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()}if(2&l){const n=e.\u0275\u0275nextContext().ngVar,c=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!n),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,5,"researcher.profile.view")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(7,7,c.isProcessingDelete())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(9,9,c.isProcessingDelete()))}}function z(l,g){if(1&l&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,G,11,13,"div",1),e.\u0275\u0275template(2,p,4,3,"div",1),e.\u0275\u0275template(3,h,6,9,"button",2),e.\u0275\u0275template(4,N,10,11,"ng-container",1),e.\u0275\u0275elementEnd()),2&l){const n=g.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n)}}let Y=(()=>{class l{constructor(n,c,P,x,J,H,Z){this.researcherProfileService=n,this.profileClaimService=c,this.translationService=P,this.notificationService=x,this.authService=J,this.router=H,this.modalService=Z,this.researcherProfile$=new a.X(null),this.processingDelete$=new a.X(!1),this.processingCreate$=new a.X(!1)}ngOnInit(){this.initResearchProfile()}createProfile(){this.processingCreate$.next(!0),this.authService.getAuthenticatedUserFromStore().pipe((0,C.q)(1),(0,O.w)(n=>this.profileClaimService.hasProfilesToSuggest(n))).subscribe(n=>{if(n){this.processingCreate$.next(!1);const c=this.modalService.open(m);c.componentInstance.dso=this.user,c.componentInstance.create.pipe((0,C.q)(1)).subscribe(()=>{this.createProfileFromScratch()})}else this.createProfileFromScratch()})}viewProfile(n){null!=this.researcherProfileItemId&&this.router.navigate(["items",this.researcherProfileItemId])}deleteProfile(n){const c=this.modalService.open(j.Y);c.componentInstance.headerLabel="confirmation-modal.delete-profile.header",c.componentInstance.infoLabel="confirmation-modal.delete-profile.info",c.componentInstance.cancelLabel="confirmation-modal.delete-profile.cancel",c.componentInstance.confirmLabel="confirmation-modal.delete-profile.confirm",c.componentInstance.brandColor="danger",c.componentInstance.confirmIcon="fas fa-trash",c.componentInstance.response.pipe((0,C.q)(1)).subscribe(P=>{P&&(this.processingDelete$.next(!0),this.researcherProfileService.delete(n.id).pipe((0,I.hC)(),(0,B.U)(x=>x.isSuccess)).subscribe(x=>{x&&(this.researcherProfile$.next(null),this.researcherProfileItemId=null),this.processingDelete$.next(!1)}))})}toggleProfileVisibility(n){this.researcherProfileService.setVisibility(n,!n.visible).pipe((0,I.hC)()).subscribe(c=>{c.hasSucceeded?this.researcherProfile$.next(c.payload):this.notificationService.error(null,this.translationService.get("researcher.profile.change-visibility.fail"))})}isProcessingDelete(){return this.processingDelete$.asObservable()}isProcessingCreate(){return this.processingCreate$.asObservable()}createProfileFromScratch(){this.processingCreate$.next(!0),this.researcherProfileService.create().pipe((0,I.hC)()).subscribe(n=>{this.processingCreate$.next(!1),n.isSuccess?(this.initResearchProfile(),this.notificationService.success(null,this.translationService.get("researcher.profile.create.success"))):this.notificationService.error(null,this.translationService.get("researcher.profile.create.fail"))})}initResearchProfile(){this.researcherProfileService.findById(this.user.id,!1,!0,(0,K.l)("item")).pipe((0,I.Gp)(),(0,y.b)(n=>this.researcherProfile$.next(n)),(0,L.z)(n=>this.researcherProfileService.findRelatedItemId(n))).subscribe(n=>{(0,W.UE)(n)&&(this.researcherProfileItemId=n)})}}return l.\u0275fac=function(n){return new(n||l)(e.\u0275\u0275directiveInject(w.E),e.\u0275\u0275directiveInject(D.n),e.\u0275\u0275directiveInject(s.sK),e.\u0275\u0275directiveInject(_.T),e.\u0275\u0275directiveInject(V.e8),e.\u0275\u0275directiveInject(S.F0),e.\u0275\u0275directiveInject(t.FF))},l.\u0275cmp=e.\u0275\u0275defineComponent({type:l,selectors:[["ds-profile-page-researcher-form"]],inputs:{user:"user"},decls:2,vars:3,consts:[[4,"ngVar"],[4,"ngIf"],["class","btn btn-primary mr-2",3,"disabled","click",4,"ngIf"],[1,"align-items-center","researcher-profile-switch"],[1,"mr-3"],[3,"checkedLabel","uncheckedLabel","checked","change"],[1,"btn","btn-primary","mr-2",3,"disabled","click"],[1,"fas","fa-circle-notch","fa-spin"],[1,"fas","fa-plus"],[1,"fas","fa-info-circle"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-trash-alt"]],template:function(n,c){1&n&&(e.\u0275\u0275template(0,z,5,4,"div",0),e.\u0275\u0275pipe(1,"async")),2&n&&e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,1,c.researcherProfile$))},directives:[$.g,d.O5,X.ob],pipes:[d.Ov,s.X$],encapsulation:2}),l})()},48723:(U,M,r)=>{r.d(M,{V:()=>S});var a=r(70074),C=r(59492),O=r(25839),B=r(53019),y=r(16228),L=r(48358),I=r(5496),e=r(86553),R=r(7519),b=r(10210),E=r(61792),F=r(45028);function D(d,f){if(1&d&&a.\u0275\u0275element(0,"ds-form",4),2&d){const s=a.\u0275\u0275nextContext();a.\u0275\u0275property("formId",s.FORM_PREFIX)("formModel",s.formModel)("formGroup",s.formGroup)("displaySubmit",!1)("displayCancel",!1)}}function A(d,f){if(1&d&&(a.\u0275\u0275elementStart(0,"div",5),a.\u0275\u0275text(1),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275elementEnd()),2&d){const s=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(2,1,s.FORM_PREFIX+"error.matching-passwords"))}}function t(d,f){if(1&d&&(a.\u0275\u0275elementStart(0,"div",6),a.\u0275\u0275text(1),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275elementEnd()),2&d){const s=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(2,1,s.FORM_PREFIX+"error.empty-password"))}}let S=(()=>{class d{constructor(s,o,m,_){this.formService=s,this.translate=o,this.epersonService=m,this.notificationsService=_,this.isInvalid=new a.EventEmitter,this.passwordValue=new a.EventEmitter,this.currentPasswordValue=new a.EventEmitter,this.formModel=[new C.b1u({id:"password",name:"password",inputType:"password"}),new C.b1u({id:"passwordrepeat",name:"passwordrepeat",inputType:"password"})],this.passwordCanBeEmpty=!0,this.subs=[]}ngOnInit(){"profile.security.form."===this.FORM_PREFIX&&this.formModel.unshift(new C.b1u({id:"current-password",name:"current-password",inputType:"password",required:!0})),this.formGroup=this.formService.createFormGroup(this.formModel,this.passwordCanBeEmpty?{validators:[this.checkPasswordsEqual]}:{validators:[this.checkPasswordsEqual,this.checkPasswordEmpty]}),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()}),this.subs.push(this.formGroup.statusChanges.pipe((0,I.ig)(300),(0,L.U)(s=>"VALID"!==s)).subscribe(s=>this.isInvalid.emit(s))),this.subs.push(this.formGroup.valueChanges.pipe((0,I.ig)(300)).subscribe(s=>{this.passwordValue.emit(s.password),"profile.security.form."===this.FORM_PREFIX&&this.currentPasswordValue.emit(s["current-password"])}))}updateFieldTranslations(){this.formModel.forEach(s=>{s.label=this.translate.instant(this.FORM_PREFIX+"label."+s.id)})}checkPasswordsEqual(s){return s.get("password").value===s.get("passwordrepeat").value?null:{notSame:!0}}checkPasswordEmpty(s){const o=s.get("password").value;return(0,O.xb)(o)?{emptyPassword:!0}:null}ngOnDestroy(){this.subs.filter(s=>(0,O.Uh)(s)).forEach(s=>s.unsubscribe())}}return d.\u0275fac=function(s){return new(s||d)(a.\u0275\u0275directiveInject(C.w1X),a.\u0275\u0275directiveInject(e.sK),a.\u0275\u0275directiveInject(B.k),a.\u0275\u0275directiveInject(y.T))},d.\u0275cmp=a.\u0275\u0275defineComponent({type:d,selectors:[["ds-profile-page-security-form"]],inputs:{passwordCanBeEmpty:"passwordCanBeEmpty",FORM_PREFIX:"FORM_PREFIX"},outputs:{isInvalid:"isInvalid",passwordValue:"passwordValue",currentPasswordValue:"currentPasswordValue"},decls:6,vars:7,consts:[[1,"mb-4",3,"type"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],["id","notSame","class","container-fluid text-danger",4,"ngIf"],["id","emptyPassword","class","container-fluid text-danger",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"],["id","notSame",1,"container-fluid","text-danger"],["id","emptyPassword",1,"container-fluid","text-danger"]],template:function(s,o){1&s&&(a.\u0275\u0275elementStart(0,"ds-alert",0),a.\u0275\u0275text(1),a.\u0275\u0275pipe(2,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(3,D,1,5,"ds-form",1),a.\u0275\u0275template(4,A,3,3,"div",2),a.\u0275\u0275template(5,t,3,3,"div",3)),2&s&&(a.\u0275\u0275property("type","alert-info"),a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(2,5,o.FORM_PREFIX+"info")),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",o.formModel),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",o.formGroup.hasError("notSame")),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",(o.formGroup.dirty||o.formGroup.touched)&&o.formGroup.hasError("emptyPassword")))},directives:[R.w,b.O5,E.U,F.JL,F.sg],pipes:[e.X$],encapsulation:2}),d})()},18412:(U,M,r)=>{r.r(M),r.d(M,{ProfilePageComponent:()=>G});var a=r(35841),C=r(20069),O=r(16228),B=r(77007),y=r(21160),L=r(27303),I=r(53019),e=r(5496),R=r(25839),b=r(8183),E=r(28709),F=r(30835),D=r(84705),A=r(82094),t=r(70074),S=r(86553),d=r(41633),f=r(10210),s=r(25619),o=r(48723);function m(p,u){if(1&p&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275elementStart(1,"h3",12),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"div",4)(5,"div",5),t.\u0275\u0275text(6),t.\u0275\u0275pipe(7,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(8,"div",6)(9,"div",12),t.\u0275\u0275element(10,"ds-profile-page-researcher-form",7),t.\u0275\u0275elementEnd()()(),t.\u0275\u0275elementContainerEnd()),2&p){const i=t.\u0275\u0275nextContext(2).ngVar;t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(3,3,"profile.head")),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(7,5,"profile.card.researcher")),t.\u0275\u0275advance(4),t.\u0275\u0275property("user",i)}}function _(p,u){if(1&p){const i=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",13)(1,"div",5),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"div",6)(5,"ds-profile-page-security-form",14),t.\u0275\u0275listener("isInvalid",function(v){return t.\u0275\u0275restoreView(i),t.\u0275\u0275nextContext(3).setInvalid(v)})("passwordValue",function(v){return t.\u0275\u0275restoreView(i),t.\u0275\u0275nextContext(3).setPasswordValue(v)})("currentPasswordValue",function(v){return t.\u0275\u0275restoreView(i),t.\u0275\u0275nextContext(3).setCurrentPasswordValue(v)}),t.\u0275\u0275elementEnd()()()}2&p&&(t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(3,2,"profile.card.security")),t.\u0275\u0275advance(3),t.\u0275\u0275property("FORM_PREFIX","profile.security.form."))}function V(p,u){if(1&p&&(t.\u0275\u0275elementStart(0,"li",18),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),2&p){const i=u.$implicit;t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate(i.name)}}function Q(p,u){if(1&p&&(t.\u0275\u0275elementStart(0,"div")(1,"h3",15),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"ul",16),t.\u0275\u0275template(5,V,2,1,"li",17),t.\u0275\u0275elementEnd()()),2&p){const i=t.\u0275\u0275nextContext().ngVar;t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(3,2,"profile.groups.head")),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",i)}}function w(p,u){if(1&p&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,Q,6,4,"div",3),t.\u0275\u0275elementContainerEnd()),2&p){const i=u.ngVar;t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",(null==i?null:i.length)>0)}}function W(p,u){if(1&p&&(t.\u0275\u0275elementStart(0,"li",18),t.\u0275\u0275text(1),t.\u0275\u0275elementEnd()),2&p){const i=u.$implicit;t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate(i.name)}}function K(p,u){if(1&p&&(t.\u0275\u0275elementStart(0,"div",20)(1,"h3",15),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(4,"ul",16),t.\u0275\u0275template(5,W,2,1,"li",17),t.\u0275\u0275elementEnd()()),2&p){const i=t.\u0275\u0275nextContext().ngVar;t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(3,2,"profile.special.groups.head")),t.\u0275\u0275advance(3),t.\u0275\u0275property("ngForOf",i)}}function j(p,u){if(1&p&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,K,6,4,"div",19),t.\u0275\u0275elementContainerEnd()),2&p){const i=u.ngVar;t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",(null==i?null:i.length)>0)}}function $(p,u){if(1&p){const i=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"div",2),t.\u0275\u0275template(1,m,11,7,"ng-container",3),t.\u0275\u0275pipe(2,"async"),t.\u0275\u0275elementStart(3,"div",4)(4,"div",5),t.\u0275\u0275text(5),t.\u0275\u0275pipe(6,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(7,"div",6),t.\u0275\u0275element(8,"ds-profile-page-metadata-form",7),t.\u0275\u0275elementEnd()(),t.\u0275\u0275template(9,_,6,4,"div",8),t.\u0275\u0275pipe(10,"async"),t.\u0275\u0275elementStart(11,"div",9)(12,"button",10),t.\u0275\u0275listener("click",function(){return t.\u0275\u0275restoreView(i),t.\u0275\u0275nextContext(2).updateProfile()}),t.\u0275\u0275element(13,"i",11),t.\u0275\u0275text(14),t.\u0275\u0275pipe(15,"translate"),t.\u0275\u0275elementEnd()(),t.\u0275\u0275template(16,w,2,1,"ng-container",0),t.\u0275\u0275pipe(17,"async"),t.\u0275\u0275template(18,j,2,1,"ng-container",0),t.\u0275\u0275pipe(19,"async"),t.\u0275\u0275elementEnd()}if(2&p){const i=t.\u0275\u0275nextContext().ngVar,h=t.\u0275\u0275nextContext();let v,T;t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(2,7,h.isResearcherProfileEnabled())),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(6,9,"profile.card.identify")),t.\u0275\u0275advance(3),t.\u0275\u0275property("user",i),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(10,11,h.canChangePassword$)),t.\u0275\u0275advance(5),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(15,13,"profile.form.submit"),""),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngVar",null==(v=t.\u0275\u0275pipeBind1(17,15,h.groupsRD$))||null==v.payload?null:v.payload.page),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngVar",null==(T=t.\u0275\u0275pipeBind1(19,17,h.specialGroupsRD$))||null==T.payload?null:T.payload.page)}}function X(p,u){if(1&p&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275template(1,$,20,19,"div",1),t.\u0275\u0275elementContainerEnd()),2&p){const i=u.ngVar;t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf",i)}}let G=(()=>{class p{constructor(i,h,v,T,N,z){this.authService=i,this.notificationsService=h,this.translate=v,this.epersonService=T,this.authorizationService=N,this.configurationService=z,this.NOTIFICATIONS_PREFIX="profile.notifications.",this.PASSWORD_NOTIFICATIONS_PREFIX="profile.security.form.notifications.",this.isResearcherProfileEnabled$=new a.X(!1)}ngOnInit(){this.user$=this.authService.getAuthenticatedUserFromStore().pipe((0,B.h)(i=>(0,R.Uh)(i.id)),(0,y.w)(i=>this.epersonService.findById(i.id,!0,!0,(0,b.l)("groups"))),(0,e.g1)(),(0,e.xe)(),(0,L.b)(i=>this.currentUser=i)),this.groupsRD$=this.user$.pipe((0,y.w)(i=>i.groups)),this.canChangePassword$=this.user$.pipe((0,y.w)(i=>this.authorizationService.isAuthorized(D.i.CanChangePassword,i._links.self.href))),this.specialGroupsRD$=this.authService.getSpecialGroupsFromAuthStatus(),this.configurationService.findByPropertyName("researcher-profile.entity-type").pipe((0,e.hC)()).subscribe(i=>{this.isResearcherProfileEnabled$.next(i.hasSucceeded&&i.payload.values.length>0)})}updateProfile(){const i=this.metadataForm.updateProfile(),h=this.updateSecurity();!i&&!h&&this.notificationsService.warning(this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.content"))}setInvalid(i){this.invalidSecurity=i}updateSecurity(){const i=(0,R.UE)(this.password);return this.invalidSecurity&&this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.general")),!this.invalidSecurity&&i&&this.epersonService.patch(this.currentUser,[{op:"add",path:"/password",value:{new_password:this.password,current_password:this.currentPassword}}]).pipe((0,e.hC)()).subscribe(v=>{v.hasSucceeded?this.notificationsService.success(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.title"),this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.content")):this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.title"),this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.change-failed"))}),i}setPasswordValue(i){this.password=i}setCurrentPasswordValue(i){this.currentPassword=i}submit(){this.updateProfile()}isResearcherProfileEnabled(){return this.isResearcherProfileEnabled$.asObservable()}}return p.\u0275fac=function(i){return new(i||p)(t.\u0275\u0275directiveInject(E.e8),t.\u0275\u0275directiveInject(O.T),t.\u0275\u0275directiveInject(S.sK),t.\u0275\u0275directiveInject(I.k),t.\u0275\u0275directiveInject(F._),t.\u0275\u0275directiveInject(A.i))},p.\u0275cmp=t.\u0275\u0275defineComponent({type:p,selectors:[["ds-profile-page"]],viewQuery:function(i,h){if(1&i&&t.\u0275\u0275viewQuery(C.u,5),2&i){let v;t.\u0275\u0275queryRefresh(v=t.\u0275\u0275loadQuery())&&(h.metadataForm=v.first)}},decls:2,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngIf"],[1,"container"],[4,"ngIf"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[3,"user"],["class","card mb-4 security-section",4,"ngIf"],[1,"col-12","text-right","pr-0"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],[1,"mb-4"],[1,"card","mb-4","security-section"],[3,"FORM_PREFIX","isInvalid","passwordValue","currentPasswordValue"],[1,"mt-4"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["data-test","specialGroups",4,"ngIf"],["data-test","specialGroups"]],template:function(i,h){1&i&&(t.\u0275\u0275template(0,X,2,1,"ng-container",0),t.\u0275\u0275pipe(1,"async")),2&i&&t.\u0275\u0275property("ngVar",t.\u0275\u0275pipeBind1(1,1,h.user$))},directives:[d.g,f.O5,s.V,C.u,o.V,f.sg],pipes:[f.Ov,S.X$],styles:[""]}),p})()}}]);