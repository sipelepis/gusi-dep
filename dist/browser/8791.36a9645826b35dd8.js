(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[8791,194],{51858:(te,W,i)=>{"use strict";i.d(W,{K:()=>v});var n=i(24702),E=i(23631);class v extends E.R{constructor(l,...b){super(l,...b),this._rootElement=l,this._subRootElement=b.join("/")}get rootElement(){return this._rootElement}get subRootElement(){return this._subRootElement}getPath(l){(0,n.pT)(l)&&Array.isArray(l)&&(l=l.join("/"));let b="/"+this.toString();return(0,n.pT)(l)&&(b+="/"+l),{rootElement:this._rootElement,subRootElement:this._subRootElement,path:b}}}},10194:(te,W,i)=>{"use strict";i.d(W,{e:()=>se});var n=i(69808),E=i(63311),v=i(5e3),e=i(8108),l=i(66212);function b(Z,le){if(1&Z){const N=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"ds-dynamic-form-control-container",1),v.\u0275\u0275listener("dfBlur",function(ue){v.\u0275\u0275restoreView(N);const V=v.\u0275\u0275nextContext();return V.onCustomEvent(ue,V.blur)})("dfChange",function(ue){v.\u0275\u0275restoreView(N);const V=v.\u0275\u0275nextContext();return V.onCustomEvent(ue,V.change)})("dfFocus",function(ue){v.\u0275\u0275restoreView(N);const V=v.\u0275\u0275nextContext();return V.onCustomEvent(ue,V.focus)})("ngbEvent",function(ue){v.\u0275\u0275restoreView(N);const V=v.\u0275\u0275nextContext();return V.onCustomEvent(ue,V.ngbEvent)}),v.\u0275\u0275elementEnd()}if(2&Z){const N=le.$implicit,ae=v.\u0275\u0275nextContext();v.\u0275\u0275classProp("d-none",N.hidden),v.\u0275\u0275property("formId",ae.formId)("group",ae.formGroup)("hasErrorMessaging",N.hasErrorMessages)("hidden",N.hidden)("layout",ae.formLayout)("model",N)("templates",ae.templates)("asBootstrapFormGroup",!0)}}let a=(()=>{class Z extends e.rmD{constructor(N,ae){super(N,ae),this.blur=new v.EventEmitter,this.change=new v.EventEmitter,this.focus=new v.EventEmitter,this.ngbEvent=new v.EventEmitter}}return Z.\u0275fac=function(N){return new(N||Z)(v.\u0275\u0275directiveInject(v.ChangeDetectorRef),v.\u0275\u0275directiveInject(e.rJA))},Z.\u0275cmp=v.\u0275\u0275defineComponent({type:Z,selectors:[["ds-dynamic-form"]],contentQueries:function(N,ae,ue){if(1&N&&v.\u0275\u0275contentQuery(ue,e.ATj,4),2&N){let V;v.\u0275\u0275queryRefresh(V=v.\u0275\u0275loadQuery())&&(ae.templates=V)}},viewQuery:function(N,ae){if(1&N&&v.\u0275\u0275viewQuery(l.B,5),2&N){let ue;v.\u0275\u0275queryRefresh(ue=v.\u0275\u0275loadQuery())&&(ae.components=ue)}},inputs:{formId:"formId",formGroup:"formGroup",formModel:"formModel",formLayout:"formLayout"},outputs:{blur:"dfBlur",change:"dfChange",focus:"dfFocus",ngbEvent:"ngbEvent"},features:[v.\u0275\u0275InheritDefinitionFeature],decls:1,vars:2,consts:[[3,"formId","group","hasErrorMessaging","hidden","d-none","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent",4,"ngFor","ngForOf","ngForTrackBy"],[3,"formId","group","hasErrorMessaging","hidden","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent"]],template:function(N,ae){1&N&&v.\u0275\u0275template(0,b,1,10,"ds-dynamic-form-control-container",0),2&N&&v.\u0275\u0275property("ngForOf",ae.formModel)("ngForTrackBy",ae.trackByFn)},directives:[n.sg,l.B],encapsulation:2}),Z})();i(88766),i(21650),i(8671),i(55648),i(42803),i(28554),i(86471),i(22280),i(74043);var R=i(66319),$=i(79001),Y=(i(19869),i(64204),i(53006),i(32272),i(57981)),O=i(86956),I=i(24440),g=(i(93571),i(77410),i(29635),i(13457),i(65806)),h=i(93075),x=i(21283);let se=(()=>{class Z{}return Z.\u0275fac=function(N){return new(N||Z)},Z.\u0275mod=v.\u0275\u0275defineNgModule({type:Z}),Z.\u0275inj=v.\u0275\u0275defineInjector({providers:[{provide:e.y8$,useValue:l._}],imports:[[n.ez,e.H9g,g.zj,I.t,Y.m,O.aw]]}),Z})();v.\u0275\u0275setComponentScope(R.i,[h.JL,h.sg,h.x0,n.mk,n.sg,l.B],[]),v.\u0275\u0275setComponentScope($.s,[h.JL,h.sg,h.CE,n.mk,x.Wj,n.sg,x.Zt,x.Bh,h.x0,n.tP,l.B],[]),v.\u0275\u0275setComponentScope(E.U,[h._Y,h.JL,h.sg,a,e.ATj,n.O5],[O.X$,n.Ov])},95195:(te,W,i)=>{"use strict";i.r(W),i.d(W,{SubmissionEditComponent:()=>L});var n=i(61135),E=i(63900),v=i(39300),e=i(78372),l=i(24702),b=i(86421),a=i(82596),U=i(68285),P=i(83639),G=i(44459),w=i(97437),C=i(5e3),M=i(74202),K=i(86956),_=i(14736);let L=(()=>{class R{constructor(f,A,p,T,Y,O,I,j){this.changeDetectorRef=f,this.notificationsService=A,this.route=p,this.router=T,this.itemDataService=Y,this.submissionService=O,this.translate=I,this.submissionJsonPatchOperationsService=j,this.subs=[],this.itemLink$=new n.X(void 0)}ngOnInit(){this.subs.push(this.route.paramMap.pipe((0,E.w)(f=>this.submissionService.retrieveSubmission(f.get("id"))),(0,v.h)(f=>(0,l.K0)(f))).subscribe(f=>{if(f.hasSucceeded)if((0,l.xb)(f.payload))this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"]);else{const{errors:A}=f.payload;this.submissionErrors=(0,w.Z)(A),this.submissionId=f.payload.id.toString(),this.collectionId=f.payload.collection.id,this.selfUrl=f.payload._links.self.href,this.sections=f.payload.sections,this.itemLink$.next(f.payload._links.item.href),this.item=f.payload.item,this.submissionDefinition=f.payload.submissionDefinition}else 404===f.statusCode&&this.router.navigate(["/404"],{skipLocationChange:!0})}),this.itemLink$.pipe((0,l.iy)(),(0,E.w)(f=>this.itemDataService.findByHref(f)),(0,U.g1)(),(0,e.b)(300)).subscribe(f=>{this.item=f.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(f=>(0,l.Uh)(f)).forEach(f=>f.unsubscribe()),this.submissionJsonPatchOperationsService.deletePendingJsonPatchOperations()}}return R.\u0275fac=function(f){return new(f||R)(C.\u0275\u0275directiveInject(C.ChangeDetectorRef),C.\u0275\u0275directiveInject(a.T),C.\u0275\u0275directiveInject(M.gz),C.\u0275\u0275directiveInject(M.F0),C.\u0275\u0275directiveInject(P.S),C.\u0275\u0275directiveInject(b.b),C.\u0275\u0275directiveInject(K.sK),C.\u0275\u0275directiveInject(G.E))},R.\u0275cmp=C.\u0275\u0275defineComponent({type:R,selectors:[["ds-submission-edit"]],decls:2,vars:7,consts:[[1,"submission-submit-container"],[3,"collectionId","sections","selfUrl","submissionDefinition","submissionErrors","item","submissionId"]],template:function(f,A){1&f&&(C.\u0275\u0275elementStart(0,"div",0),C.\u0275\u0275element(1,"ds-submission-form",1),C.\u0275\u0275elementEnd()),2&f&&(C.\u0275\u0275advance(1),C.\u0275\u0275property("collectionId",A.collectionId)("sections",A.sections)("selfUrl",A.selfUrl)("submissionDefinition",A.submissionDefinition)("submissionErrors",A.submissionErrors)("item",A.item)("submissionId",A.submissionId))},directives:[_.G],styles:[""]}),R})()},39886:(te,W,i)=>{"use strict";i.d(W,{I:()=>e});var n=i(25330),E=i(5e3);function v(l,b){}let e=(()=>{class l extends n.F{getComponentName(){return"SubmissionEditComponent"}importThemedComponent(a){return i(8377)(`./${a}/app/submission/edit/submission-edit.component`)}importUnthemedComponent(){return Promise.resolve().then(i.bind(i,95195))}}return l.\u0275fac=function(){let b;return function(U){return(b||(b=E.\u0275\u0275getInheritedFactory(l)))(U||l)}}(),l.\u0275cmp=E.\u0275\u0275defineComponent({type:l,selectors:[["ds-themed-submission-edit"]],features:[E.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(a,U){1&a&&E.\u0275\u0275template(0,v,0,0,"ng-template",null,0,E.\u0275\u0275templateRefExtractor)},encapsulation:2}),l})()},2962:(te,W,i)=>{"use strict";i.d(W,{z:()=>O});var n=i(5e3),E=i(61135),v=i(39646),e=i(40367),l=i(54004),b=i(86099),a=i(24702),U=i(51858),P=i(57428),G=i(86421),w=i(44459),C=i(36391),M=i(18285),K=i(20381),_=i(68285),L=i(11306),R=i(69808),$=i(17656),f=i(86956);function A(I,j){if(1&I&&(n.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"span",4),n.\u0275\u0275text(3),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(5,"div",5)(6,"span",4),n.\u0275\u0275text(7),n.\u0275\u0275pipe(8,"async"),n.\u0275\u0275elementEnd()()()),2&I){const m=n.\u0275\u0275nextContext();n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(4,2,"submission.sections.general.collection")),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(8,4,m.selectedCollectionName$))}}function p(I,j){1&I&&(n.\u0275\u0275elementStart(0,"span"),n.\u0275\u0275element(1,"i",13),n.\u0275\u0275elementEnd())}function T(I,j){if(1&I&&(n.\u0275\u0275elementStart(0,"span"),n.\u0275\u0275text(1),n.\u0275\u0275pipe(2,"async"),n.\u0275\u0275elementEnd()),2&I){const m=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(2,1,m.selectedCollectionName$))}}function Y(I,j){if(1&I){const m=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",6,7),n.\u0275\u0275listener("openChange",function(d){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().toggled(d)}),n.\u0275\u0275elementStart(2,"div",3)(3,"span",8),n.\u0275\u0275text(4),n.\u0275\u0275pipe(5,"translate"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(6,"button",9),n.\u0275\u0275listener("blur",function(){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().onClose()})("click",function(){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().onClose()}),n.\u0275\u0275pipe(7,"async"),n.\u0275\u0275template(8,p,2,0,"span",10),n.\u0275\u0275pipe(9,"async"),n.\u0275\u0275template(10,T,3,3,"span",10),n.\u0275\u0275pipe(11,"async"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(12,"div",11)(13,"ds-collection-dropdown",12),n.\u0275\u0275listener("selectionChange",function(d){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().onSelect(d)}),n.\u0275\u0275elementEnd()()()}if(2&I){const m=n.\u0275\u0275nextContext();n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(5,4,"submission.sections.general.collection")," "),n.\u0275\u0275advance(2),n.\u0275\u0275property("disabled",n.\u0275\u0275pipeBind1(7,6,m.processingChange$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(9,8,m.processingChange$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(11,10,m.processingChange$))}}let O=(()=>{class I{constructor(m,D,d,g,h,x){this.cdr=m,this.collectionDataService=D,this.operationsBuilder=d,this.operationsService=g,this.submissionService=h,this.sectionsService=x,this.collectionChange=new n.EventEmitter,this.processingChange$=new E.X(!1),this.subs=[]}ngOnChanges(m){(0,a.Uh)(m.currentCollectionId)&&(0,a.Uh)(m.currentCollectionId.currentValue)&&(this.selectedCollectionId=this.currentCollectionId,this.selectedCollectionName$=this.collectionDataService.findById(this.currentCollectionId).pipe((0,e.s)(D=>(0,a.UE)(D.payload)),(0,l.U)(D=>D.payload.name)))}ngOnInit(){this.pathCombiner=new U.K("sections","collection"),this.available$=this.sectionsService.isSectionTypeAvailable(this.submissionId,L.i.collection)}ngOnDestroy(){this.subs.filter(m=>(0,a.Uh)(m)).forEach(m=>m.unsubscribe())}onSelect(m){this.processingChange$.next(!0),this.operationsBuilder.replace(this.pathCombiner.getPath(),m.collection.id,!0),this.subs.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections","collection").pipe((0,b.z)(D=>this.submissionService.retrieveSubmission(D[0].id).pipe((0,_.Gp)()))).subscribe(D=>{this.selectedCollectionId=m.collection.id,this.selectedCollectionName$=(0,v.of)(m.collection.name),this.collectionChange.emit(D),this.submissionService.changeSubmissionCollection(this.submissionId,m.collection.id),this.processingChange$.next(!1),this.cdr.detectChanges()}))}onClose(){this.collectionDropdown.reset()}toggled(m){m||this.collectionDropdown.reset()}}return I.\u0275fac=function(m){return new(m||I)(n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(C.W),n.\u0275\u0275directiveInject(P.w),n.\u0275\u0275directiveInject(w.E),n.\u0275\u0275directiveInject(G.b),n.\u0275\u0275directiveInject(K.J))},I.\u0275cmp=n.\u0275\u0275defineComponent({type:I,selectors:[["ds-submission-form-collection"]],viewQuery:function(m,D){if(1&m&&n.\u0275\u0275viewQuery(M.H,5),2&m){let d;n.\u0275\u0275queryRefresh(d=n.\u0275\u0275loadQuery())&&(D.collectionDropdown=d.first)}},inputs:{currentCollectionId:"currentCollectionId",currentDefinition:"currentDefinition",submissionId:"submissionId"},outputs:{collectionChange:"collectionChange"},features:[n.\u0275\u0275NgOnChangesFeature],decls:5,vars:6,consts:[["class","input-group mb-3",4,"ngIf"],["ngbDropdown","","class","btn-group input-group",3,"openChange",4,"ngIf"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"input-group-append"],["ngbDropdown","",1,"btn-group","input-group",3,"openChange"],["collectionControls","ngbDropdown"],["id","collectionControlsMenuLabel",1,"input-group-text"],["aria-describedby","collectionControlsMenuLabel","id","collectionControlsMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary",3,"disabled","blur","click"],[4,"ngIf"],["ngbDropdownMenu","","id","collectionControlsDropdownMenu","aria-labelledby","collectionControlsMenuButton",1,"dropdown-menu"],[3,"selectionChange"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(m,D){1&m&&(n.\u0275\u0275elementStart(0,"div"),n.\u0275\u0275template(1,A,9,6,"div",0),n.\u0275\u0275pipe(2,"async"),n.\u0275\u0275template(3,Y,14,12,"div",1),n.\u0275\u0275pipe(4,"async"),n.\u0275\u0275elementEnd()),2&m&&(n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(2,2,D.available$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(4,4,D.available$)))},directives:[R.O5,$.jt,$.iD,$.Vi,M.H],pipes:[R.Ov,f.X$],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{outline:0;left:0!important;box-shadow:var(--bs-btn-focus-box-shadow)}"]}),I})()},70521:(te,W,i)=>{"use strict";i.d(W,{z:()=>p});var n=i(39646),E=i(54004),v=i(17539),e=i(86421),l=i(91511),b=i(24702),a=i(5e3),U=i(17656),P=i(69808),G=i(73579),w=i(86956);function C(T,Y){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",13),a.\u0275\u0275listener("click",function(j){a.\u0275\u0275restoreView(O);const m=a.\u0275\u0275nextContext(2),D=a.\u0275\u0275reference(2);return j.preventDefault(),m.confirmDiscard(D)}),a.\u0275\u0275pipe(1,"dsBrowserOnly"),a.\u0275\u0275pipe(2,"async"),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275element(4,"i",14),a.\u0275\u0275text(5),a.\u0275\u0275pipe(6,"translate"),a.\u0275\u0275elementEnd()}if(2&T){const O=a.\u0275\u0275nextContext(2);a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(2,5,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(3,7,O.processingDepositStatus)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(1,3,"discard")),a.\u0275\u0275advance(5),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(6,9,"submission.general.discard.submit")," ")}}function M(T,Y){1&T&&(a.\u0275\u0275elementStart(0,"span"),a.\u0275\u0275element(1,"i",15),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()),2&T&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(3,1,"submission.general.info.saved")," "))}function K(T,Y){1&T&&(a.\u0275\u0275elementStart(0,"span"),a.\u0275\u0275element(1,"i",16),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()),2&T&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(3,1,"submission.general.info.pending-changes")," "))}function _(T,Y){1&T&&(a.\u0275\u0275elementStart(0,"div",20),a.\u0275\u0275text(1,"Saving..."),a.\u0275\u0275elementEnd()),2&T&&a.\u0275\u0275styleProp("width","100%")}function L(T,Y){1&T&&(a.\u0275\u0275elementStart(0,"div",20),a.\u0275\u0275text(1,"Depositing..."),a.\u0275\u0275elementEnd()),2&T&&a.\u0275\u0275styleProp("width","100%")}function R(T,Y){if(1&T&&(a.\u0275\u0275elementStart(0,"div",17)(1,"div",18),a.\u0275\u0275template(2,_,2,2,"div",19),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275template(4,L,2,2,"div",19),a.\u0275\u0275pipe(5,"async"),a.\u0275\u0275elementEnd()()),2&T){const O=a.\u0275\u0275nextContext(2);a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(3,2,O.processingSaveStatus)),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(5,4,O.processingDepositStatus))}}function $(T,Y){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",21),a.\u0275\u0275listener("click",function(j){return a.\u0275\u0275restoreView(O),a.\u0275\u0275nextContext(2).deposit(j)}),a.\u0275\u0275pipe(1,"dsBrowserOnly"),a.\u0275\u0275pipe(2,"async"),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275elementStart(4,"span"),a.\u0275\u0275element(5,"i",22),a.\u0275\u0275text(6),a.\u0275\u0275pipe(7,"translate"),a.\u0275\u0275elementEnd()()}if(2&T){const O=a.\u0275\u0275nextContext(2);a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(2,5,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(3,7,O.processingDepositStatus)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(1,3,"deposit")),a.\u0275\u0275advance(6),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(7,9,"submission.general.deposit"),"")}}function f(T,Y){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",2)(1,"div",3),a.\u0275\u0275template(2,C,7,11,"button",4),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"div",5),a.\u0275\u0275template(5,M,4,3,"span",6),a.\u0275\u0275pipe(6,"async"),a.\u0275\u0275pipe(7,"async"),a.\u0275\u0275pipe(8,"async"),a.\u0275\u0275template(9,K,4,3,"span",6),a.\u0275\u0275pipe(10,"async"),a.\u0275\u0275pipe(11,"async"),a.\u0275\u0275pipe(12,"async"),a.\u0275\u0275template(13,R,6,6,"div",7),a.\u0275\u0275pipe(14,"async"),a.\u0275\u0275pipe(15,"async"),a.\u0275\u0275elementStart(16,"div",8)(17,"button",9),a.\u0275\u0275listener("click",function(j){return a.\u0275\u0275restoreView(O),a.\u0275\u0275nextContext().save(j)}),a.\u0275\u0275pipe(18,"dsBrowserOnly"),a.\u0275\u0275pipe(19,"async"),a.\u0275\u0275pipe(20,"async"),a.\u0275\u0275elementStart(21,"span"),a.\u0275\u0275element(22,"i",10),a.\u0275\u0275text(23),a.\u0275\u0275pipe(24,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(25,"button",11),a.\u0275\u0275listener("click",function(j){return a.\u0275\u0275restoreView(O),a.\u0275\u0275nextContext().saveLater(j)}),a.\u0275\u0275pipe(26,"async"),a.\u0275\u0275pipe(27,"async"),a.\u0275\u0275pipe(28,"dsBrowserOnly"),a.\u0275\u0275pipe(29,"async"),a.\u0275\u0275pipe(30,"async"),a.\u0275\u0275elementStart(31,"span"),a.\u0275\u0275element(32,"i",10),a.\u0275\u0275text(33),a.\u0275\u0275pipe(34,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275template(35,$,8,11,"button",12),a.\u0275\u0275pipe(36,"async"),a.\u0275\u0275elementEnd()()()}if(2&T){const O=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(3,15,O.showDepositAndDiscard)),a.\u0275\u0275advance(3),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(6,17,O.hasUnsavedModification)&&!a.\u0275\u0275pipeBind1(7,19,O.processingSaveStatus)&&!a.\u0275\u0275pipeBind1(8,21,O.processingDepositStatus)),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(10,23,O.hasUnsavedModification)&&!a.\u0275\u0275pipeBind1(11,25,O.processingSaveStatus)&&!a.\u0275\u0275pipeBind1(12,27,O.processingDepositStatus)),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(14,29,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(15,31,O.processingDepositStatus)),a.\u0275\u0275advance(4),a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(19,35,O.processingSaveStatus)||!a.\u0275\u0275pipeBind1(20,37,O.hasUnsavedModification)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(18,33,"save")),a.\u0275\u0275advance(6),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(24,39,"submission.general.save"),""),a.\u0275\u0275advance(2),a.\u0275\u0275classProp("btn-primary",!a.\u0275\u0275pipeBind1(26,41,O.showDepositAndDiscard))("btn-secondary",a.\u0275\u0275pipeBind1(27,43,O.showDepositAndDiscard)),a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(29,47,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(30,49,O.processingDepositStatus)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(28,45,"save-for-later")),a.\u0275\u0275advance(8),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(34,51,"submission.general.save-later"),""),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(36,53,O.showDepositAndDiscard))}}function A(T,Y){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",23)(1,"h4",24),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"button",25),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(O).dismiss("cancel")}),a.\u0275\u0275elementStart(5,"span",26),a.\u0275\u0275text(6,"\xd7"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(7,"div",27)(8,"p"),a.\u0275\u0275text(9),a.\u0275\u0275pipe(10,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(11,"div",28)(12,"button",29),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(O).close("cancel")}),a.\u0275\u0275text(13),a.\u0275\u0275pipe(14,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(15,"button",30),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(O).close("ok")}),a.\u0275\u0275text(16),a.\u0275\u0275pipe(17,"translate"),a.\u0275\u0275elementEnd()()}2&T&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,4,"submission.general.discard.confirm.title")),a.\u0275\u0275advance(7),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(10,6,"submission.general.discard.confirm.info")),a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(14,8,"submission.general.discard.confirm.cancel")),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(17,10,"submission.general.discard.confirm.submit")))}let p=(()=>{class T{constructor(O,I,j){this.modalService=O,this.restService=I,this.submissionService=j,this.submissionIsInvalid=(0,n.of)(!0)}ngOnChanges(O){(0,b.UE)(this.submissionId)&&(this.submissionIsInvalid=this.submissionService.getSubmissionStatus(this.submissionId).pipe((0,E.U)(I=>!1===I)),this.processingSaveStatus=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.processingDepositStatus=this.submissionService.getSubmissionDepositProcessingStatus(this.submissionId),this.showDepositAndDiscard=(0,n.of)(this.submissionService.getSubmissionScope()===l.S.WorkspaceItem),this.hasUnsavedModification=this.submissionService.hasUnsavedModification())}save(O){this.submissionService.dispatchSave(this.submissionId,!0)}saveLater(O){this.submissionService.dispatchSaveForLater(this.submissionId)}deposit(O){this.submissionService.dispatchDeposit(this.submissionId)}confirmDiscard(O){this.modalService.open(O).result.then(I=>{"ok"===I&&this.submissionService.dispatchDiscard(this.submissionId)})}}return T.\u0275fac=function(O){return new(O||T)(a.\u0275\u0275directiveInject(U.FF),a.\u0275\u0275directiveInject(v.F),a.\u0275\u0275directiveInject(e.b))},T.\u0275cmp=a.\u0275\u0275defineComponent({type:T,selectors:[["ds-submission-form-footer"]],inputs:{submissionId:"submissionId"},features:[a.\u0275\u0275NgOnChangesFeature],decls:3,vars:1,consts:[["class","row",4,"ngIf"],["content",""],[1,"row"],[1,"col"],["type","button","id","discard","class","btn btn-danger",3,"disabled","click",4,"ngIf"],[1,"col","text-right","d-flex","justify-content-end","align-items-center"],[4,"ngIf"],["class","col d-flex justify-content-end align-items-center",4,"ngIf"],[1,"ml-2","space-children-mr"],["type","button","id","save",1,"btn","btn-secondary",3,"disabled","click"],[1,"fas","fa-save"],["type","button","id","saveForLater",1,"btn",3,"disabled","click"],["type","button","id","deposit","class","btn btn-success",3,"disabled","click",4,"ngIf"],["type","button","id","discard",1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-trash"],[1,"fas","fa-check-circle"],[1,"fas","fa-exclamation-circle"],[1,"col","d-flex","justify-content-end","align-items-center"],[1,"progress","w-75"],["class","progress-bar progress-bar-striped progress-bar-animated bg-info","role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",3,"width",4,"ngIf"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info"],["type","button","id","deposit",1,"btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer","space-children-mr"],["type","button","id","discard_cancel",1,"btn","btn-secondary",3,"click"],["type","button","id","discard_submit",1,"btn","btn-danger",3,"click"]],template:function(O,I){1&O&&(a.\u0275\u0275template(0,f,37,55,"div",0),a.\u0275\u0275template(1,A,18,12,"ng-template",null,1,a.\u0275\u0275templateRefExtractor)),2&O&&a.\u0275\u0275property("ngIf",!!I.submissionId)},directives:[P.O5],pipes:[G.g,P.Ov,w.X$],styles:[""]}),T})()},26828:(te,W,i)=>{"use strict";i.d(W,{i:()=>C});var n=i(54004),E=i(20381),v=i(958),e=i(86421),l=i(5e3),b=i(17656),a=i(69808),U=i(86956);function P(M,K){1&M&&(l.\u0275\u0275elementStart(0,"button",7),l.\u0275\u0275text(1),l.\u0275\u0275pipe(2,"translate"),l.\u0275\u0275elementEnd()),2&M&&(l.\u0275\u0275advance(1),l.\u0275\u0275textInterpolate1(" ",l.\u0275\u0275pipeBind1(2,1,"submission.sections.general.no-sections")," "))}function G(M,K){if(1&M){const _=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"button",8),l.\u0275\u0275listener("click",function(){const $=l.\u0275\u0275restoreView(_).$implicit;return l.\u0275\u0275nextContext().addSection($.id)}),l.\u0275\u0275text(1),l.\u0275\u0275pipe(2,"translate"),l.\u0275\u0275elementEnd()}if(2&M){const _=K.$implicit;l.\u0275\u0275advance(1),l.\u0275\u0275textInterpolate1(" ",l.\u0275\u0275pipeBind1(2,1,"submission.sections."+_.header)," ")}}const w=function(M){return{"w-100":M}};let C=(()=>{class M{constructor(_,L,R){this.sectionService=_,this.submissionService=L,this.windowService=R}ngOnInit(){this.sectionList$=this.submissionService.getDisabledSectionsList(this.submissionId),this.hasSections$=this.sectionList$.pipe((0,n.U)(_=>_.length>0))}addSection(_){this.sectionService.addSection(this.submissionId,_)}}return M.\u0275fac=function(_){return new(_||M)(l.\u0275\u0275directiveInject(E.J),l.\u0275\u0275directiveInject(e.b),l.\u0275\u0275directiveInject(v.I))},M.\u0275cmp=l.\u0275\u0275defineComponent({type:M,selectors:[["ds-submission-form-section-add"]],inputs:{collectionId:"collectionId",submissionId:"submissionId"},decls:14,vars:25,consts:[["ngbDropdown","","placement","bottom-right",1,"d-inline-block",3,"ngClass"],["sectionAdd","ngbDropdown"],["id","sectionControls","ngbDropdownToggle","",1,"btn","btn-outline-primary","dropdown-toggle",3,"disabled","ngClass"],["aria-hidden","true",1,"fa","fa-plus"],["ngbDropdownMenu","","aria-labelledby","sectionControls",1,"sections-dropdown-menu",3,"ngClass"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"]],template:function(_,L){1&_&&(l.\u0275\u0275elementStart(0,"div",0,1)(2,"button",2),l.\u0275\u0275pipe(3,"async"),l.\u0275\u0275pipe(4,"async"),l.\u0275\u0275text(5),l.\u0275\u0275pipe(6,"translate"),l.\u0275\u0275element(7,"i",3),l.\u0275\u0275elementEnd(),l.\u0275\u0275elementStart(8,"div",4),l.\u0275\u0275pipe(9,"async"),l.\u0275\u0275template(10,P,3,3,"button",5),l.\u0275\u0275pipe(11,"async"),l.\u0275\u0275template(12,G,3,3,"button",6),l.\u0275\u0275pipe(13,"async"),l.\u0275\u0275elementEnd()()),2&_&&(l.\u0275\u0275property("ngClass",l.\u0275\u0275pureFunction1(19,w,L.windowService.isXs())),l.\u0275\u0275advance(2),l.\u0275\u0275property("disabled",!l.\u0275\u0275pipeBind1(3,7,L.hasSections$))("ngClass",l.\u0275\u0275pureFunction1(21,w,l.\u0275\u0275pipeBind1(4,9,L.windowService.isXs()))),l.\u0275\u0275advance(3),l.\u0275\u0275textInterpolate1(" ",l.\u0275\u0275pipeBind1(6,11,"submission.sections.general.add-more")," "),l.\u0275\u0275advance(3),l.\u0275\u0275property("ngClass",l.\u0275\u0275pureFunction1(23,w,l.\u0275\u0275pipeBind1(9,13,L.windowService.isXs()))),l.\u0275\u0275advance(2),l.\u0275\u0275property("ngIf",!l.\u0275\u0275pipeBind1(11,15,L.hasSections$)),l.\u0275\u0275advance(2),l.\u0275\u0275property("ngForOf",l.\u0275\u0275pipeBind1(13,17,L.sectionList$)))},directives:[b.jt,a.mk,b.iD,b.Vi,a.O5,a.sg],pipes:[a.Ov,U.X$],styles:[".dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.sections-dropdown-menu[_ngcontent-%COMP%]{z-index:var(--ds-submission-header-z-index)}"]}),M})()},14736:(te,W,i)=>{"use strict";i.d(W,{G:()=>D});var n=i(39646),E=i(39300),v=i(54004),e=i(71884),l=i(63900),b=i(24755),U=(i(21802),i(93498)),P=i(24702),G=i(82703),w=i(86421),M=(i(33609),i(11306)),K=i(20381),_=i(5e3),L=i(69808),R=i(30184),$=i(2962),f=i(26828),A=i(48106),p=i(61400),T=i(70521);function Y(d,g){if(1&d&&(_.\u0275\u0275elementStart(0,"div",12),_.\u0275\u0275element(1,"ds-submission-upload-files",13)(2,"div",14),_.\u0275\u0275elementEnd()),2&d){const h=_.\u0275\u0275nextContext(2);_.\u0275\u0275advance(1),_.\u0275\u0275property("submissionId",h.submissionId)("collectionId",h.collectionId)("uploadFilesOptions",h.uploadFilesOptions)}}function O(d,g){if(1&d){const h=_.\u0275\u0275getCurrentView();_.\u0275\u0275elementStart(0,"div",6),_.\u0275\u0275template(1,Y,3,3,"div",7),_.\u0275\u0275pipe(2,"async"),_.\u0275\u0275elementStart(3,"div",8)(4,"ds-submission-form-collection",9),_.\u0275\u0275listener("collectionChange",function(oe){return _.\u0275\u0275restoreView(h),_.\u0275\u0275nextContext().onCollectionChange(oe)}),_.\u0275\u0275elementEnd()(),_.\u0275\u0275elementStart(5,"div",10),_.\u0275\u0275element(6,"ds-submission-form-section-add",11),_.\u0275\u0275elementEnd()()}if(2&d){const h=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",_.\u0275\u0275pipeBind1(2,6,h.uploadEnabled$)),_.\u0275\u0275advance(3),_.\u0275\u0275property("currentCollectionId",h.collectionId)("currentDefinition",h.definitionId)("submissionId",h.submissionId),_.\u0275\u0275advance(2),_.\u0275\u0275property("collectionId",h.collectionId)("submissionId",h.submissionId)}}function I(d,g){1&d&&_.\u0275\u0275element(0,"ds-themed-loading",15)}function j(d,g){if(1&d&&(_.\u0275\u0275elementContainerStart(0),_.\u0275\u0275element(1,"ds-submission-section-container",16),_.\u0275\u0275elementContainerEnd()),2&d){const h=g.$implicit,x=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("collectionId",x.collectionId)("submissionId",x.submissionId)("sectionData",h)}}function m(d,g){if(1&d&&(_.\u0275\u0275elementStart(0,"div",17),_.\u0275\u0275element(1,"ds-submission-form-footer",18),_.\u0275\u0275elementEnd()),2&d){const h=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("submissionId",h.submissionId)}}let D=(()=>{class d{constructor(h,x,oe,se,Z){this.authService=h,this.changeDetectorRef=x,this.halService=oe,this.submissionService=se,this.sectionsService=Z,this.loading=(0,n.of)(!0),this.uploadFilesOptions=new G.n,this.subs=[],this.isActive=!0}ngOnChanges(h){h.collectionId&&this.collectionId&&h.submissionId&&this.submissionId&&(this.isActive=!0,this.submissionSections=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,E.h)(()=>this.isActive),(0,v.U)(x=>x.isLoading),(0,v.U)(x=>x),(0,e.x)(),(0,l.w)(x=>x?(0,n.of)([]):this.getSectionsList())),this.uploadEnabled$=this.sectionsService.isSectionTypeAvailable(this.submissionId,M.i.Upload),this.loading=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,E.h)(()=>this.isActive),(0,v.U)(x=>x.isLoading),(0,v.U)(x=>x),(0,e.x)()),this.subs.push(this.halService.getEndpoint(this.submissionService.getSubmissionObjectLinkName()).pipe((0,E.h)(x=>(0,P.UE)(x)),(0,e.x)()).subscribe(x=>{this.uploadFilesOptions.authToken=this.authService.buildAuthHeader(),this.uploadFilesOptions.url=x.concat(`/${this.submissionId}`),this.definitionId=this.submissionDefinition.name,this.submissionService.dispatchInit(this.collectionId,this.submissionId,this.selfUrl,this.submissionDefinition,this.sections,this.item,this.submissionErrors),this.changeDetectorRef.detectChanges()})),this.submissionService.startAutoSave(this.submissionId))}ngOnDestroy(){this.isActive=!1,this.submissionService.stopAutoSave(),this.submissionService.resetAllSubmissionObjects(),this.subs.filter(h=>(0,P.Uh)(h)).forEach(h=>h.unsubscribe())}onCollectionChange(h){this.collectionId=h.collection.id,this.definitionId!==h.submissionDefinition.name?(this.sections=h.sections,this.submissionDefinition=h.submissionDefinition,this.definitionId=this.submissionDefinition.name,this.submissionService.resetSubmissionObject(this.collectionId,this.submissionId,h._links.self.href,this.submissionDefinition,this.sections,this.item)):this.changeDetectorRef.detectChanges()}isLoading(){return this.loading}getSectionsList(){return this.submissionService.getSubmissionSections(this.submissionId).pipe((0,E.h)(h=>(0,P.UE)(h)),(0,v.U)(h=>h))}}return d.\u0275fac=function(h){return new(h||d)(_.\u0275\u0275directiveInject(b.e8),_.\u0275\u0275directiveInject(_.ChangeDetectorRef),_.\u0275\u0275directiveInject(U.q),_.\u0275\u0275directiveInject(w.b),_.\u0275\u0275directiveInject(K.J))},d.\u0275cmp=_.\u0275\u0275defineComponent({type:d,selectors:[["ds-submission-form"]],inputs:{collectionId:"collectionId",item:"item",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},features:[_.\u0275\u0275NgOnChangesFeature],decls:10,vars:12,consts:[[1,"container-fluid"],["class","submission-form-header mb-3 d-flex flex-wrap position-sticky",4,"ngIf"],[1,"submission-form-content"],["message","Loading...",4,"ngIf"],[4,"ngFor","ngForOf"],["class","submission-form-footer mt-3 mb-3 position-sticky",4,"ngIf"],[1,"submission-form-header","mb-3","d-flex","flex-wrap","position-sticky"],["class","w-100",4,"ngIf"],[1,"submission-form-header-item","mb-3","mb-sm-0","flex-sm-grow-1","flex-md-grow-0"],[3,"currentCollectionId","currentDefinition","submissionId","collectionChange"],[1,"submission-form-header-item","text-right"],[3,"collectionId","submissionId"],[1,"w-100"],[3,"submissionId","collectionId","uploadFilesOptions"],[1,"clearfix"],["message","Loading..."],[3,"collectionId","submissionId","sectionData"],[1,"submission-form-footer","mt-3","mb-3","position-sticky"],[3,"submissionId"]],template:function(h,x){1&h&&(_.\u0275\u0275elementStart(0,"div",0),_.\u0275\u0275template(1,O,7,8,"div",1),_.\u0275\u0275pipe(2,"async"),_.\u0275\u0275elementStart(3,"div",2),_.\u0275\u0275template(4,I,1,0,"ds-themed-loading",3),_.\u0275\u0275pipe(5,"async"),_.\u0275\u0275template(6,j,2,3,"ng-container",4),_.\u0275\u0275pipe(7,"async"),_.\u0275\u0275elementEnd(),_.\u0275\u0275template(8,m,2,1,"div",5),_.\u0275\u0275pipe(9,"async"),_.\u0275\u0275elementEnd()),2&h&&(_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",!_.\u0275\u0275pipeBind1(2,4,x.isLoading())),_.\u0275\u0275advance(3),_.\u0275\u0275property("ngIf",_.\u0275\u0275pipeBind1(5,6,x.isLoading())),_.\u0275\u0275advance(2),_.\u0275\u0275property("ngForOf",_.\u0275\u0275pipeBind1(7,8,x.submissionSections)),_.\u0275\u0275advance(2),_.\u0275\u0275property("ngIf",!_.\u0275\u0275pipeBind1(9,10,x.isLoading())))},directives:[L.O5,R.h,$.z,f.i,A.Z,L.sg,p.y,T.z],pipes:[L.Ov],styles:[".submission-form-header[_ngcontent-%COMP%]{background-color:#fffffff7;padding:calc(var(--bs-spacer) / 2) 0 calc(var(--bs-spacer) / 2) 0;top:0;z-index:var(--ds-submission-header-z-index)}.submission-form-header-item[_ngcontent-%COMP%]{flex-grow:1}.submission-form-footer[_ngcontent-%COMP%]{border-radius:var(--bs-card-border-radius);bottom:0;background-color:var(--bs-gray-400);padding:calc(var(--bs-spacer) / 2);z-index:var(--ds-submission-footer-z-index)}.btn-link-focus[_ngcontent-%COMP%]{font-weight:400;color:#066;text-decoration:none}.btn-link-focus[_ngcontent-%COMP%]:hover{color:#001a1a;text-decoration:underline}.btn-link-focus[_ngcontent-%COMP%]:disabled, .btn-link-focus.disabled[_ngcontent-%COMP%]{color:#6c757d;pointer-events:none}.btn-link-focus[_ngcontent-%COMP%]:focus, .btn-link-focus.focus[_ngcontent-%COMP%]{text-decoration:underline}"]}),d})()},30184:(te,W,i)=>{"use strict";i.d(W,{h:()=>R});var n=i(39646),E=i(50590),v=i(95698),e=i(20381),l=i(24702),b=i(34690),a=i(86421),U=i(82596),P=i(97437),G=i(44459),w=i(11306),C=i(5e3),M=i(86956),K=i(69808),_=i(62453);function L($,f){if(1&$){const A=C.\u0275\u0275getCurrentView();C.\u0275\u0275elementStart(0,"ds-uploader",1),C.\u0275\u0275listener("onCompleteItem",function(T){return C.\u0275\u0275restoreView(A),C.\u0275\u0275nextContext().onCompleteItem(T)})("onUploadError",function(){return C.\u0275\u0275restoreView(A),C.\u0275\u0275nextContext().onUploadError()}),C.\u0275\u0275elementEnd()}if(2&$){const A=C.\u0275\u0275nextContext();C.\u0275\u0275property("dropMsg",A.dropMsg)("dropOverDocumentMsg",A.dropOverDocumentMsg)("enableDragOverDocument",A.enableDragOverDocument)("onBeforeUpload",A.onBeforeUpload)("uploadFilesOptions",A.uploadFilesOptions)}}let R=(()=>{class ${constructor(A,p,T,Y,O){this.notificationsService=A,this.operationsService=p,this.sectionService=T,this.submissionService=Y,this.translate=O,this.enableDragOverDocument=!0,this.dropOverDocumentMsg="submission.sections.upload.drop-message",this.dropMsg="submission.sections.upload.drop-message",this.subs=[],this.uploadEnabled=(0,n.of)(!1),this.onBeforeUpload=()=>{const I=this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections").subscribe();return this.subs.push(I),I}}ngOnChanges(){this.uploadEnabled=this.sectionService.isSectionTypeAvailable(this.submissionId,w.i.Upload)}onCompleteItem(A){this.subs.push(this.uploadEnabled.pipe((0,E.P)()).subscribe(p=>{if(p){const{sections:T}=A,{errors:Y}=A,O=(0,P.Z)(Y);T&&(0,l.UE)(T)&&Object.keys(T).forEach(I=>{const j=(0,b.Vv)(T[I]),m=O[I];this.sectionService.isSectionType(this.submissionId,I,w.i.Upload).pipe((0,v.q)(1)).subscribe(D=>{D&&((0,l.xb)(m)?this.notificationsService.success(null,this.translate.get("submission.sections.upload.upload-successful")):this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed")))}),this.sectionService.updateSectionData(this.submissionId,I,j,m,m)})}}))}onUploadError(){this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed"))}ngOnDestroy(){this.subs.filter(A=>(0,l.Uh)(A)).forEach(A=>A.unsubscribe())}}return $.\u0275fac=function(A){return new(A||$)(C.\u0275\u0275directiveInject(U.T),C.\u0275\u0275directiveInject(G.E),C.\u0275\u0275directiveInject(e.J),C.\u0275\u0275directiveInject(a.b),C.\u0275\u0275directiveInject(M.sK))},$.\u0275cmp=C.\u0275\u0275defineComponent({type:$,selectors:[["ds-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},features:[C.\u0275\u0275NgOnChangesFeature],decls:1,vars:1,consts:[[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError"]],template:function(A,p){1&A&&C.\u0275\u0275template(0,L,1,5,"ds-uploader",0),2&A&&C.\u0275\u0275property("ngIf",p.uploadFilesOptions.url)},directives:[K.O5,_.B],encapsulation:2}),$})()},124:(te,W,i)=>{"use strict";i.d(W,{v:()=>M}),i(56237);var E=i(94569),v=i(86099),e=i(86421),l=i(82596),b=i(91320),a=i(5e3),U=i(17656),P=i(74202),G=i(69808),w=i(86956);function C(K,_){if(1&K&&(a.\u0275\u0275elementStart(0,"div",5)(1,"div",6)(2,"strong"),a.\u0275\u0275text(3),a.\u0275\u0275pipe(4,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(5,"p"),a.\u0275\u0275text(6),a.\u0275\u0275elementEnd()()()),2&K){const L=_.$implicit;a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(4,2,"item.preview."+L.key)),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(L.value.value)}}let M=(()=>{class K{constructor(L,R,$,f,A){this.activeModal=L,this.submissionService=R,this.modalService=$,this.router=f,this.notificationService=A}ngOnInit(){this.metadataList=[],Object.keys(this.externalSourceEntry.metadata).forEach(R=>{this.metadataList.push({key:R,value:E.S.first(this.externalSourceEntry.metadata,R)})})}closeMetadataModal(){this.activeModal.dismiss(!1)}import(){this.modalRef=this.modalService.open(b.L,{size:"lg"}),this.modalRef.componentInstance.entityType=this.labelPrefix,this.closeMetadataModal(),this.modalRef.componentInstance.selectedEvent.pipe((0,v.z)(L=>this.submissionService.createSubmissionFromExternalSource(this.externalSourceEntry._links.self.href,L.collection.id))).subscribe(L=>{let R=!1;1===L.length&&null!==L[0]&&(R=!0,this.router.navigateByUrl("/workspaceitems/"+L[0].id+"/edit")),R||this.notificationService.error("submission.import-external.preview.error.import.title","submission.import-external.preview.error.import.body"),this.modalRef.close()})}}return K.\u0275fac=function(L){return new(L||K)(a.\u0275\u0275directiveInject(U.Kz),a.\u0275\u0275directiveInject(e.b),a.\u0275\u0275directiveInject(U.FF),a.\u0275\u0275directiveInject(P.F0),a.\u0275\u0275directiveInject(l.T))},K.\u0275cmp=a.\u0275\u0275defineComponent({type:K,selectors:[["ds-submission-import-external-preview"]],inputs:{externalSourceEntry:"externalSourceEntry"},decls:27,vars:10,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-md-12"],["class","row",4,"ngFor","ngForOf"],[1,"col-md-12","text-right"],["role","button",1,"btn","btn-success",3,"click"],["aria-hidden","true",1,"fa","fa-file-import"]],template:function(L,R){1&L&&(a.\u0275\u0275elementStart(0,"div",0)(1,"h2"),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"button",1),a.\u0275\u0275listener("click",function(){return R.closeMetadataModal()}),a.\u0275\u0275elementStart(5,"span",2),a.\u0275\u0275text(6,"\xd7"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(7,"div",3)(8,"div",4)(9,"div",5)(10,"div",6)(11,"p"),a.\u0275\u0275text(12),a.\u0275\u0275pipe(13,"translate"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(14,"div",5)(15,"div",6),a.\u0275\u0275element(16,"hr"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275template(17,C,7,4,"div",7),a.\u0275\u0275elementStart(18,"div",5)(19,"div",6),a.\u0275\u0275element(20,"hr"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(21,"div",5)(22,"div",8)(23,"button",9),a.\u0275\u0275listener("click",function(){return R.import()}),a.\u0275\u0275element(24,"i",10),a.\u0275\u0275text(25),a.\u0275\u0275pipe(26,"translate"),a.\u0275\u0275elementEnd()()()()()),2&L&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,4,"submission.import-external.preview.title."+R.labelPrefix)),a.\u0275\u0275advance(10),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(13,6,"submission.import-external.preview.subtitle")),a.\u0275\u0275advance(5),a.\u0275\u0275property("ngForOf",R.metadataList),a.\u0275\u0275advance(8),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(26,8,"submission.import-external.preview.button.import")," "))},directives:[G.sg],pipes:[w.X$],styles:[".close[_ngcontent-%COMP%]:focus{outline:none!important}"]}),K})()},60906:(te,W,i)=>{"use strict";i.d(W,{p:()=>O});var n=i(5e3),E=i(39646),v=i(70262),e=i(18505),l=i(81964),b=i(31388),a=i(24789),U=i(62713),P=i(58577),G=i(68285),w=i(958),C=i(24702),M=i(17481),K=i(69808),_=i(93075),L=i(17656),R=i(48689),$=i(86956);function f(I,j){if(1&I){const m=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",10)(1,"input",11),n.\u0275\u0275listener("keyup.enter",function(){n.\u0275\u0275restoreView(m);const d=n.\u0275\u0275nextContext();return""===d.searchString?null:d.search()})("ngModelChange",function(d){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().searchString=d}),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275elementEnd()()}if(2&I){const m=n.\u0275\u0275nextContext();n.\u0275\u0275advance(1),n.\u0275\u0275propertyInterpolate("placeholder",n.\u0275\u0275pipeBind1(2,2,"submission.import-external.search.placeholder")),n.\u0275\u0275property("ngModel",m.searchString)}}function A(I,j){if(1&I){const m=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"input",11),n.\u0275\u0275listener("keyup.enter",function(){n.\u0275\u0275restoreView(m);const d=n.\u0275\u0275nextContext();return""===d.searchString?null:d.search()})("ngModelChange",function(d){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().searchString=d}),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275elementEnd()}if(2&I){const m=n.\u0275\u0275nextContext();n.\u0275\u0275propertyInterpolate("placeholder",n.\u0275\u0275pipeBind1(1,2,"submission.import-external.search.placeholder")),n.\u0275\u0275property("ngModel",m.searchString)}}function p(I,j){if(1&I){const m=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",12),n.\u0275\u0275listener("click",function(){const g=n.\u0275\u0275restoreView(m).$implicit;return n.\u0275\u0275nextContext().makeSourceSelection(g)}),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementEnd()}if(2&I){const m=j.$implicit;n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.import-external.source."+(null==m?null:m.name))),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(3,4,"submission.import-external.source."+(null==m?null:m.name)))}}function T(I,j){1&I&&(n.\u0275\u0275elementStart(0,"div",13)(1,"p"),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementEnd()()),2&I&&(n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(3,1,"submission.import-external.source.loading")))}const Y=function(I){return{"input-group-append":I}};let O=(()=>{class I{constructor(m,D,d){this.externalService=m,this.cdr=D,this.windowService=d,this.sourceListLoading=!1,this.externalSourceData=new n.EventEmitter}ngOnInit(){this.selectedElement={id:"",name:"loading"},this.searchString="",this.sourceList=[],this.findListOptions=Object.assign({},new M.R,{elementsPerPage:5,currentPage:1,searchParams:[new l.g("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe((0,v.K)(()=>{const m=new U.S,D=(0,a.b)(m,[]),d=(0,P.AC)(D);return(0,E.of)(d)}),(0,G.Gp)()).subscribe(m=>{m.page.forEach(D=>{this.sourceList.push({id:D.id,name:D.name}),this.initExternalSourceData.sourceId===D.id&&(this.selectedElement={id:D.id,name:D.name},this.searchString=this.initExternalSourceData.query)}),""===this.selectedElement.id&&(this.selectedElement=this.sourceList[0]),this.pageInfo=m.pageInfo,this.cdr.detectChanges()}),this.isXsOrSm$=this.windowService.isXsOrSm()}makeSourceSelection(m){this.selectedElement=m}onScroll(){!this.sourceListLoading&&this.pageInfo.currentPage+1<=this.pageInfo.totalPages&&(this.sourceListLoading=!0,this.findListOptions=Object.assign({},new M.R,{elementsPerPage:5,currentPage:this.findListOptions.currentPage+1,searchParams:[new l.g("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe((0,v.K)(()=>{const m=new U.S,D=(0,a.b)(m,[]),d=(0,P.AC)(D);return(0,E.of)(d)}),(0,G.xw)(),(0,e.b)(()=>this.sourceListLoading=!1)).subscribe(m=>{m.payload.page.forEach(D=>{this.sourceList.push({id:D.id,name:D.name})}),this.pageInfo=m.payload.pageInfo,this.cdr.detectChanges()}))}search(){this.externalSourceData.emit({entity:this.initExternalSourceData.entity,sourceId:this.selectedElement.id,query:this.searchString})}ngOnDestroy(){(0,C.Uh)(this.sub)&&this.sub.unsubscribe()}}return I.\u0275fac=function(m){return new(m||I)(n.\u0275\u0275directiveInject(b.G),n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(w.I))},I.\u0275cmp=n.\u0275\u0275defineComponent({type:I,selectors:[["ds-submission-import-external-searchbar"]],inputs:{initExternalSourceData:"initExternalSourceData"},outputs:{externalSourceData:"externalSourceData"},decls:20,vars:31,consts:[["class","input-group mb-2",4,"ngIf"],[1,"input-group","mb-5"],["type","text","class","form-control","aria-label","","aria-describedby","",3,"ngModel","placeholder","keyup.enter","ngModelChange",4,"ngIf"],["ngbDropdown","","role","group","aria-label","",3,"ngClass"],["ngbDropdownToggle","",1,"btn","btn-outline-secondary","w-fx",3,"title"],["ngbDropdownMenu","","aria-haspopup","true","aria-expanded","false","aria-labelledby","scrollableDropdownMenuButton",1,"dropdown-menu","scrollable-dropdown-menu","w-100"],["aria-labelledby","scrollableDropdownMenuButton","infiniteScroll","",1,"scrollable-menu",3,"infiniteScrollDistance","infiniteScrollThrottle","scrollWindow","scrolled"],["ngbDropdownItem","","class","dropdown-item text-truncate",3,"title","click",4,"ngFor","ngForOf"],["ngbDropdownItem","","class","scrollable-dropdown-loading text-center",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"title","disabled","click"],[1,"input-group","mb-2"],["type","text","aria-label","","aria-describedby","",1,"form-control",3,"ngModel","placeholder","keyup.enter","ngModelChange"],["ngbDropdownItem","",1,"dropdown-item","text-truncate",3,"title","click"],["ngbDropdownItem","",1,"scrollable-dropdown-loading","text-center"]],template:function(m,D){1&m&&(n.\u0275\u0275template(0,f,3,4,"div",0),n.\u0275\u0275pipe(1,"async"),n.\u0275\u0275elementStart(2,"div",1),n.\u0275\u0275template(3,A,2,4,"input",2),n.\u0275\u0275pipe(4,"async"),n.\u0275\u0275elementStart(5,"div",3),n.\u0275\u0275pipe(6,"async"),n.\u0275\u0275elementStart(7,"button",4),n.\u0275\u0275pipe(8,"translate"),n.\u0275\u0275text(9),n.\u0275\u0275pipe(10,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(11,"div",5)(12,"div",6),n.\u0275\u0275listener("scrolled",function(){return D.onScroll()}),n.\u0275\u0275template(13,p,4,6,"button",7),n.\u0275\u0275template(14,T,4,3,"div",8),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(15,"button",9),n.\u0275\u0275listener("click",function(){return D.search()}),n.\u0275\u0275pipe(16,"translate"),n.\u0275\u0275pipe(17,"translate"),n.\u0275\u0275text(18),n.\u0275\u0275pipe(19,"translate"),n.\u0275\u0275elementEnd()()()),2&m&&(n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(1,13,D.isXsOrSm$)),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(4,15,D.isXsOrSm$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(29,Y,!n.\u0275\u0275pipeBind1(6,17,D.isXsOrSm$))),n.\u0275\u0275advance(2),n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(8,19,"submission.import-external.search.source.hint")),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(10,21,"submission.import-external.source."+(null==D.selectedElement?null:D.selectedElement.name))),n.\u0275\u0275advance(3),n.\u0275\u0275property("infiniteScrollDistance",2)("infiniteScrollThrottle",50)("scrollWindow",!1),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngForOf",D.sourceList),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",D.sourceListLoading),n.\u0275\u0275advance(1),n.\u0275\u0275property("title",""===D.searchString?n.\u0275\u0275pipeBind1(16,23,"submission.import-external.search.button.hint"):n.\u0275\u0275pipeBind1(17,25,"submission.import-external.search.button"))("disabled",""===D.searchString),n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(19,27,"submission.import-external.search.button")))},directives:[K.O5,_.Fj,_.JJ,_.On,L.jt,K.mk,L.iD,L.Vi,R.R,K.sg,L.TH],pipes:[K.Ov,$.X$],styles:[".input-group-append[_ngcontent-%COMP%]:last-child > .btn[_ngcontent-%COMP%]:not(:last-child):not(.dropdown-toggle){margin-left:-1px;border-radius:0 .25rem .25rem 0}.input-group-append[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]{border-radius:0}.w-fx[_ngcontent-%COMP%]{min-width:200px}.scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:calc(var(--ds-dropdown-menu-max-height) / 2);overflow-x:hidden}.scrollable-dropdown-loading[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;height:calc(var(--bs-spacer) * 2)!important;line-height:calc(var(--bs-spacer) * 2);position:sticky;bottom:0}"]}),I})()},73391:(te,W,i)=>{"use strict";i.r(W),i.d(W,{SubmissionImportExternalComponent:()=>Ve});var n=i(61135),E=i(39841),v=i(95698),e=i(39300),l=i(63900),b=i(18505),a=i(86099),U=i(31388),P=i(24789),G=i(36872),w=i(84935),C=i(4177),M=i(5360),K=i(58577),_=i(124),L=i(28652),R=i(62713),$=i(24702),f=i(68285),A=i(13762),p=i(5e3),T=i(74202),Y=i(17656),O=i(60906),I=i(69808),j=i(98605),m=i(70714),D=i(48106),d=i(38605),g=i(86956);function h(H,_e){1&H&&(p.\u0275\u0275elementStart(0,"h3"),p.\u0275\u0275text(1),p.\u0275\u0275pipe(2,"translate"),p.\u0275\u0275elementEnd()),2&H&&(p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(2,1,"submission.sections.describe.relationship-lookup.selection-tab.title")))}const x=function(H,_e){return{repeatable:H,listId:_e}};function oe(H,_e){if(1&H){const B=p.\u0275\u0275getCurrentView();p.\u0275\u0275elementStart(0,"ds-viewable-collection",15),p.\u0275\u0275listener("importObject",function(fe){return p.\u0275\u0275restoreView(B),p.\u0275\u0275nextContext(4).import(fe)}),p.\u0275\u0275elementEnd()}if(2&H){const B=p.\u0275\u0275nextContext().ngVar,ne=p.\u0275\u0275nextContext(3);p.\u0275\u0275property("@fadeIn",void 0)("objects",B)("selectionConfig",p.\u0275\u0275pureFunction2(8,x,ne.repeatable,ne.listId))("config",ne.initialPagination)("hideGear",!0)("context",ne.context)("importable",!0)("importConfig",ne.importConfig)}}function se(H,_e){1&H&&(p.\u0275\u0275element(0,"ds-themed-loading",16),p.\u0275\u0275pipe(1,"translate")),2&H&&p.\u0275\u0275propertyInterpolate("message",p.\u0275\u0275pipeBind1(1,1,"loading.search-results"))}function Z(H,_e){1&H&&(p.\u0275\u0275elementStart(0,"div",17)(1,"ds-alert",18),p.\u0275\u0275text(2),p.\u0275\u0275pipe(3,"translate"),p.\u0275\u0275elementEnd()()),2&H&&(p.\u0275\u0275advance(1),p.\u0275\u0275property("type","alert-info"),p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(3,2,"search.results.empty")))}function le(H,_e){1&H&&(p.\u0275\u0275elementStart(0,"div",19)(1,"ds-alert",18),p.\u0275\u0275text(2),p.\u0275\u0275pipe(3,"translate"),p.\u0275\u0275elementEnd()()),2&H&&(p.\u0275\u0275advance(1),p.\u0275\u0275property("type","alert-info"),p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(3,2,"search.results.response.500")))}function N(H,_e){if(1&H&&(p.\u0275\u0275elementContainerStart(0),p.\u0275\u0275template(1,h,3,3,"h3",10),p.\u0275\u0275template(2,oe,1,11,"ds-viewable-collection",11),p.\u0275\u0275pipe(3,"async"),p.\u0275\u0275template(4,se,2,3,"ds-themed-loading",12),p.\u0275\u0275pipe(5,"async"),p.\u0275\u0275template(6,Z,4,4,"div",13),p.\u0275\u0275pipe(7,"async"),p.\u0275\u0275template(8,le,4,4,"div",14),p.\u0275\u0275pipe(9,"async"),p.\u0275\u0275elementContainerEnd()),2&H){const B=_e.ngVar,ne=p.\u0275\u0275nextContext(3);p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",B&&0!==(null==B||null==B.payload||null==B.payload.page?null:B.payload.page.length)),p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",(null==B?null:B.hasSucceeded)&&!p.\u0275\u0275pipeBind1(3,5,ne.isLoading$)&&(null==B||null==B.payload||null==B.payload.page?null:B.payload.page.length)>0),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngIf",p.\u0275\u0275pipeBind1(5,7,ne.isLoading$)),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngIf",!p.\u0275\u0275pipeBind1(7,9,ne.isLoading$)&&0===(null==B||null==B.payload||null==B.payload.page?null:B.payload.page.length)),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngIf",!p.\u0275\u0275pipeBind1(9,11,ne.isLoading$)&&500===B.statusCode)}}function ae(H,_e){if(1&H&&(p.\u0275\u0275elementStart(0,"div",2),p.\u0275\u0275template(1,N,10,13,"ng-container",9),p.\u0275\u0275pipe(2,"async"),p.\u0275\u0275elementEnd()),2&H){const B=p.\u0275\u0275nextContext(2);p.\u0275\u0275advance(1),p.\u0275\u0275property("ngVar",p.\u0275\u0275pipeBind1(2,1,B.entriesRD$))}}function ue(H,_e){1&H&&(p.\u0275\u0275elementStart(0,"div",2)(1,"ds-alert",18)(2,"p",20),p.\u0275\u0275text(3),p.\u0275\u0275pipe(4,"translate"),p.\u0275\u0275elementEnd()()()),2&H&&(p.\u0275\u0275advance(1),p.\u0275\u0275property("type","alert-info"),p.\u0275\u0275advance(2),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(4,2,"submission.import-external.page.hint")))}function V(H,_e){if(1&H&&(p.\u0275\u0275elementStart(0,"div",1),p.\u0275\u0275template(1,ae,3,3,"div",8),p.\u0275\u0275template(2,ue,5,4,"div",8),p.\u0275\u0275elementEnd()),2&H){const B=p.\u0275\u0275nextContext();p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",""!==B.reload$.value.sourceId),p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",""===B.reload$.value.sourceId)}}const Ae=function(){return["/mydspace"]};let Ve=(()=>{class H{constructor(B,ne,fe,Oe,$e){this.searchConfigService=B,this.externalService=ne,this.routeService=fe,this.router=Oe,this.modalService=$e,this.entriesRD$=new n.X(null),this.isLoading$=new n.X(!1),this.reload$=new n.X({entity:"",query:"",sourceId:""}),this.initialPagination=Object.assign(new C.r,{id:"spc",pageSize:10}),this.subs=[]}ngOnInit(){this.listId="list-submission-external-sources",this.context=w._.EntitySearchModalWithNameVariants,this.repeatable=!1,this.routeData={entity:"",sourceId:"",query:""},this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label},this.entriesRD$=new n.X((0,K.AC)((0,P.b)(new R.S,[]))),this.isLoading$=new n.X(!1),this.subs.push((0,E.a)([this.routeService.getQueryParameterValue("entity"),this.routeService.getQueryParameterValue("sourceId"),this.routeService.getQueryParameterValue("query")]).pipe((0,v.q)(1)).subscribe(([B,ne,fe])=>{this.reload$.next({entity:B||A.N,query:fe,sourceId:ne}),this.selectLabel(B),this.retrieveExternalSources()}))}getExternalSourceData(B){this.router.navigate([],{queryParams:B,replaceUrl:!0}).then(()=>{this.reload$.next(B),this.retrieveExternalSources()})}import(B){this.modalRef=this.modalService.open(_.v,{size:"lg"});const ne=this.modalRef.componentInstance;ne.externalSourceEntry=B,ne.labelPrefix=this.label}ngOnDestroy(){this.subs.filter(B=>(0,$.Uh)(B)).forEach(B=>B.unsubscribe()),(0,$.Uh)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe()}retrieveExternalSources(){(0,$.Uh)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe(),this.retrieveExternalSourcesSub=this.reload$.pipe((0,e.h)(B=>(0,$.UE)(B.sourceId)&&(0,$.UE)(B.query)),(0,l.w)(B=>{const ne=B.query;return this.routeData=B,this.searchConfigService.paginatedSearchOptions.pipe((0,b.b)(()=>this.isLoading$.next(!0)),(0,e.h)(fe=>fe.query===ne),(0,a.z)(fe=>this.externalService.getExternalSourceEntries(this.routeData.sourceId,fe).pipe((0,f.sJ)())))})).subscribe(B=>{this.entriesRD$.next(B),this.isLoading$.next(!1)})}selectLabel(B){this.label=B,this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label}}}return H.\u0275fac=function(B){return new(B||H)(p.\u0275\u0275directiveInject(G.U),p.\u0275\u0275directiveInject(U.G),p.\u0275\u0275directiveInject(M.MZ),p.\u0275\u0275directiveInject(T.F0),p.\u0275\u0275directiveInject(Y.FF))},H.\u0275cmp=p.\u0275\u0275defineComponent({type:H,selectors:[["ds-submission-import-external"]],decls:15,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-md-12"],["id","header",1,"pb-2"],[3,"initExternalSourceData","externalSourceData"],["class","row",4,"ngIf"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],["aria-hidden","true",1,"fa","fa-chevron-left"],["class","col-md-12",4,"ngIf"],[4,"ngVar"],[4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject",4,"ngIf"],[3,"message",4,"ngIf"],["data-test","empty-external-entry-list",4,"ngIf"],["data-test","empty-external-error-500",4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject"],[3,"message"],["data-test","empty-external-entry-list"],[3,"type"],["data-test","empty-external-error-500"],[1,"lead","mb-0"]],template:function(B,ne){1&B&&(p.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),p.\u0275\u0275text(4),p.\u0275\u0275pipe(5,"translate"),p.\u0275\u0275elementEnd(),p.\u0275\u0275elementStart(6,"ds-submission-import-external-searchbar",4),p.\u0275\u0275listener("externalSourceData",function(Oe){return ne.getExternalSourceData(Oe)}),p.\u0275\u0275elementEnd()()(),p.\u0275\u0275template(7,V,3,2,"div",5),p.\u0275\u0275elementStart(8,"div",1)(9,"div",2),p.\u0275\u0275element(10,"hr"),p.\u0275\u0275elementStart(11,"a",6),p.\u0275\u0275element(12,"i",7),p.\u0275\u0275text(13),p.\u0275\u0275pipe(14,"translate"),p.\u0275\u0275elementEnd()()()()),2&B&&(p.\u0275\u0275advance(4),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(5,5,"submission.import-external.title"+(ne.label?"."+ne.label:""))),p.\u0275\u0275advance(2),p.\u0275\u0275property("initExternalSourceData",ne.reload$.value),p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",ne.reload$.value.entity),p.\u0275\u0275advance(4),p.\u0275\u0275property("routerLink",p.\u0275\u0275pureFunction0(9,Ae)),p.\u0275\u0275advance(2),p.\u0275\u0275textInterpolate1(" ",p.\u0275\u0275pipeBind1(14,7,"submission.import-external.back-to-my-dspace")," "))},directives:[O.p,I.O5,j.g,m.c,D.Z,d.w,T.yS],pipes:[g.X$,I.Ov],styles:[""],data:{animation:[L.Ji]}}),H})()},17050:(te,W,i)=>{"use strict";i.d(W,{i:()=>e});var n=i(25330),E=i(5e3);function v(l,b){}let e=(()=>{class l extends n.F{getComponentName(){return"SubmissionImportExternalComponent"}importThemedComponent(a){return i(49252)(`./${a}/app/submission/import-external/submission-import-external.component`)}importUnthemedComponent(){return Promise.resolve().then(i.bind(i,73391))}}return l.\u0275fac=function(){let b;return function(U){return(b||(b=E.\u0275\u0275getInheritedFactory(l)))(U||l)}}(),l.\u0275cmp=E.\u0275\u0275defineComponent({type:l,selectors:[["ds-themed-submission-import-external"]],features:[E.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(a,U){1&a&&E.\u0275\u0275template(0,v,0,0,"ng-template",null,0,E.\u0275\u0275templateRefExtractor)},encapsulation:2}),l})()},61400:(te,W,i)=>{"use strict";i.d(W,{y:()=>j});var n=i(5e3),E=i(23740),v=i(89951),e=i(74711),l=i(69808),b=i(17656),a=i(38605),U=i(86956);const P=["sectionRef"];function G(m,D){1&m&&(n.\u0275\u0275element(0,"i",18),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&m&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.warnings.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.warnings.aria")))}function w(m,D){1&m&&(n.\u0275\u0275element(0,"i",19),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&m&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.errors.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.errors.aria")))}function C(m,D){1&m&&(n.\u0275\u0275element(0,"i",20),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&m&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.valid.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.valid.aria")))}function M(m,D){1&m&&(n.\u0275\u0275element(0,"i",21),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&m&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.info.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.info.aria")))}const K=function(m){return{"text-white":m}};function _(m,D){if(1&m&&n.\u0275\u0275element(0,"span",22),2&m){n.\u0275\u0275nextContext(3);const d=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(1,K,d.isInfo()))}}function L(m,D){1&m&&n.\u0275\u0275element(0,"span",23)}function R(m,D){if(1&m){const d=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"a",24),n.\u0275\u0275listener("click",function(h){return n.\u0275\u0275restoreView(d),n.\u0275\u0275nextContext(3).removeSection(h)}),n.\u0275\u0275element(1,"i",25),n.\u0275\u0275elementEnd()}}const $=function(m){return{sectionHeader:m}};function f(m,D){if(1&m&&(n.\u0275\u0275elementStart(0,"span",8),n.\u0275\u0275text(1),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(3,"div",9),n.\u0275\u0275template(4,G,3,6,"i",10),n.\u0275\u0275pipe(5,"async"),n.\u0275\u0275template(6,w,3,6,"i",11),n.\u0275\u0275template(7,C,3,6,"i",12),n.\u0275\u0275pipe(8,"async"),n.\u0275\u0275template(9,M,3,6,"i",13),n.\u0275\u0275elementStart(10,"a",14),n.\u0275\u0275pipe(11,"translate"),n.\u0275\u0275pipe(12,"translate"),n.\u0275\u0275pipe(13,"translate"),n.\u0275\u0275template(14,_,1,3,"span",15),n.\u0275\u0275template(15,L,1,0,"span",16),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(16,R,2,0,"a",17),n.\u0275\u0275elementEnd()),2&m){const d=n.\u0275\u0275nextContext(2),g=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(24,K,g.isInfo())),n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(2,11,"submission.sections."+d.sectionData.header)),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(5,13,g.isValid())&&!g.hasErrors()&&!g.isInfo()),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",g.hasErrors()&&!g.isInfo()),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(8,15,g.isValid())&&!g.hasErrors()&&!g.isInfo()),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",g.isInfo()),n.\u0275\u0275advance(1),n.\u0275\u0275property("title",n.\u0275\u0275pipeBind1(13,22,g.isOpen()?"submission.sections.toggle.close":"submission.sections.toggle.open")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind2(11,17,g.isOpen()?"submission.sections.toggle.aria.close":"submission.sections.toggle.aria.open",n.\u0275\u0275pureFunction1(26,$,n.\u0275\u0275pipeBind1(12,20,"submission.sections."+d.sectionData.header)))),n.\u0275\u0275advance(4),n.\u0275\u0275property("ngIf",g.isOpen()),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!g.isOpen()),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!g.isMandatory())}}function A(m,D){if(1&m){const d=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ds-alert",31),n.\u0275\u0275listener("close",function(){const x=n.\u0275\u0275restoreView(d).index;return n.\u0275\u0275nextContext(4),n.\u0275\u0275reference(1).removeError(x)}),n.\u0275\u0275elementEnd()}if(2&m){const d=D.$implicit,g=n.\u0275\u0275nextContext(4);n.\u0275\u0275property("content",d)("dismissible",!0)("type",g.AlertTypeEnum.Error)}}function p(m,D){if(1&m&&(n.\u0275\u0275elementStart(0,"div",29),n.\u0275\u0275template(1,A,1,3,"ds-alert",30),n.\u0275\u0275elementEnd()),2&m){const d=n.\u0275\u0275nextContext(3),g=n.\u0275\u0275reference(1);n.\u0275\u0275propertyInterpolate1("id","sectionGenericError_",d.sectionData.id,""),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngForOf",g.getErrors())}}function T(m,D){1&m&&n.\u0275\u0275elementContainer(0)}function Y(m,D){if(1&m){const d=n.\u0275\u0275getCurrentView();n.\u0275\u0275template(0,p,2,2,"div",26),n.\u0275\u0275elementStart(1,"div",27),n.\u0275\u0275listener("click",function(h){return n.\u0275\u0275restoreView(d),n.\u0275\u0275nextContext(2),n.\u0275\u0275reference(1).setFocus(h)}),n.\u0275\u0275template(2,T,1,0,"ng-container",28),n.\u0275\u0275elementEnd()}if(2&m){const d=n.\u0275\u0275nextContext(2),g=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngIf",g.hasGenericErrors()),n.\u0275\u0275advance(1),n.\u0275\u0275propertyInterpolate1("id","sectionContent_",d.sectionData.id,""),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngComponentOutlet",d.getSectionContent())("ngComponentOutletInjector",d.objectInjector)}}function O(m,D){if(1&m){const d=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ngb-accordion",3,4),n.\u0275\u0275listener("panelChange",function(h){return n.\u0275\u0275restoreView(d),n.\u0275\u0275nextContext(),n.\u0275\u0275reference(1).sectionChange(h)}),n.\u0275\u0275elementStart(2,"ngb-panel",5),n.\u0275\u0275template(3,f,17,28,"ng-template",6),n.\u0275\u0275template(4,Y,3,4,"ng-template",7),n.\u0275\u0275elementEnd()()}if(2&m){const d=n.\u0275\u0275nextContext(),g=n.\u0275\u0275reference(1);n.\u0275\u0275propertyInterpolate("activeIds",d.sectionData.id),n.\u0275\u0275property("destroyOnHide",!1),n.\u0275\u0275advance(2),n.\u0275\u0275propertyInterpolate("id",d.sectionData.id),n.\u0275\u0275property("type",g.isInfo()?"info":"")}}const I=function(m){return{"section-focus":m}};let j=(()=>{class m{constructor(d){this.injector=d,this.AlertTypeEnum=e.N}ngOnInit(){this.objectInjector=n.Injector.create({providers:[{provide:"collectionIdProvider",useFactory:()=>this.collectionId,deps:[]},{provide:"sectionDataProvider",useFactory:()=>this.sectionData,deps:[]},{provide:"submissionIdProvider",useFactory:()=>this.submissionId,deps:[]}],parent:this.injector})}removeSection(d){d.preventDefault(),d.stopPropagation(),this.sectionRef.removeSection(this.submissionId,this.sectionData.id)}getSectionContent(){return(0,v.A)(this.sectionData.sectionType)}}return m.\u0275fac=function(d){return new(d||m)(n.\u0275\u0275directiveInject(n.Injector))},m.\u0275cmp=n.\u0275\u0275defineComponent({type:m,selectors:[["ds-submission-section-container"]],viewQuery:function(d,g){if(1&d&&n.\u0275\u0275viewQuery(P,5),2&d){let h;n.\u0275\u0275queryRefresh(h=n.\u0275\u0275loadQuery())&&(g.sectionRef=h.first)}},inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},decls:4,vars:11,consts:[["dsSection","",3,"ngClass","mandatory","submissionId","sectionType","sectionId"],["sectionRef","sectionRef"],[3,"activeIds","destroyOnHide","panelChange",4,"ngIf"],[3,"activeIds","destroyOnHide","panelChange"],["acc","ngbAccordion"],[3,"id","type"],["ngbPanelTitle",""],["ngbPanelContent",""],["tabindex","0",1,"float-left","section-title",3,"ngClass"],[1,"d-inline-block","float-right"],["class","fas fa-exclamation-circle text-warning mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-exclamation-circle text-danger mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-check-circle text-success mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-info-circle mr-3 text-white","role","img",3,"title",4,"ngIf"],["tabindex","0","role","button",1,"close",3,"title"],["class","fas fa-chevron-up fa-fw",3,"ngClass",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],["href","javascript:void(0);","class","close mr-3",3,"click",4,"ngIf"],["role","img",1,"fas","fa-exclamation-circle","text-warning","mr-3",3,"title"],["role","img",1,"fas","fa-exclamation-circle","text-danger","mr-3",3,"title"],["role","img",1,"fas","fa-check-circle","text-success","mr-3",3,"title"],["role","img",1,"fas","fa-info-circle","mr-3","text-white",3,"title"],[1,"fas","fa-chevron-up","fa-fw",3,"ngClass"],[1,"fas","fa-chevron-down","fa-fw"],["href","javascript:void(0);",1,"close","mr-3",3,"click"],["aria-hidden","true","tabindex","0",1,"fas","fa-trash-o"],[3,"id",4,"ngIf"],[3,"id","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"id"],[3,"content","dismissible","type","close",4,"ngFor","ngForOf"],[3,"content","dismissible","type","close"]],template:function(d,g){if(1&d&&(n.\u0275\u0275elementStart(0,"div",0,1),n.\u0275\u0275template(2,O,5,4,"ngb-accordion",2),n.\u0275\u0275pipe(3,"async"),n.\u0275\u0275elementEnd()),2&d){const h=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(9,I,h.isSectionActive()))("mandatory",g.sectionData.mandatory)("submissionId",g.submissionId)("sectionType",g.sectionData.sectionType)("sectionId",g.sectionData.id),n.\u0275\u0275attribute("id","section_"+g.sectionData.id),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(3,7,h.isEnabled()))}},directives:[E.y,l.mk,l.O5,b.gY,b.Gk,b.Cu,b.gW,l.sg,a.w,l.$G],pipes:[l.Ov,U.X$],styles:["[_nghost-%COMP%]     .card{margin-bottom:var(--ds-submission-sections-margin-bottom);overflow:unset}.section-focus[_ngcontent-%COMP%]{border-radius:var(--bs-border-radius);box-shadow:var(--bs-btn-focus-box-shadow)}[_nghost-%COMP%]     .card:first-of-type{border-bottom:var(--bs-card-border-width) solid var(--bs-card-border-color)!important;border-bottom-left-radius:var(--bs-card-border-radius)!important;border-bottom-right-radius:var(--bs-card-border-radius)!important}[_nghost-%COMP%]     .card-header button{box-shadow:none!important;width:100%}"]}),m})()},89951:(te,W,i)=>{"use strict";i.d(W,{E:()=>E,A:()=>v});const n=new Map;function E(e){return function(b){!b||n.set(e,b)}}function v(e){return n.get(e)}},11306:(te,W,i)=>{"use strict";i.d(W,{i:()=>n});var n=(()=>{return(E=n||(n={})).Relationships="relationships",E.SubmissionForm="submission-form",E.Upload="upload",E.License="license",E.CcLicense="cclicense",E.collection="collection",E.AccessesCondition="accessCondition",E.SherpaPolicies="sherpaPolicy",n;var E})()},23740:(te,W,i)=>{"use strict";i.d(W,{y:()=>P});var n=i(54004),E=i(17489),e=i(20381),l=i(24702),b=i(32354),a=i(86421),U=i(5e3);let P=(()=>{class G{constructor(C,M,K){this.changeDetectorRef=C,this.submissionService=M,this.sectionService=K,this.mandatory=!0,this.genericSectionErrors=[],this.allSectionErrors=[],this.active=!0,this.sectionState=this.mandatory,this.subs=[]}ngOnInit(){this.valid=this.sectionService.isSectionValid(this.submissionId,this.sectionId).pipe((0,n.U)(C=>(C&&this.resetErrors(),C))),this.subs.push(this.sectionService.getShownSectionErrors(this.submissionId,this.sectionId,this.sectionType).subscribe(C=>{(0,l.UE)(C)?C.forEach(M=>{(0,b.Z)(M.path).forEach(_=>{_.fieldId?this.allSectionErrors.push(M.message):this.genericSectionErrors=(0,E.uniq)(this.genericSectionErrors.concat(M.message))})}):this.resetErrors()}),this.submissionService.getActiveSectionId(this.submissionId).subscribe(C=>{const M=this.active;this.active=C===this.sectionId,M!==this.active&&(this.changeDetectorRef.detectChanges(),!this.active&&(0,l.K0)(C)&&this.submissionService.dispatchSave(this.submissionId))})),this.enabled=this.sectionService.isSectionEnabled(this.submissionId,this.sectionId)}ngOnDestroy(){this.subs.filter(C=>(0,l.Uh)(C)).forEach(C=>C.unsubscribe())}sectionChange(C){this.sectionState=C.nextState}isOpen(){return this.sectionState}isMandatory(){return this.mandatory}isSectionActive(){return this.active}isEnabled(){return this.enabled}isValid(){return this.valid}removeSection(C,M){this.sectionService.removeSection(C,M)}hasGenericErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0}hasErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0||this.allSectionErrors&&this.allSectionErrors.length>0}getErrors(){return this.genericSectionErrors}setFocus(C){this.active||this.submissionService.setActiveSection(this.submissionId,this.sectionId)}isInfo(){return this.sectionService.getIsInformational(this.sectionType)}removeError(C){this.genericSectionErrors.splice(C)}resetErrors(){(0,l.UE)(this.genericSectionErrors)&&this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionId),this.genericSectionErrors=[],this.allSectionErrors=[]}}return G.\u0275fac=function(C){return new(C||G)(U.\u0275\u0275directiveInject(U.ChangeDetectorRef),U.\u0275\u0275directiveInject(a.b),U.\u0275\u0275directiveInject(e.J))},G.\u0275dir=U.\u0275\u0275defineDirective({type:G,selectors:[["","dsSection",""]],inputs:{mandatory:"mandatory",sectionId:"sectionId",sectionType:"sectionType",submissionId:"submissionId"},exportAs:["sectionRef"]}),G})()},20381:(te,W,i)=>{"use strict";i.d(W,{J:()=>j});var n=i(39841),E=i(54004),v=i(71884),e=i(86099),l=i(39300),b=i(95698),a=i(17489),P=i(24702),G=i(88360),w=i(78809),C=i(91511),M=i(32354),K=i(19522),_=i(82596),L=i(86421),R=i(11306),$=i(34690),f=i(8108),A=i(28858),p=i(51858),T=i(5e3),Y=i(13909),O=i(65620),I=i(86956);let j=(()=>{class m{constructor(d,g,h,x,oe,se){this.formService=d,this.notificationsService=g,this.scrollToService=h,this.submissionService=x,this.store=oe,this.translate=se}checkSectionErrors(d,g,h,x,oe=[]){if((0,P.xb)(x))this.store.dispatch(new G.QC(d,g)),this.store.dispatch(new K.y5(h));else if(!(0,a.isEqual)(x,oe)){const se=[];x.forEach(Z=>{(0,M.Z)(Z.path).forEach(N=>{N.fieldId&&(this.formService.addError(h,N.fieldId,N.fieldIndex,Z.message),se.push(N.fieldId))})}),oe.forEach(Z=>{(0,M.Z)(Z.path).forEach(N=>{N.fieldId&&(se.includes(N.fieldId)||this.formService.removeError(h,N.fieldId,N.fieldIndex))})})}}dispatchRemoveSectionErrors(d,g){this.store.dispatch(new G.QC(d,g))}dispatchSetSectionFormId(d,g,h){this.store.dispatch(new G.re(d,g,h))}getSectionData(d,g,h){return this.store.select((0,w.y5)(d,g)).pipe((0,E.U)(x=>h===R.i.SubmissionForm?(0,$.Vv)(x):x),(0,v.x)())}getShownSectionErrors(d,g,h){let x;return x=h!==R.i.SubmissionForm?this.getSectionErrors(d,g):this.getSectionState(d,g,h).pipe((0,e.z)(oe=>this.formService.getFormErrors(oe.formId).pipe((0,E.U)(se=>{const Z=new p.K("sections",g),le=se.map(N=>({path:Z.getPath(N.fieldId.replace(/\_/g,".")).path,message:N.message})).filter(N=>-1===(0,a.findIndex)(oe.errorsToShow,{path:N.path}));return[...oe.errorsToShow,...le]})))),x}getSectionErrors(d,g){return this.store.select((0,w.Mb)(d,g)).pipe((0,v.x)())}getSectionServerErrors(d,g){return this.store.select((0,w.fh)(d,g)).pipe((0,v.x)())}getSectionState(d,g,h){return this.store.select((0,w.gd)(d,g)).pipe((0,l.h)(x=>(0,P.Uh)(x)),(0,E.U)(x=>x),(0,E.U)(x=>(0,P.Uh)(x.data)&&h===R.i.SubmissionForm?Object.assign({},x,{data:(0,$.Vv)(x.data)}):x),(0,v.x)())}isSectionValid(d,g){return this.store.select((0,w.gd)(d,g)).pipe((0,l.h)(h=>(0,P.Uh)(h)),(0,E.U)(h=>h.isValid),(0,v.x)())}isSectionActive(d,g){return this.submissionService.getActiveSectionId(d).pipe((0,E.U)(h=>g===h),(0,v.x)())}isSectionEnabled(d,g){return this.store.select((0,w.gd)(d,g)).pipe((0,l.h)(h=>(0,P.Uh)(h)),(0,E.U)(h=>h.enabled),(0,v.x)())}isSectionReadOnly(d,g,h){return this.store.select((0,w.gd)(d,g)).pipe((0,l.h)(x=>(0,P.Uh)(x)),(0,E.U)(x=>(0,P.UE)(x.visibility)&&"READONLY"===x.visibility.other&&h!==C.S.WorkspaceItem),(0,v.x)())}isSectionAvailable(d,g){return this.store.select((0,w.ak)(d)).pipe((0,l.h)(h=>(0,P.pT)(h)),(0,E.U)(h=>(0,P.pT)(h.sections)&&(0,P.pT)(h.sections[g])),(0,v.x)())}isSectionTypeAvailable(d,g){return this.store.select((0,w.ak)(d)).pipe((0,l.h)(h=>(0,P.pT)(h)),(0,E.U)(h=>(0,P.pT)(h.sections)&&(0,P.pT)((0,a.findKey)(h.sections,{sectionType:g}))),(0,v.x)())}isSectionType(d,g,h){return this.store.select((0,w.ak)(d)).pipe((0,l.h)(x=>(0,P.pT)(x)),(0,E.U)(x=>(0,P.pT)(x.sections)&&(0,P.pT)(x.sections[g])&&x.sections[g].sectionType===h),(0,v.x)())}addSection(d,g){this.store.dispatch(new G.gn(d,g)),this.scrollToService.scrollTo({target:g,offset:-70})}removeSection(d,g){this.store.dispatch(new G.s0(d,g))}updateSectionData(d,g,h,x=[],oe=[],se){if((0,P.UE)(h)){const Z=this.isSectionAvailable(d,g),le=this.isSectionEnabled(d,g);(0,n.a)(Z,le).pipe((0,b.q)(1),(0,l.h)(([N,ae])=>N)).subscribe(([N,ae])=>{this.store.dispatch(new G.z6(d,g,h,x,oe,se))})}}setSectionError(d,g,h){this.store.dispatch(new G.uO(d,g,h))}setSectionStatus(d,g,h){this.store.dispatch(new G.hx(d,g,h))}computeSectionConfiguredMetadata(d){const g=[],h="string"==typeof d?JSON.parse(d,f.WMN):d;return h.rows&&!(0,P.xb)(h.rows)&&h.rows.forEach(x=>{x.fields&&!(0,P.xb)(x.fields)&&x.fields.forEach(oe=>{oe.selectableMetadata&&!(0,P.xb)(oe.selectableMetadata)&&oe.selectableMetadata.forEach(se=>{g.includes(se.metadata)||g.push(se.metadata)})})}),g}getIsInformational(d){return d===R.i.SherpaPolicies}}return m.\u0275fac=function(d){return new(d||m)(T.\u0275\u0275inject(A.o),T.\u0275\u0275inject(_.T),T.\u0275\u0275inject(Y.ij),T.\u0275\u0275inject(L.b),T.\u0275\u0275inject(O.yh),T.\u0275\u0275inject(I.sK))},m.\u0275prov=T.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac}),m})()},38791:(te,W,i)=>{"use strict";i.d(W,{o:()=>po});var n=i(61508),E=i(57981),v=i(70655),e=i(5e3),l=i(39841),b=i(54004),a=i(18505),U=i(86099),P=i(95698),G=i(40367),w=i(71884),C=i(39300),M=i(86956),K=i(17489),_=i(71022),L=i(63311),R=i(28858),$=i(68675),f=i(24702);let A=(()=>{class o{constructor(t,r,c){this.injectedCollectionId=t,this.injectedSectionData=r,this.injectedSubmissionId=c,this.collectionId=t,this.sectionData=r,this.submissionId=c}ngOnInit(){this.onSectionInit(),this.updateSectionStatus()}updateSectionStatus(){this.sectionStatusSub=this.getSectionStatus().pipe((0,C.h)(t=>(0,f.pT)(t)),(0,$.O)(!0)).subscribe(t=>{this.sectionService.setSectionStatus(this.submissionId,this.sectionData.id,t)})}ngOnDestroy(){(0,f.Uh)(this.sectionStatusSub)&&this.sectionStatusSub.unsubscribe(),this.onSectionDestroy()}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-section-model"]],decls:0,vars:0,template:function(t,r){},encapsulation:2}),o})();var p=i(24836),T=i(51858);class Y{constructor(s=null,t=null){this._path=s,this._value=t}get path(){return this._path}set path(s){this._path=s}get value(){return this._value}set value(s){this._value=s}delete(){this._value=null,this._path=null}isPathEqual(s){return this._path&&(0,K.isEqual)(this._path,s)}}var O=i(89951),I=i(11306),j=i(86421),m=i(13312),D=i(82596),d=i(20381),g=i(91776),h=i(62168),x=i(68285),oe=i(74297),se=i(58943),Z=i(31241),le=i(93369),N=i(21540),ae=i(91511),ue=i(61200),V=i(69808),Ae=i(48106);const Ve=["formRef"];function H(o,s){1&o&&e.\u0275\u0275element(0,"ds-themed-loading",2)}function _e(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",3,4),e.\u0275\u0275listener("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)})("dfFocus",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onFocus(c)})("remove",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onRemove(c)})("ngbEvent",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onCustomEvent(c)})("removeArrayItem",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onRemove(c)}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("displaySubmit",!1)("displayCancel",!1)}}let B=class extends A{constructor(s,t,r,c,u,y,F,k,ee,S,z,re,Q,ie,pe){super(Q,ie,pe),this.cdr=s,this.formBuilderService=t,this.formOperationsService=r,this.formService=c,this.formConfigService=u,this.notificationsService=y,this.sectionService=F,this.submissionService=k,this.translate=ee,this.submissionObjectService=S,this.objectCache=z,this.requestService=re,this.injectedCollectionId=Q,this.injectedSectionData=ie,this.injectedSubmissionId=pe,this.isUpdating=!1,this.isLoading=!0,this.fieldsOnTheirWayToBeRemoved=new Map,this.formData=Object.create({}),this.previousValue=new Y,this.subs=[]}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.sectionService.dispatchSetSectionFormId(this.submissionId,this.sectionData.id,this.formId),this.formConfigService.findByHref(this.sectionData.config).pipe((0,b.U)(s=>s.payload),(0,a.b)(s=>this.formConfig=s),(0,U.z)(()=>(0,l.a)([this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType),this.submissionObjectService.findById(this.submissionId,!0,!1,(0,le.l)("item")).pipe((0,x.xw)(),(0,x.xe)())])),(0,P.q)(1)).subscribe(([s,t])=>{(0,f.o8)(this.formModel)&&(this.submissionObject=t,this.initForm(s),this.sectionData.data=s,this.subscriptions(),this.isLoading=!1,this.cdr.detectChanges())})}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}getSectionStatus(){const s=this.formService.isValid(this.formId),t=this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,b.U)(r=>(0,f.xb)(r)));return(0,l.a)([s,t]).pipe((0,b.U)(([r,c])=>r&&c))}hasMetadataEnrichment(s){const t={};Object.keys(s).forEach(u=>{this.sectionMetadata&&this.sectionMetadata.includes(u)&&this.inCurrentSubmissionScope(u)&&(t[u]=s[u])});const r=[],c=(0,g.e5)(t,this.formData);return Object.keys(c).forEach(u=>{c[u].forEach(y=>{y.hasOwnProperty("value")&&(0,K.findIndex)(this.formData[u],{value:y.value})<0&&r.push(y)})}),(0,f.UE)(r)}inCurrentSubmissionScope(s){var t,r,c;switch(null===(c=null===(r=null===(t=this.formConfig)||void 0===t?void 0:t.rows.find(y=>{var F,k,ee,S;return(null===(S=null===(ee=null===(k=null===(F=y.fields)||void 0===F?void 0:F[0])||void 0===k?void 0:k.selectableMetadata)||void 0===ee?void 0:ee[0])||void 0===S?void 0:S.metadata)===s}).fields)||void 0===r?void 0:r[0])||void 0===c?void 0:c.scope){case ae.S.WorkspaceItem:return this.submissionObject.type===h.K.type.value;case ae.S.WorkflowItem:return this.submissionObject.type===ue.p.type.value;default:return!0}}initForm(s){try{this.formModel=this.formBuilderService.modelFromConfiguration(this.submissionId,this.formConfig,this.collectionId,s,this.submissionService.getSubmissionScope());const t=this.sectionService.computeSectionConfiguredMetadata(this.formConfig);this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,s,this.sectionData.errorsToShow,this.sectionData.serverValidationErrors,t)}catch(t){const c={message:this.translate.instant("error.submission.sections.init-form-error")+t.toString(),path:"/sections/"+this.sectionData.id};console.error(t.stack),this.sectionService.setSectionError(this.submissionId,this.sectionData.id,c)}}updateForm(s,t){(0,f.UE)(s)&&!(0,K.isEqual)(s,this.sectionData.data)?(this.sectionData.data=s,this.hasMetadataEnrichment(s)?(this.isUpdating=!0,this.formModel=null,this.cdr.detectChanges(),this.initForm(s),this.checksForErrors(t),this.isUpdating=!1,this.cdr.detectChanges()):((0,f.UE)(t)||(0,f.UE)(this.sectionData.errorsToShow))&&this.checksForErrors(t)):((0,f.UE)(t)||(0,f.UE)(this.sectionData.errorsToShow))&&this.checksForErrors(t)}checksForErrors(s){this.formService.isFormInitialized(this.formId).pipe((0,G.s)(t=>!0===t&&!this.isUpdating)).subscribe(()=>{this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,s,this.sectionData.errorsToShow),this.sectionData.errorsToShow=s,this.cdr.detectChanges()})}subscriptions(){this.subs.push(this.formService.getFormData(this.formId).pipe((0,w.x)()).subscribe(s=>{this.formData=s}),this.sectionService.getSectionState(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,C.h)(s=>(0,f.UE)(s)&&((0,f.UE)(s.data)||(0,f.UE)(s.errorsToShow))),(0,w.x)()).subscribe(s=>{this.fieldsOnTheirWayToBeRemoved=new Map,this.sectionMetadata=s.metadata,this.updateForm(s.data,s.errorsToShow)}))}onChange(s){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,this.hasStoredValue(this.formBuilderService.getId(s.model),this.formOperationsService.getArrayIndexFromEvent(s)));const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);(-1!==N.N.submission.autosave.metadata.indexOf(t)&&(0,f.UE)(r)||this.hasRelatedCustomError(t))&&this.submissionService.dispatchSave(this.submissionId)}hasRelatedCustomError(s){const t=(0,K.findIndex)(this.sectionData.errorsToShow,{path:this.pathCombiner.getPath(s).path});if(-1!==t){const c=this.sectionData.errorsToShow[t].message.replace("error.validation.","");return!N.N.form.validatorMap.hasOwnProperty(c)}return!1}onFocus(s){const t=this.formOperationsService.getFieldValueFromChangeEvent(s),r=this.formBuilderService.getPath(s.model);this.formBuilderService.hasMappedGroupValue(s.model)?(this.previousValue.path=r,this.previousValue.value=this.formOperationsService.getQualdropValueMap(s)):(0,f.UE)(t)&&("object"==typeof t&&(0,f.UE)(t.value)||"string"==typeof t)&&(this.previousValue.path=r,this.previousValue.value=t)}onRemove(s){const t=this.formBuilderService.getId(s.model),r=this.formOperationsService.getArrayIndexFromEvent(s);if(this.fieldsOnTheirWayToBeRemoved.has(t)){const c=this.fieldsOnTheirWayToBeRemoved.get(t);c.push(r),this.fieldsOnTheirWayToBeRemoved.set(t,c)}else this.fieldsOnTheirWayToBeRemoved.set(t,[r]);this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,this.hasStoredValue(t,r))}hasStoredValue(s,t){return!!(0,f.UE)(this.sectionData.data)&&this.sectionData.data.hasOwnProperty(s)&&(0,f.UE)(this.sectionData.data[s][t])&&!this.isFieldToRemove(s,t)}isFieldToRemove(s,t){return this.fieldsOnTheirWayToBeRemoved.has(s)&&this.fieldsOnTheirWayToBeRemoved.get(s).includes(t)}onCustomEvent(s){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,null)}};B.\u0275fac=function(s){return new(s||B)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(m.m),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(p.X),e.\u0275\u0275directiveInject(D.T),e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(M.sK),e.\u0275\u0275directiveInject(oe.O),e.\u0275\u0275directiveInject(se.a),e.\u0275\u0275directiveInject(Z.s),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},B.\u0275cmp=e.\u0275\u0275defineComponent({type:B,selectors:[["ds-submission-section-form"]],viewQuery:function(s,t){if(1&s&&e.\u0275\u0275viewQuery(Ve,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:2,consts:[["message","Loading...",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem",4,"ngIf"],["message","Loading..."],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem"],["formRef","formComponent"]],template:function(s,t){1&s&&(e.\u0275\u0275template(0,H,1,0,"ds-themed-loading",0),e.\u0275\u0275template(1,_e,2,4,"ds-form",1)),2&s&&(e.\u0275\u0275property("ngIf",t.isLoading),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.isLoading&&t.formModel))},directives:[V.O5,Ae.Z,L.U],styles:[""]}),B=(0,v.gn)([(0,O.E)(I.i.SubmissionForm),(0,v.w6)("design:paramtypes",[e.ChangeDetectorRef,_.c,m.m,R.o,p.X,D.T,d.J,j.b,M.sK,oe.O,se.a,Z.s,String,Object,String])],B);i(23740),i(2962),i(70521),i(14736),i(26828),i(61400);var Le=i(65620),J=i(26991),gt=i(67899),Ne=i(50457),he=i(39646),ve=i(63900),Te=i(70262),Pe=i(11365),Ue=i(44459),bt=i(97437),X=i(88360),St=i(32354);function Et(o,s,t){return o?o[s.sections[t].formId]:null}function It(o,s,t,r){if(r||t!==I.i.SubmissionForm)return s;if(!o||!o.touched)return[];const c=[];return s.forEach(u=>{(0,St.Z)(u.path).forEach(F=>{F.fieldId&&o.touched[F.fieldId]&&c.push(u)})}),c}const xt=[(()=>{class o{constructor(t,r,c,u,y,F,k,ee){this.actions$=t,this.notificationsService=r,this.operationsService=c,this.sectionService=u,this.store$=y,this.submissionService=F,this.submissionObjectService=k,this.translate=ee,this.loadForm$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.INIT_SUBMISSION_FORM),(0,b.U)(S=>{const z=S.payload.submissionDefinition,re=[];return z.sections.page.forEach(Q=>{const ie=Q._links.self.href||Q._links.self,pe=ie.substr(ie.lastIndexOf("/")+1),me=Q._links.config?Q._links.config.href||Q._links.config:"",de=Q.mandatory||(0,f.UE)(S.payload.sections)&&S.payload.sections.hasOwnProperty(pe);let ce;ce=Q.sectionType!==I.i.SubmissionForm?(0,f.pT)(S.payload.sections)&&(0,f.pT)(S.payload.sections[pe])?S.payload.sections[pe]:Object.create(null):S.payload.item.metadata;const Me=(0,f.UE)(S.payload.errors)&&S.payload.errors[pe]||null;re.push(new X.qK(S.payload.submissionId,pe,Q.header,me,Q.mandatory,Q.sectionType,Q.visibility,de,ce,Me))}),{action:S,definition:z,mappedActions:re}}),(0,U.z)(S=>(0,Ne.D)(S.mappedActions.concat(new X.p3(S.action.payload.submissionId)))))),this.resetForm$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.RESET_SUBMISSION_FORM),(0,b.U)(S=>new X.Xq(S.payload.collectionId,S.payload.submissionId,S.payload.selfUrl,S.payload.submissionDefinition,S.payload.sections,S.payload.item,null)))),this.saveSubmission$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.SAVE_SUBMISSION_FORM),(0,ve.w)(S=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),S.payload.submissionId,"sections").pipe((0,b.U)(z=>new X.Uq(S.payload.submissionId,z,S.payload.isManual,S.payload.isManual)),(0,Te.K)(()=>(0,he.of)(new X.ec(S.payload.submissionId))))))),this.saveForLaterSubmission$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.SAVE_FOR_LATER_SUBMISSION_FORM),(0,ve.w)(S=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),S.payload.submissionId,"sections").pipe((0,b.U)(z=>new X.gA(S.payload.submissionId,z)),(0,Te.K)(()=>(0,he.of)(new X.ec(S.payload.submissionId))))))),this.saveSubmissionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.SAVE_SUBMISSION_FORM_SUCCESS),(0,Pe.M)(this.store$),(0,b.U)(([S,z])=>this.parseSaveResponse(z.submission.objects[S.payload.submissionId],S.payload.submissionObject,S.payload.submissionId,z.forms,S.payload.showNotifications,S.payload.showErrors)),(0,U.z)(S=>(0,Ne.D)(S)))),this.saveSubmissionSectionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.SAVE_SUBMISSION_SECTION_FORM_SUCCESS),(0,Pe.M)(this.store$),(0,b.U)(([S,z])=>this.parseSaveResponse(z.submission.objects[S.payload.submissionId],S.payload.submissionObject,S.payload.submissionId,z.forms,!1,!1)),(0,U.z)(S=>(0,Ne.D)(S)))),this.saveSection$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.SAVE_SUBMISSION_SECTION_FORM),(0,ve.w)(S=>this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),S.payload.submissionId,"sections",S.payload.sectionId).pipe((0,b.U)(z=>new X.hM(S.payload.submissionId,z)),(0,Te.K)(()=>(0,he.of)(new X.cT(S.payload.submissionId))))))),this.saveError$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.SAVE_SUBMISSION_FORM_ERROR,X.tI.SAVE_SUBMISSION_SECTION_FORM_ERROR),(0,Pe.M)(this.store$),(0,a.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.save_error_notice")))),{dispatch:!1}),this.saveAndDeposit$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.SAVE_AND_DEPOSIT_SUBMISSION),(0,Pe.M)(this.submissionService.hasUnsavedModification()),(0,ve.w)(([S,z])=>{let re;return re=z?this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),S.payload.submissionId,"sections"):this.submissionObjectService.findById(S.payload.submissionId,!1,!0).pipe((0,x.Gp)(),(0,b.U)(Q=>[Q])),re.pipe((0,b.U)(Q=>this.canDeposit(Q)?new X.wn(S.payload.submissionId):(this.notificationsService.warning(null,this.translate.instant("submission.sections.general.cannot_deposit"),null,!0),new X.Uq(S.payload.submissionId,Q,!1,!0))),(0,Te.K)(()=>(0,he.of)(new X.ec(S.payload.submissionId))))}))),this.depositSubmission$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.DEPOSIT_SUBMISSION),(0,Pe.M)(this.store$),(0,ve.w)(([S,z])=>this.submissionService.depositSubmission(z.submission.objects[S.payload.submissionId].selfUrl).pipe((0,b.U)(()=>new X.e7(S.payload.submissionId)),(0,Te.K)(re=>(0,he.of)(new X.jn(S.payload.submissionId))))))),this.saveForLaterSubmissionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.SAVE_FOR_LATER_SUBMISSION_FORM_SUCCESS),(0,a.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice"))),(0,a.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.depositSubmissionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.DEPOSIT_SUBMISSION_SUCCESS),(0,a.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.deposit_success_notice"))),(0,a.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.depositSubmissionError$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.DEPOSIT_SUBMISSION_ERROR),(0,a.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.deposit_error_notice")))),{dispatch:!1}),this.discardSubmission$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.DISCARD_SUBMISSION),(0,ve.w)(S=>this.submissionService.discardSubmission(S.payload.submissionId).pipe((0,b.U)(()=>new X._w(S.payload.submissionId)),(0,Te.K)(()=>(0,he.of)(new X.kj(S.payload.submissionId))))))),this.addAllMetadataToSectionData=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.UPDATE_SECTION_DATA),(0,ve.w)(S=>this.sectionService.getSectionState(S.payload.submissionId,S.payload.sectionId,I.i.Upload).pipe((0,b.U)(z=>[S,z]),(0,P.q)(1))),(0,C.h)(([S,z])=>z.sectionType===I.i.SubmissionForm),(0,ve.w)(([S,z])=>z.sectionType===I.i.SubmissionForm?this.submissionObjectService.findById(S.payload.submissionId,!0,!1,(0,le.l)("item")).pipe((0,x.Gp)()).pipe((0,ve.w)(ie=>ie.item.pipe((0,x.Gp)()))).pipe((0,b.U)(ie=>ie.metadata),(0,C.h)(ie=>!(0,K.isEqual)(S.payload.data,ie)),(0,b.U)(ie=>new X.z6(S.payload.submissionId,S.payload.sectionId,ie,S.payload.errorsToShow,S.payload.serverValidationErrors,S.payload.metadata))):(0,he.of)(new X.jQ)))),this.discardSubmissionSuccess$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.DISCARD_SUBMISSION_SUCCESS),(0,a.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.discard_success_notice"))),(0,a.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.discardSubmissionError$=(0,J.GW)(()=>this.actions$.pipe((0,J.l4)(X.tI.DISCARD_SUBMISSION_ERROR),(0,a.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.discard_error_notice")))),{dispatch:!1})}canDeposit(t){let r=!0;return(0,f.UE)(t)&&t.forEach(c=>{const{errors:u}=c;u&&!(0,f.xb)(u)&&(r=!1)}),r}parseSaveResponse(t,r,c,u,y=!0,F=!0){const k=[];return(0,f.UE)(r)&&(y&&this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice")),r.forEach(ee=>{var S;let z=Object.create({});const{errors:re}=ee;re&&!(0,f.xb)(re)&&(z=(0,bt.Z)(re),y&&this.notificationsService.warning(null,this.translate.get("submission.sections.general.sections_not_valid")));const Q=ee.sections&&(0,f.UE)(ee.sections)?ee.sections:{},ie=(0,K.union)(Object.keys(Q),Object.keys(z));for(const me of ie){const de=z[me]||[],ce=Q[me]||{};if(t.sections[me].sectionType===I.i.Upload&&(0,f.xb)(ce.files)&&!t.sections[me].enabled)continue;y&&!t.sections[me].enabled&&this.submissionService.notifyNewSection(c,me,t.sections[me].sectionType);const Ze=It(Et(u,t,me),de,t.sections[me].sectionType,F);k.push(new X.z6(c,me,ce,Ze,de))}const pe=(0,K.findKey)(t.sections,me=>me.sectionType===I.i.SherpaPolicies);(0,f.pT)(pe)&&(0,f.UE)(null===(S=t.sections[pe])||void 0===S?void 0:S.data)&&(0,f.xb)(Q[pe])&&k.push(new X.z6(c,pe,null,[],[]))})),k}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(J.eX),e.\u0275\u0275inject(D.T),e.\u0275\u0275inject(Ue.E),e.\u0275\u0275inject(d.J),e.\u0275\u0275inject(Le.yh),e.\u0275\u0275inject(j.b),e.\u0275\u0275inject(oe.O),e.\u0275\u0275inject(M.sK))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o})()];var Ge=i(61135),Re=i(78809);let Fe=(()=>{class o{constructor(t){this.store=t}getUploadedFileList(t,r){return this.store.select((0,Re.y8)(t,r)).pipe((0,b.U)(c=>c),(0,w.x)())}getFileData(t,r,c){return this.store.select((0,Re.y8)(t,r)).pipe((0,C.h)(u=>!(0,f.o8)(u)),(0,b.U)(u=>{let y;return Object.keys(u).filter(F=>u[F].uuid===c).forEach(F=>y=u[F]),y}),(0,w.x)())}getDefaultPolicies(t,r,c){return this.store.select((0,Re.G)(t,r,c)).pipe((0,b.U)(u=>u),(0,w.x)())}addUploadedFile(t,r,c,u){this.store.dispatch(new X.l5(t,r,c,u))}updateFileData(t,r,c,u){this.store.dispatch(new X.GM(t,r,c,u))}removeUploadedFile(t,r,c){this.store.dispatch(new X.YU(t,r,c))}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(Le.yh))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o})();var je=i(36391),ze=i(43499),ke=i(24886),qe=i(69627),Be=i(93498),et=i(73692),Ke=i(43015),tt=i(21147);let ge=class extends qe.o{constructor(s,t,r,c){super("submissionuploads",s,t,r,c),this.requestService=s,this.rdbService=t,this.objectCache=r,this.halService=c}findByHref(s,t=!0,r=!0,...c){return super.findByHref(s,t,r,...c)}};ge.\u0275fac=function(s){return new(s||ge)(e.\u0275\u0275inject(Z.s),e.\u0275\u0275inject(Ke.Q),e.\u0275\u0275inject(se.a),e.\u0275\u0275inject(Be.q))},ge.\u0275prov=e.\u0275\u0275defineInjectable({token:ge,factory:ge.\u0275fac}),ge=(0,v.gn)([(0,tt.cQ)(et.fB),(0,v.w6)("design:paramtypes",[Z.s,Ke.Q,se.a,Be.q])],ge);var Qe=i(74711);function yt(o,s){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",2)(2,"div",3)(3,"h3",4)(4,"span",5),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd()),2&o&&(e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,1,"submission.sections.upload.no-file-uploaded")))}const nt=function(o){return{collectionName:o}};function Dt(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,"submission.sections.upload.header.policy.default.nolist",e.\u0275\u0275pureFunction1(4,nt,t.collectionName))," ")}}function Ot(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,"submission.sections.upload.header.policy.default.withlist",e.\u0275\u0275pureFunction1(4,nt,t.collectionName))," ")}}function Tt(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",8)(2,"ds-alert",9),e.\u0275\u0275template(3,Dt,3,6,"ng-container",1),e.\u0275\u0275template(4,Ot,3,6,"ng-container",1),e.\u0275\u0275element(5,"span",10)(6,"ds-submission-section-upload-access-conditions",11),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("type",t.AlertTypeEnum.Warning),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",1===t.collectionPolicyType),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",2===t.collectionPolicyType),e.\u0275\u0275advance(2),e.\u0275\u0275property("accessConditions",t.collectionDefaultAccessConditions)}}function Mt(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-submission-upload-section-file",12),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",2)(4,"div",3),e.\u0275\u0275element(5,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("availableAccessConditionOptions",r.availableAccessConditionOptions)("collectionId",r.collectionId)("collectionPolicyType",r.collectionPolicyType)("configMetadataForm",e.\u0275\u0275pipeBind1(2,9,r.configMetadataForm$))("fileId",r.fileIndexes[r.fileList.indexOf(t)])("fileIndex",r.fileList.indexOf(t))("fileName",r.fileNames[r.fileList.indexOf(t)])("sectionId",r.sectionData.id)("submissionId",r.submissionId)}}function Pt(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Tt,7,4,"div",6),e.\u0275\u0275template(2,Mt,6,11,"ng-container",7),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.collectionDefaultAccessConditions.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.fileList)}}let Ee=class extends A{constructor(s,t,r,c,u,y,F,k,ee,S){super(void 0,ee,S),this.bitstreamService=s,this.changeDetectorRef=t,this.collectionDataService=r,this.groupService=c,this.resourcePolicyService=u,this.sectionService=y,this.submissionService=F,this.uploadsConfigService=k,this.injectedSectionData=ee,this.injectedSubmissionId=S,this.AlertTypeEnum=Qe.N,this.fileIndexes=[],this.fileList=[],this.fileNames=[],this.collectionDefaultAccessConditions=[],this.required$=new Ge.X(!0),this.subs=[]}onSectionInit(){const s=this.uploadsConfigService.findByHref(this.sectionData.config,!0,!1,(0,le.l)("metadata")).pipe((0,x.xw)(),(0,b.U)(t=>t.payload));this.configMetadataForm$=s.pipe((0,ve.w)(t=>t.metadata.pipe((0,x.xw)(),(0,b.U)(r=>r.payload)))),this.subs.push(this.submissionService.getSubmissionObject(this.submissionId).pipe((0,C.h)(t=>(0,f.pT)(t)&&!t.isLoading),(0,C.h)(t=>(0,f.o8)(this.collectionId)||this.collectionId!==t.collection),(0,a.b)(t=>this.collectionId=t.collection),(0,U.z)(t=>this.collectionDataService.findById(t.collection)),(0,C.h)(t=>(0,f.pT)(t.payload)),(0,a.b)(t=>this.collectionName=t.payload.name),(0,U.z)(()=>s)).subscribe(t=>{this.required$.next(t.required),this.availableAccessConditionOptions=(0,f.UE)(t.accessConditionOptions)?t.accessConditionOptions:[],this.collectionPolicyType=this.availableAccessConditionOptions.length>0?2:1,this.changeDetectorRef.detectChanges()}),(0,l.a)(this.configMetadataForm$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id)).pipe((0,C.h)(([t,r])=>(0,f.UE)(t)&&(0,f.pT)(r)),(0,w.x)()).subscribe(([t,r])=>{this.fileList=[],this.fileIndexes=[],this.fileNames=[],this.changeDetectorRef.detectChanges(),(0,f.pT)(r)&&r.length>0&&r.forEach(c=>{this.fileList.push(c),this.fileIndexes.push(c.uuid),this.fileNames.push(this.getFileName(t,c))}),this.changeDetectorRef.detectChanges()}))}getFileName(s,t){const r=s.rows[0].fields[0].selectableMetadata[0].metadata;let c;return c=(0,f.UE)(t.metadata)&&(0,f.UE)(t.metadata[r])?t.metadata[r][0].display:t.uuid,c}getSectionStatus(){return(0,l.a)(this.required$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id),(s,t)=>!s||(0,f.pT)(t)&&t.length>0)}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}};Ee.\u0275fac=function(s){return new(s||Ee)(e.\u0275\u0275directiveInject(Fe),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(je.W),e.\u0275\u0275directiveInject(ze.O),e.\u0275\u0275directiveInject(ke.I),e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(ge),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Ee.\u0275cmp=e.\u0275\u0275defineComponent({type:Ee,selectors:[["ds-submission-section-upload"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:5,consts:[[3,"content","dismissible","type"],[4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"text-center"],[1,"text-muted"],["class","row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col-sm-12"],[3,"type"],[1,"clearfix"],[3,"accessConditions"],[3,"availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]],template:function(s,t){1&s&&(e.\u0275\u0275element(0,"ds-alert",0),e.\u0275\u0275template(1,yt,7,3,"ng-container",1),e.\u0275\u0275template(2,Pt,3,2,"ng-container",1)),2&s&&(e.\u0275\u0275property("content","submission.sections.upload.info")("dismissible",!0)("type",t.AlertTypeEnum.Info),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0==t.fileList.length),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.fileList.length>0))},styles:[""]}),Ee=(0,v.gn)([(0,O.E)(I.i.Upload),(0,v.w6)("design:paramtypes",[Fe,e.ChangeDetectorRef,je.W,ze.O,ke.I,d.J,j.b,ge,Object,String])],Ee);i(30184);var be=i(57428);const Bt={granted:{element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}}},At=[{id:"granted",label:"submission.sections.license.granted-label",required:!0,value:!1,validators:{required:null},errorMessages:{required:"submission.sections.license.required",notgranted:"submission.sections.license.notgranted"},type:"CHECKBOX"}],Lt=["formRef"];function Rt(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",2,3),e.\u0275\u0275listener("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("formLayout",t.formLayout)("displaySubmit",t.displaySubmit)("displayCancel",!1)}}let Ie=class extends A{constructor(s,t,r,c,u,y,F,k,ee,S,z,re){super(S,z,re),this.changeDetectorRef=s,this.collectionDataService=t,this.formBuilderService=r,this.formOperationsService=c,this.formService=u,this.operationsBuilder=y,this.sectionService=F,this.submissionService=k,this.translateService=ee,this.injectedCollectionId=S,this.injectedSectionData=z,this.injectedSubmissionId=re,this.formLayout=Bt,this.displaySubmit=!1,this.subs=[]}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.formModel=this.formBuilderService.fromJSON(At);const s=this.formBuilderService.findById("granted",this.formModel);s.label=this.translateService.instant(s.label),s.value=this.sectionData.data.granted,this.licenseText$=this.collectionDataService.findById(this.collectionId,!0,!0,(0,le.l)("license")).pipe((0,C.h)(t=>(0,f.pT)(t.payload)),(0,U.z)(t=>t.payload.license),(0,G.s)(t=>(0,f.pT)(t.payload)),(0,b.U)(t=>t.payload.text),(0,$.O)("")),this.subs.push(this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope()).pipe((0,P.q)(1),(0,C.h)(t=>t)).subscribe(()=>{s.disabled=!0}),this.sectionService.getSectionErrors(this.submissionId,this.sectionData.id).pipe((0,C.h)(t=>(0,f.UE)(t)),(0,w.x)()).subscribe(t=>{const r=t.map(c=>"/sections/license"===c.path?s.checked?null:Object.assign({},c,{path:"/sections/license/granted"}):c).filter(c=>(0,f.K0)(c));(0,f.UE)(r)?(this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,r),this.sectionData.errors=t):this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id),this.changeDetectorRef.detectChanges()}))}getSectionStatus(){const s=this.formBuilderService.findById("granted",this.formModel);return s.valueChanges.pipe((0,b.U)(t=>!0===t),(0,$.O)(s.value))}onChange(s){const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);r?(this.operationsBuilder.add(this.pathCombiner.getPath(t),r.value.toString(),!1,!0),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)):this.operationsBuilder.remove(this.pathCombiner.getPath(t))}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}};Ie.\u0275fac=function(s){return new(s||Ie)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(je.W),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(m.m),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(M.sK),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Ie.\u0275cmp=e.\u0275\u0275defineComponent({type:Ie,selectors:[["ds-submission-section-license"]],viewQuery:function(s,t){if(1&s&&e.\u0275\u0275viewQuery(Lt,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:5,vars:4,consts:[[1,"mb-5",3,"innerHTML"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange",4,"ngIf"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange"],["formRef","formComponent"]],template:function(s,t){1&s&&(e.\u0275\u0275element(0,"span",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"br")(3,"br"),e.\u0275\u0275template(4,Rt,2,5,"ds-form",1)),2&s&&(e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind1(1,2,t.licenseText$),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.formModel))},directives:[V.O5,L.U],pipes:[V.Ov],styles:[""]}),Ie=(0,v.gn)([(0,O.E)(I.i.License),(0,v.w6)("design:paramtypes",[e.ChangeDetectorRef,je.W,_.c,m.m,R.o,be.w,d.J,j.b,M.sK,String,Object,String])],Ie);i(95195);var q=(i(63600),i(8108));const Kt={id:"metadata",group:[]},Wt={element:{container:"form-group",label:"col-form-label"},grid:{label:"col-sm-3"}},wt={id:"accessConditionGroup",group:[]},Vt={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},$t={id:"accessConditions",groupFactory:null},Nt={grid:{group:"form-row pt-4"}},Gt={id:"name",label:"submission.sections.upload.form.access-condition-label",hint:"submission.sections.upload.form.access-condition-hint",options:[]},zt={element:{host:"col-12",label:"col-form-label name-label"}},Qt={id:"startDate",label:"submission.sections.upload.form.from-label",hint:"submission.sections.upload.form.from-hint",placeholder:"submission.sections.upload.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:q.O6Y,operator:q.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-from"}},Xt={element:{label:"col-form-label"},grid:{host:"col-6"}},Yt={id:"endDate",label:"submission.sections.upload.form.until-label",hint:"submission.sections.upload.form.until-hint",placeholder:"submission.sections.upload.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:q.O6Y,operator:q.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-until"}},Ht={element:{label:"col-form-label"},grid:{host:"col-6"}};var We=i(38723),Ce=i(17656);const Jt=["formRef"];function Zt(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",6,7),e.\u0275\u0275listener("submitForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onSubmit()})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onModalClose()})("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("displaySubmit",!t.isSaving)("displayCancel",!t.isSaving)}}let Xe=(()=>{class o{constructor(t,r,c,u,y,F,k,ee){this.activeModal=t,this.cdr=r,this.formBuilderService=c,this.formService=u,this.submissionService=y,this.operationsBuilder=F,this.operationsService=k,this.uploadService=ee,this.formMetadata=[],this.isSaving=!1,this.subscriptions=[]}initModelData(t){this.fileData.accessConditions.forEach((r,c)=>{Array.of("name","startDate","endDate").filter(u=>r.hasOwnProperty(u)&&(0,f.UE)(r[u])).forEach(u=>{const y=this.formBuilderService.findById(u,t,c);if(y)if(y.type===q.VId){const F=new Date(r[u]);y.value={year:F.getUTCFullYear(),month:F.getUTCMonth()+1,day:F.getUTCDate()}}else y.value=r[u]})})}onChange(t){"name"===t.model.id&&this.setOptions(t.model,t.control)}onModalClose(){this.activeModal.dismiss()}onSubmit(){this.isSaving=!0,this.saveBitstreamData()}setOptions(t,r){let c=null;if(this.availableAccessConditionOptions.filter(u=>u.name===r.value).forEach(u=>c=u),(0,f.UE)(c)){const u=r.parent.get("startDate"),y=r.parent.get("endDate");null==u||u.markAsUntouched(),null==y||y.markAsUntouched(),null==u||u.setValue(null),r.parent.markAsDirty(),null==y||y.setValue(null)}}ngOnInit(){this.fileData&&this.formId&&(this.formModel=this.buildFileEditForm(),this.cdr.detectChanges())}ngOnDestroy(){this.unsubscribeAll()}retrieveValueFromField(t){const r=Array.isArray(t)?t[0]:t;return r?r.value:void 0}buildFileEditForm(){const t=Object.assign({},this.configMetadataForm.rows[0].fields[0]);t.repeatable=!1;const r=Object.assign({},this.configMetadataForm,{fields:Object.assign([],this.configMetadataForm.rows[0].fields[0],[this.configMetadataForm.rows[0].fields[0],t])}),c=[],u=Object.assign({},Kt);u.group=this.formBuilderService.modelFromConfiguration(this.submissionId,r,this.collectionId,this.fileData.metadata,this.submissionService.getSubmissionScope()),c.push(new q.S_O(u,Wt));const y=Object.assign({},Gt),F=Object.assign({},$t),k=[];if(2===this.collectionPolicyType){for(const de of this.availableAccessConditionOptions)k.push({label:de.name,value:de.name});y.options=k;const ee=[],S=[];let z,re;this.availableAccessConditionOptions.forEach(de=>{if(de.hasStartDate&&(ee.push({id:"name",value:de.name}),de.maxStartDate)){const ce=new Date(de.maxStartDate);z={year:ce.getUTCFullYear(),month:ce.getUTCMonth()+1,day:ce.getUTCDate()}}if(de.hasEndDate&&(S.push({id:"name",value:de.name}),de.maxEndDate)){const ce=new Date(de.maxEndDate);re={year:ce.getUTCFullYear(),month:ce.getUTCMonth()+1,day:ce.getUTCDate()}}});const Q={relations:[{match:q.O6Y,operator:q.F8e,when:ee}]},ie={relations:[{match:q.O6Y,operator:q.F8e,when:S}]},pe=ee.length>0,me=S.length>0;F.groupFactory=()=>{const de=new q.nMt(y,zt),ce=Object.assign({},Qt,Q);z&&(ce.max=z);const Me=Object.assign({},Yt,ie);re&&(Me.max=re);const Ze=new q.oqv(ce,Xt),mo=new q.oqv(Me,Ht),we=Object.assign({},wt);return we.group=[de],pe&&we.group.push(Ze),me&&we.group.push(mo),[new q.S_O(we,Vt)]},F.initialCount=(0,f.UE)(this.fileData.accessConditions)?this.fileData.accessConditions.length:1,c.push(new q.RRz(F,Nt))}return this.initModelData(c),c}saveBitstreamData(){this.formService.validateAllFormFields(this.formRef.formGroup);const t=this.formService.isValid(this.formId).pipe((0,P.q)(1),(0,C.h)(r=>r),(0,U.z)(()=>this.formService.getFormData(this.formId)),(0,P.q)(1),(0,U.z)(r=>{Object.keys(r.metadata).filter(u=>(0,f.UE)(r.metadata[u])).forEach(u=>{const F=`metadata/${u.replace(/_/g,".")}`;this.operationsBuilder.add(this.pathCombiner.getPath(F),r.metadata[u],!0)}),Object.keys(this.fileData.metadata).filter(u=>(0,f.UE)(this.fileData.metadata[u])).filter(u=>(0,f.xI)(r.metadata[u])).filter(u=>this.formMetadata.includes(u)).forEach(u=>{const F=`metadata/${u.replace(/_/g,".")}`;this.operationsBuilder.remove(this.pathCombiner.getPath(F))});const c=[];return r.accessConditions.map(u=>u.accessConditionGroup).filter(u=>(0,f.UE)(u)).forEach(u=>{let y;if(this.availableAccessConditionOptions.filter(F=>(0,f.K0)(u.name)&&F.name===u.name[0].value).forEach(F=>y=F),y){const F=Object.assign({},u);if(F.name=this.retrieveValueFromField(u.name),y.hasStartDate){if(u.startDate){const k=this.retrieveValueFromField(u.startDate);F.startDate=(0,We.iV)(k)}}else delete F.startDate;if(y.hasEndDate){if(u.endDate){const k=this.retrieveValueFromField(u.endDate);F.endDate=(0,We.iV)(k)}}else delete F.endDate;c.push(F)}}),(0,f.UE)(c)&&this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),c,!0),this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement)})).subscribe(r=>{if(r[0].sections[this.sectionId]){const c=r[0].sections[this.sectionId];Object.keys(c.files).filter(u=>c.files[u].uuid===this.fileId).forEach(u=>this.uploadService.updateFileData(this.submissionId,this.sectionId,this.fileId,c.files[u]))}this.isSaving=!1,this.activeModal.close()});this.subscriptions.push(t)}unsubscribeAll(){this.subscriptions.filter(t=>(0,f.Uh)(t)).forEach(t=>t.unsubscribe())}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(Ce.Kz),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(Ue.E),e.\u0275\u0275directiveInject(Fe))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-submission-section-upload-file-edit"]],viewQuery:function(t,r){if(1&t&&e.\u0275\u0275viewQuery(Jt,5),2&t){let c;e.\u0275\u0275queryRefresh(c=e.\u0275\u0275loadQuery())&&(r.formRef=c.first)}},decls:10,vars:5,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"disabled","click"],["aria-hidden","true"],[1,"modal-body"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange"],["formRef","formComponent"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div")(1,"div",0)(2,"h4",1),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",2),e.\u0275\u0275listener("click",function(){return r.onModalClose()}),e.\u0275\u0275elementStart(6,"span",3),e.\u0275\u0275text(7,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(8,"div",4),e.\u0275\u0275template(9,Zt,2,4,"ds-form",5),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.upload.edit.title")),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",r.isSaving),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",r.formModel))},directives:[V.O5,L.U],pipes:[M.X$],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),o})();var kt=i(59161),qt=i(4775),en=i(13582),Ye=i(94569);function tn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span",3),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate3(" ",t.name," ",t.startDate," ",t.endDate," ")}}function nn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span",3),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.name," from ",t.endDate,"")}}function on(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.name," until ",t.startDate,"")}}function sn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,tn,2,3,"span",1),e.\u0275\u0275template(2,nn,2,2,"span",1),e.\u0275\u0275template(3,on,2,2,"span",2),e.\u0275\u0275element(4,"br"),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","DEFAULT_BITSTREAM_READ"==t.action),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","lease"==t.name),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","embargo"==t.name)}}let He=(()=>{class o{constructor(t){this.groupService=t,this.accessConditionsList=[]}ngOnInit(){this.accessConditions.forEach(t=>{(0,f.xb)(t.name)?this.groupService.findByHref(t._links.group.href).pipe((0,G.s)(r=>!r.isResponsePending&&r.hasSucceeded)).subscribe(r=>{const c=r.payload,u=Object.assign({},t);u.name=c.name,this.accessConditionsList.push(u)}):this.accessConditionsList.push(t)})}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(ze.O))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-submission-section-upload-access-conditions"]],inputs:{accessConditions:"accessConditions"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["class","badge badge-primary mt-3 mr-2",4,"ngIf"],["class","badge badge-dark mt-3 mr-2",4,"ngIf"],[1,"badge","badge-primary","mt-3","mr-2"],[1,"badge","badge-dark","mt-3","mr-2"]],template:function(t,r){1&t&&e.\u0275\u0275template(0,sn,5,3,"ng-container",0),2&t&&e.\u0275\u0275property("ngForOf",r.accessConditionsList)},directives:[V.sg,V.O5],encapsulation:2}),o})();var an=i(58714);function rn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.value," ")}}function cn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"h5")(1,"span",4),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2("",e.\u0275\u0275pipeBind1(3,2,"submission.sections.upload.no-entry")," ",t.fileTitleKey,"")}}function ln(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,cn,4,4,"h5",0),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===r.metadata[r.fileTitleKey].indexOf(t))}}function dn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,rn,3,1,"ng-container",0),e.\u0275\u0275template(2,ln,2,1,"ng-container",0),e.\u0275\u0275element(3,"span",1),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""!==t.value),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""===t.value)}}const pn=function(){return["150"]};function mn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"dsTruncate"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,t.value,e.\u0275\u0275pureFunction0(4,pn))," ")}}function un(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span",4),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",e.\u0275\u0275pipeBind1(2,2,"submission.sections.upload.no-entry")," ",t.fileDescrKey,"")}}function _n(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,un,3,4,"span",5),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===r.metadata[r.fileDescrKey].indexOf(t))}}function fn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,mn,3,5,"ng-container",0),e.\u0275\u0275template(2,_n,2,1,"ng-container",0),e.\u0275\u0275element(3,"span",1),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""!==t.value),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""===t.value)}}function hn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,dn,4,2,"ng-container",3),e.\u0275\u0275template(2,fn,4,2,"ng-container",3),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getAllMetadataValue(t.fileTitleKey)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getAllMetadataValue(t.fileDescrKey))}}let ot=(()=>{class o{constructor(){this.metadata=Object.create({}),this.fileTitleKey="Title",this.fileDescrKey="Description"}ngOnInit(){(0,f.UE)(this.fileData.metadata)&&(this.metadata[this.fileTitleKey]=Ye.S.all(this.fileData.metadata,"dc.title"),this.metadata[this.fileDescrKey]=Ye.S.all(this.fileData.metadata,"dc.description"))}getAllMetadataValue(t){return Ye.S.all(this.metadata,t)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-submission-section-upload-file-view"]],inputs:{fileData:"fileData"},decls:4,vars:2,consts:[[4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[4,"ngFor","ngForOf"],[1,"text-muted"],["class","text-muted",4,"ngIf"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,hn,3,2,"ng-container",0),e.\u0275\u0275element(2,"span",1)(3,"ds-submission-section-upload-access-conditions",2),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.metadata),e.\u0275\u0275advance(2),e.\u0275\u0275property("accessConditions",r.fileData.accessConditions))},directives:[V.O5,V.sg,He],pipes:[M.X$,an.W],encapsulation:2}),o})();var vn=i(54202);function gn(o,s){1&o&&e.\u0275\u0275element(0,"i",18)}function bn(o,s){1&o&&e.\u0275\u0275element(0,"i",19)}function Sn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",2)(2,"div",3),e.\u0275\u0275element(3,"ds-thumbnail",4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",5)(5,"div",6)(6,"h3"),e.\u0275\u0275text(7),e.\u0275\u0275elementStart(8,"span",7),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"dsFileSize"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(11,"div",8),e.\u0275\u0275elementContainerStart(12),e.\u0275\u0275elementStart(13,"ds-file-download-link",9),e.\u0275\u0275element(14,"i",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"button",11),e.\u0275\u0275listener("click",function(c){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext();return c.preventDefault(),u.editBitstreamData()}),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275element(18,"i",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"button",13),e.\u0275\u0275listener("click",function(c){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext(),y=e.\u0275\u0275reference(2);return c.preventDefault(),u.confirmDelete(y)}),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275template(23,gn,1,0,"i",14),e.\u0275\u0275pipe(24,"async"),e.\u0275\u0275template(25,bn,1,0,"i",15),e.\u0275\u0275pipe(26,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(27,"div",16)(28,"ds-submission-section-upload-file-view",17),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("thumbnail",null==t.fileData?null:t.fileData.thumbnail),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",t.fileName," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("(",e.\u0275\u0275pipeBind1(10,15,null==t.fileData?null:t.fileData.sizeBytes),")"),e.\u0275\u0275advance(4),e.\u0275\u0275property("cssClasses","btn btn-link-focus")("isBlank",!0)("bitstream",t.getBitstream())("enableRequestACopy",!1),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(17,19,"submission.sections.upload.edit.title")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(16,17,"submission.sections.upload.edit.title")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(21,23,"submission.sections.upload.delete.confirm.title")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,25,t.processingDelete$)),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(20,21,"submission.sections.upload.delete.confirm.title")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(24,27,t.processingDelete$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(26,29,t.processingDelete$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("fileData",t.fileData)}}function Cn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",20)(1,"h4",21),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",22),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t).dismiss("cancel")}),e.\u0275\u0275elementStart(5,"span",23),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",24)(8,"p"),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(11,"div",25)(12,"button",26),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t).close("cancel")}),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"button",27),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t).close("ok")}),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()()}2&o&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,4,"submission.sections.upload.delete.confirm.title")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(10,6,"submission.sections.upload.delete.confirm.info")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,8,"submission.sections.upload.delete.confirm.cancel")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,10,"submission.sections.upload.delete.confirm.submit")))}let st=(()=>{class o{constructor(t,r,c,u,y,F,k,ee){this.cdr=t,this.formService=r,this.halService=c,this.modalService=u,this.operationsBuilder=y,this.operationsService=F,this.submissionService=k,this.uploadService=ee,this.processingDelete$=new Ge.X(!1),this.subscriptions=[],this.formMetadata=[],this.readMode=!0}ngOnChanges(){this.availableAccessConditionOptions&&this.subscriptions.push(this.uploadService.getFileData(this.submissionId,this.sectionId,this.fileId).pipe((0,C.h)(t=>(0,f.pT)(t))).subscribe(t=>{this.fileData=t}))}ngOnInit(){this.formId=this.formService.getUniqueId(this.fileId),this.pathCombiner=new T.K("sections",this.sectionId,"files",this.fileIndex),this.loadFormMetadata()}confirmDelete(t){this.modalService.open(t).result.then(r=>{"ok"===r&&(this.processingDelete$.next(!0),this.deleteFile())})}getBitstream(){return Object.assign(new kt.Z,{uuid:this.fileData.uuid})}editBitstreamData(){const r=this.modalService.open(Xe,{size:"xl",backdrop:"static"});r.componentInstance.availableAccessConditionOptions=this.availableAccessConditionOptions,r.componentInstance.collectionId=this.collectionId,r.componentInstance.collectionPolicyType=this.collectionPolicyType,r.componentInstance.configMetadataForm=this.configMetadataForm,r.componentInstance.fileData=this.fileData,r.componentInstance.fileId=this.fileId,r.componentInstance.fileIndex=this.fileIndex,r.componentInstance.formId=this.formId,r.componentInstance.sectionId=this.sectionId,r.componentInstance.formMetadata=this.formMetadata,r.componentInstance.pathCombiner=this.pathCombiner,r.componentInstance.submissionId=this.submissionId}ngOnDestroy(){this.unsubscribeAll()}unsubscribeAll(){this.subscriptions.filter(t=>(0,f.Uh)(t)).forEach(t=>t.unsubscribe())}loadFormMetadata(){this.configMetadataForm.rows.forEach(t=>{t.fields.forEach(r=>{r.selectableMetadata.forEach(c=>{this.formMetadata.push(c.metadata)})})})}deleteFile(){this.operationsBuilder.remove(this.pathCombiner.getPath()),this.subscriptions.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement).subscribe(()=>{this.uploadService.removeUploadedFile(this.submissionId,this.sectionId,this.fileId),this.processingDelete$.next(!1)}))}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(Be.q),e.\u0275\u0275directiveInject(Ce.FF),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(Ue.E),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(Fe))},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-submission-upload-section-file"]],viewQuery:function(t,r){if(1&t&&e.\u0275\u0275viewQuery(Xe,5),2&t){let c;e.\u0275\u0275queryRefresh(c=e.\u0275\u0275loadQuery())&&(r.fileEditComp=c.first)}},inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},features:[e.\u0275\u0275NgOnChangesFeature],decls:3,vars:1,consts:[[4,"ngIf"],["content",""],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"float-left","w-75"],[1,"text-muted"],[1,"float-right","w-15"],[3,"cssClasses","isBlank","bitstream","enableRequestACopy"],["aria-hidden","true",1,"fa","fa-download","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","click"],[1,"fa","fa-edit","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","disabled","click"],["class","fas fa-circle-notch fa-spin fa-2x text-danger",4,"ngIf"],["class","fa fa-trash fa-2x text-danger",4,"ngIf"],[1,"clearfix"],[3,"fileData"],[1,"fas","fa-circle-notch","fa-spin","fa-2x","text-danger"],[1,"fa","fa-trash","fa-2x","text-danger"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(t,r){1&t&&(e.\u0275\u0275template(0,Sn,29,31,"ng-container",0),e.\u0275\u0275template(1,Cn,18,12,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)),2&t&&e.\u0275\u0275property("ngIf",r.fileData)},directives:[V.O5,qt.Z,en.q,ot],pipes:[vn.p,M.X$,V.Ov],styles:[""]}),o})();i(38300);var In=i(93785),at=(i(73391),i(60906),i(124),i(91320),i(44479)),rt=i(60941),Tn=i(40354),ct=i(98605);function Mn(o,s){1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"ds-themed-loading"),e.\u0275\u0275elementEnd())}function Pn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.getSelectedCcLicense().name," ")}}function Un(o,s){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.change")," "))}function Fn(o,s){1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.select")," "))}function Bn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275template(1,Un,3,3,"ng-container",3),e.\u0275\u0275template(2,Fn,3,3,"ng-container",3),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.storedCcLicenseLink),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.storedCcLicenseLink)}}function An(o,s){1&o&&(e.\u0275\u0275elementStart(0,"button",7),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.none")," "))}function Ln(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){const u=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext().selectCcLicense(u)}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Rn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",10)(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"div",20),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.label," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("innerHTML",t.description,e.\u0275\u0275sanitizeHtml)}}function jn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"div",15)(2,"div")(3,"h4"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"div",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).closeInfoModal()}),e.\u0275\u0275elementStart(7,"span",18),e.\u0275\u0275text(8,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div",19),e.\u0275\u0275template(10,Rn,4,2,"div",9),e.\u0275\u0275elementEnd()()}if(2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.label," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("innerHTML",t.description,e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t.enums)}}function Kn(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.label," ")}}function Wn(o,s){1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.option.select")," "))}function wn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0,2),e.\u0275\u0275template(1,Kn,2,1,"span",3),e.\u0275\u0275template(2,Wn,3,3,"span",3),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t)}}function Vn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){const u=e.\u0275\u0275restoreView(t).$implicit,y=e.\u0275\u0275nextContext(2).$implicit,F=e.\u0275\u0275nextContext(2);return F.selectOption(F.getSelectedCcLicense(),y,u)}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.label," ")}}function $n(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"ds-select"),e.\u0275\u0275template(1,wn,3,2,"ng-container",21),e.\u0275\u0275elementContainerStart(2,4),e.\u0275\u0275elementStart(3,"div",22),e.\u0275\u0275template(4,Vn,2,1,"button",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",r.getSelectedOption(r.getSelectedCcLicense(),t)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.enums)}}function Nn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",24)(1,"div",25),e.\u0275\u0275listener("click",function(){const u=e.\u0275\u0275restoreView(t).$implicit,y=e.\u0275\u0275nextContext(2).$implicit,F=e.\u0275\u0275nextContext(2);return F.selectOption(F.getSelectedCcLicense(),y,u)}),e.\u0275\u0275element(2,"input",26),e.\u0275\u0275elementStart(3,"span"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()()}if(2&o){const t=s.$implicit,r=e.\u0275\u0275nextContext(2).$implicit,c=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",t.label),e.\u0275\u0275property("checked",c.isSelectedOption(c.getSelectedCcLicense(),r,t)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.label)}}function Gn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Nn,5,3,"div",23),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.enums)}}function zn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"div",11)(2,"div"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const c=e.\u0275\u0275reference(7);return e.\u0275\u0275nextContext(2).openInfoModal(c)}),e.\u0275\u0275element(5,"i",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,jn,11,3,"ng-template",null,14,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(8,$n,5,2,"ds-select",3),e.\u0275\u0275template(9,Gn,2,1,"ng-container",3),e.\u0275\u0275elementEnd()}if(2&o){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("font-weight-bold ",t.id,""),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.label," "),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",(null==t.enums?null:t.enums.length)>5),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==t.enums?null:t.enums.length)<=5)}}function Qn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,zn,10,6,"div",9),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getSelectedCcLicense().fields)}}function Xn(o,s){1&o&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275element(1,"ds-themed-loading"),e.\u0275\u0275elementEnd())}function Yn(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",29)(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"a",30),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",31)(7,"div",25),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const c=e.\u0275\u0275nextContext(3);return c.setAccepted(!c.accepted)}),e.\u0275\u0275element(8,"input",32),e.\u0275\u0275elementStart(9,"span"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()()()}if(2&o){const t=e.\u0275\u0275nextContext().ngVar,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,5,"submission.sections.ccLicense.link")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("href",t,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",r.accepted),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,7,"submission.sections.ccLicense.confirmation"))}}function Hn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Xn,2,0,"div",3),e.\u0275\u0275template(2,Yn,12,9,"div",28),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}function Jn(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Hn,3,2,"ng-container",27),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t.getCcLicenseLink$()))}}let xe=class extends A{constructor(s,t,r,c,u,y,F,k){super(y,F,k),this.modalService=s,this.sectionService=t,this.submissionCcLicensesDataService=r,this.submissionCcLicenseUrlDataService=c,this.operationsBuilder=u,this.injectedCollectionId=y,this.injectedSectionData=F,this.injectedSubmissionId=k,this.isLoading=!0,this.subscriptions=[]}get storedCcLicenseLink(){return this.data.uri}get accepted(){return void 0===this.data.accepted?!!this.data.uri:this.data.accepted}get data(){return this.sectionData.data}selectCcLicense(s){this.getSelectedCcLicense()&&this.getSelectedCcLicense().id===s.id||(this.setAccepted(!1),this.updateSectionData({ccLicense:{id:s.id,fields:{}},uri:void 0}))}getSelectedCcLicense(){return this.submissionCcLicenses&&this.data.ccLicense?this.submissionCcLicenses.filter(s=>s.id===this.data.ccLicense.id)[0]:null}selectOption(s,t,r){this.isSelectedOption(s,t,r)||this.updateSectionData({ccLicense:{id:s.id,fields:Object.assign({},this.data.ccLicense.fields,{[t.id]:r})},accepted:!1})}getSelectedOption(s,t){return this.data.ccLicense.fields[t.id]}isSelectedOption(s,t,r){return this.getSelectedOption(s,t)&&this.getSelectedOption(s,t).id===r.id}getCcLicenseLink$(){if(this.storedCcLicenseLink)return(0,he.of)(this.storedCcLicenseLink);if(!this.getSelectedCcLicense()||this.getSelectedCcLicense().fields.some(t=>!this.getSelectedOption(this.getSelectedCcLicense(),t)))return;const s=this.getSelectedCcLicense();return this.submissionCcLicenseUrlDataService.getCcLicenseLink(s,new Map(s.fields.map(t=>[t,this.getSelectedOption(s,t)])))}openInfoModal(s){this.modalRef=this.modalService.open(s)}closeInfoModal(){this.modalRef.close()}getSectionStatus(){return(0,he.of)(this.accepted)}onSectionDestroy(){this.subscriptions.forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.subscriptions.push(this.sectionService.getSectionState(this.submissionId,this.sectionData.id,I.i.CcLicense).pipe((0,C.h)(s=>(0,f.UE)(s)&&((0,f.UE)(s.data)||(0,f.UE)(s.errorsToShow))),(0,w.x)(),(0,b.U)(s=>s.data)).subscribe(s=>{if(this.data.accepted!==s.accepted){const t=this.pathCombiner.getPath("uri");s.accepted?this.getCcLicenseLink$().pipe((0,P.q)(1)).subscribe(r=>{this.operationsBuilder.add(t,r.toString(),!1,!0)}):this.data.uri&&this.operationsBuilder.remove(t)}this.sectionData.data=s}),this.submissionCcLicensesDataService.findAll({elementsPerPage:9999}).pipe((0,x.xw)(),(0,x.xe)(),(0,b.U)(s=>s.page)).subscribe(s=>this.submissionCcLicenses=s))}setAccepted(s){this.updateSectionData({accepted:s}),this.updateSectionStatus()}updateSectionData(s){this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,Object.assign({},this.data,s))}};xe.\u0275fac=function(s){return new(s||xe)(e.\u0275\u0275directiveInject(Ce.FF),e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(at.I),e.\u0275\u0275directiveInject(rt.K),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},xe.\u0275cmp=e.\u0275\u0275defineComponent({type:xe,selectors:[["ds-submission-section-cc-licenses"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:11,vars:8,consts:[[1,"mb-4","ccLicense-select"],[3,"disabled"],[1,"selection"],[4,"ngIf"],[1,"menu"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"d-flex","flex-row"],[1,"btn","btn-outline-info","btn-sm","ml-2",3,"click"],[1,"fas","fa-question"],["infoModal",""],[1,"modal-header","mb-4"],[3,"innerHTML"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"font-weight-light",3,"innerHTML"],["class","selection",4,"ngVar"],[1,"options-select-menu","overflow-auto"],["class","d-flex flex-row m-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","m-1"],[3,"click"],["type","radio",1,"mr-1",3,"title","checked"],[4,"ngVar"],["class","mt-2 p-4 bg-light text-dark",4,"ngIf"],[1,"mt-2","p-4","bg-light","text-dark"],["target","_blank","rel","noopener noreferrer",1,"license-link",3,"href"],[1,"m-2"],["type","checkbox","title","accepted",3,"checked"]],template:function(s,t){1&s&&(e.\u0275\u0275elementStart(0,"div",0)(1,"ds-select",1),e.\u0275\u0275elementContainerStart(2,2),e.\u0275\u0275template(3,Mn,2,0,"span",3),e.\u0275\u0275template(4,Pn,2,1,"span",3),e.\u0275\u0275template(5,Bn,3,2,"span",3),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(6,4),e.\u0275\u0275template(7,An,3,3,"button",5),e.\u0275\u0275template(8,Ln,2,1,"button",6),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(9,Qn,2,1,"ng-container",3),e.\u0275\u0275template(10,Jn,3,3,"ng-container",3)),2&s&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!t.submissionCcLicenses),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!t.submissionCcLicenses),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.getSelectedCcLicense()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.submissionCcLicenses&&!t.getSelectedCcLicense()),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==t.submissionCcLicenses?null:t.submissionCcLicenses.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.submissionCcLicenses),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.getSelectedCcLicense()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.getCcLicenseLink$()))},directives:[Tn.N,V.O5,Ae.Z,V.sg,ct.g],pipes:[M.X$,V.Ov],styles:[".options-select-menu[_ngcontent-%COMP%]{max-height:25vh}"]}),xe=(0,v.gn)([(0,O.E)(I.i.CcLicense),(0,v.w6)("design:paramtypes",[Ce.FF,d.J,at.I,rt.K,be.w,String,Object,String])],xe);var Zn=i(74227),kn=i(84376),ni=(i(39886),i(12969),i(17050),i(10194));let Je=(()=>{class o{constructor(t){this.store=t}getAccessesData(t,r){return this.store.select((0,Re.y5)(t,r)).pipe((0,C.h)(c=>(0,f.pT)(c)),(0,w.x)())}}return o.\u0275fac=function(t){return new(t||o)(e.\u0275\u0275inject(Le.yh))},o.\u0275prov=e.\u0275\u0275defineInjectable({token:o,factory:o.\u0275fac}),o})();const ii={id:"discoverable",name:"discoverable"},oi={element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}},si={id:"accessConditionGroup",group:[]},ai={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},ri={id:"accessCondition",groupFactory:null},ci={grid:{group:"form-row pt-4"}},lt={id:"name",label:"submission.sections.accesses.form.access-condition-label",hint:"submission.sections.accesses.form.access-condition-hint",options:[]},li={element:{host:"col-12",label:"col-form-label name-label"}},di={id:"startDate",label:"submission.sections.accesses.form.from-label",hint:"submission.sections.accesses.form.from-hint",placeholder:"submission.sections.accesses.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:q.O6Y,operator:q.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-from"}},pi={element:{label:"col-form-label"},grid:{host:"col-6"}},mi={id:"endDate",label:"submission.sections.accesses.form.until-label",hint:"submission.sections.accesses.form.until-hint",placeholder:"submission.sections.accesses.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:q.O6Y,operator:q.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-until"}},ui={element:{label:"col-form-label"},grid:{host:"col-6"}};let Se=class extends qe.o{constructor(s,t,r,c){super("submissionaccessoptions",s,t,r,c),this.requestService=s,this.rdbService=t,this.objectCache=r,this.halService=c}findByHref(s,t=!0,r=!0,...c){return super.findByHref(s,t,r,...c)}};Se.\u0275fac=function(s){return new(s||Se)(e.\u0275\u0275inject(Z.s),e.\u0275\u0275inject(Ke.Q),e.\u0275\u0275inject(se.a),e.\u0275\u0275inject(Be.q))},Se.\u0275prov=e.\u0275\u0275defineInjectable({token:Se,factory:Se.\u0275fac}),Se=(0,v.gn)([(0,tt.cQ)(et.MX),(0,v.w6)("design:paramtypes",[Z.s,Ke.Q,se.a,Be.q])],Se);const _i=["formRef"];function fi(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",1,2),e.\u0275\u0275listener("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)})("removeArrayItem",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onRemove(c)}),e.\u0275\u0275elementEnd()}if(2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("displaySubmit",!1)("displayCancel",!1)}}let ye=class extends A{constructor(s,t,r,c,u,y,F,k,ee,S,z){super(void 0,S,z),this.sectionService=s,this.formBuilderService=t,this.accessesConfigService=r,this.accessesService=c,this.formOperationsService=u,this.operationsBuilder=y,this.formService=F,this.translate=k,this.operationsService=ee,this.injectedSectionData=S,this.injectedSubmissionId=z,this.subs=[]}initModelData(s){this.accessesData.accessConditions.forEach((t,r)=>{Array.of("name","startDate","endDate").filter(c=>t.hasOwnProperty(c)&&(0,f.UE)(t[c])).forEach(c=>{const u=this.formBuilderService.findById(c,s,r);if(u)if(u.type===q.VId){const y=new Date(t[c]);u.value={year:y.getUTCFullYear(),month:y.getUTCMonth()+1,day:y.getUTCDate()}}else u.value=t[c]})})}onChange(s){if(s.model.type===q.fSU){const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);this.operationsBuilder.replace(this.pathCombiner.getPath(t),r.value,!0)}else{if(s.model.id===lt.id){const t=s.control.parent.get("startDate"),r=s.control.parent.get("endDate");null==t||t.markAsUntouched(),null==r||r.markAsUntouched(),null==t||t.setValue(null),null==r||r.setValue(null),s.control.parent.markAsDirty()}this.formService.validateAllFormFields(this.formRef.formGroup),this.formService.isValid(this.formId).pipe((0,P.q)(1),(0,C.h)(t=>t),(0,U.z)(()=>this.formService.getFormData(this.formId)),(0,P.q)(1)).subscribe(t=>{const r=[];t.accessCondition.map(c=>c.accessConditionGroup).filter(c=>(0,f.UE)(c)).forEach(c=>{let u;if(this.availableAccessConditionOptions.filter(y=>(0,f.K0)(c.name)&&y.name===c.name[0].value).forEach(y=>u=y),u){const y=Object.assign({},c);if(y.name=this.retrieveValueFromField(c.name),u.hasStartDate){if(c.startDate){const F=this.retrieveValueFromField(c.startDate);y.startDate=(0,We.iV)(F)}}else delete y.startDate;if(u.hasEndDate){if(c.endDate){const F=this.retrieveValueFromField(c.endDate);y.endDate=(0,We.iV)(F)}}else delete y.endDate;r.push(y)}}),this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),r,!0)})}}onRemove(s){const t=this.formOperationsService.getArrayIndexFromEvent(s);this.operationsBuilder.remove(this.pathCombiner.getPath("accessConditions/"+t))}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id);const s=this.accessesConfigService.findByHref(this.sectionData.config,!0,!1).pipe((0,x.xw)(),(0,b.U)(r=>r.payload)),t=this.accessesService.getAccessesData(this.submissionId,this.sectionData.id);(0,l.a)([s,t]).subscribe(([r,c])=>{this.availableAccessConditionOptions=(0,f.UE)(r.accessConditionOptions)?r.accessConditionOptions:[],this.canChangeDiscoverable=!!r.canChangeDiscoverable,this.accessesData=c,this.formModel=this.buildFileEditForm()})}getSectionStatus(){return(0,he.of)(!0)}buildFileEditForm(){const s=[];if(this.canChangeDiscoverable){const Q=Object.assign({},ii,{label:this.translate.instant("submission.sections.accesses.form.discoverable-label"),hint:this.translate.instant("submission.sections.accesses.form.discoverable-description"),value:this.accessesData.discoverable});s.push(new q.dwp(Q,oi))}const t=Object.assign({},lt),r=Object.assign({},ri),c=[];for(const Q of this.availableAccessConditionOptions)c.push({label:Q.name,value:Q.name});t.options=c;const u=[],y=[];let F,k;this.availableAccessConditionOptions.forEach(Q=>{if(Q.hasStartDate&&(u.push({id:"name",value:Q.name}),Q.maxStartDate)){const ie=new Date(Q.maxStartDate);F={year:ie.getUTCFullYear(),month:ie.getUTCMonth()+1,day:ie.getUTCDate()}}if(Q.hasEndDate&&(y.push({id:"name",value:Q.name}),Q.maxEndDate)){const ie=new Date(Q.maxEndDate);k={year:ie.getUTCFullYear(),month:ie.getUTCMonth()+1,day:ie.getUTCDate()}}});const ee={relations:[{match:q.O6Y,operator:q.F8e,when:u}]},S={relations:[{match:q.O6Y,operator:q.F8e,when:y}]},z=u.length>0,re=y.length>0;return r.groupFactory=()=>{const Q=new q.nMt(t,li),ie=Object.assign({},di,ee);F&&(ie.max=F);const pe=Object.assign({},mi,S);k&&(pe.max=k);const me=new q.oqv(ie,pi),de=new q.oqv(pe,ui),ce=Object.assign({},si);return ce.group=[Q],z&&ce.group.push(me),re&&ce.group.push(de),[new q.S_O(ce,ai)]},r.initialCount=(0,f.UE)(this.accessesData.accessConditions)?this.accessesData.accessConditions.length:1,s.push(new q.RRz(r,ci)),this.initModelData(s),s}retrieveValueFromField(s){const t=Array.isArray(s)?s[0]:s;return t?t.value:void 0}};ye.\u0275fac=function(s){return new(s||ye)(e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(Se),e.\u0275\u0275directiveInject(Je),e.\u0275\u0275directiveInject(m.m),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(M.sK),e.\u0275\u0275directiveInject(Ue.E),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},ye.\u0275cmp=e.\u0275\u0275defineComponent({type:ye,selectors:[["ds-section-accesses"]],viewQuery:function(s,t){if(1&s&&e.\u0275\u0275viewQuery(_i,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem"],["formRef","formComponent"]],template:function(s,t){1&s&&e.\u0275\u0275template(0,fi,2,4,"ds-form",0),2&s&&e.\u0275\u0275property("ngIf",!!t.formModel)},directives:[V.O5,L.U],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),ye=(0,v.gn)([(0,O.E)(I.i.AccessesCondition),(0,v.w6)("design:paramtypes",[d.J,_.c,Se,Je,m.m,be.w,R.o,M.sK,Ue.E,Object,String])],ye);var dt=i(38605);function hi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",t," ")}}function vi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275template(6,hi,2,1,"p",5),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.title")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.journal.titles)}}function gi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",t," ")}}function bi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275template(6,gi,2,1,"p",5),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.issns")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.journal.issns)}}function Si(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4)(7,"a",6),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.sherpa.publication.information.url")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("href",t.journal.url,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.journal.url," ")}}function Ci(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",3)(1,"p",4)(2,"a",6),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()()()),2&o){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("href",t.uri,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Ei(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(5,Ci,4,2,"div",7),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.publishers")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.journal.publishers)}}function Ii(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.romeoPub")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.journal.romeoPub," ")}}function xi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.zetoPub")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.journal.zetoPub," ")}}let pt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-publication-information"]],inputs:{journal:"journal"},decls:7,vars:6,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],["class","m-1",4,"ngFor","ngForOf"],["target","_blank",3,"href"],["class","col-4",4,"ngFor","ngForOf"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,vi,7,4,"div",1),e.\u0275\u0275template(2,bi,7,4,"div",1),e.\u0275\u0275template(3,Si,9,5,"div",1),e.\u0275\u0275template(4,Ei,6,4,"div",1),e.\u0275\u0275template(5,Ii,8,4,"div",1),e.\u0275\u0275template(6,xi,8,4,"div",1),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.titles)&&r.journal.titles.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.issns)&&r.journal.issns.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.url)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.publishers)&&r.journal.publishers.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.romeoPub)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.zetoPub)))},directives:[V.O5,V.sg],pipes:[M.X$],styles:[""]}),o})();function yi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",15),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",t.version.embargo.amount," ",null==t.version.embargo?null:t.version.embargo.units[0],"")}}function Di(o,s){1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",15),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"submission.sections.sherpa.publisher.policy.noembargo"),""))}function Oi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("+",t.version.locations.length-1,"")}}function Ti(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,Oi,2,1,"span",16),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.version.locations[0]," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.version.locations.length>1)}}function Mi(o,s){1&o&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"submission.sections.sherpa.publisher.policy.nolocation")))}function Pi(o,s){1&o&&e.\u0275\u0275element(0,"span",17)}function Ui(o,s){1&o&&e.\u0275\u0275element(0,"span",18)}function Fi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.version.embargo.amount," ",t.version.embargo.units,"")}}function Bi(o,s){1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"submission.sections.sherpa.publisher.policy.noembargo")))}function Ai(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",15),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Fi,2,2,"p",25),e.\u0275\u0275template(8,Bi,3,3,"ng-template",null,26,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275reference(9),r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,3,"submission.sections.sherpa.publisher.policy.embargo"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!!r.version.embargo)("ngIfElse",t)}}function Li(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function Ri(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",27),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Li,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.license"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.licenses)}}function ji(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function Ki(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",29),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,ji,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.prerequisites"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.prerequisites)}}function Wi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function wi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",7),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Wi,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.location"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.locations)}}function Vi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function $i(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",30),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Vi,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&o){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.conditions"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.conditions)}}function Ni(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",19),e.\u0275\u0275template(1,Ai,10,5,"div",20),e.\u0275\u0275template(2,Ri,8,4,"div",20),e.\u0275\u0275template(3,Ki,8,4,"div",20),e.\u0275\u0275template(4,wi,8,4,"div",20),e.\u0275\u0275template(5,$i,8,4,"div",20),e.\u0275\u0275elementEnd()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.embargo||null==t.version||!t.version.embargo.amount)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.licenses)&&t.version.licenses.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.prerequisites)&&t.version.prerequisites.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.locations)&&t.version.locations.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.conditions)&&t.version.conditions.length>0)}}let mt=(()=>{class o{constructor(){this.isCollapsed=!0}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-content-accordion"]],inputs:{version:"version"},decls:22,vars:15,consts:[["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle",3,"click"],[1,"d-flex"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0","mr-4",3,"click"],[4,"ngIf","ngIfElse"],["noEmbargoTitle",""],[1,"m-1","ml-4"],[1,"far","fa-folder-open"],["noLocations",""],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["collapse","ngbCollapse"],["class","ml-4",4,"ngIf"],[1,"fas","fa-hourglass-half"],[4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-6"],["class","m-1",4,"ngIf","ngIfElse"],["noEmbargo",""],[1,"fas","fa-certificate"],["class","m-1",4,"ngFor","ngForOf"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-tasks"]],template:function(t,r){if(1&t){const c=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(c),e.\u0275\u0275reference(20).toggle()}),e.\u0275\u0275elementStart(2,"div",2)(3,"button",3),e.\u0275\u0275listener("click",function(y){return y.preventDefault()}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"titlecase"),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div"),e.\u0275\u0275template(8,yi,3,2,"span",4),e.\u0275\u0275template(9,Di,4,3,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(11,"span",6),e.\u0275\u0275element(12,"i",7),e.\u0275\u0275template(13,Ti,3,2,"span",4),e.\u0275\u0275template(14,Mi,3,3,"ng-template",null,8,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"div",9),e.\u0275\u0275template(17,Pi,1,0,"span",10),e.\u0275\u0275template(18,Ui,1,0,"span",11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"div",12,13),e.\u0275\u0275template(21,Ni,6,5,"div",14),e.\u0275\u0275elementEnd()()}if(2&t){const c=e.\u0275\u0275reference(10),u=e.\u0275\u0275reference(15),y=e.\u0275\u0275reference(20);e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!y.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(5,11,r.version.articleVersion)," ",e.\u0275\u0275pipeBind1(6,13,"submission.sections.sherpa.publisher.policy.version")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!(null==r.version||!r.version.embargo||null==r.version||!r.version.embargo.amount))("ngIfElse",c),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",!(null==r.version||!r.version.locations)&&r.version.locations.length>0)("ngIfElse",u),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",y.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!y.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",r.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!!r.version)}},directives:[V.O5,Ce._D,V.sg],pipes:[V.rS,M.X$],styles:[""]}),o})();function Gi(o,s){1&o&&e.\u0275\u0275element(0,"ds-content-accordion",3),2&o&&e.\u0275\u0275property("version",s.$implicit)}function zi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"li")(1,"a",8),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&o){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("href",t.key,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.value)}}function Qi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",4)(1,"div",5)(2,"p",6),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"ul"),e.\u0275\u0275template(6,zi,3,2,"li",7),e.\u0275\u0275pipe(7,"keyvalue"),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publisher.policy.more.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(7,4,t.policy.urls))}}let ut=(()=>{class o{constructor(){this.AlertTypeEnum=Qe.N}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-publisher-policy"]],inputs:{policy:"policy"},decls:3,vars:2,consts:[[1,"ml-4"],[3,"version",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[3,"version"],[1,"row"],[1,"col-12"],[1,"m-1"],[4,"ngFor","ngForOf"],["target","_blank",3,"href"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Gi,1,1,"ds-content-accordion",1),e.\u0275\u0275template(2,Qi,8,6,"div",2),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.policy.permittedVersions),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.policy||!r.policy.urls)))},directives:[V.sg,mt,V.O5],pipes:[M.X$,V.Nd],styles:[""]}),o})();function Xi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.id")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",t.metadata.id," ")}}function Yi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.date.created")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(8,4,t.metadata.dateCreated,"d MMMM Y H:mm:ss zzzz")," ")}}function Hi(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.date.modified")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(8,4,t.metadata.dateModified,"d MMMM Y H:mm:ss zzzz")," ")}}function Ji(o,s){if(1&o&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4)(7,"a",6),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()()()),2&o){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.sherpa.record.information.uri")),e.\u0275\u0275advance(4),e.\u0275\u0275property("href",t.metadata.uri,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.metadata.uri)}}let _t=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.\u0275\u0275defineComponent({type:o,selectors:[["ds-metadata-information"]],inputs:{metadata:"metadata"},decls:5,vars:4,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-8"],["target","_blank",3,"href"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Xi,8,4,"div",1),e.\u0275\u0275template(2,Yi,9,7,"div",1),e.\u0275\u0275template(3,Hi,9,7,"div",1),e.\u0275\u0275template(4,Ji,9,5,"div",1),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.id)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.dateCreated)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.dateModified)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.uri)))},directives:[V.O5],pipes:[M.X$,V.uU],styles:[""]}),o})();function Zi(o,s){1&o&&e.\u0275\u0275element(0,"ds-alert",3),2&o&&e.\u0275\u0275property("type","alert-info")("content","submission.sections.sherpa-policy.title-empty")}function ki(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",4)(1,"ds-alert",5),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"button",6),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().refresh()}),e.\u0275\u0275elementStart(6,"span"),e.\u0275\u0275element(7,"i",7),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()()()}2&o&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("type","alert-info"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"submission.sections.sherpa.publisher.policy.description")," "),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(9,5,"submission.sections.sherpa.publisher.policy.refresh")," "))}function qi(o,s){1&o&&e.\u0275\u0275element(0,"span",21)}function eo(o,s){1&o&&e.\u0275\u0275element(0,"span",22)}function to(o,s){1&o&&e.\u0275\u0275element(0,"span",21)}function no(o,s){1&o&&e.\u0275\u0275element(0,"span",22)}function io(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"div",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275reference(9).toggle()}),e.\u0275\u0275elementStart(2,"button",12),e.\u0275\u0275listener("click",function(c){return c.preventDefault()}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",13),e.\u0275\u0275template(6,to,1,0,"span",14),e.\u0275\u0275template(7,no,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"div",16,17),e.\u0275\u0275element(10,"ds-publisher-policy",23),e.\u0275\u0275elementEnd()()}if(2&o){const t=s.$implicit,r=e.\u0275\u0275reference(9),c=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275attribute("aria-expanded",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,6,"submission.sections.sherpa.publisher.policy")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",c.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("policy",t)}}function oo(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",10)(2,"div",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275reference(10).toggle()}),e.\u0275\u0275elementStart(3,"button",12),e.\u0275\u0275listener("click",function(c){return c.preventDefault()}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",13),e.\u0275\u0275template(7,qi,1,0,"span",14),e.\u0275\u0275template(8,eo,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",16,17),e.\u0275\u0275element(11,"ds-publication-information",19),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(12,io,11,8,"div",20),e.\u0275\u0275elementContainerEnd()}if(2&o){const t=s.$implicit,r=e.\u0275\u0275reference(10),c=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,7,"submission.sections.sherpa.publication.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",c.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("journal",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.policies)}}function so(o,s){1&o&&e.\u0275\u0275element(0,"span",21)}function ao(o,s){1&o&&e.\u0275\u0275element(0,"span",22)}function ro(o,s){if(1&o){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,oo,13,9,"ng-container",9),e.\u0275\u0275elementStart(2,"div",10)(3,"div",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275reference(11).toggle()}),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(c){return c.preventDefault()}),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",13),e.\u0275\u0275template(8,so,1,0,"span",14),e.\u0275\u0275template(9,ao,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div",16,17),e.\u0275\u0275element(12,"ds-metadata-information",18),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&o){const t=e.\u0275\u0275reference(11),r=e.\u0275\u0275nextContext().ngVar,c=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.journals),e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!t.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,7,"submission.sections.sherpa.record.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",c.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("metadata",r.metadata)}}function co(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-alert",3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&o){const t=e.\u0275\u0275nextContext().ngVar,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("type",r.AlertTypeEnum.Error)("content",t.message?t.message:e.\u0275\u0275pipeBind1(2,2,"submission.sections.sherpa.error.message"))}}function lo(o,s){if(1&o&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ro,13,9,"ng-container",8),e.\u0275\u0275template(2,co,3,4,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&o){const t=s.ngVar,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.hasNoData()&&!!t&&!t.error),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!!t&&t.error)}}let De=class extends A{constructor(s,t,r,c,u){super(void 0,c,u),this.sectionService=s,this.operationsBuilder=t,this.submissionService=r,this.injectedSectionData=c,this.injectedSubmissionId=u,this.sherpaPoliciesData$=new Ge.X(null),this.subs=[],this.isCollapsed=!1,this.AlertTypeEnum=Qe.N}onSectionDestroy(){this.subs.filter(s=>(0,f.Uh)(s)).forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.subs.push(this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType).subscribe(s=>{this.sherpaPoliciesData$.next(s)}))}getSectionStatus(){return(0,he.of)(!0)}hasNoData(){return(0,f.xb)(this.sherpaPoliciesData$.value)}refresh(){this.operationsBuilder.remove(this.pathCombiner.getPath("retrievalTime")),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}};De.\u0275fac=function(s){return new(s||De)(e.\u0275\u0275directiveInject(d.J),e.\u0275\u0275directiveInject(be.w),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},De.\u0275cmp=e.\u0275\u0275defineComponent({type:De,selectors:[["ds-section-sherpa-policies"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:5,consts:[[3,"type","content",4,"ngIf"],["class","d-flex flex-column flex-nowrap mt-2 mb-4",4,"ngIf"],[4,"ngVar"],[3,"type","content"],[1,"d-flex","flex-column","flex-nowrap","mt-2","mb-4"],[3,"type"],["type","button","data-test","refresh-btn",1,"btn","btn-secondary","float-right",3,"click"],[1,"fas","fa-sync"],[4,"ngIf"],[4,"ngFor","ngForOf"],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle","mb-3",3,"click"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0",3,"click"],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["collapse","ngbCollapse"],[3,"metadata"],[3,"journal"],["class","mb-3 border-bottom","data-test","collapse",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[3,"policy"]],template:function(s,t){if(1&s&&(e.\u0275\u0275template(0,Zi,1,2,"ds-alert",0),e.\u0275\u0275template(1,ki,10,7,"div",1),e.\u0275\u0275template(2,lo,3,2,"ng-container",2),e.\u0275\u0275pipe(3,"async")),2&s){let r;e.\u0275\u0275property("ngIf",t.hasNoData()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.hasNoData()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",null==(r=e.\u0275\u0275pipeBind1(3,3,t.sherpaPoliciesData$))?null:r.sherpaResponse)}},directives:[V.O5,dt.w,ct.g,V.sg,Ce._D,pt,ut,_t],pipes:[M.X$,V.Ov],styles:[""]}),De=(0,v.gn)([(0,O.E)(I.i.SherpaPolicies),(0,v.w6)("design:paramtypes",[d.J,be.w,j.b,Object,String])],De);const ft=[Ee,B,Ie,xe,ye,De];let po=(()=>{class o{static withEntryComponents(){return{ngModule:o,providers:ft.map(t=>({provide:t}))}}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=e.\u0275\u0275defineInjector({providers:[Fe,d.J,ge,Se,Je],imports:[[V.ez,n.IR.forRoot(),E.m,Le.Aw.forFeature("submission",gt.L,In.z7),J.sQ.forFeature(xt),Zn.x.withEntryComponents(),kn.a.withEntryComponents(),ni.e,Ce.bz,Ce.lQ,Ce.Gs]]}),o})();e.\u0275\u0275setComponentScope(Ee,[dt.w,V.O5,He,V.sg,st],[M.X$,V.Ov])},38300:(te,W,i)=>{"use strict";i.r(W),i.d(W,{SubmissionSubmitComponent:()=>C});var n=i(61135),E=i(63900),v=i(78372),e=i(24702),l=i(82596),b=i(86421),a=i(68285),U=i(83639),P=i(5e3),G=i(74202),w=i(86956);let C=(()=>{class M{constructor(_,L,R,$,f,A,p,T){this.changeDetectorRef=_,this.notificationsService=L,this.router=R,this.itemDataService=$,this.submissionService=f,this.translate=A,this.viewContainerRef=p,this.route=T,this.itemLink$=new n.X(void 0),this.subs=[],this.route.queryParams.subscribe(Y=>{this.collectionParam=Y.collection})}ngOnInit(){this.subs.push(this.submissionService.createSubmission(this.collectionParam).subscribe(_=>{(0,e.K0)(_)&&((0,e.xb)(_)?(this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"])):this.router.navigate(["/workspaceitems",_.id,"edit"],{replaceUrl:!0}))}),this.itemLink$.pipe((0,e.iy)(),(0,E.w)(_=>this.itemDataService.findByHref(_)),(0,a.g1)(),(0,v.b)(300)).subscribe(_=>{this.item=_.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(_=>(0,e.Uh)(_)).forEach(_=>_.unsubscribe()),this.viewContainerRef.clear(),this.changeDetectorRef.markForCheck()}}return M.\u0275fac=function(_){return new(_||M)(P.\u0275\u0275directiveInject(P.ChangeDetectorRef),P.\u0275\u0275directiveInject(l.T),P.\u0275\u0275directiveInject(G.F0),P.\u0275\u0275directiveInject(U.S),P.\u0275\u0275directiveInject(b.b),P.\u0275\u0275directiveInject(w.sK),P.\u0275\u0275directiveInject(P.ViewContainerRef),P.\u0275\u0275directiveInject(G.gz))},M.\u0275cmp=P.\u0275\u0275defineComponent({type:M,selectors:[["ds-submission-submit"]],decls:0,vars:0,template:function(_,L){},styles:[""]}),M})()},12969:(te,W,i)=>{"use strict";i.d(W,{Y:()=>e});var n=i(25330),E=i(5e3);function v(l,b){}let e=(()=>{class l extends n.F{getComponentName(){return"SubmissionSubmitComponent"}importThemedComponent(a){return i(39881)(`./${a}/app/submission/submit/submission-submit.component`)}importUnthemedComponent(){return Promise.resolve().then(i.bind(i,38300))}}return l.\u0275fac=function(){let b;return function(U){return(b||(b=E.\u0275\u0275getInheritedFactory(l)))(U||l)}}(),l.\u0275cmp=E.\u0275\u0275defineComponent({type:l,selectors:[["ds-themed-submission-submit"]],features:[E.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(a,U){1&a&&E.\u0275\u0275template(0,v,0,0,"ng-template",null,0,E.\u0275\u0275templateRefExtractor)},encapsulation:2}),l})()},32354:(te,W,i)=>{"use strict";i.d(W,{Z:()=>l});var n=i(24702);const E=/([^\/]+)/g,v=/\/sections\/(.*)/,l=b=>("string"==typeof b?[b]:b).map(U=>U.match(E)&&U.match(E).length>2?{sectionId:U.match(E)[1],fieldId:U.match(E)[2],fieldIndex:(0,n.Uh)(U.match(E)[3])?+U.match(E)[3]:0,originalPath:U}:{sectionId:U.match(v)[1],originalPath:U})},97437:(te,W,i)=>{"use strict";i.d(W,{Z:()=>v});var n=i(32354);const v=(e=[])=>{const l=Object.create({});return e.forEach(b=>{(0,n.Z)(b.paths).forEach(U=>{const P={path:U.originalPath,message:b.message};l[U.sectionId]||(l[U.sectionId]=[]),l[U.sectionId].push(P)})}),l}},8377:(te,W,i)=>{var n={"./custom/app/submission/edit/submission-edit.component":[88710,8710]};function E(v){if(!i.o(n,v))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+v+"'");throw b.code="MODULE_NOT_FOUND",b});var e=n[v],l=e[0];return i.e(e[1]).then(()=>i(l))}E.keys=()=>Object.keys(n),E.id=8377,te.exports=E},49252:(te,W,i)=>{var n={"./custom/app/submission/import-external/submission-import-external.component":[63457,3457]};function E(v){if(!i.o(n,v))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+v+"'");throw b.code="MODULE_NOT_FOUND",b});var e=n[v],l=e[0];return i.e(e[1]).then(()=>i(l))}E.keys=()=>Object.keys(n),E.id=49252,te.exports=E},39881:(te,W,i)=>{var n={"./custom/app/submission/submit/submission-submit.component":[47295,7295]};function E(v){if(!i.o(n,v))return Promise.resolve().then(()=>{var b=new Error("Cannot find module '"+v+"'");throw b.code="MODULE_NOT_FOUND",b});var e=n[v],l=e[0];return i.e(e[1]).then(()=>i(l))}E.keys=()=>Object.keys(n),E.id=39881,te.exports=E}}]);