(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[685],{53995:(te,W,o)=>{"use strict";o.d(W,{K:()=>y});var n=o(25839),C=o(69810);class y extends C.R{constructor(d,...g){super(d,...g),this._rootElement=d,this._subRootElement=g.join("/")}get rootElement(){return this._rootElement}get subRootElement(){return this._subRootElement}getPath(d){(0,n.pT)(d)&&Array.isArray(d)&&(d=d.join("/"));let g="/"+this.toString();return(0,n.pT)(d)&&(g+="/"+d),{rootElement:this._rootElement,subRootElement:this._subRootElement,path:g}}}},3751:(te,W,o)=>{"use strict";o.r(W),o.d(W,{SubmissionEditComponent:()=>L});var n=o(35841),C=o(21160),y=o(77007),e=o(3358),d=o(25839),g=o(83653),a=o(16228),B=o(5496),P=o(89551),$=o(82921),w=o(60516),S=o(70074),M=o(37895),K=o(86553),_=o(25748);let L=(()=>{class R{constructor(h,A,p,T,H,O,E,j){this.changeDetectorRef=h,this.notificationsService=A,this.route=p,this.router=T,this.itemDataService=H,this.submissionService=O,this.translate=E,this.submissionJsonPatchOperationsService=j,this.subs=[],this.itemLink$=new n.X(void 0)}ngOnInit(){this.subs.push(this.route.paramMap.pipe((0,C.w)(h=>this.submissionService.retrieveSubmission(h.get("id"))),(0,y.h)(h=>(0,d.K0)(h))).subscribe(h=>{if(h.hasSucceeded)if((0,d.xb)(h.payload))this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"]);else{const{errors:A}=h.payload;this.submissionErrors=(0,w.Z)(A),this.submissionId=h.payload.id.toString(),this.collectionId=h.payload.collection.id,this.selfUrl=h.payload._links.self.href,this.sections=h.payload.sections,this.itemLink$.next(h.payload._links.item.href),this.item=h.payload.item,this.submissionDefinition=h.payload.submissionDefinition}else 404===h.statusCode&&this.router.navigate(["/404"],{skipLocationChange:!0})}),this.itemLink$.pipe((0,d.iy)(),(0,C.w)(h=>this.itemDataService.findByHref(h)),(0,B.g1)(),(0,e.b)(300)).subscribe(h=>{this.item=h.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(h=>(0,d.Uh)(h)).forEach(h=>h.unsubscribe()),this.submissionJsonPatchOperationsService.deletePendingJsonPatchOperations()}}return R.\u0275fac=function(h){return new(h||R)(S.\u0275\u0275directiveInject(S.ChangeDetectorRef),S.\u0275\u0275directiveInject(a.T),S.\u0275\u0275directiveInject(M.gz),S.\u0275\u0275directiveInject(M.F0),S.\u0275\u0275directiveInject(P.S),S.\u0275\u0275directiveInject(g.b),S.\u0275\u0275directiveInject(K.sK),S.\u0275\u0275directiveInject($.E))},R.\u0275cmp=S.\u0275\u0275defineComponent({type:R,selectors:[["ds-submission-edit"]],decls:2,vars:7,consts:[[1,"submission-submit-container"],[3,"collectionId","sections","selfUrl","submissionDefinition","submissionErrors","item","submissionId"]],template:function(h,A){1&h&&(S.\u0275\u0275elementStart(0,"div",0),S.\u0275\u0275element(1,"ds-submission-form",1),S.\u0275\u0275elementEnd()),2&h&&(S.\u0275\u0275advance(1),S.\u0275\u0275property("collectionId",A.collectionId)("sections",A.sections)("selfUrl",A.selfUrl)("submissionDefinition",A.submissionDefinition)("submissionErrors",A.submissionErrors)("item",A.item)("submissionId",A.submissionId))},directives:[_.G],styles:[""]}),R})()},14530:(te,W,o)=>{"use strict";o.d(W,{I:()=>e});var n=o(46533),C=o(70074);function y(d,g){}let e=(()=>{class d extends n.F{getComponentName(){return"SubmissionEditComponent"}importThemedComponent(a){return o(8377)(`./${a}/app/submission/edit/submission-edit.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,3751))}}return d.\u0275fac=function(){let g;return function(B){return(g||(g=C.\u0275\u0275getInheritedFactory(d)))(B||d)}}(),d.\u0275cmp=C.\u0275\u0275defineComponent({type:d,selectors:[["ds-themed-submission-edit"]],features:[C.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(a,B){1&a&&C.\u0275\u0275template(0,y,0,0,"ng-template",null,0,C.\u0275\u0275templateRefExtractor)},encapsulation:2}),d})()},51769:(te,W,o)=>{"use strict";o.d(W,{z:()=>O});var n=o(70074),C=o(35841),y=o(9237),e=o(66154),d=o(48358),g=o(69637),a=o(25839),B=o(53995),P=o(26704),$=o(83653),w=o(82921),S=o(64508),M=o(60380),K=o(85848),_=o(5496),L=o(52738),R=o(10210),V=o(35053),h=o(86553);function A(E,j){if(1&E&&(n.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"span",4),n.\u0275\u0275text(3),n.\u0275\u0275pipe(4,"translate"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(5,"div",5)(6,"span",4),n.\u0275\u0275text(7),n.\u0275\u0275pipe(8,"async"),n.\u0275\u0275elementEnd()()()),2&E){const m=n.\u0275\u0275nextContext();n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(4,2,"submission.sections.general.collection")),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(8,4,m.selectedCollectionName$))}}function p(E,j){1&E&&(n.\u0275\u0275elementStart(0,"span"),n.\u0275\u0275element(1,"i",13),n.\u0275\u0275elementEnd())}function T(E,j){if(1&E&&(n.\u0275\u0275elementStart(0,"span"),n.\u0275\u0275text(1),n.\u0275\u0275pipe(2,"async"),n.\u0275\u0275elementEnd()),2&E){const m=n.\u0275\u0275nextContext(2);n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(2,1,m.selectedCollectionName$))}}function H(E,j){if(1&E){const m=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",6,7),n.\u0275\u0275listener("openChange",function(l){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().toggled(l)}),n.\u0275\u0275elementStart(2,"div",3)(3,"span",8),n.\u0275\u0275text(4),n.\u0275\u0275pipe(5,"translate"),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(6,"button",9),n.\u0275\u0275listener("blur",function(){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().onClose()})("click",function(){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().onClose()}),n.\u0275\u0275pipe(7,"async"),n.\u0275\u0275template(8,p,2,0,"span",10),n.\u0275\u0275pipe(9,"async"),n.\u0275\u0275template(10,T,3,3,"span",10),n.\u0275\u0275pipe(11,"async"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(12,"div",11)(13,"ds-collection-dropdown",12),n.\u0275\u0275listener("selectionChange",function(l){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().onSelect(l)}),n.\u0275\u0275elementEnd()()()}if(2&E){const m=n.\u0275\u0275nextContext();n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(5,4,"submission.sections.general.collection")," "),n.\u0275\u0275advance(2),n.\u0275\u0275property("disabled",n.\u0275\u0275pipeBind1(7,6,m.processingChange$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(9,8,m.processingChange$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(11,10,m.processingChange$))}}let O=(()=>{class E{constructor(m,D,l,v,f,x){this.cdr=m,this.collectionDataService=D,this.operationsBuilder=l,this.operationsService=v,this.submissionService=f,this.sectionsService=x,this.collectionChange=new n.EventEmitter,this.processingChange$=new C.X(!1),this.subs=[]}ngOnChanges(m){(0,a.Uh)(m.currentCollectionId)&&(0,a.Uh)(m.currentCollectionId.currentValue)&&(this.selectedCollectionId=this.currentCollectionId,this.selectedCollectionName$=this.collectionDataService.findById(this.currentCollectionId).pipe((0,e.s)(D=>(0,a.UE)(D.payload)),(0,d.U)(D=>D.payload.name)))}ngOnInit(){this.pathCombiner=new B.K("sections","collection"),this.available$=this.sectionsService.isSectionTypeAvailable(this.submissionId,L.i.collection)}ngOnDestroy(){this.subs.filter(m=>(0,a.Uh)(m)).forEach(m=>m.unsubscribe())}onSelect(m){this.processingChange$.next(!0),this.operationsBuilder.replace(this.pathCombiner.getPath(),m.collection.id,!0),this.subs.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections","collection").pipe((0,g.z)(D=>this.submissionService.retrieveSubmission(D[0].id).pipe((0,_.Gp)()))).subscribe(D=>{this.selectedCollectionId=m.collection.id,this.selectedCollectionName$=(0,y.of)(m.collection.name),this.collectionChange.emit(D),this.submissionService.changeSubmissionCollection(this.submissionId,m.collection.id),this.processingChange$.next(!1),this.cdr.detectChanges()}))}onClose(){this.collectionDropdown.reset()}toggled(m){m||this.collectionDropdown.reset()}}return E.\u0275fac=function(m){return new(m||E)(n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(S.W),n.\u0275\u0275directiveInject(P.w),n.\u0275\u0275directiveInject(w.E),n.\u0275\u0275directiveInject($.b),n.\u0275\u0275directiveInject(K.J))},E.\u0275cmp=n.\u0275\u0275defineComponent({type:E,selectors:[["ds-submission-form-collection"]],viewQuery:function(m,D){if(1&m&&n.\u0275\u0275viewQuery(M.H,5),2&m){let l;n.\u0275\u0275queryRefresh(l=n.\u0275\u0275loadQuery())&&(D.collectionDropdown=l.first)}},inputs:{currentCollectionId:"currentCollectionId",currentDefinition:"currentDefinition",submissionId:"submissionId"},outputs:{collectionChange:"collectionChange"},features:[n.\u0275\u0275NgOnChangesFeature],decls:5,vars:6,consts:[["class","input-group mb-3",4,"ngIf"],["ngbDropdown","","class","btn-group input-group",3,"openChange",4,"ngIf"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"input-group-append"],["ngbDropdown","",1,"btn-group","input-group",3,"openChange"],["collectionControls","ngbDropdown"],["id","collectionControlsMenuLabel",1,"input-group-text"],["aria-describedby","collectionControlsMenuLabel","id","collectionControlsMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary",3,"disabled","blur","click"],[4,"ngIf"],["ngbDropdownMenu","","id","collectionControlsDropdownMenu","aria-labelledby","collectionControlsMenuButton",1,"dropdown-menu"],[3,"selectionChange"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(m,D){1&m&&(n.\u0275\u0275elementStart(0,"div"),n.\u0275\u0275template(1,A,9,6,"div",0),n.\u0275\u0275pipe(2,"async"),n.\u0275\u0275template(3,H,14,12,"div",1),n.\u0275\u0275pipe(4,"async"),n.\u0275\u0275elementEnd()),2&m&&(n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(2,2,D.available$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(4,4,D.available$)))},directives:[R.O5,V.jt,V.iD,V.Vi,M.H],pipes:[R.Ov,h.X$],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{left:0!important}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{outline:0;box-shadow:var(--bs-btn-focus-box-shadow)}"]}),E})()},17996:(te,W,o)=>{"use strict";o.d(W,{z:()=>p});var n=o(9237),C=o(48358),y=o(13172),e=o(83653),d=o(12286),g=o(25839),a=o(70074),B=o(35053),P=o(10210),$=o(86481),w=o(86553);function S(T,H){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",13),a.\u0275\u0275listener("click",function(j){a.\u0275\u0275restoreView(O);const m=a.\u0275\u0275nextContext(2),D=a.\u0275\u0275reference(2);return j.preventDefault(),m.confirmDiscard(D)}),a.\u0275\u0275pipe(1,"dsBrowserOnly"),a.\u0275\u0275pipe(2,"async"),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275element(4,"i",14),a.\u0275\u0275text(5),a.\u0275\u0275pipe(6,"translate"),a.\u0275\u0275elementEnd()}if(2&T){const O=a.\u0275\u0275nextContext(2);a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(2,5,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(3,7,O.processingDepositStatus)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(1,3,"discard")),a.\u0275\u0275advance(5),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(6,9,"submission.general.discard.submit")," ")}}function M(T,H){1&T&&(a.\u0275\u0275elementStart(0,"span"),a.\u0275\u0275element(1,"i",15),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()),2&T&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(3,1,"submission.general.info.saved")," "))}function K(T,H){1&T&&(a.\u0275\u0275elementStart(0,"span"),a.\u0275\u0275element(1,"i",16),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd()),2&T&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(3,1,"submission.general.info.pending-changes")," "))}function _(T,H){1&T&&(a.\u0275\u0275elementStart(0,"div",20),a.\u0275\u0275text(1,"Saving..."),a.\u0275\u0275elementEnd()),2&T&&a.\u0275\u0275styleProp("width","100%")}function L(T,H){1&T&&(a.\u0275\u0275elementStart(0,"div",20),a.\u0275\u0275text(1,"Depositing..."),a.\u0275\u0275elementEnd()),2&T&&a.\u0275\u0275styleProp("width","100%")}function R(T,H){if(1&T&&(a.\u0275\u0275elementStart(0,"div",17)(1,"div",18),a.\u0275\u0275template(2,_,2,2,"div",19),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275template(4,L,2,2,"div",19),a.\u0275\u0275pipe(5,"async"),a.\u0275\u0275elementEnd()()),2&T){const O=a.\u0275\u0275nextContext(2);a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(3,2,O.processingSaveStatus)),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(5,4,O.processingDepositStatus))}}function V(T,H){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"button",21),a.\u0275\u0275listener("click",function(j){return a.\u0275\u0275restoreView(O),a.\u0275\u0275nextContext(2).deposit(j)}),a.\u0275\u0275pipe(1,"dsBrowserOnly"),a.\u0275\u0275pipe(2,"async"),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275elementStart(4,"span"),a.\u0275\u0275element(5,"i",22),a.\u0275\u0275text(6),a.\u0275\u0275pipe(7,"translate"),a.\u0275\u0275elementEnd()()}if(2&T){const O=a.\u0275\u0275nextContext(2);a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(2,5,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(3,7,O.processingDepositStatus)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(1,3,"deposit")),a.\u0275\u0275advance(6),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(7,9,"submission.general.deposit"),"")}}function h(T,H){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",2)(1,"div",3),a.\u0275\u0275template(2,S,7,11,"button",4),a.\u0275\u0275pipe(3,"async"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"div",5),a.\u0275\u0275template(5,M,4,3,"span",6),a.\u0275\u0275pipe(6,"async"),a.\u0275\u0275pipe(7,"async"),a.\u0275\u0275pipe(8,"async"),a.\u0275\u0275template(9,K,4,3,"span",6),a.\u0275\u0275pipe(10,"async"),a.\u0275\u0275pipe(11,"async"),a.\u0275\u0275pipe(12,"async"),a.\u0275\u0275template(13,R,6,6,"div",7),a.\u0275\u0275pipe(14,"async"),a.\u0275\u0275pipe(15,"async"),a.\u0275\u0275elementStart(16,"div",8)(17,"button",9),a.\u0275\u0275listener("click",function(j){return a.\u0275\u0275restoreView(O),a.\u0275\u0275nextContext().save(j)}),a.\u0275\u0275pipe(18,"dsBrowserOnly"),a.\u0275\u0275pipe(19,"async"),a.\u0275\u0275pipe(20,"async"),a.\u0275\u0275elementStart(21,"span"),a.\u0275\u0275element(22,"i",10),a.\u0275\u0275text(23),a.\u0275\u0275pipe(24,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(25,"button",11),a.\u0275\u0275listener("click",function(j){return a.\u0275\u0275restoreView(O),a.\u0275\u0275nextContext().saveLater(j)}),a.\u0275\u0275pipe(26,"async"),a.\u0275\u0275pipe(27,"async"),a.\u0275\u0275pipe(28,"dsBrowserOnly"),a.\u0275\u0275pipe(29,"async"),a.\u0275\u0275pipe(30,"async"),a.\u0275\u0275elementStart(31,"span"),a.\u0275\u0275element(32,"i",10),a.\u0275\u0275text(33),a.\u0275\u0275pipe(34,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275template(35,V,8,11,"button",12),a.\u0275\u0275pipe(36,"async"),a.\u0275\u0275elementEnd()()()}if(2&T){const O=a.\u0275\u0275nextContext();a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(3,15,O.showDepositAndDiscard)),a.\u0275\u0275advance(3),a.\u0275\u0275property("ngIf",!a.\u0275\u0275pipeBind1(6,17,O.hasUnsavedModification)&&!a.\u0275\u0275pipeBind1(7,19,O.processingSaveStatus)&&!a.\u0275\u0275pipeBind1(8,21,O.processingDepositStatus)),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(10,23,O.hasUnsavedModification)&&!a.\u0275\u0275pipeBind1(11,25,O.processingSaveStatus)&&!a.\u0275\u0275pipeBind1(12,27,O.processingDepositStatus)),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(14,29,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(15,31,O.processingDepositStatus)),a.\u0275\u0275advance(4),a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(19,35,O.processingSaveStatus)||!a.\u0275\u0275pipeBind1(20,37,O.hasUnsavedModification)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(18,33,"save")),a.\u0275\u0275advance(6),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(24,39,"submission.general.save"),""),a.\u0275\u0275advance(2),a.\u0275\u0275classProp("btn-primary",!a.\u0275\u0275pipeBind1(26,41,O.showDepositAndDiscard))("btn-secondary",a.\u0275\u0275pipeBind1(27,43,O.showDepositAndDiscard)),a.\u0275\u0275property("disabled",a.\u0275\u0275pipeBind1(29,47,O.processingSaveStatus)||a.\u0275\u0275pipeBind1(30,49,O.processingDepositStatus)),a.\u0275\u0275attribute("data-test",a.\u0275\u0275pipeBind1(28,45,"save-for-later")),a.\u0275\u0275advance(8),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(34,51,"submission.general.save-later"),""),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",a.\u0275\u0275pipeBind1(36,53,O.showDepositAndDiscard))}}function A(T,H){if(1&T){const O=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",23)(1,"h4",24),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"button",25),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(O).dismiss("cancel")}),a.\u0275\u0275elementStart(5,"span",26),a.\u0275\u0275text(6,"\xd7"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(7,"div",27)(8,"p"),a.\u0275\u0275text(9),a.\u0275\u0275pipe(10,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(11,"div",28)(12,"button",29),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(O).close("cancel")}),a.\u0275\u0275text(13),a.\u0275\u0275pipe(14,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(15,"button",30),a.\u0275\u0275listener("click",function(){return a.\u0275\u0275restoreView(O).close("ok")}),a.\u0275\u0275text(16),a.\u0275\u0275pipe(17,"translate"),a.\u0275\u0275elementEnd()()}2&T&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,4,"submission.general.discard.confirm.title")),a.\u0275\u0275advance(7),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(10,6,"submission.general.discard.confirm.info")),a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(14,8,"submission.general.discard.confirm.cancel")),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(17,10,"submission.general.discard.confirm.submit")))}let p=(()=>{class T{constructor(O,E,j){this.modalService=O,this.restService=E,this.submissionService=j,this.submissionIsInvalid=(0,n.of)(!0)}ngOnChanges(O){(0,g.UE)(this.submissionId)&&(this.submissionIsInvalid=this.submissionService.getSubmissionStatus(this.submissionId).pipe((0,C.U)(E=>!1===E)),this.processingSaveStatus=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.processingDepositStatus=this.submissionService.getSubmissionDepositProcessingStatus(this.submissionId),this.showDepositAndDiscard=(0,n.of)(this.submissionService.getSubmissionScope()===d.S.WorkspaceItem),this.hasUnsavedModification=this.submissionService.hasUnsavedModification())}save(O){this.submissionService.dispatchSave(this.submissionId,!0)}saveLater(O){this.submissionService.dispatchSaveForLater(this.submissionId)}deposit(O){this.submissionService.dispatchDeposit(this.submissionId)}confirmDiscard(O){this.modalService.open(O).result.then(E=>{"ok"===E&&this.submissionService.dispatchDiscard(this.submissionId)})}}return T.\u0275fac=function(O){return new(O||T)(a.\u0275\u0275directiveInject(B.FF),a.\u0275\u0275directiveInject(y.F),a.\u0275\u0275directiveInject(e.b))},T.\u0275cmp=a.\u0275\u0275defineComponent({type:T,selectors:[["ds-submission-form-footer"]],inputs:{submissionId:"submissionId"},features:[a.\u0275\u0275NgOnChangesFeature],decls:3,vars:1,consts:[["class","row",4,"ngIf"],["content",""],[1,"row"],[1,"col"],["type","button","id","discard","class","btn btn-danger",3,"disabled","click",4,"ngIf"],[1,"col","text-right","d-flex","justify-content-end","align-items-center"],[4,"ngIf"],["class","col d-flex justify-content-end align-items-center",4,"ngIf"],[1,"ml-2","space-children-mr"],["type","button","id","save",1,"btn","btn-secondary",3,"disabled","click"],[1,"fas","fa-save"],["type","button","id","saveForLater",1,"btn",3,"disabled","click"],["type","button","id","deposit","class","btn btn-success",3,"disabled","click",4,"ngIf"],["type","button","id","discard",1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-trash"],[1,"fas","fa-check-circle"],[1,"fas","fa-exclamation-circle"],[1,"col","d-flex","justify-content-end","align-items-center"],[1,"progress","w-75"],["class","progress-bar progress-bar-striped progress-bar-animated bg-info","role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",3,"width",4,"ngIf"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info"],["type","button","id","deposit",1,"btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer","space-children-mr"],["type","button","id","discard_cancel",1,"btn","btn-secondary",3,"click"],["type","button","id","discard_submit",1,"btn","btn-danger",3,"click"]],template:function(O,E){1&O&&(a.\u0275\u0275template(0,h,37,55,"div",0),a.\u0275\u0275template(1,A,18,12,"ng-template",null,1,a.\u0275\u0275templateRefExtractor)),2&O&&a.\u0275\u0275property("ngIf",!!E.submissionId)},directives:[P.O5],pipes:[$.g,P.Ov,w.X$],styles:[""]}),T})()},29959:(te,W,o)=>{"use strict";o.d(W,{i:()=>S});var n=o(48358),C=o(85848),y=o(90016),e=o(83653),d=o(70074),g=o(35053),a=o(10210),B=o(86553);function P(M,K){1&M&&(d.\u0275\u0275elementStart(0,"button",7),d.\u0275\u0275text(1),d.\u0275\u0275pipe(2,"translate"),d.\u0275\u0275elementEnd()),2&M&&(d.\u0275\u0275advance(1),d.\u0275\u0275textInterpolate1(" ",d.\u0275\u0275pipeBind1(2,1,"submission.sections.general.no-sections")," "))}function $(M,K){if(1&M){const _=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"button",8),d.\u0275\u0275listener("click",function(){const V=d.\u0275\u0275restoreView(_).$implicit;return d.\u0275\u0275nextContext().addSection(V.id)}),d.\u0275\u0275text(1),d.\u0275\u0275pipe(2,"translate"),d.\u0275\u0275elementEnd()}if(2&M){const _=K.$implicit;d.\u0275\u0275advance(1),d.\u0275\u0275textInterpolate1(" ",d.\u0275\u0275pipeBind1(2,1,"submission.sections."+_.header)," ")}}const w=function(M){return{"w-100":M}};let S=(()=>{class M{constructor(_,L,R){this.sectionService=_,this.submissionService=L,this.windowService=R}ngOnInit(){this.sectionList$=this.submissionService.getDisabledSectionsList(this.submissionId),this.hasSections$=this.sectionList$.pipe((0,n.U)(_=>_.length>0))}addSection(_){this.sectionService.addSection(this.submissionId,_)}}return M.\u0275fac=function(_){return new(_||M)(d.\u0275\u0275directiveInject(C.J),d.\u0275\u0275directiveInject(e.b),d.\u0275\u0275directiveInject(y.I))},M.\u0275cmp=d.\u0275\u0275defineComponent({type:M,selectors:[["ds-submission-form-section-add"]],inputs:{collectionId:"collectionId",submissionId:"submissionId"},decls:14,vars:25,consts:[["ngbDropdown","","placement","bottom-right",1,"d-inline-block",3,"ngClass"],["sectionAdd","ngbDropdown"],["id","sectionControls","ngbDropdownToggle","",1,"btn","btn-outline-primary","dropdown-toggle",3,"disabled","ngClass"],["aria-hidden","true",1,"fa","fa-plus"],["ngbDropdownMenu","","aria-labelledby","sectionControls",1,"sections-dropdown-menu",3,"ngClass"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"]],template:function(_,L){1&_&&(d.\u0275\u0275elementStart(0,"div",0,1)(2,"button",2),d.\u0275\u0275pipe(3,"async"),d.\u0275\u0275pipe(4,"async"),d.\u0275\u0275text(5),d.\u0275\u0275pipe(6,"translate"),d.\u0275\u0275element(7,"i",3),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(8,"div",4),d.\u0275\u0275pipe(9,"async"),d.\u0275\u0275template(10,P,3,3,"button",5),d.\u0275\u0275pipe(11,"async"),d.\u0275\u0275template(12,$,3,3,"button",6),d.\u0275\u0275pipe(13,"async"),d.\u0275\u0275elementEnd()()),2&_&&(d.\u0275\u0275property("ngClass",d.\u0275\u0275pureFunction1(19,w,L.windowService.isXs())),d.\u0275\u0275advance(2),d.\u0275\u0275property("disabled",!d.\u0275\u0275pipeBind1(3,7,L.hasSections$))("ngClass",d.\u0275\u0275pureFunction1(21,w,d.\u0275\u0275pipeBind1(4,9,L.windowService.isXs()))),d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate1(" ",d.\u0275\u0275pipeBind1(6,11,"submission.sections.general.add-more")," "),d.\u0275\u0275advance(3),d.\u0275\u0275property("ngClass",d.\u0275\u0275pureFunction1(23,w,d.\u0275\u0275pipeBind1(9,13,L.windowService.isXs()))),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngIf",!d.\u0275\u0275pipeBind1(11,15,L.hasSections$)),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngForOf",d.\u0275\u0275pipeBind1(13,17,L.sectionList$)))},directives:[g.jt,a.mk,g.iD,g.Vi,a.O5,a.sg],pipes:[a.Ov,B.X$],styles:[".dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.sections-dropdown-menu[_ngcontent-%COMP%]{z-index:var(--ds-submission-header-z-index)}"]}),M})()},25748:(te,W,o)=>{"use strict";o.d(W,{G:()=>D});var n=o(9237),C=o(77007),y=o(48358),e=o(49887),d=o(21160),g=o(28709),B=(o(38540),o(19339)),P=o(25839),$=o(46316),w=o(83653),M=(o(27899),o(52738)),K=o(85848),_=o(70074),L=o(10210),R=o(703),V=o(51769),h=o(29959),A=o(76924),p=o(38103),T=o(17996);function H(l,v){if(1&l&&(_.\u0275\u0275elementStart(0,"div",12),_.\u0275\u0275element(1,"ds-submission-upload-files",13)(2,"div",14),_.\u0275\u0275elementEnd()),2&l){const f=_.\u0275\u0275nextContext(2);_.\u0275\u0275advance(1),_.\u0275\u0275property("submissionId",f.submissionId)("collectionId",f.collectionId)("uploadFilesOptions",f.uploadFilesOptions)}}function O(l,v){if(1&l){const f=_.\u0275\u0275getCurrentView();_.\u0275\u0275elementStart(0,"div",6),_.\u0275\u0275template(1,H,3,3,"div",7),_.\u0275\u0275pipe(2,"async"),_.\u0275\u0275elementStart(3,"div",8)(4,"ds-submission-form-collection",9),_.\u0275\u0275listener("collectionChange",function(ne){return _.\u0275\u0275restoreView(f),_.\u0275\u0275nextContext().onCollectionChange(ne)}),_.\u0275\u0275elementEnd()(),_.\u0275\u0275elementStart(5,"div",10),_.\u0275\u0275element(6,"ds-submission-form-section-add",11),_.\u0275\u0275elementEnd()()}if(2&l){const f=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",_.\u0275\u0275pipeBind1(2,6,f.uploadEnabled$)),_.\u0275\u0275advance(3),_.\u0275\u0275property("currentCollectionId",f.collectionId)("currentDefinition",f.definitionId)("submissionId",f.submissionId),_.\u0275\u0275advance(2),_.\u0275\u0275property("collectionId",f.collectionId)("submissionId",f.submissionId)}}function E(l,v){1&l&&_.\u0275\u0275element(0,"ds-themed-loading",15)}function j(l,v){if(1&l&&(_.\u0275\u0275elementContainerStart(0),_.\u0275\u0275element(1,"ds-submission-section-container",16),_.\u0275\u0275elementContainerEnd()),2&l){const f=v.$implicit,x=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("collectionId",x.collectionId)("submissionId",x.submissionId)("sectionData",f)}}function m(l,v){if(1&l&&(_.\u0275\u0275elementStart(0,"div",17),_.\u0275\u0275element(1,"ds-submission-form-footer",18),_.\u0275\u0275elementEnd()),2&l){const f=_.\u0275\u0275nextContext();_.\u0275\u0275advance(1),_.\u0275\u0275property("submissionId",f.submissionId)}}let D=(()=>{class l{constructor(f,x,ne,ie,ce){this.authService=f,this.changeDetectorRef=x,this.halService=ne,this.submissionService=ie,this.sectionsService=ce,this.loading=(0,n.of)(!0),this.uploadFilesOptions=new $.n,this.subs=[],this.isActive=!0}ngOnChanges(f){f.collectionId&&this.collectionId&&f.submissionId&&this.submissionId&&(this.isActive=!0,this.submissionSections=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,C.h)(()=>this.isActive),(0,y.U)(x=>x.isLoading),(0,y.U)(x=>x),(0,e.x)(),(0,d.w)(x=>x?(0,n.of)([]):this.getSectionsList())),this.uploadEnabled$=this.sectionsService.isSectionTypeAvailable(this.submissionId,M.i.Upload),this.loading=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,C.h)(()=>this.isActive),(0,y.U)(x=>x.isLoading),(0,y.U)(x=>x),(0,e.x)()),this.subs.push(this.halService.getEndpoint(this.submissionService.getSubmissionObjectLinkName()).pipe((0,C.h)(x=>(0,P.UE)(x)),(0,e.x)()).subscribe(x=>{this.uploadFilesOptions.authToken=this.authService.buildAuthHeader(),this.uploadFilesOptions.url=x.concat(`/${this.submissionId}`),this.definitionId=this.submissionDefinition.name,this.submissionService.dispatchInit(this.collectionId,this.submissionId,this.selfUrl,this.submissionDefinition,this.sections,this.item,this.submissionErrors),this.changeDetectorRef.detectChanges()})),this.submissionService.startAutoSave(this.submissionId))}ngOnDestroy(){this.isActive=!1,this.submissionService.stopAutoSave(),this.submissionService.resetAllSubmissionObjects(),this.subs.filter(f=>(0,P.Uh)(f)).forEach(f=>f.unsubscribe())}onCollectionChange(f){this.collectionId=f.collection.id,this.definitionId!==f.submissionDefinition.name?(this.sections=f.sections,this.submissionDefinition=f.submissionDefinition,this.definitionId=this.submissionDefinition.name,this.submissionService.resetSubmissionObject(this.collectionId,this.submissionId,f._links.self.href,this.submissionDefinition,this.sections,this.item)):this.changeDetectorRef.detectChanges()}isLoading(){return this.loading}getSectionsList(){return this.submissionService.getSubmissionSections(this.submissionId).pipe((0,C.h)(f=>(0,P.UE)(f)),(0,y.U)(f=>f))}}return l.\u0275fac=function(f){return new(f||l)(_.\u0275\u0275directiveInject(g.e8),_.\u0275\u0275directiveInject(_.ChangeDetectorRef),_.\u0275\u0275directiveInject(B.q),_.\u0275\u0275directiveInject(w.b),_.\u0275\u0275directiveInject(K.J))},l.\u0275cmp=_.\u0275\u0275defineComponent({type:l,selectors:[["ds-submission-form"]],inputs:{collectionId:"collectionId",item:"item",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},features:[_.\u0275\u0275NgOnChangesFeature],decls:10,vars:12,consts:[[1,"container-fluid"],["class","submission-form-header mb-3 d-flex flex-wrap position-sticky",4,"ngIf"],[1,"submission-form-content"],["message","Loading...",4,"ngIf"],[4,"ngFor","ngForOf"],["class","submission-form-footer mt-3 mb-3 position-sticky",4,"ngIf"],[1,"submission-form-header","mb-3","d-flex","flex-wrap","position-sticky"],["class","w-100",4,"ngIf"],[1,"submission-form-header-item","mb-3","mb-sm-0","flex-sm-grow-1","flex-md-grow-0"],[3,"currentCollectionId","currentDefinition","submissionId","collectionChange"],[1,"submission-form-header-item","text-right"],[3,"collectionId","submissionId"],[1,"w-100"],[3,"submissionId","collectionId","uploadFilesOptions"],[1,"clearfix"],["message","Loading..."],[3,"collectionId","submissionId","sectionData"],[1,"submission-form-footer","mt-3","mb-3","position-sticky"],[3,"submissionId"]],template:function(f,x){1&f&&(_.\u0275\u0275elementStart(0,"div",0),_.\u0275\u0275template(1,O,7,8,"div",1),_.\u0275\u0275pipe(2,"async"),_.\u0275\u0275elementStart(3,"div",2),_.\u0275\u0275template(4,E,1,0,"ds-themed-loading",3),_.\u0275\u0275pipe(5,"async"),_.\u0275\u0275template(6,j,2,3,"ng-container",4),_.\u0275\u0275pipe(7,"async"),_.\u0275\u0275elementEnd(),_.\u0275\u0275template(8,m,2,1,"div",5),_.\u0275\u0275pipe(9,"async"),_.\u0275\u0275elementEnd()),2&f&&(_.\u0275\u0275advance(1),_.\u0275\u0275property("ngIf",!_.\u0275\u0275pipeBind1(2,4,x.isLoading())),_.\u0275\u0275advance(3),_.\u0275\u0275property("ngIf",_.\u0275\u0275pipeBind1(5,6,x.isLoading())),_.\u0275\u0275advance(2),_.\u0275\u0275property("ngForOf",_.\u0275\u0275pipeBind1(7,8,x.submissionSections)),_.\u0275\u0275advance(2),_.\u0275\u0275property("ngIf",!_.\u0275\u0275pipeBind1(9,10,x.isLoading())))},directives:[L.O5,R.h,V.z,h.i,A.Z,L.sg,p.y,T.z],pipes:[L.Ov],styles:[".submission-form-header[_ngcontent-%COMP%]{background-color:#fffffff7;padding:calc(var(--bs-spacer) / 2) 0 calc(var(--bs-spacer) / 2) 0;top:0;z-index:var(--ds-submission-header-z-index)}.submission-form-header-item[_ngcontent-%COMP%]{flex-grow:1}.submission-form-footer[_ngcontent-%COMP%]{border-radius:var(--bs-card-border-radius);bottom:0;background-color:var(--bs-gray-400);padding:calc(var(--bs-spacer) / 2);z-index:var(--ds-submission-footer-z-index)}.btn-link-focus[_ngcontent-%COMP%]{font-weight:400;color:#066;text-decoration:none}.btn-link-focus[_ngcontent-%COMP%]:hover{color:#001a1a;text-decoration:underline}.btn-link-focus[_ngcontent-%COMP%]:disabled, .btn-link-focus.disabled[_ngcontent-%COMP%]{color:#6c757d;pointer-events:none}.btn-link-focus[_ngcontent-%COMP%]:focus, .btn-link-focus.focus[_ngcontent-%COMP%]{text-decoration:underline}"]}),l})()},703:(te,W,o)=>{"use strict";o.d(W,{h:()=>R});var n=o(9237),C=o(76215),y=o(77176),e=o(85848),d=o(25839),g=o(96937),a=o(83653),B=o(16228),P=o(60516),$=o(82921),w=o(52738),S=o(70074),M=o(86553),K=o(10210),_=o(53858);function L(V,h){if(1&V){const A=S.\u0275\u0275getCurrentView();S.\u0275\u0275elementStart(0,"ds-uploader",1),S.\u0275\u0275listener("onCompleteItem",function(T){return S.\u0275\u0275restoreView(A),S.\u0275\u0275nextContext().onCompleteItem(T)})("onUploadError",function(){return S.\u0275\u0275restoreView(A),S.\u0275\u0275nextContext().onUploadError()}),S.\u0275\u0275elementEnd()}if(2&V){const A=S.\u0275\u0275nextContext();S.\u0275\u0275property("dropMsg",A.dropMsg)("dropOverDocumentMsg",A.dropOverDocumentMsg)("enableDragOverDocument",A.enableDragOverDocument)("onBeforeUpload",A.onBeforeUpload)("uploadFilesOptions",A.uploadFilesOptions)}}let R=(()=>{class V{constructor(A,p,T,H,O){this.notificationsService=A,this.operationsService=p,this.sectionService=T,this.submissionService=H,this.translate=O,this.enableDragOverDocument=!0,this.dropOverDocumentMsg="submission.sections.upload.drop-message",this.dropMsg="submission.sections.upload.drop-message",this.subs=[],this.uploadEnabled=(0,n.of)(!1),this.onBeforeUpload=()=>{const E=this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections").subscribe();return this.subs.push(E),E}}ngOnChanges(){this.uploadEnabled=this.sectionService.isSectionTypeAvailable(this.submissionId,w.i.Upload)}onCompleteItem(A){this.subs.push(this.uploadEnabled.pipe((0,C.P)()).subscribe(p=>{if(p){const{sections:T}=A,{errors:H}=A,O=(0,P.Z)(H);T&&(0,d.UE)(T)&&Object.keys(T).forEach(E=>{const j=(0,g.Vv)(T[E]),m=O[E];this.sectionService.isSectionType(this.submissionId,E,w.i.Upload).pipe((0,y.q)(1)).subscribe(D=>{D&&((0,d.xb)(m)?this.notificationsService.success(null,this.translate.get("submission.sections.upload.upload-successful")):this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed")))}),this.sectionService.updateSectionData(this.submissionId,E,j,m,m)})}}))}onUploadError(){this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed"))}ngOnDestroy(){this.subs.filter(A=>(0,d.Uh)(A)).forEach(A=>A.unsubscribe())}}return V.\u0275fac=function(A){return new(A||V)(S.\u0275\u0275directiveInject(B.T),S.\u0275\u0275directiveInject($.E),S.\u0275\u0275directiveInject(e.J),S.\u0275\u0275directiveInject(a.b),S.\u0275\u0275directiveInject(M.sK))},V.\u0275cmp=S.\u0275\u0275defineComponent({type:V,selectors:[["ds-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},features:[S.\u0275\u0275NgOnChangesFeature],decls:1,vars:1,consts:[[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError"]],template:function(A,p){1&A&&S.\u0275\u0275template(0,L,1,5,"ds-uploader",0),2&A&&S.\u0275\u0275property("ngIf",p.uploadFilesOptions.url)},directives:[K.O5,_.B],encapsulation:2}),V})()},54877:(te,W,o)=>{"use strict";o.d(W,{v:()=>M}),o(7634);var C=o(59874),y=o(69637),e=o(83653),d=o(16228),g=o(54475),a=o(70074),B=o(35053),P=o(37895),$=o(10210),w=o(86553);function S(K,_){if(1&K&&(a.\u0275\u0275elementStart(0,"div",5)(1,"div",6)(2,"strong"),a.\u0275\u0275text(3),a.\u0275\u0275pipe(4,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(5,"p"),a.\u0275\u0275text(6),a.\u0275\u0275elementEnd()()()),2&K){const L=_.$implicit;a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(4,2,"item.preview."+L.key)),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(L.value.value)}}let M=(()=>{class K{constructor(L,R,V,h,A){this.activeModal=L,this.submissionService=R,this.modalService=V,this.router=h,this.notificationService=A}ngOnInit(){this.metadataList=[],Object.keys(this.externalSourceEntry.metadata).forEach(R=>{this.metadataList.push({key:R,value:C.S.first(this.externalSourceEntry.metadata,R)})})}closeMetadataModal(){this.activeModal.dismiss(!1)}import(){this.modalRef=this.modalService.open(g.L,{size:"lg"}),this.modalRef.componentInstance.entityType=this.labelPrefix,this.closeMetadataModal(),this.modalRef.componentInstance.selectedEvent.pipe((0,y.z)(L=>this.submissionService.createSubmissionFromExternalSource(this.externalSourceEntry._links.self.href,L.collection.id))).subscribe(L=>{let R=!1;1===L.length&&null!==L[0]&&(R=!0,this.router.navigateByUrl("/workspaceitems/"+L[0].id+"/edit")),R||this.notificationService.error("submission.import-external.preview.error.import.title","submission.import-external.preview.error.import.body"),this.modalRef.close()})}}return K.\u0275fac=function(L){return new(L||K)(a.\u0275\u0275directiveInject(B.Kz),a.\u0275\u0275directiveInject(e.b),a.\u0275\u0275directiveInject(B.FF),a.\u0275\u0275directiveInject(P.F0),a.\u0275\u0275directiveInject(d.T))},K.\u0275cmp=a.\u0275\u0275defineComponent({type:K,selectors:[["ds-submission-import-external-preview"]],inputs:{externalSourceEntry:"externalSourceEntry"},decls:27,vars:10,consts:[[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"container"],[1,"row"],[1,"col-md-12"],["class","row",4,"ngFor","ngForOf"],[1,"col-md-12","text-right"],["role","button",1,"btn","btn-success",3,"click"],["aria-hidden","true",1,"fa","fa-file-import"]],template:function(L,R){1&L&&(a.\u0275\u0275elementStart(0,"div",0)(1,"h2"),a.\u0275\u0275text(2),a.\u0275\u0275pipe(3,"translate"),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"button",1),a.\u0275\u0275listener("click",function(){return R.closeMetadataModal()}),a.\u0275\u0275elementStart(5,"span",2),a.\u0275\u0275text(6,"\xd7"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(7,"div",3)(8,"div",4)(9,"div",5)(10,"div",6)(11,"p"),a.\u0275\u0275text(12),a.\u0275\u0275pipe(13,"translate"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(14,"div",5)(15,"div",6),a.\u0275\u0275element(16,"hr"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275template(17,S,7,4,"div",7),a.\u0275\u0275elementStart(18,"div",5)(19,"div",6),a.\u0275\u0275element(20,"hr"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(21,"div",5)(22,"div",8)(23,"button",9),a.\u0275\u0275listener("click",function(){return R.import()}),a.\u0275\u0275element(24,"i",10),a.\u0275\u0275text(25),a.\u0275\u0275pipe(26,"translate"),a.\u0275\u0275elementEnd()()()()()),2&L&&(a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(3,4,"submission.import-external.preview.title."+R.labelPrefix)),a.\u0275\u0275advance(10),a.\u0275\u0275textInterpolate(a.\u0275\u0275pipeBind1(13,6,"submission.import-external.preview.subtitle")),a.\u0275\u0275advance(5),a.\u0275\u0275property("ngForOf",R.metadataList),a.\u0275\u0275advance(8),a.\u0275\u0275textInterpolate1(" ",a.\u0275\u0275pipeBind1(26,8,"submission.import-external.preview.button.import")," "))},directives:[$.sg],pipes:[w.X$],styles:[".close[_ngcontent-%COMP%]:focus{outline:none!important}"]}),K})()},76202:(te,W,o)=>{"use strict";o.d(W,{p:()=>O});var n=o(70074),C=o(9237),y=o(9249),e=o(27303),d=o(68862),g=o(17390),a=o(73535),B=o(45419),P=o(65639),$=o(5496),w=o(90016),S=o(25839),M=o(30292),K=o(10210),_=o(45028),L=o(35053),R=o(25501),V=o(86553);function h(E,j){if(1&E){const m=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"div",10)(1,"input",11),n.\u0275\u0275listener("keyup.enter",function(){n.\u0275\u0275restoreView(m);const l=n.\u0275\u0275nextContext();return""===l.searchString?null:l.search()})("ngModelChange",function(l){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().searchString=l}),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275elementEnd()()}if(2&E){const m=n.\u0275\u0275nextContext();n.\u0275\u0275advance(1),n.\u0275\u0275propertyInterpolate("placeholder",n.\u0275\u0275pipeBind1(2,2,"submission.import-external.search.placeholder")),n.\u0275\u0275property("ngModel",m.searchString)}}function A(E,j){if(1&E){const m=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"input",11),n.\u0275\u0275listener("keyup.enter",function(){n.\u0275\u0275restoreView(m);const l=n.\u0275\u0275nextContext();return""===l.searchString?null:l.search()})("ngModelChange",function(l){return n.\u0275\u0275restoreView(m),n.\u0275\u0275nextContext().searchString=l}),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275elementEnd()}if(2&E){const m=n.\u0275\u0275nextContext();n.\u0275\u0275propertyInterpolate("placeholder",n.\u0275\u0275pipeBind1(1,2,"submission.import-external.search.placeholder")),n.\u0275\u0275property("ngModel",m.searchString)}}function p(E,j){if(1&E){const m=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"button",12),n.\u0275\u0275listener("click",function(){const v=n.\u0275\u0275restoreView(m).$implicit;return n.\u0275\u0275nextContext().makeSourceSelection(v)}),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementEnd()}if(2&E){const m=j.$implicit;n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.import-external.source."+(null==m?null:m.name))),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(3,4,"submission.import-external.source."+(null==m?null:m.name)))}}function T(E,j){1&E&&(n.\u0275\u0275elementStart(0,"div",13)(1,"p"),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementEnd()()),2&E&&(n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(3,1,"submission.import-external.source.loading")))}const H=function(E){return{"input-group-append":E}};let O=(()=>{class E{constructor(m,D,l){this.externalService=m,this.cdr=D,this.windowService=l,this.sourceListLoading=!1,this.externalSourceData=new n.EventEmitter}ngOnInit(){this.selectedElement={id:"",name:"loading"},this.searchString="",this.sourceList=[],this.findListOptions=Object.assign({},new M.R,{elementsPerPage:5,currentPage:1,searchParams:[new d.g("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe((0,y.K)(()=>{const m=new B.S,D=(0,a.b)(m,[]),l=(0,P.AC)(D);return(0,C.of)(l)}),(0,$.Gp)()).subscribe(m=>{m.page.forEach(D=>{this.sourceList.push({id:D.id,name:D.name}),this.initExternalSourceData.sourceId===D.id&&(this.selectedElement={id:D.id,name:D.name},this.searchString=this.initExternalSourceData.query)}),""===this.selectedElement.id&&(this.selectedElement=this.sourceList[0]),this.pageInfo=m.pageInfo,this.cdr.detectChanges()}),this.isXsOrSm$=this.windowService.isXsOrSm()}makeSourceSelection(m){this.selectedElement=m}onScroll(){!this.sourceListLoading&&this.pageInfo.currentPage+1<=this.pageInfo.totalPages&&(this.sourceListLoading=!0,this.findListOptions=Object.assign({},new M.R,{elementsPerPage:5,currentPage:this.findListOptions.currentPage+1,searchParams:[new d.g("entityType",this.initExternalSourceData.entity)]}),this.externalService.searchBy("findByEntityType",this.findListOptions).pipe((0,y.K)(()=>{const m=new B.S,D=(0,a.b)(m,[]),l=(0,P.AC)(D);return(0,C.of)(l)}),(0,$.xw)(),(0,e.b)(()=>this.sourceListLoading=!1)).subscribe(m=>{m.payload.page.forEach(D=>{this.sourceList.push({id:D.id,name:D.name})}),this.pageInfo=m.payload.pageInfo,this.cdr.detectChanges()}))}search(){this.externalSourceData.emit({entity:this.initExternalSourceData.entity,sourceId:this.selectedElement.id,query:this.searchString})}ngOnDestroy(){(0,S.Uh)(this.sub)&&this.sub.unsubscribe()}}return E.\u0275fac=function(m){return new(m||E)(n.\u0275\u0275directiveInject(g.G),n.\u0275\u0275directiveInject(n.ChangeDetectorRef),n.\u0275\u0275directiveInject(w.I))},E.\u0275cmp=n.\u0275\u0275defineComponent({type:E,selectors:[["ds-submission-import-external-searchbar"]],inputs:{initExternalSourceData:"initExternalSourceData"},outputs:{externalSourceData:"externalSourceData"},decls:20,vars:31,consts:[["class","input-group mb-2",4,"ngIf"],[1,"input-group","mb-5"],["type","text","class","form-control","aria-label","","aria-describedby","",3,"ngModel","placeholder","keyup.enter","ngModelChange",4,"ngIf"],["ngbDropdown","","role","group","aria-label","",3,"ngClass"],["ngbDropdownToggle","",1,"btn","btn-outline-secondary","w-fx",3,"title"],["ngbDropdownMenu","","aria-haspopup","true","aria-expanded","false","aria-labelledby","scrollableDropdownMenuButton",1,"dropdown-menu","scrollable-dropdown-menu","w-100"],["aria-labelledby","scrollableDropdownMenuButton","infiniteScroll","",1,"scrollable-menu",3,"infiniteScrollDistance","infiniteScrollThrottle","scrollWindow","scrolled"],["ngbDropdownItem","","class","dropdown-item text-truncate",3,"title","click",4,"ngFor","ngForOf"],["ngbDropdownItem","","class","scrollable-dropdown-loading text-center",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"title","disabled","click"],[1,"input-group","mb-2"],["type","text","aria-label","","aria-describedby","",1,"form-control",3,"ngModel","placeholder","keyup.enter","ngModelChange"],["ngbDropdownItem","",1,"dropdown-item","text-truncate",3,"title","click"],["ngbDropdownItem","",1,"scrollable-dropdown-loading","text-center"]],template:function(m,D){1&m&&(n.\u0275\u0275template(0,h,3,4,"div",0),n.\u0275\u0275pipe(1,"async"),n.\u0275\u0275elementStart(2,"div",1),n.\u0275\u0275template(3,A,2,4,"input",2),n.\u0275\u0275pipe(4,"async"),n.\u0275\u0275elementStart(5,"div",3),n.\u0275\u0275pipe(6,"async"),n.\u0275\u0275elementStart(7,"button",4),n.\u0275\u0275pipe(8,"translate"),n.\u0275\u0275text(9),n.\u0275\u0275pipe(10,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(11,"div",5)(12,"div",6),n.\u0275\u0275listener("scrolled",function(){return D.onScroll()}),n.\u0275\u0275template(13,p,4,6,"button",7),n.\u0275\u0275template(14,T,4,3,"div",8),n.\u0275\u0275elementEnd()(),n.\u0275\u0275elementStart(15,"button",9),n.\u0275\u0275listener("click",function(){return D.search()}),n.\u0275\u0275pipe(16,"translate"),n.\u0275\u0275pipe(17,"translate"),n.\u0275\u0275text(18),n.\u0275\u0275pipe(19,"translate"),n.\u0275\u0275elementEnd()()()),2&m&&(n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(1,13,D.isXsOrSm$)),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(4,15,D.isXsOrSm$)),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(29,H,!n.\u0275\u0275pipeBind1(6,17,D.isXsOrSm$))),n.\u0275\u0275advance(2),n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(8,19,"submission.import-external.search.source.hint")),n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(10,21,"submission.import-external.source."+(null==D.selectedElement?null:D.selectedElement.name))),n.\u0275\u0275advance(3),n.\u0275\u0275property("infiniteScrollDistance",2)("infiniteScrollThrottle",50)("scrollWindow",!1),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngForOf",D.sourceList),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",D.sourceListLoading),n.\u0275\u0275advance(1),n.\u0275\u0275property("title",""===D.searchString?n.\u0275\u0275pipeBind1(16,23,"submission.import-external.search.button.hint"):n.\u0275\u0275pipeBind1(17,25,"submission.import-external.search.button"))("disabled",""===D.searchString),n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(19,27,"submission.import-external.search.button")))},directives:[K.O5,_.Fj,_.JJ,_.On,L.jt,K.mk,L.iD,L.Vi,R.R,K.sg,L.TH],pipes:[K.Ov,V.X$],styles:[".input-group-append[_ngcontent-%COMP%]:last-child > .btn[_ngcontent-%COMP%]:not(:last-child):not(.dropdown-toggle){margin-left:-1px;border-radius:0 .25rem .25rem 0}.input-group-append[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]{border-radius:0}.w-fx[_ngcontent-%COMP%]{min-width:200px}.scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:calc(var(--ds-dropdown-menu-max-height) / 2);overflow-x:hidden}.scrollable-dropdown-loading[_ngcontent-%COMP%]{height:calc(var(--bs-spacer) * 2)!important}.scrollable-dropdown-loading[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;line-height:calc(var(--bs-spacer) * 2);position:sticky;bottom:0}"]}),E})()},51063:(te,W,o)=>{"use strict";o.r(W),o.d(W,{SubmissionImportExternalComponent:()=>Ve});var n=o(35841),C=o(53426),y=o(77176),e=o(77007),d=o(21160),g=o(27303),a=o(69637),B=o(17390),P=o(73535),$=o(6574),w=o(10364),S=o(98865),M=o(43685),K=o(65639),_=o(54877),L=o(95033),R=o(45419),V=o(25839),h=o(5496),A=o(60508),p=o(70074),T=o(37895),H=o(35053),O=o(76202),E=o(10210),j=o(41633),m=o(64285),D=o(76924),l=o(7519),v=o(86553);function f(X,pe){1&X&&(p.\u0275\u0275elementStart(0,"h3"),p.\u0275\u0275text(1),p.\u0275\u0275pipe(2,"translate"),p.\u0275\u0275elementEnd()),2&X&&(p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(2,1,"submission.sections.describe.relationship-lookup.selection-tab.title")))}const x=function(X,pe){return{repeatable:X,listId:pe}};function ne(X,pe){if(1&X){const F=p.\u0275\u0275getCurrentView();p.\u0275\u0275elementStart(0,"ds-viewable-collection",15),p.\u0275\u0275listener("importObject",function(ue){return p.\u0275\u0275restoreView(F),p.\u0275\u0275nextContext(4).import(ue)}),p.\u0275\u0275elementEnd()}if(2&X){const F=p.\u0275\u0275nextContext().ngVar,q=p.\u0275\u0275nextContext(3);p.\u0275\u0275property("@fadeIn",void 0)("objects",F)("selectionConfig",p.\u0275\u0275pureFunction2(8,x,q.repeatable,q.listId))("config",q.initialPagination)("hideGear",!0)("context",q.context)("importable",!0)("importConfig",q.importConfig)}}function ie(X,pe){1&X&&(p.\u0275\u0275element(0,"ds-themed-loading",16),p.\u0275\u0275pipe(1,"translate")),2&X&&p.\u0275\u0275propertyInterpolate("message",p.\u0275\u0275pipeBind1(1,1,"loading.search-results"))}function ce(X,pe){1&X&&(p.\u0275\u0275elementStart(0,"div",17)(1,"ds-alert",18),p.\u0275\u0275text(2),p.\u0275\u0275pipe(3,"translate"),p.\u0275\u0275elementEnd()()),2&X&&(p.\u0275\u0275advance(1),p.\u0275\u0275property("type","alert-info"),p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(3,2,"search.results.empty")))}function me(X,pe){1&X&&(p.\u0275\u0275elementStart(0,"div",19)(1,"ds-alert",18),p.\u0275\u0275text(2),p.\u0275\u0275pipe(3,"translate"),p.\u0275\u0275elementEnd()()),2&X&&(p.\u0275\u0275advance(1),p.\u0275\u0275property("type","alert-info"),p.\u0275\u0275advance(1),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(3,2,"search.results.response.500")))}function oe(X,pe){if(1&X&&(p.\u0275\u0275elementContainerStart(0),p.\u0275\u0275template(1,f,3,3,"h3",10),p.\u0275\u0275template(2,ne,1,11,"ds-viewable-collection",11),p.\u0275\u0275pipe(3,"async"),p.\u0275\u0275template(4,ie,2,3,"ds-themed-loading",12),p.\u0275\u0275pipe(5,"async"),p.\u0275\u0275template(6,ce,4,4,"div",13),p.\u0275\u0275pipe(7,"async"),p.\u0275\u0275template(8,me,4,4,"div",14),p.\u0275\u0275pipe(9,"async"),p.\u0275\u0275elementContainerEnd()),2&X){const F=pe.ngVar,q=p.\u0275\u0275nextContext(3);p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",F&&0!==(null==F||null==F.payload||null==F.payload.page?null:F.payload.page.length)),p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",(null==F?null:F.hasSucceeded)&&!p.\u0275\u0275pipeBind1(3,5,q.isLoading$)&&(null==F||null==F.payload||null==F.payload.page?null:F.payload.page.length)>0),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngIf",p.\u0275\u0275pipeBind1(5,7,q.isLoading$)),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngIf",!p.\u0275\u0275pipeBind1(7,9,q.isLoading$)&&0===(null==F||null==F.payload||null==F.payload.page?null:F.payload.page.length)),p.\u0275\u0275advance(2),p.\u0275\u0275property("ngIf",!p.\u0275\u0275pipeBind1(9,11,q.isLoading$)&&500===F.statusCode)}}function ye(X,pe){if(1&X&&(p.\u0275\u0275elementStart(0,"div",2),p.\u0275\u0275template(1,oe,10,13,"ng-container",9),p.\u0275\u0275pipe(2,"async"),p.\u0275\u0275elementEnd()),2&X){const F=p.\u0275\u0275nextContext(2);p.\u0275\u0275advance(1),p.\u0275\u0275property("ngVar",p.\u0275\u0275pipeBind1(2,1,F.entriesRD$))}}function we(X,pe){1&X&&(p.\u0275\u0275elementStart(0,"div",2)(1,"ds-alert",18)(2,"p",20),p.\u0275\u0275text(3),p.\u0275\u0275pipe(4,"translate"),p.\u0275\u0275elementEnd()()()),2&X&&(p.\u0275\u0275advance(1),p.\u0275\u0275property("type","alert-info"),p.\u0275\u0275advance(2),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(4,2,"submission.import-external.page.hint")))}function J(X,pe){if(1&X&&(p.\u0275\u0275elementStart(0,"div",1),p.\u0275\u0275template(1,ye,3,3,"div",8),p.\u0275\u0275template(2,we,5,4,"div",8),p.\u0275\u0275elementEnd()),2&X){const F=p.\u0275\u0275nextContext();p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",""!==F.reload$.value.sourceId),p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",""===F.reload$.value.sourceId)}}const Fe=function(){return["/mydspace"]};let Ve=(()=>{class X{constructor(F,q,ue,De,$e){this.searchConfigService=F,this.externalService=q,this.routeService=ue,this.router=De,this.modalService=$e,this.entriesRD$=new n.X(null),this.isLoading$=new n.X(!1),this.reload$=new n.X({entity:"",query:"",sourceId:""}),this.initialPagination=Object.assign(new S.r,{id:"spc",pageSize:10}),this.subs=[]}ngOnInit(){this.listId="list-submission-external-sources",this.context=w._.EntitySearchModalWithNameVariants,this.repeatable=!1,this.routeData={entity:"",sourceId:"",query:""},this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label},this.entriesRD$=new n.X((0,K.AC)((0,P.b)(new R.S,[]))),this.isLoading$=new n.X(!1),this.subs.push((0,C.a)([this.routeService.getQueryParameterValue("entity"),this.routeService.getQueryParameterValue("sourceId"),this.routeService.getQueryParameterValue("query")]).pipe((0,y.q)(1)).subscribe(([F,q,ue])=>{this.reload$.next({entity:F||A.N,query:ue,sourceId:q}),this.selectLabel(F),this.retrieveExternalSources()}))}getExternalSourceData(F){this.router.navigate([],{queryParams:F,replaceUrl:!0}).then(()=>{this.reload$.next(F),this.retrieveExternalSources()})}import(F){this.modalRef=this.modalService.open(_.v,{size:"lg"});const q=this.modalRef.componentInstance;q.externalSourceEntry=F,q.labelPrefix=this.label}ngOnDestroy(){this.subs.filter(F=>(0,V.Uh)(F)).forEach(F=>F.unsubscribe()),(0,V.Uh)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe()}retrieveExternalSources(){(0,V.Uh)(this.retrieveExternalSourcesSub)&&this.retrieveExternalSourcesSub.unsubscribe(),this.retrieveExternalSourcesSub=this.reload$.pipe((0,e.h)(F=>(0,V.UE)(F.sourceId)&&(0,V.UE)(F.query)),(0,d.w)(F=>{const q=F.query;return this.routeData=F,this.searchConfigService.paginatedSearchOptions.pipe((0,g.b)(()=>this.isLoading$.next(!0)),(0,e.h)(ue=>ue.query===q),(0,a.z)(ue=>this.externalService.getExternalSourceEntries(this.routeData.sourceId,ue).pipe((0,h.sJ)())))})).subscribe(F=>{this.entriesRD$.next(F),this.isLoading$.next(!1)})}selectLabel(F){this.label=F,this.importConfig={buttonLabel:"submission.sections.describe.relationship-lookup.external-source.import-button-title."+this.label}}}return X.\u0275fac=function(F){return new(F||X)(p.\u0275\u0275directiveInject($.U),p.\u0275\u0275directiveInject(B.G),p.\u0275\u0275directiveInject(M.MZ),p.\u0275\u0275directiveInject(T.F0),p.\u0275\u0275directiveInject(H.FF))},X.\u0275cmp=p.\u0275\u0275defineComponent({type:X,selectors:[["ds-submission-import-external"]],decls:15,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-md-12"],["id","header",1,"pb-2"],[3,"initExternalSourceData","externalSourceData"],["class","row",4,"ngIf"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],["aria-hidden","true",1,"fa","fa-chevron-left"],["class","col-md-12",4,"ngIf"],[4,"ngVar"],[4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject",4,"ngIf"],[3,"message",4,"ngIf"],["data-test","empty-external-entry-list",4,"ngIf"],["data-test","empty-external-error-500",4,"ngIf"],[3,"objects","selectionConfig","config","hideGear","context","importable","importConfig","importObject"],[3,"message"],["data-test","empty-external-entry-list"],[3,"type"],["data-test","empty-external-error-500"],[1,"lead","mb-0"]],template:function(F,q){1&F&&(p.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),p.\u0275\u0275text(4),p.\u0275\u0275pipe(5,"translate"),p.\u0275\u0275elementEnd(),p.\u0275\u0275elementStart(6,"ds-submission-import-external-searchbar",4),p.\u0275\u0275listener("externalSourceData",function(De){return q.getExternalSourceData(De)}),p.\u0275\u0275elementEnd()()(),p.\u0275\u0275template(7,J,3,2,"div",5),p.\u0275\u0275elementStart(8,"div",1)(9,"div",2),p.\u0275\u0275element(10,"hr"),p.\u0275\u0275elementStart(11,"a",6),p.\u0275\u0275element(12,"i",7),p.\u0275\u0275text(13),p.\u0275\u0275pipe(14,"translate"),p.\u0275\u0275elementEnd()()()()),2&F&&(p.\u0275\u0275advance(4),p.\u0275\u0275textInterpolate(p.\u0275\u0275pipeBind1(5,5,"submission.import-external.title"+(q.label?"."+q.label:""))),p.\u0275\u0275advance(2),p.\u0275\u0275property("initExternalSourceData",q.reload$.value),p.\u0275\u0275advance(1),p.\u0275\u0275property("ngIf",q.reload$.value.entity),p.\u0275\u0275advance(4),p.\u0275\u0275property("routerLink",p.\u0275\u0275pureFunction0(9,Fe)),p.\u0275\u0275advance(2),p.\u0275\u0275textInterpolate1(" ",p.\u0275\u0275pipeBind1(14,7,"submission.import-external.back-to-my-dspace")," "))},directives:[O.p,E.O5,j.g,m.c,D.Z,l.w,T.yS],pipes:[v.X$,E.Ov],styles:[""],data:{animation:[L.Ji]}}),X})()},22992:(te,W,o)=>{"use strict";o.d(W,{i:()=>e});var n=o(46533),C=o(70074);function y(d,g){}let e=(()=>{class d extends n.F{getComponentName(){return"SubmissionImportExternalComponent"}importThemedComponent(a){return o(49252)(`./${a}/app/submission/import-external/submission-import-external.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,51063))}}return d.\u0275fac=function(){let g;return function(B){return(g||(g=C.\u0275\u0275getInheritedFactory(d)))(B||d)}}(),d.\u0275cmp=C.\u0275\u0275defineComponent({type:d,selectors:[["ds-themed-submission-import-external"]],features:[C.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(a,B){1&a&&C.\u0275\u0275template(0,y,0,0,"ng-template",null,0,C.\u0275\u0275templateRefExtractor)},encapsulation:2}),d})()},38103:(te,W,o)=>{"use strict";o.d(W,{y:()=>j});var n=o(70074),C=o(31768),y=o(18738),e=o(338),d=o(10210),g=o(35053),a=o(7519),B=o(86553);const P=["sectionRef"];function $(m,D){1&m&&(n.\u0275\u0275element(0,"i",18),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&m&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.warnings.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.warnings.aria")))}function w(m,D){1&m&&(n.\u0275\u0275element(0,"i",19),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&m&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.errors.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.errors.aria")))}function S(m,D){1&m&&(n.\u0275\u0275element(0,"i",20),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&m&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.valid.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.valid.aria")))}function M(m,D){1&m&&(n.\u0275\u0275element(0,"i",21),n.\u0275\u0275pipe(1,"translate"),n.\u0275\u0275pipe(2,"translate")),2&m&&(n.\u0275\u0275propertyInterpolate("title",n.\u0275\u0275pipeBind1(1,2,"submission.sections.status.info.title")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind1(2,4,"submission.sections.status.info.aria")))}const K=function(m){return{"text-white":m}};function _(m,D){if(1&m&&n.\u0275\u0275element(0,"span",22),2&m){n.\u0275\u0275nextContext(3);const l=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(1,K,l.isInfo()))}}function L(m,D){1&m&&n.\u0275\u0275element(0,"span",23)}function R(m,D){if(1&m){const l=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"a",24),n.\u0275\u0275listener("click",function(f){return n.\u0275\u0275restoreView(l),n.\u0275\u0275nextContext(3).removeSection(f)}),n.\u0275\u0275element(1,"i",25),n.\u0275\u0275elementEnd()}}const V=function(m){return{sectionHeader:m}};function h(m,D){if(1&m&&(n.\u0275\u0275elementStart(0,"span",8),n.\u0275\u0275text(1),n.\u0275\u0275pipe(2,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(3,"div",9),n.\u0275\u0275template(4,$,3,6,"i",10),n.\u0275\u0275pipe(5,"async"),n.\u0275\u0275template(6,w,3,6,"i",11),n.\u0275\u0275template(7,S,3,6,"i",12),n.\u0275\u0275pipe(8,"async"),n.\u0275\u0275template(9,M,3,6,"i",13),n.\u0275\u0275elementStart(10,"a",14),n.\u0275\u0275pipe(11,"translate"),n.\u0275\u0275pipe(12,"translate"),n.\u0275\u0275pipe(13,"translate"),n.\u0275\u0275template(14,_,1,3,"span",15),n.\u0275\u0275template(15,L,1,0,"span",16),n.\u0275\u0275elementEnd(),n.\u0275\u0275template(16,R,2,0,"a",17),n.\u0275\u0275elementEnd()),2&m){const l=n.\u0275\u0275nextContext(2),v=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(24,K,v.isInfo())),n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(2,11,"submission.sections."+l.sectionData.header)),n.\u0275\u0275advance(3),n.\u0275\u0275property("ngIf",!n.\u0275\u0275pipeBind1(5,13,v.isValid())&&!v.hasErrors()&&!v.isInfo()),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",v.hasErrors()&&!v.isInfo()),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(8,15,v.isValid())&&!v.hasErrors()&&!v.isInfo()),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",v.isInfo()),n.\u0275\u0275advance(1),n.\u0275\u0275property("title",n.\u0275\u0275pipeBind1(13,22,v.isOpen()?"submission.sections.toggle.close":"submission.sections.toggle.open")),n.\u0275\u0275attribute("aria-label",n.\u0275\u0275pipeBind2(11,17,v.isOpen()?"submission.sections.toggle.aria.close":"submission.sections.toggle.aria.open",n.\u0275\u0275pureFunction1(26,V,n.\u0275\u0275pipeBind1(12,20,"submission.sections."+l.sectionData.header)))),n.\u0275\u0275advance(4),n.\u0275\u0275property("ngIf",v.isOpen()),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!v.isOpen()),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngIf",!v.isMandatory())}}function A(m,D){if(1&m){const l=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ds-alert",31),n.\u0275\u0275listener("close",function(){const x=n.\u0275\u0275restoreView(l).index;return n.\u0275\u0275nextContext(4),n.\u0275\u0275reference(1).removeError(x)}),n.\u0275\u0275elementEnd()}if(2&m){const l=D.$implicit,v=n.\u0275\u0275nextContext(4);n.\u0275\u0275property("content",l)("dismissible",!0)("type",v.AlertTypeEnum.Error)}}function p(m,D){if(1&m&&(n.\u0275\u0275elementStart(0,"div",29),n.\u0275\u0275template(1,A,1,3,"ds-alert",30),n.\u0275\u0275elementEnd()),2&m){const l=n.\u0275\u0275nextContext(3),v=n.\u0275\u0275reference(1);n.\u0275\u0275propertyInterpolate1("id","sectionGenericError_",l.sectionData.id,""),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngForOf",v.getErrors())}}function T(m,D){1&m&&n.\u0275\u0275elementContainer(0)}function H(m,D){if(1&m){const l=n.\u0275\u0275getCurrentView();n.\u0275\u0275template(0,p,2,2,"div",26),n.\u0275\u0275elementStart(1,"div",27),n.\u0275\u0275listener("click",function(f){return n.\u0275\u0275restoreView(l),n.\u0275\u0275nextContext(2),n.\u0275\u0275reference(1).setFocus(f)}),n.\u0275\u0275template(2,T,1,0,"ng-container",28),n.\u0275\u0275elementEnd()}if(2&m){const l=n.\u0275\u0275nextContext(2),v=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngIf",v.hasGenericErrors()),n.\u0275\u0275advance(1),n.\u0275\u0275propertyInterpolate1("id","sectionContent_",l.sectionData.id,""),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngComponentOutlet",l.getSectionContent())("ngComponentOutletInjector",l.objectInjector)}}function O(m,D){if(1&m){const l=n.\u0275\u0275getCurrentView();n.\u0275\u0275elementStart(0,"ngb-accordion",3,4),n.\u0275\u0275listener("panelChange",function(f){return n.\u0275\u0275restoreView(l),n.\u0275\u0275nextContext(),n.\u0275\u0275reference(1).sectionChange(f)}),n.\u0275\u0275elementStart(2,"ngb-panel",5),n.\u0275\u0275template(3,h,17,28,"ng-template",6),n.\u0275\u0275template(4,H,3,4,"ng-template",7),n.\u0275\u0275elementEnd()()}if(2&m){const l=n.\u0275\u0275nextContext(),v=n.\u0275\u0275reference(1);n.\u0275\u0275propertyInterpolate("activeIds",l.sectionData.id),n.\u0275\u0275property("destroyOnHide",!1),n.\u0275\u0275advance(2),n.\u0275\u0275propertyInterpolate("id",l.sectionData.id),n.\u0275\u0275property("type",v.isInfo()?"info":"")}}const E=function(m){return{"section-focus":m}};let j=(()=>{class m{constructor(l){this.injector=l,this.AlertTypeEnum=e.N}ngOnInit(){this.objectInjector=n.Injector.create({providers:[{provide:"collectionIdProvider",useFactory:()=>this.collectionId,deps:[]},{provide:"sectionDataProvider",useFactory:()=>this.sectionData,deps:[]},{provide:"submissionIdProvider",useFactory:()=>this.submissionId,deps:[]}],parent:this.injector})}removeSection(l){l.preventDefault(),l.stopPropagation(),this.sectionRef.removeSection(this.submissionId,this.sectionData.id)}getSectionContent(){return(0,y.A)(this.sectionData.sectionType)}}return m.\u0275fac=function(l){return new(l||m)(n.\u0275\u0275directiveInject(n.Injector))},m.\u0275cmp=n.\u0275\u0275defineComponent({type:m,selectors:[["ds-submission-section-container"]],viewQuery:function(l,v){if(1&l&&n.\u0275\u0275viewQuery(P,5),2&l){let f;n.\u0275\u0275queryRefresh(f=n.\u0275\u0275loadQuery())&&(v.sectionRef=f.first)}},inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},decls:4,vars:11,consts:[["dsSection","",3,"ngClass","mandatory","submissionId","sectionType","sectionId"],["sectionRef","sectionRef"],[3,"activeIds","destroyOnHide","panelChange",4,"ngIf"],[3,"activeIds","destroyOnHide","panelChange"],["acc","ngbAccordion"],[3,"id","type"],["ngbPanelTitle",""],["ngbPanelContent",""],["tabindex","0",1,"float-left","section-title",3,"ngClass"],[1,"d-inline-block","float-right"],["class","fas fa-exclamation-circle text-warning mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-exclamation-circle text-danger mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-check-circle text-success mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-info-circle mr-3 text-white","role","img",3,"title",4,"ngIf"],["tabindex","0","role","button",1,"close",3,"title"],["class","fas fa-chevron-up fa-fw",3,"ngClass",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],["href","javascript:void(0);","class","close mr-3",3,"click",4,"ngIf"],["role","img",1,"fas","fa-exclamation-circle","text-warning","mr-3",3,"title"],["role","img",1,"fas","fa-exclamation-circle","text-danger","mr-3",3,"title"],["role","img",1,"fas","fa-check-circle","text-success","mr-3",3,"title"],["role","img",1,"fas","fa-info-circle","mr-3","text-white",3,"title"],[1,"fas","fa-chevron-up","fa-fw",3,"ngClass"],[1,"fas","fa-chevron-down","fa-fw"],["href","javascript:void(0);",1,"close","mr-3",3,"click"],["aria-hidden","true","tabindex","0",1,"fas","fa-trash-o"],[3,"id",4,"ngIf"],[3,"id","click"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"id"],[3,"content","dismissible","type","close",4,"ngFor","ngForOf"],[3,"content","dismissible","type","close"]],template:function(l,v){if(1&l&&(n.\u0275\u0275elementStart(0,"div",0,1),n.\u0275\u0275template(2,O,5,4,"ngb-accordion",2),n.\u0275\u0275pipe(3,"async"),n.\u0275\u0275elementEnd()),2&l){const f=n.\u0275\u0275reference(1);n.\u0275\u0275property("ngClass",n.\u0275\u0275pureFunction1(9,E,f.isSectionActive()))("mandatory",v.sectionData.mandatory)("submissionId",v.submissionId)("sectionType",v.sectionData.sectionType)("sectionId",v.sectionData.id),n.\u0275\u0275attribute("id","section_"+v.sectionData.id),n.\u0275\u0275advance(2),n.\u0275\u0275property("ngIf",n.\u0275\u0275pipeBind1(3,7,f.isEnabled()))}},directives:[C.y,d.mk,d.O5,g.gY,g.Gk,g.Cu,g.gW,d.sg,a.w,d.$G],pipes:[d.Ov,B.X$],styles:["[_nghost-%COMP%]     .card{margin-bottom:var(--ds-submission-sections-margin-bottom);overflow:unset}.section-focus[_ngcontent-%COMP%]{border-radius:var(--bs-border-radius);box-shadow:var(--bs-btn-focus-box-shadow)}[_nghost-%COMP%]     .card:first-of-type{border-bottom:var(--bs-card-border-width) solid var(--bs-card-border-color)!important;border-bottom-left-radius:var(--bs-card-border-radius)!important;border-bottom-right-radius:var(--bs-card-border-radius)!important}[_nghost-%COMP%]     .card-header button{box-shadow:none!important}[_nghost-%COMP%]     .card-header button{width:100%}"]}),m})()},18738:(te,W,o)=>{"use strict";o.d(W,{A:()=>y,E:()=>C});const n=new Map;function C(e){return function(g){!g||n.set(e,g)}}function y(e){return n.get(e)}},52738:(te,W,o)=>{"use strict";o.d(W,{i:()=>n});var n=(()=>{return(C=n||(n={})).Relationships="relationships",C.SubmissionForm="submission-form",C.Upload="upload",C.License="license",C.CcLicense="cclicense",C.collection="collection",C.AccessesCondition="accessCondition",C.SherpaPolicies="sherpaPolicy",n;var C})()},31768:(te,W,o)=>{"use strict";o.d(W,{y:()=>P});var n=o(48358),C=o(61001),e=o(85848),d=o(25839),g=o(66660),a=o(83653),B=o(70074);let P=(()=>{class ${constructor(S,M,K){this.changeDetectorRef=S,this.submissionService=M,this.sectionService=K,this.mandatory=!0,this.genericSectionErrors=[],this.allSectionErrors=[],this.active=!0,this.sectionState=this.mandatory,this.subs=[]}ngOnInit(){this.valid=this.sectionService.isSectionValid(this.submissionId,this.sectionId).pipe((0,n.U)(S=>(S&&this.resetErrors(),S))),this.subs.push(this.sectionService.getShownSectionErrors(this.submissionId,this.sectionId,this.sectionType).subscribe(S=>{(0,d.UE)(S)?S.forEach(M=>{(0,g.Z)(M.path).forEach(_=>{_.fieldId?this.allSectionErrors.push(M.message):this.genericSectionErrors=(0,C.uniq)(this.genericSectionErrors.concat(M.message))})}):this.resetErrors()}),this.submissionService.getActiveSectionId(this.submissionId).subscribe(S=>{const M=this.active;this.active=S===this.sectionId,M!==this.active&&(this.changeDetectorRef.detectChanges(),!this.active&&(0,d.K0)(S)&&this.submissionService.dispatchSave(this.submissionId))})),this.enabled=this.sectionService.isSectionEnabled(this.submissionId,this.sectionId)}ngOnDestroy(){this.subs.filter(S=>(0,d.Uh)(S)).forEach(S=>S.unsubscribe())}sectionChange(S){this.sectionState=S.nextState}isOpen(){return this.sectionState}isMandatory(){return this.mandatory}isSectionActive(){return this.active}isEnabled(){return this.enabled}isValid(){return this.valid}removeSection(S,M){this.sectionService.removeSection(S,M)}hasGenericErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0}hasErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0||this.allSectionErrors&&this.allSectionErrors.length>0}getErrors(){return this.genericSectionErrors}setFocus(S){this.active||this.submissionService.setActiveSection(this.submissionId,this.sectionId)}isInfo(){return this.sectionService.getIsInformational(this.sectionType)}removeError(S){this.genericSectionErrors.splice(S)}resetErrors(){(0,d.UE)(this.genericSectionErrors)&&this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionId),this.genericSectionErrors=[],this.allSectionErrors=[]}}return $.\u0275fac=function(S){return new(S||$)(B.\u0275\u0275directiveInject(B.ChangeDetectorRef),B.\u0275\u0275directiveInject(a.b),B.\u0275\u0275directiveInject(e.J))},$.\u0275dir=B.\u0275\u0275defineDirective({type:$,selectors:[["","dsSection",""]],inputs:{mandatory:"mandatory",sectionId:"sectionId",sectionType:"sectionType",submissionId:"submissionId"},exportAs:["sectionRef"]}),$})()},85848:(te,W,o)=>{"use strict";o.d(W,{J:()=>j});var n=o(53426),C=o(48358),y=o(49887),e=o(69637),d=o(77007),g=o(77176),a=o(61001),P=o(25839),$=o(91219),w=o(36219),S=o(12286),M=o(66660),K=o(78487),_=o(16228),L=o(83653),R=o(52738),V=o(96937),h=o(59492),A=o(86727),p=o(53995),T=o(70074),H=o(40654),O=o(5328),E=o(86553);let j=(()=>{class m{constructor(l,v,f,x,ne,ie){this.formService=l,this.notificationsService=v,this.scrollToService=f,this.submissionService=x,this.store=ne,this.translate=ie}checkSectionErrors(l,v,f,x,ne=[]){if((0,P.xb)(x))this.store.dispatch(new $.QC(l,v)),this.store.dispatch(new K.y5(f));else if(!(0,a.isEqual)(x,ne)){const ie=[];x.forEach(ce=>{(0,M.Z)(ce.path).forEach(oe=>{oe.fieldId&&(this.formService.addError(f,oe.fieldId,oe.fieldIndex,ce.message),ie.push(oe.fieldId))})}),ne.forEach(ce=>{(0,M.Z)(ce.path).forEach(oe=>{oe.fieldId&&(ie.includes(oe.fieldId)||this.formService.removeError(f,oe.fieldId,oe.fieldIndex))})})}}dispatchRemoveSectionErrors(l,v){this.store.dispatch(new $.QC(l,v))}dispatchSetSectionFormId(l,v,f){this.store.dispatch(new $.re(l,v,f))}getSectionData(l,v,f){return this.store.select((0,w.y5)(l,v)).pipe((0,C.U)(x=>f===R.i.SubmissionForm?(0,V.Vv)(x):x),(0,y.x)())}getShownSectionErrors(l,v,f){let x;return x=f!==R.i.SubmissionForm?this.getSectionErrors(l,v):this.getSectionState(l,v,f).pipe((0,e.z)(ne=>this.formService.getFormErrors(ne.formId).pipe((0,C.U)(ie=>{const ce=new p.K("sections",v),me=ie.map(oe=>({path:ce.getPath(oe.fieldId.replace(/\_/g,".")).path,message:oe.message})).filter(oe=>-1===(0,a.findIndex)(ne.errorsToShow,{path:oe.path}));return[...ne.errorsToShow,...me]})))),x}getSectionErrors(l,v){return this.store.select((0,w.Mb)(l,v)).pipe((0,y.x)())}getSectionServerErrors(l,v){return this.store.select((0,w.fh)(l,v)).pipe((0,y.x)())}getSectionState(l,v,f){return this.store.select((0,w.gd)(l,v)).pipe((0,d.h)(x=>(0,P.Uh)(x)),(0,C.U)(x=>x),(0,C.U)(x=>(0,P.Uh)(x.data)&&f===R.i.SubmissionForm?Object.assign({},x,{data:(0,V.Vv)(x.data)}):x),(0,y.x)())}isSectionValid(l,v){return this.store.select((0,w.gd)(l,v)).pipe((0,d.h)(f=>(0,P.Uh)(f)),(0,C.U)(f=>f.isValid),(0,y.x)())}isSectionActive(l,v){return this.submissionService.getActiveSectionId(l).pipe((0,C.U)(f=>v===f),(0,y.x)())}isSectionEnabled(l,v){return this.store.select((0,w.gd)(l,v)).pipe((0,d.h)(f=>(0,P.Uh)(f)),(0,C.U)(f=>f.enabled),(0,y.x)())}isSectionReadOnly(l,v,f){return this.store.select((0,w.gd)(l,v)).pipe((0,d.h)(x=>(0,P.Uh)(x)),(0,C.U)(x=>(0,P.UE)(x.visibility)&&"READONLY"===x.visibility.other&&f!==S.S.WorkspaceItem),(0,y.x)())}isSectionAvailable(l,v){return this.store.select((0,w.ak)(l)).pipe((0,d.h)(f=>(0,P.pT)(f)),(0,C.U)(f=>(0,P.pT)(f.sections)&&(0,P.pT)(f.sections[v])),(0,y.x)())}isSectionTypeAvailable(l,v){return this.store.select((0,w.ak)(l)).pipe((0,d.h)(f=>(0,P.pT)(f)),(0,C.U)(f=>(0,P.pT)(f.sections)&&(0,P.pT)((0,a.findKey)(f.sections,{sectionType:v}))),(0,y.x)())}isSectionType(l,v,f){return this.store.select((0,w.ak)(l)).pipe((0,d.h)(x=>(0,P.pT)(x)),(0,C.U)(x=>(0,P.pT)(x.sections)&&(0,P.pT)(x.sections[v])&&x.sections[v].sectionType===f),(0,y.x)())}addSection(l,v){this.store.dispatch(new $.gn(l,v)),this.scrollToService.scrollTo({target:v,offset:-70})}removeSection(l,v){this.store.dispatch(new $.s0(l,v))}updateSectionData(l,v,f,x=[],ne=[],ie){if((0,P.UE)(f)){const ce=this.isSectionAvailable(l,v),me=this.isSectionEnabled(l,v);(0,n.a)(ce,me).pipe((0,g.q)(1),(0,d.h)(([oe,ye])=>oe)).subscribe(([oe,ye])=>{this.store.dispatch(new $.z6(l,v,f,x,ne,ie))})}}setSectionError(l,v,f){this.store.dispatch(new $.uO(l,v,f))}setSectionStatus(l,v,f){this.store.dispatch(new $.hx(l,v,f))}computeSectionConfiguredMetadata(l){const v=[],f="string"==typeof l?JSON.parse(l,h.WMN):l;return f.rows&&!(0,P.xb)(f.rows)&&f.rows.forEach(x=>{x.fields&&!(0,P.xb)(x.fields)&&x.fields.forEach(ne=>{ne.selectableMetadata&&!(0,P.xb)(ne.selectableMetadata)&&ne.selectableMetadata.forEach(ie=>{v.includes(ie.metadata)||v.push(ie.metadata)})})}),v}getIsInformational(l){return l===R.i.SherpaPolicies}}return m.\u0275fac=function(l){return new(l||m)(T.\u0275\u0275inject(A.o),T.\u0275\u0275inject(_.T),T.\u0275\u0275inject(H.ij),T.\u0275\u0275inject(L.b),T.\u0275\u0275inject(O.yh),T.\u0275\u0275inject(E.sK))},m.\u0275prov=T.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac}),m})()},10685:(te,W,o)=>{"use strict";o.d(W,{o:()=>ds});var n=o(39179),C=o(66004),y=o(70655),e=o(70074),d=o(53426),g=o(48358),a=o(27303),B=o(69637),P=o(77176),$=o(66154),w=o(49887),S=o(77007),M=o(86553),K=o(61001),_=o(24656),L=o(61792),R=o(86727),V=o(9302),h=o(25839);let A=(()=>{class i{constructor(t,r,c){this.injectedCollectionId=t,this.injectedSectionData=r,this.injectedSubmissionId=c,this.collectionId=t,this.sectionData=r,this.submissionId=c}ngOnInit(){this.onSectionInit(),this.updateSectionStatus()}updateSectionStatus(){this.sectionStatusSub=this.getSectionStatus().pipe((0,S.h)(t=>(0,h.pT)(t)),(0,V.O)(!0)).subscribe(t=>{this.sectionService.setSectionStatus(this.submissionId,this.sectionData.id,t)})}ngOnDestroy(){(0,h.Uh)(this.sectionStatusSub)&&this.sectionStatusSub.unsubscribe(),this.onSectionDestroy()}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-section-model"]],decls:0,vars:0,template:function(t,r){},encapsulation:2}),i})();var p=o(47924),T=o(53995);class H{constructor(s=null,t=null){this._path=s,this._value=t}get path(){return this._path}set path(s){this._path=s}get value(){return this._value}set value(s){this._value=s}delete(){this._value=null,this._path=null}isPathEqual(s){return this._path&&(0,K.isEqual)(this._path,s)}}var O=o(18738),E=o(52738),j=o(83653),m=o(42820),D=o(16228),l=o(85848),v=o(92466),f=o(46845),x=o(5496),ne=o(66358),ie=o(50939),ce=o(37958),me=o(8183),oe=o(57017),ye=o(12286),we=o(41527),J=o(10210),Fe=o(76924);const Ve=["formRef"];function X(i,s){1&i&&e.\u0275\u0275element(0,"ds-themed-loading",2)}function pe(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",3,4),e.\u0275\u0275listener("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)})("dfFocus",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onFocus(c)})("remove",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onRemove(c)})("ngbEvent",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onCustomEvent(c)})("removeArrayItem",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onRemove(c)}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("displaySubmit",!1)("displayCancel",!1)}}let F=class extends A{constructor(s,t,r,c,u,I,U,Q,k,b,N,se,z,ee,le){super(z,ee,le),this.cdr=s,this.formBuilderService=t,this.formOperationsService=r,this.formService=c,this.formConfigService=u,this.notificationsService=I,this.sectionService=U,this.submissionService=Q,this.translate=k,this.submissionObjectService=b,this.objectCache=N,this.requestService=se,this.injectedCollectionId=z,this.injectedSectionData=ee,this.injectedSubmissionId=le,this.isUpdating=!1,this.isLoading=!0,this.fieldsOnTheirWayToBeRemoved=new Map,this.formData=Object.create({}),this.previousValue=new H,this.subs=[]}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.sectionService.dispatchSetSectionFormId(this.submissionId,this.sectionData.id,this.formId),this.formConfigService.findByHref(this.sectionData.config).pipe((0,g.U)(s=>s.payload),(0,a.b)(s=>this.formConfig=s),(0,B.z)(()=>(0,d.a)([this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType),this.submissionObjectService.findById(this.submissionId,!0,!1,(0,me.l)("item")).pipe((0,x.xw)(),(0,x.xe)())])),(0,P.q)(1)).subscribe(([s,t])=>{(0,h.o8)(this.formModel)&&(this.submissionObject=t,this.initForm(s),this.sectionData.data=s,this.subscriptions(),this.isLoading=!1,this.cdr.detectChanges())})}onSectionDestroy(){this.subs.filter(s=>(0,h.Uh)(s)).forEach(s=>s.unsubscribe())}getSectionStatus(){const s=this.formService.isValid(this.formId),t=this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,g.U)(r=>(0,h.xb)(r)));return(0,d.a)([s,t]).pipe((0,g.U)(([r,c])=>r&&c))}hasMetadataEnrichment(s){const t={};Object.keys(s).forEach(u=>{this.sectionMetadata&&this.sectionMetadata.includes(u)&&this.inCurrentSubmissionScope(u)&&(t[u]=s[u])});const r=[],c=(0,v.e5)(t,this.formData);return Object.keys(c).forEach(u=>{c[u].forEach(I=>{I.hasOwnProperty("value")&&(0,K.findIndex)(this.formData[u],{value:I.value})<0&&r.push(I)})}),(0,h.UE)(r)}inCurrentSubmissionScope(s){var t,r,c;switch(null===(c=null===(r=null===(t=this.formConfig)||void 0===t?void 0:t.rows.find(I=>{var U,Q,k,b;return(null===(b=null===(k=null===(Q=null===(U=I.fields)||void 0===U?void 0:U[0])||void 0===Q?void 0:Q.selectableMetadata)||void 0===k?void 0:k[0])||void 0===b?void 0:b.metadata)===s}).fields)||void 0===r?void 0:r[0])||void 0===c?void 0:c.scope){case ye.S.WorkspaceItem:return this.submissionObject.type===f.K.type.value;case ye.S.WorkflowItem:return this.submissionObject.type===we.p.type.value;default:return!0}}initForm(s){try{this.formModel=this.formBuilderService.modelFromConfiguration(this.submissionId,this.formConfig,this.collectionId,s,this.submissionService.getSubmissionScope());const t=this.sectionService.computeSectionConfiguredMetadata(this.formConfig);this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,s,this.sectionData.errorsToShow,this.sectionData.serverValidationErrors,t)}catch(t){const c={message:this.translate.instant("error.submission.sections.init-form-error")+t.toString(),path:"/sections/"+this.sectionData.id};console.error(t.stack),this.sectionService.setSectionError(this.submissionId,this.sectionData.id,c)}}updateForm(s,t){(0,h.UE)(s)&&!(0,K.isEqual)(s,this.sectionData.data)?(this.sectionData.data=s,this.hasMetadataEnrichment(s)?(this.isUpdating=!0,this.formModel=null,this.cdr.detectChanges(),this.initForm(s),this.checksForErrors(t),this.isUpdating=!1,this.cdr.detectChanges()):((0,h.UE)(t)||(0,h.UE)(this.sectionData.errorsToShow))&&this.checksForErrors(t)):((0,h.UE)(t)||(0,h.UE)(this.sectionData.errorsToShow))&&this.checksForErrors(t)}checksForErrors(s){this.formService.isFormInitialized(this.formId).pipe((0,$.s)(t=>!0===t&&!this.isUpdating)).subscribe(()=>{this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,s,this.sectionData.errorsToShow),this.sectionData.errorsToShow=s,this.cdr.detectChanges()})}subscriptions(){this.subs.push(this.formService.getFormData(this.formId).pipe((0,w.x)()).subscribe(s=>{this.formData=s}),this.sectionService.getSectionState(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,S.h)(s=>(0,h.UE)(s)&&((0,h.UE)(s.data)||(0,h.UE)(s.errorsToShow))),(0,w.x)()).subscribe(s=>{this.fieldsOnTheirWayToBeRemoved=new Map,this.sectionMetadata=s.metadata,this.updateForm(s.data,s.errorsToShow)}))}onChange(s){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,this.hasStoredValue(this.formBuilderService.getId(s.model),this.formOperationsService.getArrayIndexFromEvent(s)));const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);(-1!==oe.N.submission.autosave.metadata.indexOf(t)&&(0,h.UE)(r)||this.hasRelatedCustomError(t))&&this.submissionService.dispatchSave(this.submissionId)}hasRelatedCustomError(s){const t=(0,K.findIndex)(this.sectionData.errorsToShow,{path:this.pathCombiner.getPath(s).path});if(-1!==t){const c=this.sectionData.errorsToShow[t].message.replace("error.validation.","");return!oe.N.form.validatorMap.hasOwnProperty(c)}return!1}onFocus(s){const t=this.formOperationsService.getFieldValueFromChangeEvent(s),r=this.formBuilderService.getPath(s.model);this.formBuilderService.hasMappedGroupValue(s.model)?(this.previousValue.path=r,this.previousValue.value=this.formOperationsService.getQualdropValueMap(s)):(0,h.UE)(t)&&("object"==typeof t&&(0,h.UE)(t.value)||"string"==typeof t)&&(this.previousValue.path=r,this.previousValue.value=t)}onRemove(s){const t=this.formBuilderService.getId(s.model),r=this.formOperationsService.getArrayIndexFromEvent(s);if(this.fieldsOnTheirWayToBeRemoved.has(t)){const c=this.fieldsOnTheirWayToBeRemoved.get(t);c.push(r),this.fieldsOnTheirWayToBeRemoved.set(t,c)}else this.fieldsOnTheirWayToBeRemoved.set(t,[r]);this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,this.hasStoredValue(t,r))}hasStoredValue(s,t){return!!(0,h.UE)(this.sectionData.data)&&this.sectionData.data.hasOwnProperty(s)&&(0,h.UE)(this.sectionData.data[s][t])&&!this.isFieldToRemove(s,t)}isFieldToRemove(s,t){return this.fieldsOnTheirWayToBeRemoved.has(s)&&this.fieldsOnTheirWayToBeRemoved.get(s).includes(t)}onCustomEvent(s){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,s,this.previousValue,null)}};F.\u0275fac=function(s){return new(s||F)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(m.m),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(p.X),e.\u0275\u0275directiveInject(D.T),e.\u0275\u0275directiveInject(l.J),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(M.sK),e.\u0275\u0275directiveInject(ne.O),e.\u0275\u0275directiveInject(ie.a),e.\u0275\u0275directiveInject(ce.s),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},F.\u0275cmp=e.\u0275\u0275defineComponent({type:F,selectors:[["ds-submission-section-form"]],viewQuery:function(s,t){if(1&s&&e.\u0275\u0275viewQuery(Ve,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:2,consts:[["message","Loading...",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem",4,"ngIf"],["message","Loading..."],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem"],["formRef","formComponent"]],template:function(s,t){1&s&&(e.\u0275\u0275template(0,X,1,0,"ds-themed-loading",0),e.\u0275\u0275template(1,pe,2,4,"ds-form",1)),2&s&&(e.\u0275\u0275property("ngIf",t.isLoading),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.isLoading&&t.formModel))},directives:[J.O5,Fe.Z,L.U],styles:[""]}),F=(0,y.__decorate)([(0,O.E)(E.i.SubmissionForm),(0,y.__metadata)("design:paramtypes",[e.ChangeDetectorRef,_.c,m.m,R.o,p.X,D.T,l.J,j.b,M.sK,ne.O,ie.a,ce.s,String,Object,String])],F);o(31768),o(51769),o(17996),o(25748),o(29959),o(38103);var Ae=o(5328),Y=o(68682),bt=o(34521),Ne=o(14111),_e=o(9237),he=o(21160),Oe=o(9249),Me=o(22040),Pe=o(82921),gt=o(60516),G=o(91219),St=o(66660);function Et(i,s,t){return i?i[s.sections[t].formId]:null}function It(i,s,t,r){if(r||t!==E.i.SubmissionForm)return s;if(!i||!i.touched)return[];const c=[];return s.forEach(u=>{(0,St.Z)(u.path).forEach(U=>{U.fieldId&&i.touched[U.fieldId]&&c.push(u)})}),c}const xt=[(()=>{class i{constructor(t,r,c,u,I,U,Q,k){this.actions$=t,this.notificationsService=r,this.operationsService=c,this.sectionService=u,this.store$=I,this.submissionService=U,this.submissionObjectService=Q,this.translate=k,this.loadForm$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.INIT_SUBMISSION_FORM),(0,g.U)(b=>{const N=b.payload.submissionDefinition,se=[];return N.sections.page.forEach(z=>{const ee=z._links.self.href||z._links.self,le=ee.substr(ee.lastIndexOf("/")+1),de=z._links.config?z._links.config.href||z._links.config:"",re=z.mandatory||(0,h.UE)(b.payload.sections)&&b.payload.sections.hasOwnProperty(le);let ae;ae=z.sectionType!==E.i.SubmissionForm?(0,h.pT)(b.payload.sections)&&(0,h.pT)(b.payload.sections[le])?b.payload.sections[le]:Object.create(null):b.payload.item.metadata;const Te=(0,h.UE)(b.payload.errors)&&b.payload.errors[le]||null;se.push(new G.qK(b.payload.submissionId,le,z.header,de,z.mandatory,z.sectionType,z.visibility,re,ae,Te))}),{action:b,definition:N,mappedActions:se}}),(0,B.z)(b=>(0,Ne.D)(b.mappedActions.concat(new G.p3(b.action.payload.submissionId)))))),this.resetForm$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.RESET_SUBMISSION_FORM),(0,g.U)(b=>new G.Xq(b.payload.collectionId,b.payload.submissionId,b.payload.selfUrl,b.payload.submissionDefinition,b.payload.sections,b.payload.item,null)))),this.saveSubmission$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.SAVE_SUBMISSION_FORM),(0,he.w)(b=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),b.payload.submissionId,"sections").pipe((0,g.U)(N=>new G.Uq(b.payload.submissionId,N,b.payload.isManual,b.payload.isManual)),(0,Oe.K)(()=>(0,_e.of)(new G.ec(b.payload.submissionId))))))),this.saveForLaterSubmission$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.SAVE_FOR_LATER_SUBMISSION_FORM),(0,he.w)(b=>this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),b.payload.submissionId,"sections").pipe((0,g.U)(N=>new G.gA(b.payload.submissionId,N)),(0,Oe.K)(()=>(0,_e.of)(new G.ec(b.payload.submissionId))))))),this.saveSubmissionSuccess$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.SAVE_SUBMISSION_FORM_SUCCESS),(0,Me.M)(this.store$),(0,g.U)(([b,N])=>this.parseSaveResponse(N.submission.objects[b.payload.submissionId],b.payload.submissionObject,b.payload.submissionId,N.forms,b.payload.showNotifications,b.payload.showErrors)),(0,B.z)(b=>(0,Ne.D)(b)))),this.saveSubmissionSectionSuccess$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.SAVE_SUBMISSION_SECTION_FORM_SUCCESS),(0,Me.M)(this.store$),(0,g.U)(([b,N])=>this.parseSaveResponse(N.submission.objects[b.payload.submissionId],b.payload.submissionObject,b.payload.submissionId,N.forms,!1,!1)),(0,B.z)(b=>(0,Ne.D)(b)))),this.saveSection$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.SAVE_SUBMISSION_SECTION_FORM),(0,he.w)(b=>this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),b.payload.submissionId,"sections",b.payload.sectionId).pipe((0,g.U)(N=>new G.hM(b.payload.submissionId,N)),(0,Oe.K)(()=>(0,_e.of)(new G.cT(b.payload.submissionId))))))),this.saveError$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.SAVE_SUBMISSION_FORM_ERROR,G.tI.SAVE_SUBMISSION_SECTION_FORM_ERROR),(0,Me.M)(this.store$),(0,a.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.save_error_notice")))),{dispatch:!1}),this.saveAndDeposit$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.SAVE_AND_DEPOSIT_SUBMISSION),(0,Me.M)(this.submissionService.hasUnsavedModification()),(0,he.w)(([b,N])=>{let se;return se=N?this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),b.payload.submissionId,"sections"):this.submissionObjectService.findById(b.payload.submissionId,!1,!0).pipe((0,x.Gp)(),(0,g.U)(z=>[z])),se.pipe((0,g.U)(z=>this.canDeposit(z)?new G.wn(b.payload.submissionId):(this.notificationsService.warning(null,this.translate.instant("submission.sections.general.cannot_deposit"),null,!0),new G.Uq(b.payload.submissionId,z,!1,!0))),(0,Oe.K)(()=>(0,_e.of)(new G.ec(b.payload.submissionId))))}))),this.depositSubmission$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.DEPOSIT_SUBMISSION),(0,Me.M)(this.store$),(0,he.w)(([b,N])=>this.submissionService.depositSubmission(N.submission.objects[b.payload.submissionId].selfUrl).pipe((0,g.U)(()=>new G.e7(b.payload.submissionId)),(0,Oe.K)(se=>(0,_e.of)(new G.jn(b.payload.submissionId))))))),this.saveForLaterSubmissionSuccess$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.SAVE_FOR_LATER_SUBMISSION_FORM_SUCCESS),(0,a.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice"))),(0,a.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.depositSubmissionSuccess$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.DEPOSIT_SUBMISSION_SUCCESS),(0,a.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.deposit_success_notice"))),(0,a.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.depositSubmissionError$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.DEPOSIT_SUBMISSION_ERROR),(0,a.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.deposit_error_notice")))),{dispatch:!1}),this.discardSubmission$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.DISCARD_SUBMISSION),(0,he.w)(b=>this.submissionService.discardSubmission(b.payload.submissionId).pipe((0,g.U)(()=>new G._w(b.payload.submissionId)),(0,Oe.K)(()=>(0,_e.of)(new G.kj(b.payload.submissionId))))))),this.addAllMetadataToSectionData=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.UPDATE_SECTION_DATA),(0,he.w)(b=>this.sectionService.getSectionState(b.payload.submissionId,b.payload.sectionId,E.i.Upload).pipe((0,g.U)(N=>[b,N]),(0,P.q)(1))),(0,S.h)(([b,N])=>N.sectionType===E.i.SubmissionForm),(0,he.w)(([b,N])=>N.sectionType===E.i.SubmissionForm?this.submissionObjectService.findById(b.payload.submissionId,!0,!1,(0,me.l)("item")).pipe((0,x.Gp)()).pipe((0,he.w)(ee=>ee.item.pipe((0,x.Gp)()))).pipe((0,g.U)(ee=>ee.metadata),(0,S.h)(ee=>!(0,K.isEqual)(b.payload.data,ee)),(0,g.U)(ee=>new G.z6(b.payload.submissionId,b.payload.sectionId,ee,b.payload.errorsToShow,b.payload.serverValidationErrors,b.payload.metadata))):(0,_e.of)(new G.jQ)))),this.discardSubmissionSuccess$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.DISCARD_SUBMISSION_SUCCESS),(0,a.b)(()=>this.notificationsService.success(null,this.translate.get("submission.sections.general.discard_success_notice"))),(0,a.b)(()=>this.submissionService.redirectToMyDSpace())),{dispatch:!1}),this.discardSubmissionError$=(0,Y.GW)(()=>this.actions$.pipe((0,Y.l4)(G.tI.DISCARD_SUBMISSION_ERROR),(0,a.b)(()=>this.notificationsService.error(null,this.translate.get("submission.sections.general.discard_error_notice")))),{dispatch:!1})}canDeposit(t){let r=!0;return(0,h.UE)(t)&&t.forEach(c=>{const{errors:u}=c;u&&!(0,h.xb)(u)&&(r=!1)}),r}parseSaveResponse(t,r,c,u,I=!0,U=!0){const Q=[];return(0,h.UE)(r)&&(I&&this.notificationsService.success(null,this.translate.get("submission.sections.general.save_success_notice")),r.forEach(k=>{var b;let N=Object.create({});const{errors:se}=k;se&&!(0,h.xb)(se)&&(N=(0,gt.Z)(se),I&&this.notificationsService.warning(null,this.translate.get("submission.sections.general.sections_not_valid")));const z=k.sections&&(0,h.UE)(k.sections)?k.sections:{},ee=(0,K.union)(Object.keys(z),Object.keys(N));for(const de of ee){const re=N[de]||[],ae=z[de]||{};if(t.sections[de].sectionType===E.i.Upload&&(0,h.xb)(ae.files)&&!t.sections[de].enabled)continue;I&&!t.sections[de].enabled&&this.submissionService.notifyNewSection(c,de,t.sections[de].sectionType);const Ze=It(Et(u,t,de),re,t.sections[de].sectionType,U);Q.push(new G.z6(c,de,ae,Ze,re))}const le=(0,K.findKey)(t.sections,de=>de.sectionType===E.i.SherpaPolicies);(0,h.pT)(le)&&(0,h.UE)(null===(b=t.sections[le])||void 0===b?void 0:b.data)&&(0,h.xb)(z[le])&&Q.push(new G.z6(c,le,null,[],[]))})),Q}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(Y.eX),e.\u0275\u0275inject(D.T),e.\u0275\u0275inject(Pe.E),e.\u0275\u0275inject(l.J),e.\u0275\u0275inject(Ae.yh),e.\u0275\u0275inject(j.b),e.\u0275\u0275inject(ne.O),e.\u0275\u0275inject(M.sK))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})()];var ze=o(35841),Le=o(36219);let Ue=(()=>{class i{constructor(t){this.store=t}getUploadedFileList(t,r){return this.store.select((0,Le.y8)(t,r)).pipe((0,g.U)(c=>c),(0,w.x)())}getFileData(t,r,c){return this.store.select((0,Le.y8)(t,r)).pipe((0,S.h)(u=>!(0,h.o8)(u)),(0,g.U)(u=>{let I;return Object.keys(u).filter(U=>u[U].uuid===c).forEach(U=>I=u[U]),I}),(0,w.x)())}getDefaultPolicies(t,r,c){return this.store.select((0,Le.G)(t,r,c)).pipe((0,g.U)(u=>u),(0,w.x)())}addUploadedFile(t,r,c,u){this.store.dispatch(new G.l5(t,r,c,u))}updateFileData(t,r,c,u){this.store.dispatch(new G.GM(t,r,c,u))}removeUploadedFile(t,r,c){this.store.dispatch(new G.YU(t,r,c))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(Ae.yh))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})();var Re=o(64508),Ge=o(96652),ke=o(98266),qe=o(81703),Be=o(19339),et=o(49004),je=o(41881),tt=o(8411);let fe=class extends qe.o{constructor(s,t,r,c){super("submissionuploads",s,t,r,c),this.requestService=s,this.rdbService=t,this.objectCache=r,this.halService=c}findByHref(s,t=!0,r=!0,...c){return super.findByHref(s,t,r,...c)}};fe.\u0275fac=function(s){return new(s||fe)(e.\u0275\u0275inject(ce.s),e.\u0275\u0275inject(je.Q),e.\u0275\u0275inject(ie.a),e.\u0275\u0275inject(Be.q))},fe.\u0275prov=e.\u0275\u0275defineInjectable({token:fe,factory:fe.\u0275fac}),fe=(0,y.__decorate)([(0,tt.cQ)(et.fB),(0,y.__metadata)("design:paramtypes",[ce.s,je.Q,ie.a,Be.q])],fe);var Xe=o(338);function yt(i,s){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",2)(2,"div",3)(3,"h3",4)(4,"span",5),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd()),2&i&&(e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,1,"submission.sections.upload.no-file-uploaded")))}const nt=function(i){return{collectionName:i}};function Dt(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,"submission.sections.upload.header.policy.default.nolist",e.\u0275\u0275pureFunction1(4,nt,t.collectionName))," ")}}function Ot(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,"submission.sections.upload.header.policy.default.withlist",e.\u0275\u0275pureFunction1(4,nt,t.collectionName))," ")}}function Tt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",8)(2,"ds-alert",9),e.\u0275\u0275template(3,Dt,3,6,"ng-container",1),e.\u0275\u0275template(4,Ot,3,6,"ng-container",1),e.\u0275\u0275element(5,"span",10)(6,"ds-submission-section-upload-access-conditions",11),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("type",t.AlertTypeEnum.Warning),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",1===t.collectionPolicyType),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",2===t.collectionPolicyType),e.\u0275\u0275advance(2),e.\u0275\u0275property("accessConditions",t.collectionDefaultAccessConditions)}}function Mt(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-submission-upload-section-file",12),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",2)(4,"div",3),e.\u0275\u0275element(5,"hr"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("availableAccessConditionOptions",r.availableAccessConditionOptions)("collectionId",r.collectionId)("collectionPolicyType",r.collectionPolicyType)("configMetadataForm",e.\u0275\u0275pipeBind1(2,9,r.configMetadataForm$))("fileId",r.fileIndexes[r.fileList.indexOf(t)])("fileIndex",r.fileList.indexOf(t))("fileName",r.fileNames[r.fileList.indexOf(t)])("sectionId",r.sectionData.id)("submissionId",r.submissionId)}}function Pt(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Tt,7,4,"div",6),e.\u0275\u0275template(2,Mt,6,11,"ng-container",7),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.collectionDefaultAccessConditions.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.fileList)}}let Se=class extends A{constructor(s,t,r,c,u,I,U,Q,k,b){super(void 0,k,b),this.bitstreamService=s,this.changeDetectorRef=t,this.collectionDataService=r,this.groupService=c,this.resourcePolicyService=u,this.sectionService=I,this.submissionService=U,this.uploadsConfigService=Q,this.injectedSectionData=k,this.injectedSubmissionId=b,this.AlertTypeEnum=Xe.N,this.fileIndexes=[],this.fileList=[],this.fileNames=[],this.collectionDefaultAccessConditions=[],this.required$=new ze.X(!0),this.subs=[]}onSectionInit(){const s=this.uploadsConfigService.findByHref(this.sectionData.config,!0,!1,(0,me.l)("metadata")).pipe((0,x.xw)(),(0,g.U)(t=>t.payload));this.configMetadataForm$=s.pipe((0,he.w)(t=>t.metadata.pipe((0,x.xw)(),(0,g.U)(r=>r.payload)))),this.subs.push(this.submissionService.getSubmissionObject(this.submissionId).pipe((0,S.h)(t=>(0,h.pT)(t)&&!t.isLoading),(0,S.h)(t=>(0,h.o8)(this.collectionId)||this.collectionId!==t.collection),(0,a.b)(t=>this.collectionId=t.collection),(0,B.z)(t=>this.collectionDataService.findById(t.collection)),(0,S.h)(t=>(0,h.pT)(t.payload)),(0,a.b)(t=>this.collectionName=t.payload.name),(0,B.z)(()=>s)).subscribe(t=>{this.required$.next(t.required),this.availableAccessConditionOptions=(0,h.UE)(t.accessConditionOptions)?t.accessConditionOptions:[],this.collectionPolicyType=this.availableAccessConditionOptions.length>0?2:1,this.changeDetectorRef.detectChanges()}),(0,d.a)(this.configMetadataForm$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id)).pipe((0,S.h)(([t,r])=>(0,h.UE)(t)&&(0,h.pT)(r)),(0,w.x)()).subscribe(([t,r])=>{this.fileList=[],this.fileIndexes=[],this.fileNames=[],this.changeDetectorRef.detectChanges(),(0,h.pT)(r)&&r.length>0&&r.forEach(c=>{this.fileList.push(c),this.fileIndexes.push(c.uuid),this.fileNames.push(this.getFileName(t,c))}),this.changeDetectorRef.detectChanges()}))}getFileName(s,t){const r=s.rows[0].fields[0].selectableMetadata[0].metadata;let c;return c=(0,h.UE)(t.metadata)&&(0,h.UE)(t.metadata[r])?t.metadata[r][0].display:t.uuid,c}getSectionStatus(){return(0,d.a)(this.required$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id),(s,t)=>!s||(0,h.pT)(t)&&t.length>0)}onSectionDestroy(){this.subs.filter(s=>(0,h.Uh)(s)).forEach(s=>s.unsubscribe())}};Se.\u0275fac=function(s){return new(s||Se)(e.\u0275\u0275directiveInject(Ue),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Re.W),e.\u0275\u0275directiveInject(Ge.O),e.\u0275\u0275directiveInject(ke.I),e.\u0275\u0275directiveInject(l.J),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(fe),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Se.\u0275cmp=e.\u0275\u0275defineComponent({type:Se,selectors:[["ds-submission-section-upload"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:5,consts:[[3,"content","dismissible","type"],[4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"text-center"],[1,"text-muted"],["class","row",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"col-sm-12"],[3,"type"],[1,"clearfix"],[3,"accessConditions"],[3,"availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]],template:function(s,t){1&s&&(e.\u0275\u0275element(0,"ds-alert",0),e.\u0275\u0275template(1,yt,7,3,"ng-container",1),e.\u0275\u0275template(2,Pt,3,2,"ng-container",1)),2&s&&(e.\u0275\u0275property("content","submission.sections.upload.info")("dismissible",!0)("type",t.AlertTypeEnum.Info),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0==t.fileList.length),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.fileList.length>0))},styles:[""]}),Se=(0,y.__decorate)([(0,O.E)(E.i.Upload),(0,y.__metadata)("design:paramtypes",[Ue,e.ChangeDetectorRef,Re.W,Ge.O,ke.I,l.J,j.b,fe,Object,String])],Se);o(703);var ve=o(26704);const Ft={granted:{element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}}},At=[{id:"granted",label:"submission.sections.license.granted-label",required:!0,value:!1,validators:{required:null},errorMessages:{required:"submission.sections.license.required",notgranted:"submission.sections.license.notgranted"},type:"CHECKBOX"}],Lt=["formRef"];function Rt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",2,3),e.\u0275\u0275listener("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("formLayout",t.formLayout)("displaySubmit",t.displaySubmit)("displayCancel",!1)}}let Ce=class extends A{constructor(s,t,r,c,u,I,U,Q,k,b,N,se){super(b,N,se),this.changeDetectorRef=s,this.collectionDataService=t,this.formBuilderService=r,this.formOperationsService=c,this.formService=u,this.operationsBuilder=I,this.sectionService=U,this.submissionService=Q,this.translateService=k,this.injectedCollectionId=b,this.injectedSectionData=N,this.injectedSubmissionId=se,this.formLayout=Ft,this.displaySubmit=!1,this.subs=[]}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.formModel=this.formBuilderService.fromJSON(At);const s=this.formBuilderService.findById("granted",this.formModel);s.label=this.translateService.instant(s.label),s.value=this.sectionData.data.granted,this.licenseText$=this.collectionDataService.findById(this.collectionId,!0,!0,(0,me.l)("license")).pipe((0,S.h)(t=>(0,h.pT)(t.payload)),(0,B.z)(t=>t.payload.license),(0,$.s)(t=>(0,h.pT)(t.payload)),(0,g.U)(t=>t.payload.text),(0,V.O)("")),this.subs.push(this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope()).pipe((0,P.q)(1),(0,S.h)(t=>t)).subscribe(()=>{s.disabled=!0}),this.sectionService.getSectionErrors(this.submissionId,this.sectionData.id).pipe((0,S.h)(t=>(0,h.UE)(t)),(0,w.x)()).subscribe(t=>{const r=t.map(c=>"/sections/license"===c.path?s.checked?null:Object.assign({},c,{path:"/sections/license/granted"}):c).filter(c=>(0,h.K0)(c));(0,h.UE)(r)?(this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,r),this.sectionData.errors=t):this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id),this.changeDetectorRef.detectChanges()}))}getSectionStatus(){const s=this.formBuilderService.findById("granted",this.formModel);return s.valueChanges.pipe((0,g.U)(t=>!0===t),(0,V.O)(s.value))}onChange(s){const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);r?(this.operationsBuilder.add(this.pathCombiner.getPath(t),r.value.toString(),!1,!0),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)):this.operationsBuilder.remove(this.pathCombiner.getPath(t))}onSectionDestroy(){this.subs.filter(s=>(0,h.Uh)(s)).forEach(s=>s.unsubscribe())}};Ce.\u0275fac=function(s){return new(s||Ce)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Re.W),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(m.m),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(ve.w),e.\u0275\u0275directiveInject(l.J),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(M.sK),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Ce.\u0275cmp=e.\u0275\u0275defineComponent({type:Ce,selectors:[["ds-submission-section-license"]],viewQuery:function(s,t){if(1&s&&e.\u0275\u0275viewQuery(Lt,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:5,vars:4,consts:[[1,"mb-5",3,"innerHTML"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange",4,"ngIf"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange"],["formRef","formComponent"]],template:function(s,t){1&s&&(e.\u0275\u0275element(0,"span",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"br")(3,"br"),e.\u0275\u0275template(4,Rt,2,5,"ds-form",1)),2&s&&(e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind1(1,2,t.licenseText$),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.formModel))},directives:[J.O5,L.U],pipes:[J.Ov],styles:[""]}),Ce=(0,y.__decorate)([(0,O.E)(E.i.License),(0,y.__metadata)("design:paramtypes",[e.ChangeDetectorRef,Re.W,_.c,m.m,R.o,ve.w,l.J,j.b,M.sK,String,Object,String])],Ce);o(3751);var Z=(o(23938),o(59492));const Kt={id:"metadata",group:[]},Wt={element:{container:"form-group",label:"col-form-label"},grid:{label:"col-sm-3"}},wt={id:"accessConditionGroup",group:[]},Vt={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},$t={id:"accessConditions",groupFactory:null},Nt={grid:{group:"form-row pt-4"}},zt={id:"name",label:"submission.sections.upload.form.access-condition-label",hint:"submission.sections.upload.form.access-condition-hint",options:[]},Gt={element:{host:"col-12",label:"col-form-label name-label"}},Xt={id:"startDate",label:"submission.sections.upload.form.from-label",hint:"submission.sections.upload.form.from-hint",placeholder:"submission.sections.upload.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Z.O6Y,operator:Z.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-from"}},Yt={element:{label:"col-form-label"},grid:{host:"col-6"}},Qt={id:"endDate",label:"submission.sections.upload.form.until-label",hint:"submission.sections.upload.form.until-hint",placeholder:"submission.sections.upload.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Z.O6Y,operator:Z.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-until"}},Ht={element:{label:"col-form-label"},grid:{host:"col-6"}};var Ke=o(96099),ge=o(35053);const Jt=["formRef"];function Zt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",6,7),e.\u0275\u0275listener("submitForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onSubmit()})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onModalClose()})("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("displaySubmit",!t.isSaving)("displayCancel",!t.isSaving)}}let Ye=(()=>{class i{constructor(t,r,c,u,I,U,Q,k){this.activeModal=t,this.cdr=r,this.formBuilderService=c,this.formService=u,this.submissionService=I,this.operationsBuilder=U,this.operationsService=Q,this.uploadService=k,this.formMetadata=[],this.isSaving=!1,this.subscriptions=[]}initModelData(t){this.fileData.accessConditions.forEach((r,c)=>{Array.of("name","startDate","endDate").filter(u=>r.hasOwnProperty(u)&&(0,h.UE)(r[u])).forEach(u=>{const I=this.formBuilderService.findById(u,t,c);if(I)if(I.type===Z.VId){const U=new Date(r[u]);I.value={year:U.getUTCFullYear(),month:U.getUTCMonth()+1,day:U.getUTCDate()}}else I.value=r[u]})})}onChange(t){"name"===t.model.id&&this.setOptions(t.model,t.control)}onModalClose(){this.activeModal.dismiss()}onSubmit(){this.isSaving=!0,this.saveBitstreamData()}setOptions(t,r){let c=null;if(this.availableAccessConditionOptions.filter(u=>u.name===r.value).forEach(u=>c=u),(0,h.UE)(c)){const u=r.parent.get("startDate"),I=r.parent.get("endDate");null==u||u.markAsUntouched(),null==I||I.markAsUntouched(),null==u||u.setValue(null),r.parent.markAsDirty(),null==I||I.setValue(null)}}ngOnInit(){this.fileData&&this.formId&&(this.formModel=this.buildFileEditForm(),this.cdr.detectChanges())}ngOnDestroy(){this.unsubscribeAll()}retrieveValueFromField(t){const r=Array.isArray(t)?t[0]:t;return r?r.value:void 0}buildFileEditForm(){const t=Object.assign({},this.configMetadataForm.rows[0].fields[0]);t.repeatable=!1;const r=Object.assign({},this.configMetadataForm,{fields:Object.assign([],this.configMetadataForm.rows[0].fields[0],[this.configMetadataForm.rows[0].fields[0],t])}),c=[],u=Object.assign({},Kt);u.group=this.formBuilderService.modelFromConfiguration(this.submissionId,r,this.collectionId,this.fileData.metadata,this.submissionService.getSubmissionScope()),c.push(new Z.S_O(u,Wt));const I=Object.assign({},zt),U=Object.assign({},$t),Q=[];if(2===this.collectionPolicyType){for(const re of this.availableAccessConditionOptions)Q.push({label:re.name,value:re.name});I.options=Q;const k=[],b=[];let N,se;this.availableAccessConditionOptions.forEach(re=>{if(re.hasStartDate&&(k.push({id:"name",value:re.name}),re.maxStartDate)){const ae=new Date(re.maxStartDate);N={year:ae.getUTCFullYear(),month:ae.getUTCMonth()+1,day:ae.getUTCDate()}}if(re.hasEndDate&&(b.push({id:"name",value:re.name}),re.maxEndDate)){const ae=new Date(re.maxEndDate);se={year:ae.getUTCFullYear(),month:ae.getUTCMonth()+1,day:ae.getUTCDate()}}});const z={relations:[{match:Z.O6Y,operator:Z.F8e,when:k}]},ee={relations:[{match:Z.O6Y,operator:Z.F8e,when:b}]},le=k.length>0,de=b.length>0;U.groupFactory=()=>{const re=new Z.nMt(I,Gt),ae=Object.assign({},Xt,z);N&&(ae.max=N);const Te=Object.assign({},Qt,ee);se&&(Te.max=se);const Ze=new Z.oqv(ae,Yt),ps=new Z.oqv(Te,Ht),We=Object.assign({},wt);return We.group=[re],le&&We.group.push(Ze),de&&We.group.push(ps),[new Z.S_O(We,Vt)]},U.initialCount=(0,h.UE)(this.fileData.accessConditions)?this.fileData.accessConditions.length:1,c.push(new Z.RRz(U,Nt))}return this.initModelData(c),c}saveBitstreamData(){this.formService.validateAllFormFields(this.formRef.formGroup);const t=this.formService.isValid(this.formId).pipe((0,P.q)(1),(0,S.h)(r=>r),(0,B.z)(()=>this.formService.getFormData(this.formId)),(0,P.q)(1),(0,B.z)(r=>{Object.keys(r.metadata).filter(u=>(0,h.UE)(r.metadata[u])).forEach(u=>{const U=`metadata/${u.replace(/_/g,".")}`;this.operationsBuilder.add(this.pathCombiner.getPath(U),r.metadata[u],!0)}),Object.keys(this.fileData.metadata).filter(u=>(0,h.UE)(this.fileData.metadata[u])).filter(u=>(0,h.xI)(r.metadata[u])).filter(u=>this.formMetadata.includes(u)).forEach(u=>{const U=`metadata/${u.replace(/_/g,".")}`;this.operationsBuilder.remove(this.pathCombiner.getPath(U))});const c=[];return r.accessConditions.map(u=>u.accessConditionGroup).filter(u=>(0,h.UE)(u)).forEach(u=>{let I;if(this.availableAccessConditionOptions.filter(U=>(0,h.K0)(u.name)&&U.name===u.name[0].value).forEach(U=>I=U),I){const U=Object.assign({},u);if(U.name=this.retrieveValueFromField(u.name),I.hasStartDate){if(u.startDate){const Q=this.retrieveValueFromField(u.startDate);U.startDate=(0,Ke.iV)(Q)}}else delete U.startDate;if(I.hasEndDate){if(u.endDate){const Q=this.retrieveValueFromField(u.endDate);U.endDate=(0,Ke.iV)(Q)}}else delete U.endDate;c.push(U)}}),(0,h.UE)(c)&&this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),c,!0),this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement)})).subscribe(r=>{if(r[0].sections[this.sectionId]){const c=r[0].sections[this.sectionId];Object.keys(c.files).filter(u=>c.files[u].uuid===this.fileId).forEach(u=>this.uploadService.updateFileData(this.submissionId,this.sectionId,this.fileId,c.files[u]))}this.isSaving=!1,this.activeModal.close()});this.subscriptions.push(t)}unsubscribeAll(){this.subscriptions.filter(t=>(0,h.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(ge.Kz),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(ve.w),e.\u0275\u0275directiveInject(Pe.E),e.\u0275\u0275directiveInject(Ue))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-submission-section-upload-file-edit"]],viewQuery:function(t,r){if(1&t&&e.\u0275\u0275viewQuery(Jt,5),2&t){let c;e.\u0275\u0275queryRefresh(c=e.\u0275\u0275loadQuery())&&(r.formRef=c.first)}},decls:10,vars:5,consts:[[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"disabled","click"],["aria-hidden","true"],[1,"modal-body"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange"],["formRef","formComponent"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div")(1,"div",0)(2,"h4",1),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"button",2),e.\u0275\u0275listener("click",function(){return r.onModalClose()}),e.\u0275\u0275elementStart(6,"span",3),e.\u0275\u0275text(7,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(8,"div",4),e.\u0275\u0275template(9,Zt,2,4,"ds-form",5),e.\u0275\u0275elementEnd()()),2&t&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.upload.edit.title")),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",r.isSaving),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",r.formModel))},directives:[J.O5,L.U],pipes:[M.X$],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),i})();var kt=o(87844),qt=o(7553),en=o(91689),Qe=o(59874);function tn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span",3),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate3(" ",t.name," ",t.startDate," ",t.endDate," ")}}function nn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span",3),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.name," from ",t.endDate,"")}}function sn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.name," until ",t.startDate,"")}}function on(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,tn,2,3,"span",1),e.\u0275\u0275template(2,nn,2,2,"span",1),e.\u0275\u0275template(3,sn,2,2,"span",2),e.\u0275\u0275element(4,"br"),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","DEFAULT_BITSTREAM_READ"==t.action),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","lease"==t.name),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","embargo"==t.name)}}let He=(()=>{class i{constructor(t){this.groupService=t,this.accessConditionsList=[]}ngOnInit(){this.accessConditions.forEach(t=>{(0,h.xb)(t.name)?this.groupService.findByHref(t._links.group.href).pipe((0,$.s)(r=>!r.isResponsePending&&r.hasSucceeded)).subscribe(r=>{const c=r.payload,u=Object.assign({},t);u.name=c.name,this.accessConditionsList.push(u)}):this.accessConditionsList.push(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(Ge.O))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-submission-section-upload-access-conditions"]],inputs:{accessConditions:"accessConditions"},decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["class","badge badge-primary mt-3 mr-2",4,"ngIf"],["class","badge badge-dark mt-3 mr-2",4,"ngIf"],[1,"badge","badge-primary","mt-3","mr-2"],[1,"badge","badge-dark","mt-3","mr-2"]],template:function(t,r){1&t&&e.\u0275\u0275template(0,on,5,3,"ng-container",0),2&t&&e.\u0275\u0275property("ngForOf",r.accessConditionsList)},directives:[J.sg,J.O5],encapsulation:2}),i})();var an=o(83073);function rn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.value," ")}}function cn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"h5")(1,"span",4),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2("",e.\u0275\u0275pipeBind1(3,2,"submission.sections.upload.no-entry")," ",t.fileTitleKey,"")}}function ln(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,cn,4,4,"h5",0),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===r.metadata[r.fileTitleKey].indexOf(t))}}function dn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,rn,3,1,"ng-container",0),e.\u0275\u0275template(2,ln,2,1,"ng-container",0),e.\u0275\u0275element(3,"span",1),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""!==t.value),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""===t.value)}}const pn=function(){return["150"]};function mn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"dsTruncate"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(2,1,t.value,e.\u0275\u0275pureFunction0(4,pn))," ")}}function un(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span",4),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",e.\u0275\u0275pipeBind1(2,2,"submission.sections.upload.no-entry")," ",t.fileDescrKey,"")}}function _n(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,un,3,4,"span",5),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===r.metadata[r.fileDescrKey].indexOf(t))}}function hn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,mn,3,5,"ng-container",0),e.\u0275\u0275template(2,_n,2,1,"ng-container",0),e.\u0275\u0275element(3,"span",1),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""!==t.value),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",""===t.value)}}function fn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,dn,4,2,"ng-container",3),e.\u0275\u0275template(2,hn,4,2,"ng-container",3),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getAllMetadataValue(t.fileTitleKey)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getAllMetadataValue(t.fileDescrKey))}}let st=(()=>{class i{constructor(){this.metadata=Object.create({}),this.fileTitleKey="Title",this.fileDescrKey="Description"}ngOnInit(){(0,h.UE)(this.fileData.metadata)&&(this.metadata[this.fileTitleKey]=Qe.S.all(this.fileData.metadata,"dc.title"),this.metadata[this.fileDescrKey]=Qe.S.all(this.fileData.metadata,"dc.description"))}getAllMetadataValue(t){return Qe.S.all(this.metadata,t)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-submission-section-upload-file-view"]],inputs:{fileData:"fileData"},decls:4,vars:2,consts:[[4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[4,"ngFor","ngForOf"],[1,"text-muted"],["class","text-muted",4,"ngIf"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,fn,3,2,"ng-container",0),e.\u0275\u0275element(2,"span",1)(3,"ds-submission-section-upload-access-conditions",2),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",r.metadata),e.\u0275\u0275advance(2),e.\u0275\u0275property("accessConditions",r.fileData.accessConditions))},directives:[J.O5,J.sg,He],pipes:[M.X$,an.W],encapsulation:2}),i})();var vn=o(69748);function bn(i,s){1&i&&e.\u0275\u0275element(0,"i",18)}function gn(i,s){1&i&&e.\u0275\u0275element(0,"i",19)}function Sn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",2)(2,"div",3),e.\u0275\u0275element(3,"ds-thumbnail",4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",5)(5,"div",6)(6,"h3"),e.\u0275\u0275text(7),e.\u0275\u0275elementStart(8,"span",7),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"dsFileSize"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(11,"div",8),e.\u0275\u0275elementContainerStart(12),e.\u0275\u0275elementStart(13,"ds-file-download-link",9),e.\u0275\u0275element(14,"i",10),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"button",11),e.\u0275\u0275listener("click",function(c){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext();return c.preventDefault(),u.editBitstreamData()}),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275element(18,"i",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"button",13),e.\u0275\u0275listener("click",function(c){e.\u0275\u0275restoreView(t);const u=e.\u0275\u0275nextContext(),I=e.\u0275\u0275reference(2);return c.preventDefault(),u.confirmDelete(I)}),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275template(23,bn,1,0,"i",14),e.\u0275\u0275pipe(24,"async"),e.\u0275\u0275template(25,gn,1,0,"i",15),e.\u0275\u0275pipe(26,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(27,"div",16)(28,"ds-submission-section-upload-file-view",17),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("thumbnail",null==t.fileData?null:t.fileData.thumbnail),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",t.fileName," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("(",e.\u0275\u0275pipeBind1(10,15,null==t.fileData?null:t.fileData.sizeBytes),")"),e.\u0275\u0275advance(4),e.\u0275\u0275property("cssClasses","btn btn-link-focus")("isBlank",!0)("bitstream",t.getBitstream())("enableRequestACopy",!1),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(17,19,"submission.sections.upload.edit.title")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(16,17,"submission.sections.upload.edit.title")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(21,23,"submission.sections.upload.delete.confirm.title")),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(22,25,t.processingDelete$)),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(20,21,"submission.sections.upload.delete.confirm.title")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(24,27,t.processingDelete$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(26,29,t.processingDelete$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("fileData",t.fileData)}}function Cn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",20)(1,"h4",21),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",22),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t).dismiss("cancel")}),e.\u0275\u0275elementStart(5,"span",23),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",24)(8,"p"),e.\u0275\u0275text(9),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(11,"div",25)(12,"button",26),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t).close("cancel")}),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"button",27),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t).close("ok")}),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,4,"submission.sections.upload.delete.confirm.title")),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(10,6,"submission.sections.upload.delete.confirm.info")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,8,"submission.sections.upload.delete.confirm.cancel")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,10,"submission.sections.upload.delete.confirm.submit")))}let ot=(()=>{class i{constructor(t,r,c,u,I,U,Q,k){this.cdr=t,this.formService=r,this.halService=c,this.modalService=u,this.operationsBuilder=I,this.operationsService=U,this.submissionService=Q,this.uploadService=k,this.processingDelete$=new ze.X(!1),this.subscriptions=[],this.formMetadata=[],this.readMode=!0}ngOnChanges(){this.availableAccessConditionOptions&&this.subscriptions.push(this.uploadService.getFileData(this.submissionId,this.sectionId,this.fileId).pipe((0,S.h)(t=>(0,h.pT)(t))).subscribe(t=>{this.fileData=t}))}ngOnInit(){this.formId=this.formService.getUniqueId(this.fileId),this.pathCombiner=new T.K("sections",this.sectionId,"files",this.fileIndex),this.loadFormMetadata()}confirmDelete(t){this.modalService.open(t).result.then(r=>{"ok"===r&&(this.processingDelete$.next(!0),this.deleteFile())})}getBitstream(){return Object.assign(new kt.Z,{uuid:this.fileData.uuid})}editBitstreamData(){const r=this.modalService.open(Ye,{size:"xl",backdrop:"static"});r.componentInstance.availableAccessConditionOptions=this.availableAccessConditionOptions,r.componentInstance.collectionId=this.collectionId,r.componentInstance.collectionPolicyType=this.collectionPolicyType,r.componentInstance.configMetadataForm=this.configMetadataForm,r.componentInstance.fileData=this.fileData,r.componentInstance.fileId=this.fileId,r.componentInstance.fileIndex=this.fileIndex,r.componentInstance.formId=this.formId,r.componentInstance.sectionId=this.sectionId,r.componentInstance.formMetadata=this.formMetadata,r.componentInstance.pathCombiner=this.pathCombiner,r.componentInstance.submissionId=this.submissionId}ngOnDestroy(){this.unsubscribeAll()}unsubscribeAll(){this.subscriptions.filter(t=>(0,h.Uh)(t)).forEach(t=>t.unsubscribe())}loadFormMetadata(){this.configMetadataForm.rows.forEach(t=>{t.fields.forEach(r=>{r.selectableMetadata.forEach(c=>{this.formMetadata.push(c.metadata)})})})}deleteFile(){this.operationsBuilder.remove(this.pathCombiner.getPath()),this.subscriptions.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement).subscribe(()=>{this.uploadService.removeUploadedFile(this.submissionId,this.sectionId,this.fileId),this.processingDelete$.next(!1)}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(Be.q),e.\u0275\u0275directiveInject(ge.FF),e.\u0275\u0275directiveInject(ve.w),e.\u0275\u0275directiveInject(Pe.E),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject(Ue))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-submission-upload-section-file"]],viewQuery:function(t,r){if(1&t&&e.\u0275\u0275viewQuery(Ye,5),2&t){let c;e.\u0275\u0275queryRefresh(c=e.\u0275\u0275loadQuery())&&(r.fileEditComp=c.first)}},inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},features:[e.\u0275\u0275NgOnChangesFeature],decls:3,vars:1,consts:[[4,"ngIf"],["content",""],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"float-left","w-75"],[1,"text-muted"],[1,"float-right","w-15"],[3,"cssClasses","isBlank","bitstream","enableRequestACopy"],["aria-hidden","true",1,"fa","fa-download","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","click"],[1,"fa","fa-edit","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"title","disabled","click"],["class","fas fa-circle-notch fa-spin fa-2x text-danger",4,"ngIf"],["class","fa fa-trash fa-2x text-danger",4,"ngIf"],[1,"clearfix"],[3,"fileData"],[1,"fas","fa-circle-notch","fa-spin","fa-2x","text-danger"],[1,"fa","fa-trash","fa-2x","text-danger"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(t,r){1&t&&(e.\u0275\u0275template(0,Sn,29,31,"ng-container",0),e.\u0275\u0275template(1,Cn,18,12,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)),2&t&&e.\u0275\u0275property("ngIf",r.fileData)},directives:[J.O5,qt.Z,en.q,st],pipes:[vn.p,M.X$,J.Ov],styles:[""]}),i})();o(26098);var In=o(39397),at=(o(51063),o(76202),o(54877),o(54475),o(97100)),rt=o(74299),Tn=o(31084),ct=o(41633);function Mn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"ds-themed-loading"),e.\u0275\u0275elementEnd())}function Pn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.getSelectedCcLicense().name," ")}}function Un(i,s){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.change")," "))}function Bn(i,s){1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.select")," "))}function Fn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275template(1,Un,3,3,"ng-container",3),e.\u0275\u0275template(2,Bn,3,3,"ng-container",3),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.storedCcLicenseLink),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.storedCcLicenseLink)}}function An(i,s){1&i&&(e.\u0275\u0275elementStart(0,"button",7),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.none")," "))}function Ln(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){const u=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext().selectCcLicense(u)}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Rn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",10)(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"div",20),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.label," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("innerHTML",t.description,e.\u0275\u0275sanitizeHtml)}}function jn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"div",15)(2,"div")(3,"h4"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"div",16),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).closeInfoModal()}),e.\u0275\u0275elementStart(7,"span",18),e.\u0275\u0275text(8,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div",19),e.\u0275\u0275template(10,Rn,4,2,"div",9),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.label," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("innerHTML",t.description,e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t.enums)}}function Kn(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.label," ")}}function Wn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"submission.sections.ccLicense.option.select")," "))}function wn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0,2),e.\u0275\u0275template(1,Kn,2,1,"span",3),e.\u0275\u0275template(2,Wn,3,3,"span",3),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t)}}function Vn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){const u=e.\u0275\u0275restoreView(t).$implicit,I=e.\u0275\u0275nextContext(2).$implicit,U=e.\u0275\u0275nextContext(2);return U.selectOption(U.getSelectedCcLicense(),I,u)}),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()}if(2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.label," ")}}function $n(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-select"),e.\u0275\u0275template(1,wn,3,2,"ng-container",21),e.\u0275\u0275elementContainerStart(2,4),e.\u0275\u0275elementStart(3,"div",22),e.\u0275\u0275template(4,Vn,2,1,"button",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",r.getSelectedOption(r.getSelectedCcLicense(),t)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.enums)}}function Nn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",24)(1,"div",25),e.\u0275\u0275listener("click",function(){const u=e.\u0275\u0275restoreView(t).$implicit,I=e.\u0275\u0275nextContext(2).$implicit,U=e.\u0275\u0275nextContext(2);return U.selectOption(U.getSelectedCcLicense(),I,u)}),e.\u0275\u0275element(2,"input",26),e.\u0275\u0275elementStart(3,"span"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()()}if(2&i){const t=s.$implicit,r=e.\u0275\u0275nextContext(2).$implicit,c=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",t.label),e.\u0275\u0275property("checked",c.isSelectedOption(c.getSelectedCcLicense(),r,t)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.label)}}function zn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Nn,5,3,"div",23),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.enums)}}function Gn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"div",11)(2,"div"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const c=e.\u0275\u0275reference(7);return e.\u0275\u0275nextContext(2).openInfoModal(c)}),e.\u0275\u0275element(5,"i",13),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(6,jn,11,3,"ng-template",null,14,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(8,$n,5,2,"ds-select",3),e.\u0275\u0275template(9,zn,2,1,"ng-container",3),e.\u0275\u0275elementEnd()}if(2&i){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("font-weight-bold ",t.id,""),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.label," "),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",(null==t.enums?null:t.enums.length)>5),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==t.enums?null:t.enums.length)<=5)}}function Xn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Gn,10,6,"div",9),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.getSelectedCcLicense().fields)}}function Yn(i,s){1&i&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275element(1,"ds-themed-loading"),e.\u0275\u0275elementEnd())}function Qn(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",29)(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"a",30),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",31)(7,"div",25),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const c=e.\u0275\u0275nextContext(3);return c.setAccepted(!c.accepted)}),e.\u0275\u0275element(8,"input",32),e.\u0275\u0275elementStart(9,"span"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext().ngVar,r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,5,"submission.sections.ccLicense.link")," "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("href",t,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",r.accepted),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,7,"submission.sections.ccLicense.confirmation"))}}function Hn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Yn,2,0,"div",3),e.\u0275\u0275template(2,Qn,12,9,"div",28),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}function Jn(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Hn,3,2,"ng-container",27),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t.getCcLicenseLink$()))}}let Ee=class extends A{constructor(s,t,r,c,u,I,U,Q){super(I,U,Q),this.modalService=s,this.sectionService=t,this.submissionCcLicensesDataService=r,this.submissionCcLicenseUrlDataService=c,this.operationsBuilder=u,this.injectedCollectionId=I,this.injectedSectionData=U,this.injectedSubmissionId=Q,this.isLoading=!0,this.subscriptions=[]}get storedCcLicenseLink(){return this.data.uri}get accepted(){return void 0===this.data.accepted?!!this.data.uri:this.data.accepted}get data(){return this.sectionData.data}selectCcLicense(s){this.getSelectedCcLicense()&&this.getSelectedCcLicense().id===s.id||(this.setAccepted(!1),this.updateSectionData({ccLicense:{id:s.id,fields:{}},uri:void 0}))}getSelectedCcLicense(){return this.submissionCcLicenses&&this.data.ccLicense?this.submissionCcLicenses.filter(s=>s.id===this.data.ccLicense.id)[0]:null}selectOption(s,t,r){this.isSelectedOption(s,t,r)||this.updateSectionData({ccLicense:{id:s.id,fields:Object.assign({},this.data.ccLicense.fields,{[t.id]:r})},accepted:!1})}getSelectedOption(s,t){return this.data.ccLicense.fields[t.id]}isSelectedOption(s,t,r){return this.getSelectedOption(s,t)&&this.getSelectedOption(s,t).id===r.id}getCcLicenseLink$(){if(this.storedCcLicenseLink)return(0,_e.of)(this.storedCcLicenseLink);if(!this.getSelectedCcLicense()||this.getSelectedCcLicense().fields.some(t=>!this.getSelectedOption(this.getSelectedCcLicense(),t)))return;const s=this.getSelectedCcLicense();return this.submissionCcLicenseUrlDataService.getCcLicenseLink(s,new Map(s.fields.map(t=>[t,this.getSelectedOption(s,t)])))}openInfoModal(s){this.modalRef=this.modalService.open(s)}closeInfoModal(){this.modalRef.close()}getSectionStatus(){return(0,_e.of)(this.accepted)}onSectionDestroy(){this.subscriptions.forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.subscriptions.push(this.sectionService.getSectionState(this.submissionId,this.sectionData.id,E.i.CcLicense).pipe((0,S.h)(s=>(0,h.UE)(s)&&((0,h.UE)(s.data)||(0,h.UE)(s.errorsToShow))),(0,w.x)(),(0,g.U)(s=>s.data)).subscribe(s=>{if(this.data.accepted!==s.accepted){const t=this.pathCombiner.getPath("uri");s.accepted?this.getCcLicenseLink$().pipe((0,P.q)(1)).subscribe(r=>{this.operationsBuilder.add(t,r.toString(),!1,!0)}):this.data.uri&&this.operationsBuilder.remove(t)}this.sectionData.data=s}),this.submissionCcLicensesDataService.findAll({elementsPerPage:9999}).pipe((0,x.xw)(),(0,x.xe)(),(0,g.U)(s=>s.page)).subscribe(s=>this.submissionCcLicenses=s))}setAccepted(s){this.updateSectionData({accepted:s}),this.updateSectionStatus()}updateSectionData(s){this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,Object.assign({},this.data,s))}};Ee.\u0275fac=function(s){return new(s||Ee)(e.\u0275\u0275directiveInject(ge.FF),e.\u0275\u0275directiveInject(l.J),e.\u0275\u0275directiveInject(at.I),e.\u0275\u0275directiveInject(rt.K),e.\u0275\u0275directiveInject(ve.w),e.\u0275\u0275directiveInject("collectionIdProvider"),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Ee.\u0275cmp=e.\u0275\u0275defineComponent({type:Ee,selectors:[["ds-submission-section-cc-licenses"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:11,vars:8,consts:[[1,"mb-4","ccLicense-select"],[3,"disabled"],[1,"selection"],[4,"ngIf"],[1,"menu"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"d-flex","flex-row"],[1,"btn","btn-outline-info","btn-sm","ml-2",3,"click"],[1,"fas","fa-question"],["infoModal",""],[1,"modal-header","mb-4"],[3,"innerHTML"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"font-weight-light",3,"innerHTML"],["class","selection",4,"ngVar"],[1,"options-select-menu","overflow-auto"],["class","d-flex flex-row m-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","m-1"],[3,"click"],["type","radio",1,"mr-1",3,"title","checked"],[4,"ngVar"],["class","mt-2 p-4 bg-light text-dark",4,"ngIf"],[1,"mt-2","p-4","bg-light","text-dark"],["target","_blank","rel","noopener noreferrer",1,"license-link",3,"href"],[1,"m-2"],["type","checkbox","title","accepted",3,"checked"]],template:function(s,t){1&s&&(e.\u0275\u0275elementStart(0,"div",0)(1,"ds-select",1),e.\u0275\u0275elementContainerStart(2,2),e.\u0275\u0275template(3,Mn,2,0,"span",3),e.\u0275\u0275template(4,Pn,2,1,"span",3),e.\u0275\u0275template(5,Fn,3,2,"span",3),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementContainerStart(6,4),e.\u0275\u0275template(7,An,3,3,"button",5),e.\u0275\u0275template(8,Ln,2,1,"button",6),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(9,Xn,2,1,"ng-container",3),e.\u0275\u0275template(10,Jn,3,3,"ng-container",3)),2&s&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!t.submissionCcLicenses),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!t.submissionCcLicenses),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.getSelectedCcLicense()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.submissionCcLicenses&&!t.getSelectedCcLicense()),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==t.submissionCcLicenses?null:t.submissionCcLicenses.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.submissionCcLicenses),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.getSelectedCcLicense()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.getCcLicenseLink$()))},directives:[Tn.N,J.O5,Fe.Z,J.sg,ct.g],pipes:[M.X$,J.Ov],styles:[".options-select-menu[_ngcontent-%COMP%]{max-height:25vh}"]}),Ee=(0,y.__decorate)([(0,O.E)(E.i.CcLicense),(0,y.__metadata)("design:paramtypes",[ge.FF,l.J,at.I,rt.K,ve.w,String,Object,String])],Ee);var Zn=o(30504),kn=o(42245),ni=(o(14530),o(68457),o(22992),o(48197));let Je=(()=>{class i{constructor(t){this.store=t}getAccessesData(t,r){return this.store.select((0,Le.y5)(t,r)).pipe((0,S.h)(c=>(0,h.pT)(c)),(0,w.x)())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(Ae.yh))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})();const ii={id:"discoverable",name:"discoverable"},si={element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}},oi={id:"accessConditionGroup",group:[]},ai={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},ri={id:"accessCondition",groupFactory:null},ci={grid:{group:"form-row pt-4"}},lt={id:"name",label:"submission.sections.accesses.form.access-condition-label",hint:"submission.sections.accesses.form.access-condition-hint",options:[]},li={element:{host:"col-12",label:"col-form-label name-label"}},di={id:"startDate",label:"submission.sections.accesses.form.from-label",hint:"submission.sections.accesses.form.from-hint",placeholder:"submission.sections.accesses.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Z.O6Y,operator:Z.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-from"}},pi={element:{label:"col-form-label"},grid:{host:"col-6"}},mi={id:"endDate",label:"submission.sections.accesses.form.until-label",hint:"submission.sections.accesses.form.until-hint",placeholder:"submission.sections.accesses.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:Z.O6Y,operator:Z.F8e,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-until"}},ui={element:{label:"col-form-label"},grid:{host:"col-6"}};let be=class extends qe.o{constructor(s,t,r,c){super("submissionaccessoptions",s,t,r,c),this.requestService=s,this.rdbService=t,this.objectCache=r,this.halService=c}findByHref(s,t=!0,r=!0,...c){return super.findByHref(s,t,r,...c)}};be.\u0275fac=function(s){return new(s||be)(e.\u0275\u0275inject(ce.s),e.\u0275\u0275inject(je.Q),e.\u0275\u0275inject(ie.a),e.\u0275\u0275inject(Be.q))},be.\u0275prov=e.\u0275\u0275defineInjectable({token:be,factory:be.\u0275fac}),be=(0,y.__decorate)([(0,tt.cQ)(et.MX),(0,y.__metadata)("design:paramtypes",[ce.s,je.Q,ie.a,Be.q])],be);const _i=["formRef"];function hi(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",1,2),e.\u0275\u0275listener("dfChange",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(c)})("removeArrayItem",function(c){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onRemove(c)}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",t.formId)("formModel",t.formModel)("displaySubmit",!1)("displayCancel",!1)}}let Ie=class extends A{constructor(s,t,r,c,u,I,U,Q,k,b,N){super(void 0,b,N),this.sectionService=s,this.formBuilderService=t,this.accessesConfigService=r,this.accessesService=c,this.formOperationsService=u,this.operationsBuilder=I,this.formService=U,this.translate=Q,this.operationsService=k,this.injectedSectionData=b,this.injectedSubmissionId=N,this.subs=[]}initModelData(s){this.accessesData.accessConditions.forEach((t,r)=>{Array.of("name","startDate","endDate").filter(c=>t.hasOwnProperty(c)&&(0,h.UE)(t[c])).forEach(c=>{const u=this.formBuilderService.findById(c,s,r);if(u)if(u.type===Z.VId){const I=new Date(t[c]);u.value={year:I.getUTCFullYear(),month:I.getUTCMonth()+1,day:I.getUTCDate()}}else u.value=t[c]})})}onChange(s){if(s.model.type===Z.fSU){const t=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(s),r=this.formOperationsService.getFieldValueFromChangeEvent(s);this.operationsBuilder.replace(this.pathCombiner.getPath(t),r.value,!0)}else{if(s.model.id===lt.id){const t=s.control.parent.get("startDate"),r=s.control.parent.get("endDate");null==t||t.markAsUntouched(),null==r||r.markAsUntouched(),null==t||t.setValue(null),null==r||r.setValue(null),s.control.parent.markAsDirty()}this.formService.validateAllFormFields(this.formRef.formGroup),this.formService.isValid(this.formId).pipe((0,P.q)(1),(0,S.h)(t=>t),(0,B.z)(()=>this.formService.getFormData(this.formId)),(0,P.q)(1)).subscribe(t=>{const r=[];t.accessCondition.map(c=>c.accessConditionGroup).filter(c=>(0,h.UE)(c)).forEach(c=>{let u;if(this.availableAccessConditionOptions.filter(I=>(0,h.K0)(c.name)&&I.name===c.name[0].value).forEach(I=>u=I),u){const I=Object.assign({},c);if(I.name=this.retrieveValueFromField(c.name),u.hasStartDate){if(c.startDate){const U=this.retrieveValueFromField(c.startDate);I.startDate=(0,Ke.iV)(U)}}else delete I.startDate;if(u.hasEndDate){if(c.endDate){const U=this.retrieveValueFromField(c.endDate);I.endDate=(0,Ke.iV)(U)}}else delete I.endDate;r.push(I)}}),this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),r,!0)})}}onRemove(s){const t=this.formOperationsService.getArrayIndexFromEvent(s);this.operationsBuilder.remove(this.pathCombiner.getPath("accessConditions/"+t))}onSectionDestroy(){this.subs.filter(s=>(0,h.Uh)(s)).forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id);const s=this.accessesConfigService.findByHref(this.sectionData.config,!0,!1).pipe((0,x.xw)(),(0,g.U)(r=>r.payload)),t=this.accessesService.getAccessesData(this.submissionId,this.sectionData.id);(0,d.a)([s,t]).subscribe(([r,c])=>{this.availableAccessConditionOptions=(0,h.UE)(r.accessConditionOptions)?r.accessConditionOptions:[],this.canChangeDiscoverable=!!r.canChangeDiscoverable,this.accessesData=c,this.formModel=this.buildFileEditForm()})}getSectionStatus(){return(0,_e.of)(!0)}buildFileEditForm(){const s=[];if(this.canChangeDiscoverable){const z=Object.assign({},ii,{label:this.translate.instant("submission.sections.accesses.form.discoverable-label"),hint:this.translate.instant("submission.sections.accesses.form.discoverable-description"),value:this.accessesData.discoverable});s.push(new Z.dwp(z,si))}const t=Object.assign({},lt),r=Object.assign({},ri),c=[];for(const z of this.availableAccessConditionOptions)c.push({label:z.name,value:z.name});t.options=c;const u=[],I=[];let U,Q;this.availableAccessConditionOptions.forEach(z=>{if(z.hasStartDate&&(u.push({id:"name",value:z.name}),z.maxStartDate)){const ee=new Date(z.maxStartDate);U={year:ee.getUTCFullYear(),month:ee.getUTCMonth()+1,day:ee.getUTCDate()}}if(z.hasEndDate&&(I.push({id:"name",value:z.name}),z.maxEndDate)){const ee=new Date(z.maxEndDate);Q={year:ee.getUTCFullYear(),month:ee.getUTCMonth()+1,day:ee.getUTCDate()}}});const k={relations:[{match:Z.O6Y,operator:Z.F8e,when:u}]},b={relations:[{match:Z.O6Y,operator:Z.F8e,when:I}]},N=u.length>0,se=I.length>0;return r.groupFactory=()=>{const z=new Z.nMt(t,li),ee=Object.assign({},di,k);U&&(ee.max=U);const le=Object.assign({},mi,b);Q&&(le.max=Q);const de=new Z.oqv(ee,pi),re=new Z.oqv(le,ui),ae=Object.assign({},oi);return ae.group=[z],N&&ae.group.push(de),se&&ae.group.push(re),[new Z.S_O(ae,ai)]},r.initialCount=(0,h.UE)(this.accessesData.accessConditions)?this.accessesData.accessConditions.length:1,s.push(new Z.RRz(r,ci)),this.initModelData(s),s}retrieveValueFromField(s){const t=Array.isArray(s)?s[0]:s;return t?t.value:void 0}};Ie.\u0275fac=function(s){return new(s||Ie)(e.\u0275\u0275directiveInject(l.J),e.\u0275\u0275directiveInject(_.c),e.\u0275\u0275directiveInject(be),e.\u0275\u0275directiveInject(Je),e.\u0275\u0275directiveInject(m.m),e.\u0275\u0275directiveInject(ve.w),e.\u0275\u0275directiveInject(R.o),e.\u0275\u0275directiveInject(M.sK),e.\u0275\u0275directiveInject(Pe.E),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},Ie.\u0275cmp=e.\u0275\u0275defineComponent({type:Ie,selectors:[["ds-section-accesses"]],viewQuery:function(s,t){if(1&s&&e.\u0275\u0275viewQuery(_i,5),2&s){let r;e.\u0275\u0275queryRefresh(r=e.\u0275\u0275loadQuery())&&(t.formRef=r.first)}},features:[e.\u0275\u0275InheritDefinitionFeature],decls:1,vars:1,consts:[[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem"],["formRef","formComponent"]],template:function(s,t){1&s&&e.\u0275\u0275template(0,hi,2,4,"ds-form",0),2&s&&e.\u0275\u0275property("ngIf",!!t.formModel)},directives:[J.O5,L.U],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]}),Ie=(0,y.__decorate)([(0,O.E)(E.i.AccessesCondition),(0,y.__metadata)("design:paramtypes",[l.J,_.c,be,Je,m.m,ve.w,R.o,M.sK,Pe.E,Object,String])],Ie);var dt=o(7519);function fi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"p",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",t," ")}}function vi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275template(6,fi,2,1,"p",5),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.title")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.journal.titles)}}function bi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"p",4),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("",t," ")}}function gi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275template(6,bi,2,1,"p",5),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.issns")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.journal.issns)}}function Si(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4)(7,"a",6),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.sherpa.publication.information.url")),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("href",t.journal.url,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.journal.url," ")}}function Ci(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",3)(1,"p",4)(2,"a",6),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd()()()),2&i){const t=s.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("href",t.uri,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.name," ")}}function Ei(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(5,Ci,4,2,"div",7),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.publishers")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t.journal.publishers)}}function Ii(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.romeoPub")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.journal.romeoPub," ")}}function xi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",3)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publication.information.zetoPub")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.journal.zetoPub," ")}}let pt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-publication-information"]],inputs:{journal:"journal"},decls:7,vars:6,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],["class","m-1",4,"ngFor","ngForOf"],["target","_blank",3,"href"],["class","col-4",4,"ngFor","ngForOf"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,vi,7,4,"div",1),e.\u0275\u0275template(2,gi,7,4,"div",1),e.\u0275\u0275template(3,Si,9,5,"div",1),e.\u0275\u0275template(4,Ei,6,4,"div",1),e.\u0275\u0275template(5,Ii,8,4,"div",1),e.\u0275\u0275template(6,xi,8,4,"div",1),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.titles)&&r.journal.titles.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.issns)&&r.journal.issns.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.url)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.publishers)&&r.journal.publishers.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.romeoPub)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.journal||!r.journal.zetoPub)))},directives:[J.O5,J.sg],pipes:[M.X$],styles:[""]}),i})();function yi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",15),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",t.version.embargo.amount," ",null==t.version.embargo?null:t.version.embargo.units[0],"")}}function Di(i,s){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",15),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"submission.sections.sherpa.publisher.policy.noembargo"),""))}function Oi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1("+",t.version.locations.length-1,"")}}function Ti(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275template(2,Oi,2,1,"span",16),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",t.version.locations[0]," "),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.version.locations.length>1)}}function Mi(i,s){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"submission.sections.sherpa.publisher.policy.nolocation")))}function Pi(i,s){1&i&&e.\u0275\u0275element(0,"span",17)}function Ui(i,s){1&i&&e.\u0275\u0275element(0,"span",18)}function Bi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2("",t.version.embargo.amount," ",t.version.embargo.units,"")}}function Fi(i,s){1&i&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"submission.sections.sherpa.publisher.policy.noembargo")))}function Ai(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",15),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Bi,2,2,"p",25),e.\u0275\u0275template(8,Fi,3,3,"ng-template",null,26,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275reference(9),r=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,3,"submission.sections.sherpa.publisher.policy.embargo"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!!r.version.embargo)("ngIfElse",t)}}function Li(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function Ri(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",27),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Li,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.license"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.licenses)}}function ji(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function Ki(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",29),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,ji,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.prerequisites"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.prerequisites)}}function Wi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function wi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",7),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Wi,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.location"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.locations)}}function Vi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"p",23),e.\u0275\u0275text(1),e.\u0275\u0275elementEnd()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t)}}function $i(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",21)(1,"div",22)(2,"p",23),e.\u0275\u0275element(3,"i",30),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",24),e.\u0275\u0275template(7,Vi,2,1,"p",28),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"submission.sections.sherpa.publisher.policy.conditions"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",t.version.conditions)}}function Ni(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",19),e.\u0275\u0275template(1,Ai,10,5,"div",20),e.\u0275\u0275template(2,Ri,8,4,"div",20),e.\u0275\u0275template(3,Ki,8,4,"div",20),e.\u0275\u0275template(4,wi,8,4,"div",20),e.\u0275\u0275template(5,$i,8,4,"div",20),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.embargo||null==t.version||!t.version.embargo.amount)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.licenses)&&t.version.licenses.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.prerequisites)&&t.version.prerequisites.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.locations)&&t.version.locations.length>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==t.version||!t.version.conditions)&&t.version.conditions.length>0)}}let mt=(()=>{class i{constructor(){this.isCollapsed=!0}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-content-accordion"]],inputs:{version:"version"},decls:22,vars:15,consts:[["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle",3,"click"],[1,"d-flex"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0","mr-4",3,"click"],[4,"ngIf","ngIfElse"],["noEmbargoTitle",""],[1,"m-1","ml-4"],[1,"far","fa-folder-open"],["noLocations",""],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["collapse","ngbCollapse"],["class","ml-4",4,"ngIf"],[1,"fas","fa-hourglass-half"],[4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-6"],["class","m-1",4,"ngIf","ngIfElse"],["noEmbargo",""],[1,"fas","fa-certificate"],["class","m-1",4,"ngFor","ngForOf"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-tasks"]],template:function(t,r){if(1&t){const c=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(c),e.\u0275\u0275reference(20).toggle()}),e.\u0275\u0275elementStart(2,"div",2)(3,"button",3),e.\u0275\u0275listener("click",function(I){return I.preventDefault()}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"titlecase"),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div"),e.\u0275\u0275template(8,yi,3,2,"span",4),e.\u0275\u0275template(9,Di,4,3,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(11,"span",6),e.\u0275\u0275element(12,"i",7),e.\u0275\u0275template(13,Ti,3,2,"span",4),e.\u0275\u0275template(14,Mi,3,3,"ng-template",null,8,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"div",9),e.\u0275\u0275template(17,Pi,1,0,"span",10),e.\u0275\u0275template(18,Ui,1,0,"span",11),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(19,"div",12,13),e.\u0275\u0275template(21,Ni,6,5,"div",14),e.\u0275\u0275elementEnd()()}if(2&t){const c=e.\u0275\u0275reference(10),u=e.\u0275\u0275reference(15),I=e.\u0275\u0275reference(20);e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!I.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(5,11,r.version.articleVersion)," ",e.\u0275\u0275pipeBind1(6,13,"submission.sections.sherpa.publisher.policy.version")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!(null==r.version||!r.version.embargo||null==r.version||!r.version.embargo.amount))("ngIfElse",c),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",!(null==r.version||!r.version.locations)&&r.version.locations.length>0)("ngIfElse",u),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",I.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!I.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",r.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!!r.version)}},directives:[J.O5,ge._D,J.sg],pipes:[J.rS,M.X$],styles:[""]}),i})();function zi(i,s){1&i&&e.\u0275\u0275element(0,"ds-content-accordion",3),2&i&&e.\u0275\u0275property("version",s.$implicit)}function Gi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"li")(1,"a",8),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd()()),2&i){const t=s.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("href",t.key,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.value)}}function Xi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",4)(1,"div",5)(2,"p",6),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"ul"),e.\u0275\u0275template(6,Gi,3,2,"li",7),e.\u0275\u0275pipe(7,"keyvalue"),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.publisher.policy.more.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(7,4,t.policy.urls))}}let ut=(()=>{class i{constructor(){this.AlertTypeEnum=Xe.N}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-publisher-policy"]],inputs:{policy:"policy"},decls:3,vars:2,consts:[[1,"ml-4"],[3,"version",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[3,"version"],[1,"row"],[1,"col-12"],[1,"m-1"],[4,"ngFor","ngForOf"],["target","_blank",3,"href"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,zi,1,1,"ds-content-accordion",1),e.\u0275\u0275template(2,Xi,8,6,"div",2),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.policy.permittedVersions),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.policy||!r.policy.urls)))},directives:[J.sg,mt,J.O5],pipes:[M.X$,J.Nd],styles:[""]}),i})();function Yi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.id")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",t.metadata.id," ")}}function Qi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.date.created")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(8,4,t.metadata.dateCreated,"d MMMM Y H:mm:ss zzzz")," ")}}function Hi(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"date"),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"submission.sections.sherpa.record.information.date.modified")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind2(8,4,t.metadata.dateModified,"d MMMM Y H:mm:ss zzzz")," ")}}function Ji(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"div",3)(2,"p",4),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"div",5)(6,"p",4)(7,"a",6),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,3,"submission.sections.sherpa.record.information.uri")),e.\u0275\u0275advance(4),e.\u0275\u0275property("href",t.metadata.uri,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.metadata.uri)}}let _t=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-metadata-information"]],inputs:{metadata:"metadata"},decls:5,vars:4,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-8"],["target","_blank",3,"href"]],template:function(t,r){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,Yi,8,4,"div",1),e.\u0275\u0275template(2,Qi,9,7,"div",1),e.\u0275\u0275template(3,Hi,9,7,"div",1),e.\u0275\u0275template(4,Ji,9,5,"div",1),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.id)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.dateCreated)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.dateModified)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null==r.metadata||!r.metadata.uri)))},directives:[J.O5],pipes:[M.X$,J.uU],styles:[""]}),i})();function Zi(i,s){1&i&&e.\u0275\u0275element(0,"ds-alert",3),2&i&&e.\u0275\u0275property("type","alert-info")("content","submission.sections.sherpa-policy.title-empty")}function ki(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",4)(1,"ds-alert",5),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"button",6),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().refresh()}),e.\u0275\u0275elementStart(6,"span"),e.\u0275\u0275element(7,"i",7),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()()()}2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("type","alert-info"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"submission.sections.sherpa.publisher.policy.description")," "),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(9,5,"submission.sections.sherpa.publisher.policy.refresh")," "))}function qi(i,s){1&i&&e.\u0275\u0275element(0,"span",21)}function es(i,s){1&i&&e.\u0275\u0275element(0,"span",22)}function ts(i,s){1&i&&e.\u0275\u0275element(0,"span",21)}function ns(i,s){1&i&&e.\u0275\u0275element(0,"span",22)}function is(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"div",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275reference(9).toggle()}),e.\u0275\u0275elementStart(2,"button",12),e.\u0275\u0275listener("click",function(c){return c.preventDefault()}),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"div",13),e.\u0275\u0275template(6,ts,1,0,"span",14),e.\u0275\u0275template(7,ns,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(8,"div",16,17),e.\u0275\u0275element(10,"ds-publisher-policy",23),e.\u0275\u0275elementEnd()()}if(2&i){const t=s.$implicit,r=e.\u0275\u0275reference(9),c=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(2),e.\u0275\u0275attribute("aria-expanded",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,6,"submission.sections.sherpa.publisher.policy")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",c.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("policy",t)}}function ss(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",10)(2,"div",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275reference(10).toggle()}),e.\u0275\u0275elementStart(3,"button",12),e.\u0275\u0275listener("click",function(c){return c.preventDefault()}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",13),e.\u0275\u0275template(7,qi,1,0,"span",14),e.\u0275\u0275template(8,es,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(9,"div",16,17),e.\u0275\u0275element(11,"ds-publication-information",19),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(12,is,11,8,"div",20),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=s.$implicit,r=e.\u0275\u0275reference(10),c=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,7,"submission.sections.sherpa.publication.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",c.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("journal",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.policies)}}function os(i,s){1&i&&e.\u0275\u0275element(0,"span",21)}function as(i,s){1&i&&e.\u0275\u0275element(0,"span",22)}function rs(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ss,13,9,"ng-container",9),e.\u0275\u0275elementStart(2,"div",10)(3,"div",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275reference(11).toggle()}),e.\u0275\u0275elementStart(4,"button",12),e.\u0275\u0275listener("click",function(c){return c.preventDefault()}),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div",13),e.\u0275\u0275template(8,os,1,0,"span",14),e.\u0275\u0275template(9,as,1,0,"span",15),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div",16,17),e.\u0275\u0275element(12,"ds-metadata-information",18),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275reference(11),r=e.\u0275\u0275nextContext().ngVar,c=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",r.journals),e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!t.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(6,7,"submission.sections.sherpa.record.information")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.collapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngbCollapse",c.isCollapsed),e.\u0275\u0275advance(2),e.\u0275\u0275property("metadata",r.metadata)}}function cs(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-alert",3),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("type",r.AlertTypeEnum.Error)("content",t.message?t.message:e.\u0275\u0275pipeBind1(2,2,"submission.sections.sherpa.error.message"))}}function ls(i,s){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,rs,13,9,"ng-container",8),e.\u0275\u0275template(2,cs,3,4,"ng-container",8),e.\u0275\u0275elementContainerEnd()),2&i){const t=s.ngVar,r=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!r.hasNoData()&&!!t&&!t.error),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!!t&&t.error)}}let xe=class extends A{constructor(s,t,r,c,u){super(void 0,c,u),this.sectionService=s,this.operationsBuilder=t,this.submissionService=r,this.injectedSectionData=c,this.injectedSubmissionId=u,this.sherpaPoliciesData$=new ze.X(null),this.subs=[],this.isCollapsed=!1,this.AlertTypeEnum=Xe.N}onSectionDestroy(){this.subs.filter(s=>(0,h.Uh)(s)).forEach(s=>s.unsubscribe())}onSectionInit(){this.pathCombiner=new T.K("sections",this.sectionData.id),this.subs.push(this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType).subscribe(s=>{this.sherpaPoliciesData$.next(s)}))}getSectionStatus(){return(0,_e.of)(!0)}hasNoData(){return(0,h.xb)(this.sherpaPoliciesData$.value)}refresh(){this.operationsBuilder.remove(this.pathCombiner.getPath("retrievalTime")),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}};xe.\u0275fac=function(s){return new(s||xe)(e.\u0275\u0275directiveInject(l.J),e.\u0275\u0275directiveInject(ve.w),e.\u0275\u0275directiveInject(j.b),e.\u0275\u0275directiveInject("sectionDataProvider"),e.\u0275\u0275directiveInject("submissionIdProvider"))},xe.\u0275cmp=e.\u0275\u0275defineComponent({type:xe,selectors:[["ds-section-sherpa-policies"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:5,consts:[[3,"type","content",4,"ngIf"],["class","d-flex flex-column flex-nowrap mt-2 mb-4",4,"ngIf"],[4,"ngVar"],[3,"type","content"],[1,"d-flex","flex-column","flex-nowrap","mt-2","mb-4"],[3,"type"],["type","button","data-test","refresh-btn",1,"btn","btn-secondary","float-right",3,"click"],[1,"fas","fa-sync"],[4,"ngIf"],[4,"ngFor","ngForOf"],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle","mb-3",3,"click"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0",3,"click"],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["collapse","ngbCollapse"],[3,"metadata"],[3,"journal"],["class","mb-3 border-bottom","data-test","collapse",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[3,"policy"]],template:function(s,t){if(1&s&&(e.\u0275\u0275template(0,Zi,1,2,"ds-alert",0),e.\u0275\u0275template(1,ki,10,7,"div",1),e.\u0275\u0275template(2,ls,3,2,"ng-container",2),e.\u0275\u0275pipe(3,"async")),2&s){let r;e.\u0275\u0275property("ngIf",t.hasNoData()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.hasNoData()),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",null==(r=e.\u0275\u0275pipeBind1(3,3,t.sherpaPoliciesData$))?null:r.sherpaResponse)}},directives:[J.O5,dt.w,ct.g,J.sg,ge._D,pt,ut,_t],pipes:[M.X$,J.Ov],styles:[""]}),xe=(0,y.__decorate)([(0,O.E)(E.i.SherpaPolicies),(0,y.__metadata)("design:paramtypes",[l.J,ve.w,j.b,Object,String])],xe);const ht=[Se,F,Ce,Ee,Ie,xe];let ds=(()=>{class i{static withEntryComponents(){return{ngModule:i,providers:ht.map(t=>({provide:t}))}}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({providers:[Ue,l.J,fe,be,Je],imports:[[J.ez,n.IR.forRoot(),C.m,Ae.Aw.forFeature("submission",bt.L,In.z7),Y.sQ.forFeature(xt),Zn.x.withEntryComponents(),kn.a.withEntryComponents(),ni.e,ge.bz,ge.lQ,ge.Gs]]}),i})();e.\u0275\u0275setComponentScope(Se,[dt.w,J.O5,He,J.sg,ot],[M.X$,J.Ov])},26098:(te,W,o)=>{"use strict";o.r(W),o.d(W,{SubmissionSubmitComponent:()=>S});var n=o(35841),C=o(21160),y=o(3358),e=o(25839),d=o(16228),g=o(83653),a=o(5496),B=o(89551),P=o(70074),$=o(37895),w=o(86553);let S=(()=>{class M{constructor(_,L,R,V,h,A,p,T){this.changeDetectorRef=_,this.notificationsService=L,this.router=R,this.itemDataService=V,this.submissionService=h,this.translate=A,this.viewContainerRef=p,this.route=T,this.itemLink$=new n.X(void 0),this.subs=[],this.route.queryParams.subscribe(H=>{this.collectionParam=H.collection})}ngOnInit(){this.subs.push(this.submissionService.createSubmission(this.collectionParam).subscribe(_=>{(0,e.K0)(_)&&((0,e.xb)(_)?(this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"])):this.router.navigate(["/workspaceitems",_.id,"edit"],{replaceUrl:!0}))}),this.itemLink$.pipe((0,e.iy)(),(0,C.w)(_=>this.itemDataService.findByHref(_)),(0,a.g1)(),(0,y.b)(300)).subscribe(_=>{this.item=_.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(_=>(0,e.Uh)(_)).forEach(_=>_.unsubscribe()),this.viewContainerRef.clear(),this.changeDetectorRef.markForCheck()}}return M.\u0275fac=function(_){return new(_||M)(P.\u0275\u0275directiveInject(P.ChangeDetectorRef),P.\u0275\u0275directiveInject(d.T),P.\u0275\u0275directiveInject($.F0),P.\u0275\u0275directiveInject(B.S),P.\u0275\u0275directiveInject(g.b),P.\u0275\u0275directiveInject(w.sK),P.\u0275\u0275directiveInject(P.ViewContainerRef),P.\u0275\u0275directiveInject($.gz))},M.\u0275cmp=P.\u0275\u0275defineComponent({type:M,selectors:[["ds-submission-submit"]],decls:0,vars:0,template:function(_,L){},styles:[""]}),M})()},68457:(te,W,o)=>{"use strict";o.d(W,{Y:()=>e});var n=o(46533),C=o(70074);function y(d,g){}let e=(()=>{class d extends n.F{getComponentName(){return"SubmissionSubmitComponent"}importThemedComponent(a){return o(39881)(`./${a}/app/submission/submit/submission-submit.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,26098))}}return d.\u0275fac=function(){let g;return function(B){return(g||(g=C.\u0275\u0275getInheritedFactory(d)))(B||d)}}(),d.\u0275cmp=C.\u0275\u0275defineComponent({type:d,selectors:[["ds-themed-submission-submit"]],features:[C.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(a,B){1&a&&C.\u0275\u0275template(0,y,0,0,"ng-template",null,0,C.\u0275\u0275templateRefExtractor)},encapsulation:2}),d})()},66660:(te,W,o)=>{"use strict";o.d(W,{Z:()=>d});var n=o(25839);const C=/([^\/]+)/g,y=/\/sections\/(.*)/,d=g=>("string"==typeof g?[g]:g).map(B=>B.match(C)&&B.match(C).length>2?{sectionId:B.match(C)[1],fieldId:B.match(C)[2],fieldIndex:(0,n.Uh)(B.match(C)[3])?+B.match(C)[3]:0,originalPath:B}:{sectionId:B.match(y)[1],originalPath:B})},60516:(te,W,o)=>{"use strict";o.d(W,{Z:()=>y});var n=o(66660);const y=(e=[])=>{const d=Object.create({});return e.forEach(g=>{(0,n.Z)(g.paths).forEach(B=>{const P={path:B.originalPath,message:g.message};d[B.sectionId]||(d[B.sectionId]=[]),d[B.sectionId].push(P)})}),d}},8377:(te,W,o)=>{var n={"./custom/app/submission/edit/submission-edit.component":[959,959],"./gusi/app/submission/edit/submission-edit.component":[42272,2272]};function C(y){if(!o.o(n,y))return Promise.resolve().then(()=>{var g=new Error("Cannot find module '"+y+"'");throw g.code="MODULE_NOT_FOUND",g});var e=n[y],d=e[0];return o.e(e[1]).then(()=>o(d))}C.keys=()=>Object.keys(n),C.id=8377,te.exports=C},49252:(te,W,o)=>{var n={"./custom/app/submission/import-external/submission-import-external.component":[69803,9803],"./gusi/app/submission/import-external/submission-import-external.component":[92661,2661]};function C(y){if(!o.o(n,y))return Promise.resolve().then(()=>{var g=new Error("Cannot find module '"+y+"'");throw g.code="MODULE_NOT_FOUND",g});var e=n[y],d=e[0];return o.e(e[1]).then(()=>o(d))}C.keys=()=>Object.keys(n),C.id=49252,te.exports=C},39881:(te,W,o)=>{var n={"./custom/app/submission/submit/submission-submit.component":[18711,8711],"./gusi/app/submission/submit/submission-submit.component":[70095,95]};function C(y){if(!o.o(n,y))return Promise.resolve().then(()=>{var g=new Error("Cannot find module '"+y+"'");throw g.code="MODULE_NOT_FOUND",g});var e=n[y],d=e[0];return o.e(e[1]).then(()=>o(d))}C.keys=()=>Object.keys(n),C.id=39881,te.exports=C}}]);