"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[5720],{15720:(yt,D,a)=>{a.r(D),a.d(D,{EditCollectionPageModule:()=>bt});var u=a(10210),G=a(66004),h=a(37895),E=a(35841),x=a(53426),U=a(95033),m=a(48358),v=a(21160),X=a(9302),B=a(77176),l=a(5496),K=a(46685),j=a(1367),R=a(16228),Y=a(89551),$=a(64508),d=a(25839),w=a(43718),Q=a(6574),W=a(34978),J=a(49965),Z=a(8183),V=a(84705),e=a(70074),C=a(86553),P=a(53043),T=a(35053),q=a(45235),ee=a(52093);const te=["tabs"];function ne(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"ds-item-select",11),e.\u0275\u0275listener("confirm",function(o){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().mapItems(o,!0)})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onCancel()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","browse")("dsoRD$",t.collectionItemsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,7,t.searchOptions$))?null:n.pagination)("confirmButton","collection.edit.item-mapper.remove")("cancelButton","collection.edit.item-mapper.cancel")("dangerConfirm",!0)("hideCollection",!0)}}function ie(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"ds-item-select",17),e.\u0275\u0275listener("confirm",function(o){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).mapItems(o)})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).onCancel()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);let n;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","map")("dsoRD$",t.mappedItemsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,6,t.searchOptions$))?null:n.pagination)("featureId",t.FeatureIds.CanManageMappings)("confirmButton","collection.edit.item-mapper.confirm")("cancelButton","collection.edit.item-mapper.cancel")}}function oe(i,r){1&i&&(e.\u0275\u0275elementStart(0,"div",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"collection.edit.item-mapper.no-search")," "))}function ae(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"div",13)(2,"ds-search-form",14),e.\u0275\u0275listener("submitSearch",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().performedSearch=!0}),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(6,ie,3,8,"div",15),e.\u0275\u0275template(7,oe,3,3,"div",16)}if(2&i){const t=e.\u0275\u0275nextContext();let n,o;e.\u0275\u0275advance(2),e.\u0275\u0275property("query",null==(n=e.\u0275\u0275pipeBind1(3,7,t.searchOptions$))?null:n.query)("scope",null==(o=e.\u0275\u0275pipeBind1(4,9,t.searchOptions$))?null:o.scope)("currentUrl","./")("inPlaceSearch",!0)("searchPlaceholder",e.\u0275\u0275pipeBind1(5,11,"collection.edit.item-mapper.search-form.placeholder")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.performedSearch),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.performedSearch)}}const re=function(i){return{name:i}};let se=(()=>{class i{constructor(t,n,o,s,p,f,S,b,I){this.route=t,this.router=n,this.searchConfigService=o,this.searchService=s,this.notificationsService=p,this.itemDataService=f,this.collectionDataService=S,this.translateService=b,this.dsoNameService=I,this.FeatureIds=V.i,this.defaultSortOptions=new j.o("dc.title",j.S.ASC),this.performedSearch=!1}ngOnInit(){this.collectionRD$=this.route.parent.data.pipe((0,m.U)(t=>t.dso),(0,l.xw)()),this.collectionName$=this.collectionRD$.pipe((0,m.U)(t=>this.dsoNameService.getName(t.payload))),this.searchOptions$=this.searchConfigService.paginatedSearchOptions,this.loadItemLists()}loadItemLists(){this.shouldUpdate$=new E.X(!0);const t=(0,x.a)(this.collectionRD$,this.searchOptions$,this.shouldUpdate$);this.collectionItemsRD$=t.pipe((0,v.w)(([n,o,s])=>(!0===s&&this.shouldUpdate$.next(!1),this.itemDataService.findListByHref(n.payload._links.mappedItems.href,Object.assign(o,{sort:this.defaultSortOptions}),!s,!1,(0,Z.l)("owningCollection")).pipe((0,l.g1)())))),this.mappedItemsRD$=t.pipe((0,v.w)(([n,o,s])=>this.searchService.search(Object.assign(new W.t(o),{query:this.buildQuery(n.payload.id,o.query),scope:void 0,dsoTypes:[K.h.ITEM],sort:this.defaultSortOptions}),1e4).pipe((0,l.Ie)(),(0,X.O)(void 0))))}mapItems(t,n){const o=this.collectionRD$.pipe((0,l.xw)(),(0,m.U)(s=>s.payload),(0,v.w)(s=>(0,x.a)(t.map(p=>n?this.itemDataService.removeMappingFromCollection(p,s.id).pipe((0,l.hC)()):this.itemDataService.mapToCollection(p,s._links.self.href).pipe((0,l.hC)())))));this.showNotifications(o,n)}showNotifications(t,n){const o=n?"unmap":"map";t.subscribe(s=>{const p=s.filter(S=>S.hasSucceeded),f=s.filter(S=>S.hasFailed);p.length>0&&((0,x.a)(this.translateService.get(`collection.edit.item-mapper.notifications.${o}.success.head`),this.translateService.get(`collection.edit.item-mapper.notifications.${o}.success.content`,{amount:p.length})).subscribe(([b,I])=>{this.notificationsService.success(b,I)}),this.shouldUpdate$.next(!0)),f.length>0&&(0,x.a)(this.translateService.get(`collection.edit.item-mapper.notifications.${o}.error.head`),this.translateService.get(`collection.edit.item-mapper.notifications.${o}.error.content`,{amount:f.length})).subscribe(([b,I])=>{this.notificationsService.error(b,I)}),this.switchToFirstTab()})}tabChange(t){this.performedSearch=!1,this.router.navigateByUrl(this.getCurrentUrl())}getCurrentUrl(){return this.router.url.indexOf("?")>-1?this.router.url.substring(0,this.router.url.indexOf("?")):this.router.url}buildQuery(t,n){const o=`-location.coll:"${t}"`;return(0,d.UE)(n)?`${o} AND ${n}`:o}switchToFirstTab(){this.tabs.select("browseTab")}onCancel(){this.collectionRD$.pipe((0,l.xw)(),(0,l.xe)(),(0,B.q)(1)).subscribe(t=>{this.router.navigate(["/collections/",t.id])})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(w.SEARCH_CONFIG_SERVICE),e.\u0275\u0275directiveInject(J.o),e.\u0275\u0275directiveInject(R.T),e.\u0275\u0275directiveInject(Y.S),e.\u0275\u0275directiveInject($.W),e.\u0275\u0275directiveInject(C.sK),e.\u0275\u0275directiveInject(P._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-collection-item-mapper"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(te,5),2&t){let o;e.\u0275\u0275queryRefresh(o=e.\u0275\u0275loadQuery())&&(n.tabs=o.first)}},features:[e.\u0275\u0275ProvidersFeature([{provide:w.SEARCH_CONFIG_SERVICE,useClass:Q.U}])],decls:25,vars:24,consts:[[1,"container"],[1,"row"],[1,"col-12"],["id","collection-name",3,"innerHTML"],["ngbNav","",1,"nav-tabs",3,"destroyOnHide","navChange"],["tabs","ngbNav"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"mt-2"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","confirmButton","cancelButton","dangerConfirm","hideCollection","confirm","cancel"],[1,"row","mt-2"],[1,"col-12","col-lg-6"],["id","search-form",3,"query","scope","currentUrl","inPlaceSearch","searchPlaceholder","submitSearch"],[4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","featureId","confirmButton","cancelButton","confirm","cancel"],["role","alert",1,"alert","alert-info","w-100"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"p",3),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"p"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"ul",4,5),e.\u0275\u0275listener("navChange",function(s){return n.tabChange(s)}),e.\u0275\u0275elementStart(14,"li",6)(15,"a",7),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,ne,3,9,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"li",6)(20,"a",7),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(23,ae,8,13,"ng-template",8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(24,"div",9),e.\u0275\u0275elementEnd()()()),2&t){const o=e.\u0275\u0275reference(13);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,9,"collection.edit.item-mapper.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind2(7,11,"collection.edit.item-mapper.collection",e.\u0275\u0275pureFunction1(22,re,e.\u0275\u0275pipeBind1(8,14,n.collectionName$))),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,16,"collection.edit.item-mapper.description")),e.\u0275\u0275advance(2),e.\u0275\u0275property("destroyOnHide",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbNavItem","browseTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,18,"collection.edit.item-mapper.tabs.browse")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavItem","mapTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(22,20,"collection.edit.item-mapper.tabs.map")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavOutlet",o)}},directives:[T.Pz,T.nv,T.Vx,T.uN,q.p,ee.o,u.O5,T.tO],pipes:[C.X$,u.Ov],styles:[""],data:{animation:[U.Ji,U.Ic]},changeDetection:0}),i})();var le=a(31583),L=a(10954);const ce=function(i){return{active:i}},pe=function(i){return[i]};function de(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"li",13)(1,"a",14),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(5,ce,t===n.currentPage))("routerLink",e.\u0275\u0275pureFunction1(7,pe,"./"+t)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,n.type+".edit.tabs."+t+".head")," ")}}function ue(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"a",15),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",16),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275property("routerLink",t.getPageUrl(null==(n=e.\u0275\u0275pipeBind1(1,2,t.dsoRD$))?null:n.payload)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,4,t.type+".edit.return")," ")}}let me=(()=>{class i extends le.x{constructor(t,n){super(t,n),this.router=t,this.route=n,this.type="collection"}getPageUrl(t){return(0,L.MI)(t.id)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(h.gz))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-collection"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:21,vars:11,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom"],[1,"btn","btn-danger",3,"routerLink"],[1,"fas","fa-trash"],[1,"pt-2"],[1,"nav","nav-tabs","justify-content-start","mb-2"],["class","nav-item",4,"ngFor","ngForOf"],[1,"tab-pane","active"],[1,"mb-4"],[1,"col-12","text-right"],["class","btn btn-outline-secondary",3,"routerLink",4,"ngIf"],[1,"nav-item"],[1,"nav-link",3,"ngClass","routerLink"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2"),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div")(8,"a",4),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275element(10,"i",5),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(13,"div",6)(14,"ul",7),e.\u0275\u0275template(15,de,4,9,"li",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",9)(17,"div",10),e.\u0275\u0275element(18,"router-outlet"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"div",11),e.\u0275\u0275template(20,ue,5,6,"a",12),e.\u0275\u0275elementEnd()()()()()()),2&t){let o;e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,5,n.type+".edit.head")),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",("community"===n.type?"/communities/":"/collections/")+(null==(o=e.\u0275\u0275pipeBind1(9,7,n.dsoRD$))?null:o.payload.uuid)+"/delete"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(12,9,n.type+".edit.delete"),""),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",n.pages),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngIf",!n.hideReturnButton)}},directives:[h.yS,u.sg,u.mk,h.lC,u.O5],pipes:[C.X$,u.Ov],encapsulation:2}),i})();var he=a(49466),ve=a(34269),fe=a(95034),Se=a(27899),F=a(37958),A=a(41633),Ce=a(42073);function ge(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).addItemTemplate()}),e.\u0275\u0275element(1,"i",8),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"collection.edit.template.add-button"),""))}function be(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",10),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).deleteItemTemplate()}),e.\u0275\u0275element(1,"i",11),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"collection.edit.template.delete-button"),""))}function ye(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"button",12),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",13),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext(2);let n;e.\u0275\u0275property("routerLink","/collections/"+(null==(n=e.\u0275\u0275pipeBind1(1,2,t.dsoRD$))?null:n.payload.uuid)+"/itemtemplate"),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"collection.edit.template.edit-button"),"")}}function _e(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"label"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",3),e.\u0275\u0275template(5,ge,5,3,"button",4),e.\u0275\u0275template(6,be,5,3,"button",5),e.\u0275\u0275template(7,ye,6,6,"button",6),e.\u0275\u0275elementEnd()()),2&i){const t=r.ngVar;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,4,"collection.edit.template.label")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!(null!=t&&t.payload)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t?null:t.payload),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null==t?null:t.payload)}}let Ie=(()=>{class i extends he.Z{constructor(t,n,o,s,p,f,S){super(t,o,s,p,f),this.collectionDataService=t,this.itemTemplateService=n,this.router=o,this.route=s,this.notificationsService=p,this.translate=f,this.requestService=S,this.frontendURL="/collections/",this.type=ve.F.type}ngOnInit(){super.ngOnInit(),this.initTemplateItem()}initTemplateItem(){this.itemTemplateRD$=this.dsoRD$.pipe((0,l.Gp)(),(0,v.w)(t=>this.itemTemplateService.findByCollectionID(t.uuid)))}addItemTemplate(){const t=this.dsoRD$.pipe((0,l.Gp)()),n=t.pipe((0,v.w)(s=>this.itemTemplateService.createByCollectionID(new Se.c,s.uuid).pipe((0,l.Gp)()))),o=t.pipe((0,v.w)(s=>this.itemTemplateService.getCollectionEndpoint(s.id)));(0,x.a)(t,n,o).subscribe(([s,p,f])=>{this.requestService.setStaleByHrefSubstring(f),this.router.navigate([(0,L.$X)(s.uuid)])})}deleteItemTemplate(){this.dsoRD$.pipe((0,l.Gp)(),(0,v.w)(t=>this.itemTemplateService.findByCollectionID(t.uuid)),(0,l.Gp)(),(0,v.w)(t=>this.itemTemplateService.delete(t.uuid)),(0,l.hC)(),(0,m.U)(t=>(0,d.Uh)(t)&&t.hasSucceeded)).subscribe(t=>{t?this.notificationsService.success(null,this.translate.get("collection.edit.template.notifications.delete.success")):this.notificationsService.error(null,this.translate.get("collection.edit.template.notifications.delete.error")),this.initTemplateItem()})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject($.W),e.\u0275\u0275directiveInject(fe.w),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(R.T),e.\u0275\u0275directiveInject(C.sK),e.\u0275\u0275directiveInject(F.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-collection-metadata"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:4,vars:6,consts:[["class","container-fluid mb-2",4,"ngVar"],[3,"dso","submitForm","back","finish"],[1,"container-fluid","mb-2"],[1,"button-row","space-children-mr"],["class","btn btn-success",3,"click",4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],["class","btn btn-primary",3,"routerLink",4,"ngIf"],[1,"btn","btn-success",3,"click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[1,"btn","btn-danger",3,"click"],[1,"fas","fa-trash-alt"],[1,"btn","btn-primary",3,"routerLink"],[1,"fas","fa-edit"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,_e,8,6,"div",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"ds-collection-form",1),e.\u0275\u0275listener("submitForm",function(s){return n.onSubmit(s)})("back",function(){return n.navigateToHomePage()})("finish",function(){return n.navigateToHomePage()}),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd()),2&t){let o;e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,2,n.itemTemplateRD$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("dso",null==(o=e.\u0275\u0275pipeBind1(3,4,n.dsoRD$))?null:o.payload)}},directives:[A.g,u.O5,h.rH,Ce.L],pipes:[u.Ov,C.X$],encapsulation:2}),i})();var M=a(76215),xe=a(1808);function Te(i,r){if(1&i&&(e.\u0275\u0275element(0,"ds-comcol-role",1),e.\u0275\u0275pipe(1,"async")),2&i){const t=r.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("dso",e.\u0275\u0275pipeBind1(1,2,n.collection$))("comcolRole",t)}}let Ee=(()=>{class i{constructor(t){this.route=t}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,M.P)(),(0,m.U)(t=>t.dso)),this.collection$=this.dsoRD$.pipe((0,l.xw)(),(0,l.xe)()),this.comcolRoles$=this.collection$.pipe((0,m.U)(t=>[{name:"collection-admin",href:t._links.adminGroup.href},{name:"submitters",href:t._links.submittersGroup.href},{name:"item_read",href:t._links.itemReadGroup.href},{name:"bitstream_read",href:t._links.bitstreamReadGroup.href},...t._links.workflowGroups]))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-collection-roles"]],decls:2,vars:3,consts:[[3,"dso","comcolRole",4,"ngFor","ngForOf"],[3,"dso","comcolRole"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,Te,2,4,"ds-comcol-role",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(1,1,n.comcolRoles$))},directives:[u.sg,xe.b],pipes:[u.Ov],encapsulation:2}),i})();var Be=a(19648),g=a(59492),Re=a(86852),y=a(80266),N=a(61001),$e=a(57017),Fe=a(76924),Me=a(61792),H=a(45028),Ne=a(97965),Oe=a(77686),O=a(27303),_=a(77007),c=a(71716),De=a(93132),Ue=a(96576),je=a(78819);function we(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",8),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const o=e.\u0275\u0275nextContext(2).ngVar;return e.\u0275\u0275nextContext().testConfiguration(o)}),e.\u0275\u0275elementStart(1,"span"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!t.isEnabled),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,2,"collection.source.controls.test.submit"))}}function Ve(i,r){1&i&&(e.\u0275\u0275elementStart(0,"button",9),e.\u0275\u0275element(1,"span",10),e.\u0275\u0275elementStart(2,"span"),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275property("disabled",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"collection.source.controls.test.running")))}function Pe(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).importNow()}),e.\u0275\u0275elementStart(1,"span",12),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!t.isEnabled),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,2,"collection.source.controls.import.submit"))}}function Le(i,r){1&i&&(e.\u0275\u0275elementStart(0,"button",13),e.\u0275\u0275element(1,"span",10),e.\u0275\u0275elementStart(2,"span",12),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275property("disabled",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"collection.source.controls.import.running")))}function Ae(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",11),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).resetAndReimport()}),e.\u0275\u0275elementStart(1,"span",12),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!t.isEnabled),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(3,2,"collection.source.controls.reset.submit"),"")}}function He(i,r){1&i&&(e.\u0275\u0275elementStart(0,"button",13),e.\u0275\u0275element(1,"span",10),e.\u0275\u0275elementStart(2,"span",12),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&i&&(e.\u0275\u0275property("disabled",!0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,2,"collection.source.controls.reset.running"),""))}function ze(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div",2)(1,"h4"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"span",3),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"span"),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(10,"div")(11,"span",3),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"span"),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(17,"div")(18,"span",3),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"span"),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(24,"div")(25,"span",3),e.\u0275\u0275text(26),e.\u0275\u0275pipe(27,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(28,"span"),e.\u0275\u0275text(29),e.\u0275\u0275pipe(30,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(31,we,4,4,"button",4),e.\u0275\u0275pipe(32,"async"),e.\u0275\u0275template(33,Ve,5,4,"button",5),e.\u0275\u0275pipe(34,"async"),e.\u0275\u0275template(35,Pe,4,4,"button",6),e.\u0275\u0275pipe(36,"async"),e.\u0275\u0275template(37,Le,5,4,"button",7),e.\u0275\u0275pipe(38,"async"),e.\u0275\u0275template(39,Ae,4,4,"button",6),e.\u0275\u0275pipe(40,"async"),e.\u0275\u0275template(41,He,5,4,"button",7),e.\u0275\u0275pipe(42,"async"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,15,"collection.source.controls.head")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,17,"collection.source.controls.harvest.status")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(null==t?null:t.harvestStatus),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(13,19,"collection.source.controls.harvest.start")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(null!=t&&t.harvestStartTime?null==t?null:t.harvestStartTime:e.\u0275\u0275pipeBind1(16,21,"collection.source.controls.harvest.no-information")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(20,23,"collection.source.controls.harvest.last")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(null!=t&&t.message?null==t?null:t.message:e.\u0275\u0275pipeBind1(23,25,"collection.source.controls.harvest.no-information")),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(27,27,"collection.source.controls.harvest.message")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(null!=t&&t.lastHarvested?null==t?null:t.lastHarvested:e.\u0275\u0275pipeBind1(30,29,"collection.source.controls.harvest.no-information")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(32,31,n.testConfigRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(34,33,n.testConfigRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(36,35,n.importRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(38,37,n.importRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(40,39,n.reImportRunning$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(42,41,n.reImportRunning$))}}function ke(i,r){if(1&i&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,ze,43,43,"div",1),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t.shouldShow)}}let Ge=(()=>{class i{constructor(t,n,o,s,p,f,S,b){this.scriptDataService=t,this.processDataService=n,this.requestService=o,this.notificationsService=s,this.collectionService=p,this.translateService=f,this.httpClient=S,this.bitstreamService=b,this.subs=[],this.testConfigRunning$=new E.X(!1),this.importRunning$=new E.X(!1),this.reImportRunning$=new E.X(!1)}ngOnInit(){this.contentSource$=this.collectionService.findByHref(this.collection._links.self.href,!1).pipe((0,l.mc)(),(0,v.w)(t=>this.collectionService.getContentSource(t.uuid,!1)),(0,l.mc)())}testConfiguration(t){this.testConfigRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-g",value:null},{name:"-a",value:t.oaiSource},{name:"-i",value:(new Ue.q).Serialize(t.oaiSetId)}],[]).pipe((0,l.hC)(),(0,O.b)(n=>{n.hasFailed&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.submit.error")),this.testConfigRunning$.next(!1))}),(0,_.h)(n=>n.hasSucceeded&&(0,d.Uh)(n.payload)),(0,v.w)(n=>this.processDataService.findById(n.payload.processId,!1)),(0,l.f1)(),(0,_.h)(n=>!n.isStale&&(n.hasSucceeded||n.hasFailed)),(0,m.U)(n=>n.payload),(0,d.tz)()).subscribe(n=>{n.processStatus.toString()!==c.N[c.N.COMPLETED].toString()&&n.processStatus.toString()!==c.N[c.N.FAILED].toString()&&setTimeout(()=>{this.requestService.setStaleByHrefSubstring(n._links.self.href)},5e3),n.processStatus.toString()===c.N[c.N.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.failed")),this.testConfigRunning$.next(!1)),n.processStatus.toString()===c.N[c.N.COMPLETED].toString()&&(this.bitstreamService.findByHref(n._links.output.href).pipe((0,l.Gp)()).subscribe(o=>{this.httpClient.get(o._links.content.href,{responseType:"text"}).subscribe(s=>{const p=s.replaceAll(new RegExp(".*\\@(.*)","g"),"$1").replaceAll("The script has started","").replaceAll("The script has completed","");this.notificationsService.info(this.translateService.get("collection.source.controls.test.completed"),p)})}),this.testConfigRunning$.next(!1))}))}importNow(){this.importRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-r",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe((0,l.hC)(),(0,O.b)(t=>{t.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.import.submit.error")),this.importRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.import.submit.success"))}),(0,_.h)(t=>t.hasSucceeded&&(0,d.Uh)(t.payload)),(0,v.w)(t=>this.processDataService.findById(t.payload.processId,!1)),(0,l.f1)(),(0,_.h)(t=>!t.isStale&&(t.hasSucceeded||t.hasFailed)),(0,m.U)(t=>t.payload),(0,d.tz)()).subscribe(t=>{t.processStatus.toString()!==c.N[c.N.COMPLETED].toString()&&t.processStatus.toString()!==c.N[c.N.FAILED].toString()&&setTimeout(()=>{this.requestService.setStaleByHrefSubstring(t._links.self.href),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href)},5e3),t.processStatus.toString()===c.N[c.N.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.import.failed")),this.importRunning$.next(!1)),t.processStatus.toString()===c.N[c.N.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.import.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.importRunning$.next(!1))}))}resetAndReimport(){this.reImportRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-o",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe((0,l.hC)(),(0,O.b)(t=>{t.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.submit.error")),this.reImportRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.reset.submit.success"))}),(0,_.h)(t=>t.hasSucceeded&&(0,d.Uh)(t.payload)),(0,v.w)(t=>this.processDataService.findById(t.payload.processId,!1)),(0,l.f1)(),(0,_.h)(t=>!t.isStale&&(t.hasSucceeded||t.hasFailed)),(0,m.U)(t=>t.payload),(0,d.tz)()).subscribe(t=>{t.processStatus.toString()!==c.N[c.N.COMPLETED].toString()&&t.processStatus.toString()!==c.N[c.N.FAILED].toString()&&setTimeout(()=>{this.requestService.setStaleByHrefSubstring(t._links.self.href),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href)},5e3),t.processStatus.toString()===c.N[c.N.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.failed")),this.reImportRunning$.next(!1)),t.processStatus.toString()===c.N[c.N.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.reset.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.reImportRunning$.next(!1))}))}ngOnDestroy(){this.subs.forEach(t=>{(0,d.Uh)(t)&&t.unsubscribe()})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(Ne.UY),e.\u0275\u0275directiveInject(Oe.n),e.\u0275\u0275directiveInject(F.s),e.\u0275\u0275directiveInject(R.T),e.\u0275\u0275directiveInject($.W),e.\u0275\u0275directiveInject(C.sK),e.\u0275\u0275directiveInject(je.eN),e.\u0275\u0275directiveInject(De.J))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-collection-source-controls"]],inputs:{isEnabled:"isEnabled",collection:"collection",shouldShow:"shouldShow"},decls:2,vars:3,consts:[[4,"ngVar"],["class","container-fluid space-children-mr",4,"ngIf"],[1,"container-fluid","space-children-mr"],[1,"font-weight-bold"],["class","btn btn-secondary",3,"disabled","click",4,"ngIf"],["class","btn btn-secondary",3,"disabled",4,"ngIf"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],["class","btn btn-primary",3,"disabled",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"btn","btn-secondary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","spinner-button"],[1,"btn","btn-primary",3,"disabled","click"],[1,"d-none","d-sm-inline"],[1,"btn","btn-primary",3,"disabled"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,ke,2,1,"div",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,1,n.contentSource$))},directives:[A.g,u.O5],pipes:[u.Ov,C.X$],styles:[".spinner-button[_ngcontent-%COMP%]{margin-bottom:calc((var(--bs-line-height-base) * 1rem - var(--bs-font-size-base)) / 2)}"]}),i})();function Xe(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",14),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",6),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function Ke(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().reinstate()}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",6),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function Ye(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",18)(1,"input",19),e.\u0275\u0275listener("change",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().changeExternalSource()}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(2,"label",20),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("checked",(null==t.contentSource?null:t.contentSource.harvestType)!==t.harvestTypeNone),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(4,2,"collection.edit.tabs.source.external"))}}function Qe(i,r){1&i&&(e.\u0275\u0275element(0,"ds-themed-loading",21),e.\u0275\u0275pipe(1,"translate")),2&i&&e.\u0275\u0275property("message",e.\u0275\u0275pipeBind1(1,1,"loading.content-source"))}function We(i,r){1&i&&(e.\u0275\u0275elementStart(0,"h4"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"collection.edit.tabs.source.form.head")))}function Je(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-form",22),e.\u0275\u0275listener("dfChange",function(o){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onChange(o)})("submitForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onSubmit()})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onCancel()}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId","collection-source-form-id")("formGroup",t.formGroup)("formModel",t.formModel)("formLayout",t.formLayout)("displaySubmit",!1)("displayCancel",!1)}}function Ze(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",14),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",6),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function qe(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).reinstate()}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",6),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function et(i,r){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",23)(1,"div",10)(2,"div",24)(3,"div",25),e.\u0275\u0275template(4,Ze,6,6,"button",2),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275template(6,qe,5,3,"button",3),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275elementStart(8,"button",4),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onSubmit()}),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275element(10,"i",5),e.\u0275\u0275elementStart(11,"span",6),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd()()()()()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(5,4,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(7,6,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(9,8,t.hasChanges())||!t.isValid()||t.initialHarvestType===t.harvestTypeNone&&t.contentSource.harvestType===t.initialHarvestType),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(13,10,"item.edit.metadata.save-button"),"")}}let tt=(()=>{class i extends Be._{constructor(t,n,o,s,p,f,S,b,I){super(t,n,p),this.objectUpdatesService=t,this.notificationsService=n,this.location=o,this.formService=s,this.translate=p,this.route=f,this.router=S,this.collectionService=b,this.requestService=I,this.LABEL_KEY_PREFIX="collection.edit.tabs.source.form.",this.ERROR_KEY_PREFIX="collection.edit.tabs.source.form.errors.",this.OPTIONS_KEY_PREFIX="collection.edit.tabs.source.form.options.",this.oaiSourceModel=new g.b1u({id:"oaiSource",name:"oaiSource",required:!0,validators:{required:null},errorMessages:{required:"You must provide a set id of the target collection."}}),this.oaiSetIdModel=new g.b1u({id:"oaiSetId",name:"oaiSetId"}),this.metadataConfigIdModel=new g.nMt({id:"metadataConfigId",name:"metadataConfigId"}),this.harvestTypeModel=new g.TJt({id:"harvestType",name:"harvestType",options:[{value:y.V.Metadata},{value:y.V.MetadataAndRef},{value:y.V.MetadataAndBitstreams}]}),this.inputModels=[this.oaiSourceModel,this.oaiSetIdModel,this.metadataConfigIdModel,this.harvestTypeModel],this.formModel=[new g.S_O({id:"oaiSourceContainer",group:[this.oaiSourceModel]}),new g.S_O({id:"oaiSetContainer",group:[this.oaiSetIdModel,this.metadataConfigIdModel]}),new g.S_O({id:"harvestTypeContainer",group:[this.harvestTypeModel]})],this.formLayout={oaiSource:{grid:{host:"col-12 d-inline-block"}},oaiSetId:{grid:{host:"col col-sm-6 d-inline-block"}},metadataConfigId:{grid:{host:"col col-sm-6 d-inline-block"}},harvestType:{grid:{host:"col-12",option:"btn-outline-secondary"}},oaiSetContainer:{grid:{host:"row"}},oaiSourceContainer:{grid:{host:"row"}},harvestTypeContainer:{grid:{host:"row"}}},this.harvestTypeNone=y.V.None,this.previouslySelectedHarvestType=y.V.Metadata,this.displayedNotifications=[]}ngOnInit(){this.notificationsPrefix="collection.edit.tabs.source.notifications.",this.discardTimeOut=$e.N.collection.edit.undoTimeout,this.url=this.router.url,this.url.indexOf("?")>0&&(this.url=this.url.substr(0,this.url.indexOf("?"))),this.formGroup=this.formService.createFormGroup(this.formModel),this.collectionRD$=this.route.parent.data.pipe((0,M.P)(),(0,m.U)(t=>t.dso)),this.collectionRD$.pipe((0,l.xw)(),(0,m.U)(t=>t.payload.uuid),(0,v.w)(t=>this.collectionService.getContentSource(t)),(0,l.hC)()).subscribe(t=>{this.initializeOriginalContentSource(t.payload)}),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}initializeOriginalContentSource(t){this.contentSource=t,this.initialHarvestType=t.harvestType,this.initializeMetadataConfigs();const n=(0,N.cloneDeep)(this.contentSource);this.objectUpdatesService.initialize(this.url,[n],new Date),this.update$=this.objectUpdatesService.getFieldUpdates(this.url,[n]).pipe((0,m.U)(o=>o[n.uuid])),this.updateSub=this.update$.subscribe(o=>{if(o){const s=o.field;let p;(0,d.Uh)(this.contentSource)&&(0,d.UE)(this.contentSource.metadataConfigs)&&(p=this.contentSource.metadataConfigs[0].id),(0,d.Uh)(s)&&(0,d.Uh)(s.metadataConfigId)&&(p=s.metadataConfigId),(0,d.Uh)(s)&&(this.formGroup.patchValue({oaiSourceContainer:{oaiSource:s.oaiSource},oaiSetContainer:{oaiSetId:s.oaiSetId,metadataConfigId:p},harvestTypeContainer:{harvestType:s.harvestType}}),this.contentSource=(0,N.cloneDeep)(s)),this.contentSource.metadataConfigId=p}})}initializeMetadataConfigs(){this.metadataConfigIdModel.options=this.contentSource.metadataConfigs.map(t=>Object.assign({value:t.id,label:t.label})),this.metadataConfigIdModel.options.length>0&&this.formGroup.patchValue({oaiSetContainer:{metadataConfigId:this.metadataConfigIdModel.options[0].value}})}updateFieldTranslations(){this.inputModels.forEach(t=>{this.updateFieldTranslation(t)})}updateFieldTranslation(t){t.label=this.translate.instant(this.LABEL_KEY_PREFIX+t.id),(0,d.UE)(t.validators)&&(t.errorMessages={},Object.keys(t.validators).forEach(n=>{t.errorMessages[n]=this.translate.instant(this.ERROR_KEY_PREFIX+t.id+"."+n)})),t instanceof g.WS&&(0,d.UE)(t.options)&&t.options.forEach(n=>{(0,d.xI)(n.label)&&(n.label=this.translate.instant(this.OPTIONS_KEY_PREFIX+t.id+"."+n.value))})}onChange(t){this.updateContentSourceField(t.model,!0),this.saveFieldUpdate()}onSubmit(){this.collectionRD$.pipe((0,l.xw)(),(0,m.U)(t=>t.payload.uuid),(0,v.w)(t=>this.collectionService.getHarvesterEndpoint(t)),(0,B.q)(1)).subscribe(t=>this.requestService.removeByHrefSubstring(t)),this.requestService.setStaleByHrefSubstring(this.contentSource._links.self.href),this.collectionRD$.pipe((0,l.xw)(),(0,m.U)(t=>t.payload.uuid),(0,v.w)(t=>this.collectionService.updateContentSource(t,this.contentSource)),(0,B.q)(1)).subscribe(t=>{(0,d.Uh)(t.harvestType)?(this.clearNotifications(),this.initializeOriginalContentSource(t),this.displayedNotifications.push(this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved")))):this.displayedNotifications.push(t)})}onCancel(){this.location.back()}isValid(){return this.contentSource.harvestType===y.V.None||this.formGroup.valid}changeExternalSource(){this.contentSource.harvestType===y.V.None?this.contentSource.harvestType=this.previouslySelectedHarvestType:(this.previouslySelectedHarvestType=this.contentSource.harvestType,this.contentSource.harvestType=y.V.None),this.updateContentSource(!1)}updateContentSource(t){this.inputModels.forEach(n=>{this.updateContentSourceField(n,t)}),this.saveFieldUpdate()}updateContentSourceField(t,n){(0,d.Uh)(t.value)&&(t.id!==this.harvestTypeModel.id||n)&&(this.contentSource[t.id]=t.value)}saveFieldUpdate(){this.objectUpdatesService.saveAddFieldUpdate(this.url,(0,N.cloneDeep)(this.contentSource))}clearNotifications(){this.displayedNotifications.forEach(t=>{this.notificationsService.remove(t)}),this.displayedNotifications=[]}ngOnDestroy(){this.updateSub&&this.updateSub.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(Re.d),e.\u0275\u0275directiveInject(R.T),e.\u0275\u0275directiveInject(u.Ye),e.\u0275\u0275directiveInject(g.w1X),e.\u0275\u0275directiveInject(C.sK),e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(h.F0),e.\u0275\u0275directiveInject($.W),e.\u0275\u0275directiveInject(F.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-collection-source"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:24,vars:27,consts:[[1,"container-fluid"],[1,"d-inline-block","float-right","space-children-mr"],["class"," btn btn-danger",3,"disabled","click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],[1,"d-none","d-sm-inline"],["class","form-check mb-4",4,"ngIf"],[3,"message",4,"ngIf"],[4,"ngIf"],[1,"row"],[3,"formId","formGroup","formModel","formLayout","displaySubmit","displayCancel","dfChange","submitForm","cancel",4,"ngIf"],["class","container mt-2",4,"ngIf"],[3,"isEnabled","shouldShow","collection"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"form-check","mb-4"],["type","checkbox","id","externalSourceCheck",1,"form-check-input",3,"checked","change"],["for","externalSourceCheck",1,"form-check-label"],[3,"message"],[3,"formId","formGroup","formModel","formLayout","displaySubmit","displayCancel","dfChange","submitForm","cancel"],[1,"container","mt-2"],[1,"col-12"],[1,"d-inline-block","float-right","ml-1","space-children-mr"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275template(2,Xe,6,6,"button",2),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275template(4,Ke,5,3,"button",3),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementStart(6,"button",4),e.\u0275\u0275listener("click",function(){return n.onSubmit()}),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275element(8,"i",5),e.\u0275\u0275elementStart(9,"span",6),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(12,"h4"),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(15,Ye,5,4,"div",7),e.\u0275\u0275template(16,Qe,2,3,"ds-themed-loading",8),e.\u0275\u0275template(17,We,3,3,"h4",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"div",10),e.\u0275\u0275template(19,Je,1,6,"ds-form",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(20,et,14,12,"div",12),e.\u0275\u0275element(21,"ds-collection-source-controls",13),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275pipe(23,"async")),2&t){let o;e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(3,13,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(5,15,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(7,17,n.hasChanges())||!n.isValid()||n.initialHarvestType===n.harvestTypeNone&&n.contentSource.harvestType===n.initialHarvestType),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(11,19,"item.edit.metadata.save-button"),""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,21,"collection.edit.tabs.source.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.contentSource),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.contentSource),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.contentSource&&(null==n.contentSource?null:n.contentSource.harvestType)!==n.harvestTypeNone),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.formGroup&&n.contentSource&&(null==n.contentSource?null:n.contentSource.harvestType)!==n.harvestTypeNone),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==n.contentSource?null:n.contentSource.harvestType)!==n.harvestTypeNone),e.\u0275\u0275advance(1),e.\u0275\u0275property("isEnabled",!e.\u0275\u0275pipeBind1(22,23,n.hasChanges()))("shouldShow",(null==n.contentSource?null:n.contentSource.harvestType)!==n.harvestTypeNone)("collection",null==(o=e.\u0275\u0275pipeBind1(23,25,n.collectionRD$))?null:o.payload)}},directives:[u.O5,Fe.Z,Me.U,H.JL,H.sg,Ge],pipes:[u.Ov,C.X$],encapsulation:2}),i})();var nt=a(12141);const it=function(i){return{collection:i}};let ot=(()=>{class i{constructor(t,n){this.route=t,this.dsoNameService=n}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,B.q)(1),(0,m.U)(t=>t.dso)),this.collectionName$=this.dsoRD$.pipe((0,_.h)(t=>(0,d.Uh)(t)),(0,m.U)(t=>this.dsoNameService.getName(t.payload)))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz),e.\u0275\u0275directiveInject(P._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-collection-curate"]],decls:7,vars:11,consts:[[1,"container"],[3,"dsoHandle"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"h3"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(5,"ds-curation-form",1),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()),2&t){let o;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(3,2,"collection.curate.header",e.\u0275\u0275pureFunction1(9,it,e.\u0275\u0275pipeBind1(4,5,n.collectionName$)))),e.\u0275\u0275advance(3),e.\u0275\u0275property("dsoHandle",null==(o=e.\u0275\u0275pipeBind1(6,7,n.dsoRD$))?null:o.payload.handle)}},directives:[nt._],pipes:[C.X$,u.Ov],encapsulation:2}),i})();var at=a(45452);let rt=(()=>{class i{constructor(t){this.route=t}ngOnInit(){this.dsoRD$=this.route.parent.parent.data.pipe((0,M.P)(),(0,m.U)(t=>t.dso))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(h.gz))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-collection-authorizations"]],decls:3,vars:4,consts:[[1,"container"],[3,"resourceType","resourceUUID"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"ds-resource-policies",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&t){let o;e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","collection")("resourceUUID",null==(o=e.\u0275\u0275pipeBind1(2,2,n.dsoRD$))||null==o.payload?null:o.payload.id)}},directives:[at.F],pipes:[u.Ov],encapsulation:2}),i})();var st=a(64561),z=a(37443),lt=a(91870),k=a(66057),ct=a(40279),pt=a(18043),dt=a(30835),ut=a(28709),mt=a(9237);let ht=(()=>{class i extends pt.C{constructor(t,n,o){super(t,n,o),this.authorizationService=t,this.router=n,this.authService=o}getFeatureID(t,n){return(0,mt.of)(V.i.IsCollectionAdmin)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(dt._),e.\u0275\u0275inject(h.F0),e.\u0275\u0275inject(ut.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),vt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({providers:[k.b,z.a],imports:[[h.Bz.forChild([{path:"",resolve:{breadcrumb:st.t},data:{breadcrumbKey:"collection.edit"},component:me,canActivate:[ht],children:[{path:"",redirectTo:"metadata",pathMatch:"full"},{path:"metadata",component:Ie,data:{title:"collection.edit.tabs.metadata.title",hideReturnButton:!0,showBreadcrumbs:!0}},{path:"roles",component:Ee,data:{title:"collection.edit.tabs.roles.title",showBreadcrumbs:!0}},{path:"source",component:tt,data:{title:"collection.edit.tabs.source.title",showBreadcrumbs:!0}},{path:"curate",component:ot,data:{title:"collection.edit.tabs.curate.title",showBreadcrumbs:!0}},{path:"authorizations",data:{showBreadcrumbs:!0},children:[{path:"create",resolve:{resourcePolicyTarget:z.a},component:lt.v,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:k.b},component:ct.x,data:{title:"resource-policies.edit.page.title"}},{path:"",component:rt,data:{title:"collection.edit.tabs.authorizations.title",showBreadcrumbs:!0}}]},{path:"mapper",component:se,data:{title:"collection.edit.tabs.item-mapper.title",hideReturnButton:!0,showBreadcrumbs:!0}}]}])]]}),i})();var ft=a(87533),St=a(36331),Ct=a(48197),gt=a(39570);let bt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({imports:[[u.ez,G.m,vt,ft.s,St.q,Ct.e,gt.H]]}),i})()}}]);