"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[8951,194],{92414:(Z,w,o)=>{o.d(w,{CH:()=>l,EV:()=>S});var m=o(23631),P=o(50503);const l="groups";function S(g){return new m.R((0,P.sr)(),l,g).toString()}},98951:(Z,w,o)=>{o.r(w),o.d(w,{AccessControlModule:()=>Vt});var m=o(69808),P=o(74202),l=o(57981),x=o(61135),S=o(39841),g=o(63900),b=o(54004),f=o(95698),M=o(24789),$=o(45061),p=o(24702),H=o(82596),k=o(4177);class K{}var A=o(47235),C=o(19937),u=o(68285),B=o(18916),F=o(31241),R=o(62713),E=o(77467),e=o(5e3),G=o(86956),c=o(93075),W=o(17656),U=o(8108),T=o(39646),te=o(78372),Y=o(43499),ne=o(36146),j=o(71022),q=o(24755),Q=o(93369),D=o(93459),V=o(63311),_=o(48106),I=o(62697);function O(i,s){1&i&&e.\u0275\u0275element(0,"div")}function L(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"h4"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".create"))}}function xe(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"h4"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".edit"))}}const ye=function(i){return{"d-none":i}};function Pe(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().impersonate()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",18),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(6,ye,!e.\u0275\u0275pipeBind1(1,2,t.canImpersonate$))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,4,"admin.access-control.epeople.actions.impersonate")," ")}}function Ie(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",19),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().stopImpersonating()}),e.\u0275\u0275element(1,"i",18),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"admin.access-control.epeople.actions.stop-impersonating")," "))}function Ee(i,s){1&i&&e.\u0275\u0275element(0,"ds-themed-loading",20),2&i&&e.\u0275\u0275property("showMessage",!1)}function Ce(i,s){1&i&&e.\u0275\u0275element(0,"ds-themed-loading",20),2&i&&e.\u0275\u0275property("showMessage",!1)}const ue=function(i){return[i]};function Be(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",28),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",28)(4,"a",29),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).groupsDataService.startEditingNewGroup(a)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",28),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(3);let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(6,ue,n.groupsDataService.getGroupEditPageRouterLink(t))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(r=e.\u0275\u0275pipeBind1(8,4,t.object))||null==r.payload?null:r.payload.name)}}function Fe(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-pagination",23),e.\u0275\u0275listener("pageChange",function(r){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).onPageChange(r)}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",24)(4,"table",25)(5,"thead")(6,"tr")(7,"th",26),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",26),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",26),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"tbody"),e.\u0275\u0275template(17,Be,9,8,"tr",27),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext(2);let n,r,a;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,9,t.groups))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,11,t.groups))||null==r.payload?null:r.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,13,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,15,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,17,t.messagePrefix+".table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(a=e.\u0275\u0275pipeBind1(18,19,t.groups))||null==a.payload?null:a.payload.page)}}function Ge(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",30)(1,"div"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div")(5,"button",31),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd()()()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,3,t.messagePrefix+".memberOfNoGroups")),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(7,ue,t.groupsDataService.getGroupRegistryRouterLink())),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(7,5,t.messagePrefix+".goToGroups"))}}function De(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"h5"),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(4,Ce,1,1,"ds-themed-loading",15),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275template(6,Fe,19,21,"ds-pagination",21),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275template(8,Ge,8,9,"div",22),e.\u0275\u0275pipe(9,"async"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,4,t.messagePrefix+".groupsEPersonIsMemberOf")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(5,6,t.groups)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(n=e.\u0275\u0275pipeBind1(7,8,t.groups))||null==n.payload?null:n.payload.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(r=e.\u0275\u0275pipeBind1(9,10,t.groups))||null==r.payload?null:r.payload.totalElements))}}let Te=(()=>{class i{constructor(t,n,r,a,d,v,y,h,z,N,ee,ce){this.changeDetectorRef=t,this.epersonService=n,this.groupsDataService=r,this.formBuilderService=a,this.translateService=d,this.notificationsService=v,this.authService=y,this.authorizationService=h,this.modalService=z,this.paginationService=N,this.requestService=ee,this.epersonRegistrationService=ce,this.labelPrefix="admin.access-control.epeople.form.",this.formId="eperson-form",this.messagePrefix="admin.access-control.epeople.form",this.formLayout={firstName:{grid:{host:"row"}},lastName:{grid:{host:"row"}},email:{grid:{host:"row"}},canLogIn:{grid:{host:"col col-sm-6 d-inline-block"}},requireCertificate:{grid:{host:"col col-sm-6 d-inline-block"}}},this.submitForm=new e.EventEmitter,this.cancelForm=new e.EventEmitter,this.subs=[],this.config=Object.assign(new k.r,{id:"gem",pageSize:5,currentPage:1}),this.isImpersonated=!1,this.subs.push(this.epersonService.getActiveEPerson().subscribe(me=>{this.epersonInitial=me,(0,p.Uh)(me)&&(this.isImpersonated=this.authService.isImpersonatingUser(me.id))}))}ngOnInit(){this.initialisePage()}initialisePage(){(0,S.a)(this.translateService.get(`${this.messagePrefix}.firstName`),this.translateService.get(`${this.messagePrefix}.lastName`),this.translateService.get(`${this.messagePrefix}.email`),this.translateService.get(`${this.messagePrefix}.canLogIn`),this.translateService.get(`${this.messagePrefix}.requireCertificate`),this.translateService.get(`${this.messagePrefix}.emailHint`)).subscribe(([t,n,r,a,d,v])=>{this.firstName=new U.b1u({id:"firstName",label:t,name:"firstName",validators:{required:null},required:!0}),this.lastName=new U.b1u({id:"lastName",label:n,name:"lastName",validators:{required:null},required:!0}),this.email=new U.b1u({id:"email",label:r,name:"email",validators:{required:null,pattern:"^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$"},required:!0,errorMessages:{emailTaken:"error.validation.emailTaken",pattern:"error.validation.NotValidEmail"},hint:v}),this.canLogIn=new U.dwp({id:"canLogIn",label:a,name:"canLogIn",value:null==this.epersonInitial||this.epersonInitial.canLogIn}),this.requireCertificate=new U.dwp({id:"requireCertificate",label:d,name:"requireCertificate",value:null!=this.epersonInitial&&this.epersonInitial.requireCertificate}),this.formModel=[this.firstName,this.lastName,this.email,this.canLogIn,this.requireCertificate],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.subs.push(this.epersonService.getActiveEPerson().subscribe(h=>{null!=h&&(this.groups=this.groupsDataService.findListByHref(h._links.groups.href,{currentPage:1,elementsPerPage:this.config.pageSize})),this.formGroup.patchValue({firstName:null!=h?h.firstMetadataValue("eperson.firstname"):"",lastName:null!=h?h.firstMetadataValue("eperson.lastname"):"",email:null!=h?h.email:"",canLogIn:null==h||h.canLogIn,requireCertificate:null!=h&&h.requireCertificate}),null===h&&this.formGroup.controls.email&&(this.formGroup.controls.email.setAsyncValidators(class re{static createValidator(s){return t=>s.getEPersonByEmail(t.value).pipe((0,u.xw)(),(0,b.U)(n=>n.payload?{emailTaken:!0}:null))}}.createValidator(this.epersonService)),this.emailValueChangeSubscribe=this.email.valueChanges.pipe((0,te.b)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()}))}));const y=this.epersonService.getActiveEPerson();this.groups=y.pipe((0,g.w)(h=>(0,S.a)([(0,T.of)(h),this.paginationService.getFindListOptions(this.config.id,{currentPage:1,elementsPerPage:this.config.pageSize})])),(0,g.w)(([h,z])=>null!=h?this.groupsDataService.findListByHref(h._links.groups.href,z,!0,!0,(0,Q.l)("object")):(0,T.of)(void 0))),this.canImpersonate$=y.pipe((0,g.w)(h=>(0,p.Uh)(h)?this.authorizationService.isAuthorized(A.i.LoginOnBehalfOf,h.self):(0,T.of)(!1))),this.canDelete$=y.pipe((0,g.w)(h=>this.authorizationService.isAuthorized(A.i.CanDelete,(0,p.Uh)(h)?h.self:void 0))),this.canReset$=(0,T.of)(!0)})}onCancel(){this.epersonService.cancelEditEPerson(),this.cancelForm.emit()}onSubmit(){this.epersonService.getActiveEPerson().pipe((0,f.q)(1)).subscribe(t=>{const n={metadata:{"eperson.firstname":[{value:this.firstName.value}],"eperson.lastname":[{value:this.lastName.value}]},email:this.email.value,canLogIn:this.canLogIn.value,requireCertificate:this.requireCertificate.value};null==t?this.createNewEPerson(n):this.editEPerson(t,n)})}createNewEPerson(t){const n=Object.assign(new ne.T,t);this.epersonService.create(n).pipe((0,u.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.created.success",{name:n.name})),this.submitForm.emit(n)):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.created.failure",{name:n.name})),this.cancelForm.emit())}),this.showNotificationIfEmailInUse(n,"created")}editEPerson(t,n){const r=Object.assign(new ne.T,{id:t.id,metadata:{"eperson.firstname":[{value:this.firstName.value?this.firstName.value:t.firstMetadataValue("eperson.firstname")}],"eperson.lastname":[{value:this.lastName.value?this.lastName.value:t.firstMetadataValue("eperson.lastname")}]},email:(0,p.Uh)(n.email)?n.email:t.email,canLogIn:(0,p.Uh)(n.canLogIn)?n.canLogIn:t.canLogIn,requireCertificate:(0,p.Uh)(n.requireCertificate)?n.requireCertificate:t.requireCertificate,_links:t._links});this.epersonService.updateEPerson(r).pipe((0,u.hC)()).subscribe(d=>{d.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.edited.success",{name:r.name})),this.submitForm.emit(r)):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.edited.failure",{name:r.name})),this.cancelForm.emit())}),null!=n.email&&n.email!==t.email&&this.showNotificationIfEmailInUse(r,"edited")}onPageChange(t){this.updateGroups({currentPage:t,elementsPerPage:this.config.pageSize})}impersonate(){this.authService.impersonate(this.epersonInitial.id),this.isImpersonated=!0}delete(){this.epersonService.getActiveEPerson().pipe((0,f.q)(1)).subscribe(t=>{const n=this.modalService.open(B.Y);n.componentInstance.dso=t,n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,f.q)(1)).subscribe(r=>{r&&(0,p.Uh)(t.id)&&this.epersonService.deleteEPerson(t).pipe((0,u.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:t.name})),this.submitForm.emit()):this.notificationsService.error("Error occured when trying to delete EPerson with id: "+t.id+" with code: "+a.statusCode+" and message: "+a.errorMessage),this.cancelForm.emit()})})})}stopImpersonating(){this.authService.stopImpersonatingAndRefresh(),this.isImpersonated=!1}resetPassword(){(0,p.Uh)(this.epersonInitial.email)&&this.epersonRegistrationService.registerEmail(this.epersonInitial.email).pipe((0,u.hC)()).subscribe(t=>{t.hasSucceeded?this.notificationsService.success(this.translateService.get("admin.access-control.epeople.actions.reset"),this.translateService.get("forgot-email.form.success.content",{email:this.epersonInitial.email})):this.notificationsService.error(this.translateService.get("forgot-email.form.error.head"),this.translateService.get("forgot-email.form.error.content",{email:this.epersonInitial.email}))})}ngOnDestroy(){this.onCancel(),this.subs.filter(t=>(0,p.Uh)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id),(0,p.Uh)(this.emailValueChangeSubscribe)&&this.emailValueChangeSubscribe.unsubscribe()}reset(){this.epersonService.getActiveEPerson().pipe((0,f.q)(1)).subscribe(t=>{this.requestService.removeByHrefSubstring(t.self)}),this.initialisePage()}showNotificationIfEmailInUse(t,n){this.subs.push(this.epersonService.searchByScope("email",t.email,{currentPage:1,elementsPerPage:0}).pipe((0,u.xw)(),(0,u.xe)()).subscribe(r=>{r.totalElements>0&&this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification."+n+".failure.emailInUse",{name:t.name,email:t.email}))}))}updateGroups(t){this.subs.push(this.epersonService.getActiveEPerson().subscribe(n=>{this.groups=this.groupsDataService.findListByHref(n._links.groups.href,t)}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject($.k),e.\u0275\u0275directiveInject(Y.O),e.\u0275\u0275directiveInject(j.c),e.\u0275\u0275directiveInject(G.sK),e.\u0275\u0275directiveInject(H.T),e.\u0275\u0275directiveInject(q.e8),e.\u0275\u0275directiveInject(C._),e.\u0275\u0275directiveInject(W.FF),e.\u0275\u0275directiveInject(E.N),e.\u0275\u0275directiveInject(F.s),e.\u0275\u0275directiveInject(D.m))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-eperson-form"]],outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},decls:29,vars:31,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["createHeader",""],["editheader",""],[3,"formId","formModel","formGroup","formLayout","displayCancel","submitForm"],["before","",1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["between","",1,"btn-group"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fa","fa-key"],["between","",1,"btn-group","ml-1"],["class","btn btn-primary",3,"ngClass","click",4,"ngIf"],["class","btn btn-primary",3,"click",4,"ngIf"],["after","",1,"btn","btn-danger","delete-button",3,"disabled","click"],[1,"fas","fa-trash"],[3,"showMessage",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-primary",3,"ngClass","click"],[1,"fa","fa-user-secret"],[1,"btn","btn-primary",3,"click"],[3,"showMessage"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[4,"ngFor","ngForOf"],[1,"align-middle"],[3,"routerLink","click"],["role","alert",1,"alert","alert-info","w-100","mb-2"],[1,"btn","btn-primary",3,"routerLink"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,O,1,0,"div",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,L,3,3,"ng-template",null,1,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(4,xe,3,3,"ng-template",null,2,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementStart(6,"ds-form",3),e.\u0275\u0275listener("submitForm",function(){return n.onSubmit()}),e.\u0275\u0275elementStart(7,"div",4)(8,"button",5),e.\u0275\u0275listener("click",function(){return n.onCancel()}),e.\u0275\u0275element(9,"i",6),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(12,"div",7)(13,"button",8),e.\u0275\u0275listener("click",function(){return n.resetPassword()}),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275element(15,"i",9),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(18,"div",10),e.\u0275\u0275template(19,Pe,5,8,"button",11),e.\u0275\u0275template(20,Ie,4,3,"button",12),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",13),e.\u0275\u0275listener("click",function(){return n.delete()}),e.\u0275\u0275pipe(22,"async"),e.\u0275\u0275element(23,"i",14),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(26,Ee,1,1,"ds-themed-loading",15),e.\u0275\u0275template(27,De,10,12,"div",16),e.\u0275\u0275pipe(28,"async")),2&t){const r=e.\u0275\u0275reference(3),a=e.\u0275\u0275reference(5);e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,17,n.epersonService.getActiveEPerson()))("ngIfThen",a)("ngIfElse",r),e.\u0275\u0275advance(6),e.\u0275\u0275property("formId",n.formId)("formModel",n.formModel)("formGroup",n.formGroup)("formLayout",n.formLayout)("displayCancel",!1),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(11,19,n.messagePrefix+".return"),""),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(14,21,n.canReset$)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(17,23,"admin.access-control.epeople.actions.reset")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!n.isImpersonated),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.isImpersonated),e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(22,25,n.canDelete$)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(25,27,"admin.access-control.epeople.actions.delete")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.formGroup),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(28,29,n.epersonService.getActiveEPerson()))}},directives:[m.O5,V.U,c.JL,c.sg,m.mk,_.Z,I.Q,m.sg,P.yS,P.rH],pipes:[m.Ov,G.X$],encapsulation:2}),i})();function Le(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().isEPersonFormShown=!0}),e.\u0275\u0275element(2,"i",8),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,1,t.labelPrefix+"button.add"))}}function we(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-eperson-form",10),e.\u0275\u0275listener("submitForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().reset()})("cancelForm",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().isEPersonFormShown=!1}),e.\u0275\u0275elementEnd()}}function Oe(i,s){1&i&&e.\u0275\u0275element(0,"ds-themed-loading")}const Me=function(i){return{"table-primary":i}},de=function(i){return{name:i}};function Re(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr",30),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"td"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"td"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"td"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"td")(9,"div",31)(10,"button",32),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).toggleEditEPerson(a.eperson)}),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275element(12,"i",33),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"button",34),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).deleteEPerson(a.eperson)}),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275element(15,"i",35),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(15,Me,e.\u0275\u0275pipeBind1(1,7,n.isActive(t.eperson)))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(t.eperson.id),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.email),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(11,9,n.labelPrefix+"table.edit.buttons.edit",e.\u0275\u0275pureFunction1(17,de,t.eperson.name))),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(14,12,n.labelPrefix+"table.edit.buttons.remove",e.\u0275\u0275pureFunction1(19,de,t.eperson.name))),e.\u0275\u0275property("disabled",!t.ableToDelete)}}function je(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",25),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"div",26)(3,"table",27)(4,"thead")(5,"tr")(6,"th",28),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"th",28),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"th",28),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"th"),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(18,"tbody"),e.\u0275\u0275template(19,Re,16,21,"tr",29),e.\u0275\u0275pipe(20,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext(2);let n,r;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",t.pageInfoState$)("collectionSize",null==(n=e.\u0275\u0275pipeBind1(1,10,t.pageInfoState$))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,12,t.labelPrefix+"table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,14,t.labelPrefix+"table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,16,t.labelPrefix+"table.email")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,18,t.labelPrefix+"table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(20,20,t.ePeopleDto$))?null:r.page)}}function $e(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",36),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.labelPrefix+"no-items")," ")}}function Ae(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"h3",11),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"form",12),e.\u0275\u0275listener("ngSubmit",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext();return r.search(r.searchForm.value)}),e.\u0275\u0275elementStart(5,"div")(6,"select",13)(7,"option",14),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"option",15),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(13,"div",16)(14,"div",17),e.\u0275\u0275element(15,"input",18),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementStart(18,"span",19)(19,"button",20),e.\u0275\u0275element(20,"i",21),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(23,"div")(24,"button",22),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().clearFormAndResetResult()}),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(27,Oe,1,0,"ds-themed-loading",5),e.\u0275\u0275pipe(28,"async"),e.\u0275\u0275template(29,je,21,22,"ds-pagination",23),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275template(32,$e,3,3,"div",24),e.\u0275\u0275pipe(33,"async"),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,11,t.labelPrefix+"search.head")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",t.searchForm),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,13,t.labelPrefix+"search.scope.metadata")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,15,t.labelPrefix+"search.scope.email")),e.\u0275\u0275advance(4),e.\u0275\u0275property("placeholder",e.\u0275\u0275pipeBind1(17,19,t.labelPrefix+"search.placeholder")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(16,17,t.labelPrefix+"search.placeholder")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(22,21,t.labelPrefix+"search.button")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(26,23,t.labelPrefix+"button.see-all")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(28,25,t.searching$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(n=e.\u0275\u0275pipeBind1(30,27,t.pageInfoState$))?null:n.totalElements)>0&&!e.\u0275\u0275pipeBind1(31,29,t.searching$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0==(null==(r=e.\u0275\u0275pipeBind1(33,31,t.pageInfoState$))?null:r.totalElements))}}let Ue=(()=>{class i{constructor(t,n,r,a,d,v,y,h,z){this.epersonService=t,this.translateService=n,this.notificationsService=r,this.authorizationService=a,this.formBuilder=d,this.router=v,this.modalService=y,this.paginationService=h,this.requestService=z,this.labelPrefix="admin.access-control.epeople.",this.ePeople$=new x.X((0,M.b)(new R.S,[])),this.ePeopleDto$=new x.X({}),this.pageInfoState$=new x.X(void 0),this.searching$=new x.X(!1),this.config=Object.assign(new k.r,{id:"elp",pageSize:5,currentPage:1}),this.subs=[],this.currentSearchQuery="",this.currentSearchScope="metadata",this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}ngOnInit(){this.initialisePage()}initialisePage(){this.searching$.next(!0),this.isEPersonFormShown=!1,this.search({scope:this.currentSearchScope,query:this.currentSearchQuery}),this.subs.push(this.epersonService.getActiveEPerson().subscribe(t=>{null!=t&&t.id&&(this.isEPersonFormShown=!0)})),this.subs.push(this.ePeople$.pipe((0,g.w)(t=>t.pageInfo.totalElements>0?(0,S.a)(...t.page.map(n=>this.authorizationService.isAuthorized(A.i.CanDelete,(0,p.Uh)(n)?n.self:void 0).pipe((0,b.U)(r=>{const a=new K;return a.ableToDelete=r,a.eperson=n,a})))).pipe((0,b.U)(n=>(0,M.b)(t.pageInfo,n))):[t])).subscribe(t=>{this.searching$.next(!1),this.ePeopleDto$.next(t),this.pageInfoState$.next(t.pageInfo)}))}search(t){this.searching$.next(!0),(0,p.Uh)(this.findListOptionsSub)&&this.findListOptionsSub.unsubscribe(),this.findListOptionsSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,g.w)(n=>{const r=t.query,a=t.scope;return null!=r&&this.currentSearchQuery!==r&&(this.router.navigate([this.epersonService.getEPeoplePageRouterLink()],{queryParamsHandling:"merge"}),this.currentSearchQuery=r,this.paginationService.resetPage(this.config.id)),null!=a&&this.currentSearchScope!==a&&(this.router.navigate([this.epersonService.getEPeoplePageRouterLink()],{queryParamsHandling:"merge"}),this.currentSearchScope=a,this.paginationService.resetPage(this.config.id)),this.epersonService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:n.currentPage,elementsPerPage:n.pageSize})}),(0,u.g1)()).subscribe(n=>{this.ePeople$.next(n.payload),this.pageInfoState$.next(n.payload.pageInfo)})}isActive(t){return this.getActiveEPerson().pipe((0,b.U)(n=>t===n))}getActiveEPerson(){return this.epersonService.getActiveEPerson()}toggleEditEPerson(t){this.getActiveEPerson().pipe((0,f.q)(1)).subscribe(n=>{t===n?(this.epersonService.cancelEditEPerson(),this.isEPersonFormShown=!1):(this.epersonService.editEPerson(t),this.isEPersonFormShown=!0)}),this.scrollToTop()}deleteEPerson(t){if((0,p.Uh)(t.id)){const n=this.modalService.open(B.Y);n.componentInstance.dso=t,n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,f.q)(1)).subscribe(r=>{r&&(0,p.Uh)(t.id)&&this.epersonService.deleteEPerson(t).pipe((0,u.hC)()).subscribe(a=>{a.hasSucceeded?this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:t.name})):this.notificationsService.error("Error occured when trying to delete EPerson with id: "+t.id+" with code: "+a.statusCode+" and message: "+a.errorMessage)})})}}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){this.subs.filter(t=>(0,p.Uh)(t)).forEach(t=>t.unsubscribe())}scrollToTop(){!function t(){const n=document.documentElement.scrollTop||document.body.scrollTop;n>0&&(window.requestAnimationFrame(t),window.scrollTo(0,n-n/8))}()}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}reset(){this.epersonService.getBrowseEndpoint().pipe((0,f.q)(1)).subscribe(t=>{this.requestService.setStaleByHrefSubstring(t).pipe((0,f.q)(1)).subscribe(()=>{this.epersonService.cancelEditEPerson(),this.isEPersonFormShown=!1})})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject($.k),e.\u0275\u0275directiveInject(G.sK),e.\u0275\u0275directiveInject(H.T),e.\u0275\u0275directiveInject(C._),e.\u0275\u0275directiveInject(c.qu),e.\u0275\u0275directiveInject(P.F0),e.\u0275\u0275directiveInject(W.FF),e.\u0275\u0275directiveInject(E.N),e.\u0275\u0275directiveInject(F.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-epeople-registry"]],decls:10,vars:6,consts:[[1,"container"],[1,"epeople-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[4,"ngIf"],[3,"submitForm","cancelForm",4,"ngIf"],[1,"mr-auto","btn","btn-success","addEPerson-button",3,"click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[3,"submitForm","cancelForm"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"search-button","btn","btn-secondary",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epeople",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm","access-control-editEPersonButton",3,"title","click"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-danger","btn-sm","access-control-deleteEPersonButton",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(7,Le,6,3,"div",5),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(8,we,1,0,"ds-eperson-form",6),e.\u0275\u0275template(9,Ae,34,33,"div",5),e.\u0275\u0275elementEnd()()()),2&t&&(e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,4,n.labelPrefix+"head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.isEPersonFormShown),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.isEPersonFormShown),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.isEPersonFormShown))},directives:[m.O5,Te,c._Y,c.JL,c.sg,c.EJ,c.JJ,c.u,c.YN,c.Kr,c.Fj,_.Z,I.Q,m.sg,m.mk],pipes:[G.X$,m.Ov],encapsulation:2}),i})();var Ne=o(39300),ge=o(70262),ke=o(95376),Ve=o(43438),fe=o(83360),ze=o(13748),He=o(22979),We=o(21721),Qe=o(74711),Xe=o(38605),ae=o(46590),oe=o(86099);const se=function(i){return{name:i}};function Ke(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",25),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).deleteMemberFromGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",26),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(4,se,t.eperson.name)))}}function Ye(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",27),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).addMemberToGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",28),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.add",e.\u0275\u0275pureFunction1(4,se,t.eperson.name)))}}const he=function(i){return[i]};function Ze(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",19),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",19)(4,"a",21),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).ePersonDataService.startEditingNewEPerson(a.eperson)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",19),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275element(9,"br"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"td",19)(13,"div",22),e.\u0275\u0275template(14,Ke,3,6,"button",23),e.\u0275\u0275template(15,Ye,3,6,"button",24),e.\u0275\u0275elementEnd()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(13,he,n.ePersonDataService.getEPeoplePageRouterLink())),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.eperson.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(8,9,n.messagePrefix+".table.email"),": ",t.eperson.email?t.eperson.email:"-",""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(11,11,n.messagePrefix+".table.netid"),": ",t.eperson.netid?t.eperson.netid:"-"," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",t.memberOfGroup),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.memberOfGroup)}}function qe(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",15),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",16)(4,"table",17)(5,"thead")(6,"tr")(7,"th",18),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",18),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",18),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th",19),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,Ze,16,15,"tr",20),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("paginationOptions",t.configSearch)("pageInfoState",e.\u0275\u0275pipeBind1(1,10,t.ePeopleSearchDtos))("collectionSize",null==(n=e.\u0275\u0275pipeBind1(2,12,t.ePeopleSearchDtos))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.identity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(21,22,t.ePeopleSearchDtos))?null:r.page)}}function et(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",29),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-items")," ")}}function tt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",19),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",19)(4,"a",21),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).ePersonDataService.startEditingNewEPerson(a.eperson)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",19),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275element(9,"br"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"td",19)(13,"div",22)(14,"button",25),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).deleteMemberFromGroup(a)}),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275element(16,"i",26),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.eperson.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(15,he,n.ePersonDataService.getEPeoplePageRouterLink())),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.eperson.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(8,8,n.messagePrefix+".table.email"),": ",t.eperson.email?t.eperson.email:"-",""),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(11,10,n.messagePrefix+".table.netid"),": ",t.eperson.netid?t.eperson.netid:"-"," "),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(15,12,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(17,se,t.eperson.name)))}}function nt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",15),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",16)(4,"table",30)(5,"thead")(6,"tr")(7,"th",18),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",18),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",18),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th",19),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,tt,17,19,"tr",20),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",e.\u0275\u0275pipeBind1(1,10,t.ePeopleMembersOfGroupDtos))("collectionSize",null==(n=e.\u0275\u0275pipeBind1(2,12,t.ePeopleMembersOfGroupDtos))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.identity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(21,22,t.ePeopleMembersOfGroupDtos))?null:r.page)}}function it(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",29),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-members-yet")," ")}}var J=(()=>{return(i=J||(J={}))[i.ActiveGroup=0]="ActiveGroup",i[i.MembersDTO=1]="MembersDTO",i[i.SearchResultsDTO=2]="SearchResultsDTO",J;var i})();let rt=(()=>{class i{constructor(t,n,r,a,d,v,y){this.groupDataService=t,this.ePersonDataService=n,this.translateService=r,this.notificationsService=a,this.formBuilder=d,this.paginationService=v,this.router=y,this.ePeopleSearchDtos=new x.X(void 0),this.ePeopleMembersOfGroupDtos=new x.X(void 0),this.configSearch=Object.assign(new k.r,{id:"sml",pageSize:5,currentPage:1}),this.config=Object.assign(new k.r,{id:"ml",pageSize:5,currentPage:1}),this.subs=new Map,this.currentSearchQuery="",this.currentSearchScope="metadata"}ngOnInit(){this.searchForm=this.formBuilder.group({scope:"metadata",query:""}),this.subs.set(J.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(t=>{null!=t&&(this.groupBeingEdited=t,this.retrieveMembers(this.config.currentPage))}))}retrieveMembers(t){this.unsubFrom(J.MembersDTO),this.subs.set(J.MembersDTO,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,g.w)(n=>this.ePersonDataService.findListByHref(this.groupBeingEdited._links.epersons.href,{currentPage:n.currentPage,elementsPerPage:n.pageSize})),(0,u.f1)(),(0,b.U)(n=>{if(!n.hasFailed)return n;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:n.errorMessage}))}),(0,g.w)(n=>(0,S.a)([...n.payload.page.map(a=>(0,S.a)(this.isMemberOfGroup(a),v=>{const y=new K;return y.eperson=a,y.memberOfGroup=v,y}))]).pipe((0,ae.d)([]),(0,b.U)(a=>(0,M.b)(n.payload.pageInfo,a))))).subscribe(n=>{this.ePeopleMembersOfGroupDtos.next(n)}))}isMemberOfGroup(t){return this.groupDataService.getActiveGroup().pipe((0,f.q)(1),(0,oe.z)(n=>null!=n?this.ePersonDataService.findListByHref(n._links.epersons.href,{currentPage:1,elementsPerPage:9999}).pipe((0,u.xw)(),(0,u.xe)(),(0,b.U)(r=>r.page.filter(a=>a.id===t.id)),(0,b.U)(r=>r.length>0)):(0,T.of)(!1)))}unsubFrom(t){this.subs.has(t)&&(this.subs.get(t).unsubscribe(),this.subs.delete(t))}deleteMemberFromGroup(t){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{if(null!=n){const r=this.groupDataService.deleteMemberFromGroup(n,t.eperson);this.showNotifications("deleteMember",r,t.eperson.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addMemberToGroup(t){t.memberOfGroup=!0,this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{if(null!=n){const r=this.groupDataService.addMemberToGroup(n,t.eperson);this.showNotifications("addMember",r,t.eperson.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(t){this.unsubFrom(J.SearchResultsDTO),this.subs.set(J.SearchResultsDTO,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,g.w)(n=>{const r=t.query,a=t.scope;return null!=r&&this.currentSearchQuery!==r&&this.groupBeingEdited&&(this.router.navigate([],{queryParamsHandling:"merge"}),this.currentSearchQuery=r,this.paginationService.resetPage(this.configSearch.id)),null!=a&&this.currentSearchScope!==a&&this.groupBeingEdited&&(this.router.navigate([],{queryParamsHandling:"merge"}),this.currentSearchScope=a,this.paginationService.resetPage(this.configSearch.id)),this.searchDone=!0,this.ePersonDataService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:n.currentPage,elementsPerPage:n.pageSize})}),(0,u.f1)(),(0,b.U)(n=>{if(!n.hasFailed)return n;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:n.errorMessage}))}),(0,g.w)(n=>(0,S.a)([...n.payload.page.map(a=>(0,S.a)(this.isMemberOfGroup(a),v=>{const y=new K;return y.eperson=a,y.memberOfGroup=v,y}))]).pipe((0,ae.d)([]),(0,b.U)(a=>(0,M.b)(n.payload.pageInfo,a))))).subscribe(n=>{this.ePeopleSearchDtos.next(n)}))}ngOnDestroy(){for(const t of this.subs.keys())this.unsubFrom(t);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(t,n,r,a){n.pipe((0,u.hC)()).subscribe(d=>{d.hasSucceeded?this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+t,{name:r})):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+t,{name:r}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(Y.O),e.\u0275\u0275directiveInject($.k),e.\u0275\u0275directiveInject(G.sK),e.\u0275\u0275directiveInject(H.T),e.\u0275\u0275directiveInject(c.qu),e.\u0275\u0275directiveInject(E.N),e.\u0275\u0275directiveInject(P.F0))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-members-list"]],inputs:{messagePrefix:"messagePrefix"},decls:40,vars:36,consts:[[1,"border-bottom","pb-2"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epersonsSearch",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[1,"align-middle"],[4,"ngFor","ngForOf"],[3,"routerLink","click"],[1,"btn-group","edit-field"],["class","btn btn-outline-danger btn-sm",3,"title","click",4,"ngIf"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm",3,"title","click"],[1,"fas","fa-plus","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","ePeopleMembersOfGroup",1,"table","table-striped","table-hover","table-bordered"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"h3",0),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"h4",1),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"form",2),e.\u0275\u0275listener("ngSubmit",function(){return n.search(n.searchForm.value)}),e.\u0275\u0275elementStart(8,"div")(9,"select",3)(10,"option",4),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"option",5),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"div",6)(17,"div",7),e.\u0275\u0275element(18,"input",8),e.\u0275\u0275elementStart(19,"span",9)(20,"button",10),e.\u0275\u0275element(21,"i",11),e.\u0275\u0275text(22),e.\u0275\u0275pipe(23,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(24,"div")(25,"button",12),e.\u0275\u0275listener("click",function(){return n.clearFormAndResetResult()}),e.\u0275\u0275text(26),e.\u0275\u0275pipe(27,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(28,qe,22,24,"ds-pagination",13),e.\u0275\u0275pipe(29,"async"),e.\u0275\u0275template(30,et,3,3,"div",14),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275elementStart(32,"h4"),e.\u0275\u0275text(33),e.\u0275\u0275pipe(34,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(35,nt,22,24,"ds-pagination",13),e.\u0275\u0275pipe(36,"async"),e.\u0275\u0275template(37,it,3,3,"div",14),e.\u0275\u0275pipe(38,"async"),e.\u0275\u0275pipe(39,"async"),e.\u0275\u0275elementContainerEnd()),2&t){let r,a,d,v;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,12,n.messagePrefix+".head")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(6,14,n.messagePrefix+".search.head")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.searchForm),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,n.messagePrefix+".search.scope.metadata")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,n.messagePrefix+".search.scope.email")),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(23,20,n.messagePrefix+".search.button"),""),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(27,22,n.messagePrefix+".button.see-all")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(29,24,n.ePeopleSearchDtos))?null:r.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(a=e.\u0275\u0275pipeBind1(31,26,n.ePeopleSearchDtos))?null:a.totalElements)&&n.searchDone),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(34,28,n.messagePrefix+".headMembers")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(d=e.\u0275\u0275pipeBind1(36,30,n.ePeopleMembersOfGroupDtos))?null:d.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null==e.\u0275\u0275pipeBind1(38,32,n.ePeopleMembersOfGroupDtos)||0==(null==(v=e.\u0275\u0275pipeBind1(39,34,n.ePeopleMembersOfGroupDtos))?null:v.totalElements))}},directives:[c._Y,c.JL,c.sg,c.EJ,c.JJ,c.u,c.YN,c.Kr,c.Fj,m.O5,I.Q,m.sg,P.yS],pipes:[G.X$,m.Ov],encapsulation:2}),i})();const le=function(i){return{name:i}};function at(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",23),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).deleteSubgroupFromGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",24),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(4,le,t.name)))}}function ot(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"p"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".table.edit.currentGroup"))}}function st(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",25),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).addSubgroupToGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",26),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+".table.edit.buttons.add",e.\u0275\u0275pureFunction1(4,le,t.name)))}}const ve=function(i){return[i]};function lt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",16),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",16)(4,"a",18),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).groupDataService.startEditingNewGroup(a)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",16),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"td",16)(10,"div",19),e.\u0275\u0275template(11,at,3,6,"button",20),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275template(14,ot,3,3,"p",21),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275template(16,st,3,6,"button",22),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275pipe(18,"async"),e.\u0275\u0275elementEnd()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2);let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(19,ve,n.groupDataService.getGroupEditPageRouterLink(t))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(r=e.\u0275\u0275pipeBind1(8,7,t.object))||null==r.payload?null:r.payload.name),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(12,9,n.isSubgroupOfGroup(t))&&!e.\u0275\u0275pipeBind1(13,11,n.isActiveGroup(t))),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(15,13,n.isActiveGroup(t))),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(17,15,n.isSubgroupOfGroup(t))&&!e.\u0275\u0275pipeBind1(18,17,n.isActiveGroup(t)))}}function pt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",12),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",13)(4,"table",14)(5,"thead")(6,"tr")(7,"th",15),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",15),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",15),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th",16),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,lt,19,21,"tr",17),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r,a;e.\u0275\u0275property("paginationOptions",t.configSearch)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,10,t.searchResults$))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,12,t.searchResults$))||null==r.payload?null:r.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(a=e.\u0275\u0275pipeBind1(21,22,t.searchResults$))||null==a.payload?null:a.payload.page)}}function ct(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",27),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-items")," ")}}function mt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr")(1,"td",16),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td",16)(4,"a",18),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).groupDataService.startEditingNewGroup(a)}),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"td",16),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"td",16)(10,"div",19)(11,"button",23),e.\u0275\u0275listener("click",function(){const a=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(2).deleteSubgroupFromGroup(a)}),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275element(13,"i",24),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=s.$implicit,n=e.\u0275\u0275nextContext(2);let r;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.id),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(10,ve,n.groupDataService.getGroupEditPageRouterLink(t))),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(t.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(r=e.\u0275\u0275pipeBind1(8,5,t.object))||null==r.payload?null:r.payload.name),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(12,7,n.messagePrefix+".table.edit.buttons.remove",e.\u0275\u0275pureFunction1(12,le,t.name)))}}function ut(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",12),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"div",13)(4,"table",28)(5,"thead")(6,"tr")(7,"th",15),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"th",15),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(13,"th",15),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"th"),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"tbody"),e.\u0275\u0275template(20,mt,14,14,"tr",17),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r,a;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,10,t.subGroups$))?null:n.payload)("collectionSize",null==(r=e.\u0275\u0275pipeBind1(2,12,t.subGroups$))||null==r.payload?null:r.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(8),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,14,t.messagePrefix+".table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,16,t.messagePrefix+".table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,18,t.messagePrefix+".table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,t.messagePrefix+".table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(a=e.\u0275\u0275pipeBind1(21,22,t.subGroups$))||null==a.payload?null:a.payload.page)}}function dt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",27),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".no-subgroups-yet")," ")}}var X=(()=>{return(i=X||(X={}))[i.Members=0]="Members",i[i.ActiveGroup=1]="ActiveGroup",i[i.SearchResults=2]="SearchResults",X;var i})();let gt=(()=>{class i{constructor(t,n,r,a,d,v){this.groupDataService=t,this.translateService=n,this.notificationsService=r,this.formBuilder=a,this.paginationService=d,this.router=v,this.searchResults$=new x.X(void 0),this.subGroups$=new x.X(void 0),this.subs=new Map,this.configSearch=Object.assign(new k.r,{id:"ssgl",pageSize:5,currentPage:1}),this.config=Object.assign(new k.r,{id:"sgl",pageSize:5,currentPage:1}),this.currentSearchQuery=""}ngOnInit(){this.searchForm=this.formBuilder.group({query:""}),this.subs.set(X.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(t=>{null!=t&&(this.groupBeingEdited=t,this.retrieveSubGroups())}))}retrieveSubGroups(){this.unsubFrom(X.Members),this.subs.set(X.Members,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,g.w)(t=>this.groupDataService.findListByHref(this.groupBeingEdited._links.subgroups.href,{currentPage:t.currentPage,elementsPerPage:t.pageSize},!0,!0,(0,Q.l)("object")))).subscribe(t=>{this.subGroups$.next(t)}))}isSubgroupOfGroup(t){return this.groupDataService.getActiveGroup().pipe((0,f.q)(1),(0,oe.z)(n=>null!=n?n.uuid===t.uuid?(0,T.of)(!1):this.groupDataService.findListByHref(n._links.subgroups.href,{currentPage:1,elementsPerPage:9999}).pipe((0,u.xw)(),(0,u.xe)(),(0,b.U)(r=>r.page.filter(a=>a.id===t.id)),(0,b.U)(r=>r.length>0)):(0,T.of)(!1)))}isActiveGroup(t){return this.groupDataService.getActiveGroup().pipe((0,f.q)(1),(0,oe.z)(n=>(0,T.of)(null!=n&&n.uuid===t.uuid)))}deleteSubgroupFromGroup(t){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{if(null!=n){const r=this.groupDataService.deleteSubGroupFromGroup(n,t);this.showNotifications("deleteSubgroup",r,t.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addSubgroupToGroup(t){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{if(null!=n)if(n.uuid!==t.uuid){const r=this.groupDataService.addSubGroupToGroup(n,t);this.showNotifications("addSubgroup",r,t.name,n)}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.subgroupToAddIsActiveGroup"));else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(t){const n=t.query;null!=n&&this.currentSearchQuery!==n&&(this.router.navigateByUrl(this.groupDataService.getGroupEditPageRouterLink(this.groupBeingEdited)),this.currentSearchQuery=n,this.configSearch.currentPage=1),this.searchDone=!0,this.unsubFrom(X.SearchResults),this.subs.set(X.SearchResults,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,g.w)(r=>this.groupDataService.searchGroups(this.currentSearchQuery,{currentPage:r.currentPage,elementsPerPage:r.pageSize},!0,!0,(0,Q.l)("object")))).subscribe(r=>{this.searchResults$.next(r)}))}unsubFrom(t){this.subs.has(t)&&(this.subs.get(t).unsubscribe(),this.subs.delete(t))}ngOnDestroy(){for(const t of this.subs.keys())this.unsubFrom(t);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(t,n,r,a){n.pipe((0,u.hC)()).subscribe(d=>{d.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+t,{name:r})),this.groupDataService.clearGroupLinkRequests(a._links.subgroups.href)):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+t,{name:r}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(Y.O),e.\u0275\u0275directiveInject(G.sK),e.\u0275\u0275directiveInject(H.T),e.\u0275\u0275directiveInject(c.qu),e.\u0275\u0275directiveInject(E.N),e.\u0275\u0275directiveInject(P.F0))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-subgroups-list"]],inputs:{messagePrefix:"messagePrefix"},decls:31,vars:28,consts:[[1,"border-bottom","pb-2"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group","mr-3"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary","float-right",3,"click"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groupsSearch",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[1,"align-middle"],[4,"ngFor","ngForOf"],[3,"routerLink","click"],[1,"btn-group","edit-field"],["class","btn btn-outline-danger btn-sm deleteButton",3,"title","click",4,"ngIf"],[4,"ngIf"],["class","btn btn-outline-primary btn-sm addButton",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm","deleteButton",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm","addButton",3,"title","click"],[1,"fas","fa-plus","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","subgroupsOfGroup",1,"table","table-striped","table-hover","table-bordered"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"h3",0),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"h4",1),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"form",2),e.\u0275\u0275listener("ngSubmit",function(){return n.search(n.searchForm.value)}),e.\u0275\u0275elementStart(8,"div",3)(9,"div",4),e.\u0275\u0275element(10,"input",5),e.\u0275\u0275elementStart(11,"span",6)(12,"button",7),e.\u0275\u0275element(13,"i",8),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(16,"div")(17,"button",9),e.\u0275\u0275listener("click",function(){return n.clearFormAndResetResult()}),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(20,pt,22,24,"ds-pagination",10),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275template(22,ct,3,3,"div",11),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275elementStart(24,"h4"),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(27,ut,22,24,"ds-pagination",10),e.\u0275\u0275pipe(28,"async"),e.\u0275\u0275template(29,dt,3,3,"div",11),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275elementContainerEnd()),2&t){let r,a,d,v;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,10,n.messagePrefix+".head")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(6,12,n.messagePrefix+".search.head")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.searchForm),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(15,14,n.messagePrefix+".search.button")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(19,16,n.messagePrefix+".button.see-all")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(21,18,n.searchResults$))||null==r.payload?null:r.payload.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(a=e.\u0275\u0275pipeBind1(23,20,n.searchResults$))||null==a.payload?null:a.payload.totalElements)&&n.searchDone),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(26,22,n.messagePrefix+".headSubgroups")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(d=e.\u0275\u0275pipeBind1(28,24,n.subGroups$))||null==d.payload?null:d.payload.totalElements)>0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",0==(null==(v=e.\u0275\u0275pipeBind1(30,26,n.subGroups$))||null==v.payload?null:v.payload.totalElements))}},directives:[c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u,m.O5,I.Q,m.sg,P.yS],pipes:[G.X$,m.Ov],encapsulation:2}),i})();function ft(i,s){1&i&&e.\u0275\u0275element(0,"div")}function ht(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"h2",14),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".head.create"))}}function vt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"h2",14),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+".head.edit"))}}function bt(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-alert",15),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("type",t.AlertTypeEnum.Warning)("content",t.messagePrefix+".alert.permanent")}}const St=function(i,s,t){return{name:i,comcol:s,comcolEditRolesRoute:t}};function _t(i,s){if(1&i&&(e.\u0275\u0275element(0,"ds-alert",15),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async")),2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275property("type",t.AlertTypeEnum.Warning)("content",e.\u0275\u0275pipeBind2(1,2,t.messagePrefix+".alert.workflowGroup",e.\u0275\u0275pureFunction3(11,St,null==(n=e.\u0275\u0275pipeBind1(2,5,t.getLinkedDSO(t.groupBeingEdited)))||null==n.payload?null:n.payload.name,null==(n=e.\u0275\u0275pipeBind1(3,7,t.getLinkedDSO(t.groupBeingEdited)))||null==n.payload?null:n.payload.type,e.\u0275\u0275pipeBind1(4,9,t.getLinkedEditRolesRoute(t.groupBeingEdited)))))}}function xt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",16)(1,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().delete()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275element(3,"i",18),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(2,2,t.canEdit$)||t.groupBeingEdited.permanent),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,4,t.messagePrefix+".actions.delete")," ")}}function yt(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-members-list",19),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("messagePrefix",t.messagePrefix+".members-list")}}function Pt(i,s){if(1&i&&e.\u0275\u0275element(0,"ds-subgroups-list",19),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("messagePrefix",t.messagePrefix+".subgroups-list")}}let be=(()=>{class i{constructor(t,n,r,a,d,v,y,h,z,N,ee,ce){this.groupDataService=t,this.ePersonDataService=n,this.dSpaceObjectDataService=r,this.formBuilderService=a,this.translateService=d,this.notificationsService=v,this.route=y,this.router=h,this.authorizationService=z,this.modalService=N,this.requestService=ee,this.changeDetectorRef=ce,this.messagePrefix="admin.access-control.groups.form",this.formId="group-form",this.formLayout={groupName:{grid:{host:"row"}},groupDescription:{grid:{host:"row"}}},this.submitForm=new e.EventEmitter,this.cancelForm=new e.EventEmitter,this.subs=[],this.AlertTypeEnum=Qe.N}ngOnInit(){this.initialisePage()}initialisePage(){this.subs.push(this.route.params.subscribe(t=>{"newGroup"!==t.groupId&&this.setActiveGroup(t.groupId)})),this.canEdit$=this.groupDataService.getActiveGroup().pipe((0,p.tz)(),(0,g.w)(t=>(0,S.a)(this.authorizationService.isAuthorized(A.i.CanDelete,(0,p.UE)(t)?t.self:void 0),this.hasLinkedDSO(t),(n,r)=>n&&!r))),(0,S.a)(this.translateService.get(`${this.messagePrefix}.groupName`),this.translateService.get(`${this.messagePrefix}.groupCommunity`),this.translateService.get(`${this.messagePrefix}.groupDescription`)).subscribe(([t,n,r])=>{this.groupName=new U.b1u({id:"groupName",label:t,name:"groupName",validators:{required:null},required:!0}),this.groupCommunity=new U.b1u({id:"groupCommunity",label:n,name:"groupCommunity",required:!1,readOnly:!0}),this.groupDescription=new U.HBf({id:"groupDescription",label:r,name:"groupDescription",required:!1}),this.formModel=[this.groupName,this.groupDescription],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.formGroup.controls.groupName&&(this.formGroup.controls.groupName.setAsyncValidators(class Je{static createValidator(s){return t=>s.searchGroups(t.value,{currentPage:1,elementsPerPage:100}).pipe((0,u.LQ)(),(0,b.U)(n=>n.filter(r=>r.name===t.value)),(0,b.U)(n=>n.length>0?{groupExists:!0}:null))}}.createValidator(this.groupDataService)),this.groupNameValueChangeSubscribe=this.groupName.valueChanges.pipe((0,te.b)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()})),this.subs.push((0,S.a)(this.groupDataService.getActiveGroup(),this.canEdit$,this.groupDataService.getActiveGroup().pipe((0,Ne.h)(a=>(0,p.Uh)(a)),(0,g.w)(a=>this.getLinkedDSO(a).pipe((0,u.Gp)())))).subscribe(([a,d,v])=>{var y;null!=a&&(this.formGroup.controls.groupName.clearAsyncValidators(),this.groupBeingEdited=a,(null==v?void 0:v.name)?(this.formBuilderService.insertFormGroupControl(1,this.formGroup,this.formModel,this.groupCommunity),this.formGroup.patchValue({groupName:a.name,groupCommunity:null!==(y=null==v?void 0:v.name)&&void 0!==y?y:"",groupDescription:a.firstMetadataValue("dc.description")})):(this.formModel=[this.groupName,this.groupDescription],this.formGroup.patchValue({groupName:a.name,groupDescription:a.firstMetadataValue("dc.description")})),setTimeout(()=>{(!d||a.permanent)&&this.formGroup.disable()},200))}))})}onCancel(){this.groupDataService.cancelEditGroup(),this.cancelForm.emit(),this.router.navigate([this.groupDataService.getGroupRegistryRouterLink()])}onSubmit(){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(t=>{null===t?this.createNewGroup({name:this.groupName.value,metadata:{"dc.description":[{value:this.groupDescription.value}]}}):this.editGroup(t)})}createNewGroup(t){const n=Object.assign(new ze.Z,t);this.groupDataService.create(n).pipe((0,u.hC)()).subscribe(r=>{r.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.created.success",{name:n.name})),this.submitForm.emit(n),(0,p.UE)(r.payload)&&(this.setActiveGroupWithLink(r.payload._links.self.href),this.groupDataService.clearGroupsRequests(),this.router.navigateByUrl(this.groupDataService.getGroupEditPageRouterLinkWithID(r.payload.uuid)))):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.created.failure",{name:n.name})),this.showNotificationIfNameInUse(n,"created"),this.cancelForm.emit())})}showNotificationIfNameInUse(t,n){this.subs.push(this.groupDataService.searchGroups(t.name,{currentPage:1,elementsPerPage:0}).pipe((0,u.xw)(),(0,u.xe)()).subscribe(r=>{r.totalElements>0&&this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification."+n+".failure.groupNameInUse",{name:t.name}))}))}editGroup(t){let n=[];(0,p.Uh)(this.groupDescription.value)&&(n=[...n,{op:"replace",path:"/metadata/dc.description/0/value",value:this.groupDescription.value}]),(0,p.Uh)(this.groupName.value)&&(n=[...n,{op:"replace",path:"/name",value:this.groupName.value}]),this.groupDataService.patch(t,n).pipe((0,u.hC)()).subscribe(r=>{r.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.edited.success",{name:r.payload.name})),this.submitForm.emit(r.payload)):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.edited.failure",{name:t.name})),this.cancelForm.emit())})}setActiveGroup(t){this.groupDataService.cancelEditGroup(),this.groupDataService.findById(t).pipe((0,u.xw)(),(0,u.xe)()).subscribe(n=>{this.groupDataService.editGroup(n)})}setActiveGroupWithLink(t){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(n=>{null===n&&(this.groupDataService.cancelEditGroup(),this.groupDataService.findByHref(t,!1,!1,(0,Q.l)("subgroups"),(0,Q.l)("epersons"),(0,Q.l)("object")).pipe((0,u.xw)(),(0,u.xe)()).subscribe(r=>{this.groupDataService.editGroup(r)}))})}delete(){this.groupDataService.getActiveGroup().pipe((0,f.q)(1)).subscribe(t=>{const n=this.modalService.open(B.Y);n.componentInstance.dso=t,n.componentInstance.headerLabel=this.messagePrefix+".delete-group.modal.header",n.componentInstance.infoLabel=this.messagePrefix+".delete-group.modal.info",n.componentInstance.cancelLabel=this.messagePrefix+".delete-group.modal.cancel",n.componentInstance.confirmLabel=this.messagePrefix+".delete-group.modal.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,f.q)(1)).subscribe(r=>{r&&(0,p.Uh)(t.id)&&this.groupDataService.delete(t.id).pipe((0,u.hC)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.deleted.success",{name:t.name})),this.onCancel()):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.deleted.failure.title",{name:t.name}),this.translateService.get(this.messagePrefix+".notification.deleted.failure.content",{cause:a.errorMessage}))})})})}ngOnDestroy(){this.groupDataService.cancelEditGroup(),this.subs.filter(t=>(0,p.Uh)(t)).forEach(t=>t.unsubscribe()),(0,p.Uh)(this.groupNameValueChangeSubscribe)&&this.groupNameValueChangeSubscribe.unsubscribe()}hasLinkedDSO(t){if((0,p.Uh)(t)&&(0,p.Uh)(t._links.object.href))return this.getLinkedDSO(t).pipe((0,b.U)(n=>(0,p.Uh)(n)&&(0,p.Uh)(n.payload)),(0,ge.K)(()=>(0,T.of)(!1)))}getLinkedDSO(t){if((0,p.Uh)(t)&&(0,p.Uh)(t._links.object.href))return void 0===t.object?this.dSpaceObjectDataService.findByHref(t._links.object.href):t.object}getLinkedEditRolesRoute(t){if((0,p.Uh)(t)&&(0,p.Uh)(t._links.object.href))return this.getLinkedDSO(t).pipe((0,b.U)(n=>{if((0,p.Uh)(n)&&(0,p.Uh)(n.payload))switch(n.payload.type){case We.S.type.value:return(0,Ve.eq)(n.payload.id);case He.F.type.value:return(0,ke.Po)(n.payload.id)}}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(Y.O),e.\u0275\u0275directiveInject($.k),e.\u0275\u0275directiveInject(fe.D),e.\u0275\u0275directiveInject(j.c),e.\u0275\u0275directiveInject(G.sK),e.\u0275\u0275directiveInject(H.T),e.\u0275\u0275directiveInject(P.gz),e.\u0275\u0275directiveInject(P.F0),e.\u0275\u0275directiveInject(C._),e.\u0275\u0275directiveInject(W.FF),e.\u0275\u0275directiveInject(F.s),e.\u0275\u0275directiveInject(e.ChangeDetectorRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-group-form"]],hostBindings:function(t,n){1&t&&e.\u0275\u0275listener("beforeunload",function(){return n.ngOnDestroy()},!1,e.\u0275\u0275resolveWindow)},outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},decls:23,vars:22,consts:[[1,"container"],[1,"group-form","row"],[1,"col-12"],[4,"ngIf","ngIfThen","ngIfElse"],["createHeader",""],["editheader",""],[3,"type","content",4,"ngIf"],[3,"formId","formModel","formGroup","formLayout","displayCancel","submitForm"],["before","",1,"btn-group"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["after","","class","btn-group",4,"ngIf"],[1,"mb-5"],[3,"messagePrefix",4,"ngIf"],[1,"border-bottom","pb-2"],[3,"type","content"],["after","",1,"btn-group"],[1,"btn","btn-danger","delete-button",3,"disabled","click"],[1,"fa","fa-trash"],[3,"messagePrefix"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2),e.\u0275\u0275template(3,ft,1,0,"div",3),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,ht,3,3,"ng-template",null,4,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(7,vt,3,3,"ng-template",null,5,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275template(9,bt,1,2,"ds-alert",6),e.\u0275\u0275template(10,_t,5,15,"ds-alert",6),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275elementStart(13,"ds-form",7),e.\u0275\u0275listener("submitForm",function(){return n.onSubmit()}),e.\u0275\u0275elementStart(14,"div",8)(15,"button",9),e.\u0275\u0275listener("click",function(){return n.onCancel()}),e.\u0275\u0275element(16,"i",10),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(19,xt,6,6,"div",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"div",12),e.\u0275\u0275template(21,yt,1,1,"ds-members-list",13),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(22,Pt,1,1,"ds-subgroups-list",13),e.\u0275\u0275elementEnd()()()),2&t){const r=e.\u0275\u0275reference(6),a=e.\u0275\u0275reference(8);e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,14,n.groupDataService.getActiveGroup()))("ngIfThen",a)("ngIfElse",r),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",null==n.groupBeingEdited?null:n.groupBeingEdited.permanent),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(11,16,n.canEdit$)&&e.\u0275\u0275pipeBind1(12,18,n.groupDataService.getActiveGroup())),e.\u0275\u0275advance(3),e.\u0275\u0275property("formId",n.formId)("formModel",n.formModel)("formGroup",n.formGroup)("formLayout",n.formLayout)("displayCancel",!1),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,20,n.messagePrefix+".return"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null!=n.groupBeingEdited),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",null!=n.groupBeingEdited),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",null!=n.groupBeingEdited)}},directives:[m.O5,Xe.w,V.U,c.JL,c.sg,rt,gt],pipes:[m.Ov,G.X$],encapsulation:2}),i})();var It=o(60515),Et=o(18505);class Ct{}var Bt=o(5360);function Ft(i,s){1&i&&e.\u0275\u0275element(0,"ds-themed-loading")}const Se=function(i){return{name:i}};function Gt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"button",30),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",31),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,2,n.messagePrefix+"table.edit.buttons.edit",e.\u0275\u0275pureFunction1(5,Se,t.group.name))),e.\u0275\u0275property("routerLink",n.groupService.getGroupEditPageRouterLink(t.group))}}function Dt(i,s){1&i&&(e.\u0275\u0275elementStart(0,"button",32),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",31),e.\u0275\u0275elementEnd()),2&i&&e.\u0275\u0275property("disabled",!0)("ngbTooltip",e.\u0275\u0275pipeBind1(1,2,"admin.access-control.epeople.table.edit.buttons.edit-disabled"))}function Tt(i,s){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",33),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const r=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(2).deleteGroup(r)}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",34),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind2(1,1,n.messagePrefix+"table.edit.buttons.remove",e.\u0275\u0275pureFunction1(4,Se,t.group.name)))}}function Lt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"tr")(1,"td"),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"td"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(5,"td"),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"td"),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"td")(11,"div",25),e.\u0275\u0275elementContainerStart(12,26),e.\u0275\u0275template(13,Gt,3,7,"button",27),e.\u0275\u0275template(14,Dt,3,4,"button",28),e.\u0275\u0275elementContainerEnd(),e.\u0275\u0275template(15,Tt,3,6,"button",29),e.\u0275\u0275elementEnd()()()),2&i){const t=s.$implicit;let n;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.group.id),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(t.group.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(null==(n=e.\u0275\u0275pipeBind1(7,8,t.group.object))||null==n.payload?null:n.payload.name),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate((null==t.epersons?null:t.epersons.totalElements)+(null==t.subgroups?null:t.subgroups.totalElements)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngSwitch",t.ableToEdit),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",!0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngSwitchCase",!1),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!(null!=t.group&&t.group.permanent)&&t.ableToDelete)}}function wt(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",20),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"div",21)(3,"table",22)(4,"thead")(5,"tr")(6,"th",23),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"th",23),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"th",23),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"th",23),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"th"),e.\u0275\u0275text(19),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(21,"tbody"),e.\u0275\u0275template(22,Lt,16,10,"tr",24),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275elementEnd()()()()),2&i){const t=e.\u0275\u0275nextContext();let n,r;e.\u0275\u0275property("paginationOptions",t.config)("pageInfoState",t.pageInfoState$)("collectionSize",null==(n=e.\u0275\u0275pipeBind1(1,11,t.pageInfoState$))?null:n.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,13,t.messagePrefix+"table.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,15,t.messagePrefix+"table.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,17,t.messagePrefix+"table.collectionOrCommunity")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,19,t.messagePrefix+"table.members")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(20,21,t.messagePrefix+"table.edit")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(r=e.\u0275\u0275pipeBind1(23,23,t.groupsDto$))?null:r.page)}}function Ot(i,s){if(1&i&&(e.\u0275\u0275elementStart(0,"div",35),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,t.messagePrefix+"no-items")," ")}}const Mt=function(){return["newGroup"]};let Rt=(()=>{class i{constructor(t,n,r,a,d,v,y,h,z,N,ee){this.groupService=t,this.ePersonDataService=n,this.dSpaceObjectDataService=r,this.translateService=a,this.notificationsService=d,this.formBuilder=v,this.routeService=y,this.router=h,this.authorizationService=z,this.paginationService=N,this.requestService=ee,this.messagePrefix="admin.access-control.groups.",this.config=Object.assign(new k.r,{id:"gl",pageSize:5,currentPage:1}),this.groupsDto$=new x.X({}),this.deletedGroupsIds=[],this.pageInfoState$=new x.X(void 0),this.loading$=new x.X(!1),this.subs=[],this.currentSearchQuery="",this.searchForm=this.formBuilder.group({query:this.currentSearchQuery})}ngOnInit(){this.search({query:this.currentSearchQuery})}search(t){(0,p.Uh)(this.searchSub)&&(this.searchSub.unsubscribe(),this.subs=this.subs.filter(n=>n!==this.searchSub)),this.searchSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,Et.b)(()=>this.loading$.next(!0)),(0,g.w)(n=>{const r=t.query;return null!=r&&this.currentSearchQuery!==r&&(this.currentSearchQuery=r,this.paginationService.updateRouteWithUrl(this.config.id,[],{page:1})),this.groupService.searchGroups(this.currentSearchQuery.trim(),{currentPage:n.currentPage,elementsPerPage:n.pageSize},!0,!0,(0,Q.l)("object"))}),(0,u.g1)(),(0,u.xe)(),(0,g.w)(n=>0===n.page.length?(0,T.of)((0,M.b)(n.pageInfo,[])):this.authorizationService.isAuthorized(A.i.AdministratorOf).pipe((0,g.w)(r=>(0,S.a)([...n.page.map(a=>(0,p.Uh)(a)&&!this.deletedGroupsIds.includes(a.id)?(0,S.a)([this.authorizationService.isAuthorized(A.i.CanDelete,a.self),this.canManageGroup$(r,a),this.hasLinkedDSO(a),this.getSubgroups(a),this.getMembers(a)]).pipe((0,b.U)(([d,v,y,h,z])=>{const N=new Ct;return N.ableToDelete=d&&!y,N.ableToEdit=v,N.group=a,N.subgroups=h.payload,N.epersons=z.payload,N})):It.E)]).pipe((0,ae.d)([]),(0,b.U)(a=>(0,M.b)(n.pageInfo,a))))))).subscribe(n=>{this.groupsDto$.next(n),this.pageInfoState$.next(n.pageInfo),this.loading$.next(!1)}),this.subs.push(this.searchSub)}canManageGroup$(t,n){return t?(0,T.of)(!0):this.authorizationService.isAuthorized(A.i.CanManageGroup,n.self)}deleteGroup(t){(0,p.Uh)(t.group.id)&&this.groupService.delete(t.group.id).pipe((0,u.hC)()).subscribe(n=>{n.hasSucceeded?(this.deletedGroupsIds=[...this.deletedGroupsIds,t.group.id],this.notificationsService.success(this.translateService.get(this.messagePrefix+"notification.deleted.success",{name:t.group.name}))):this.notificationsService.error(this.translateService.get(this.messagePrefix+"notification.deleted.failure.title",{name:t.group.name}),this.translateService.get(this.messagePrefix+"notification.deleted.failure.content",{cause:n.errorMessage}))})}getMembers(t){return this.ePersonDataService.findListByHref(t._links.epersons.href).pipe((0,u.xw)())}getSubgroups(t){return this.groupService.findListByHref(t._links.subgroups.href).pipe((0,u.xw)())}hasLinkedDSO(t){return this.dSpaceObjectDataService.findByHref(t._links.object.href).pipe((0,u.xw)(),(0,b.U)(n=>(0,p.Uh)(n)&&(0,p.Uh)(n.payload)),(0,ge.K)(()=>(0,T.of)(!1)))}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){(0,p.Uh)(this.paginationSub)&&this.paginationSub.unsubscribe(),this.subs.filter(t=>(0,p.Uh)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(Y.O),e.\u0275\u0275directiveInject($.k),e.\u0275\u0275directiveInject(fe.D),e.\u0275\u0275directiveInject(G.sK),e.\u0275\u0275directiveInject(H.T),e.\u0275\u0275directiveInject(c.qu),e.\u0275\u0275directiveInject(Bt.MZ),e.\u0275\u0275directiveInject(P.F0),e.\u0275\u0275directiveInject(C._),e.\u0275\u0275directiveInject(E.N),e.\u0275\u0275directiveInject(F.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-groups-registry"]],decls:38,vars:35,consts:[[1,"container"],[1,"groups-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn-group","edit-field"],[3,"ngSwitch"],["class","btn btn-outline-primary btn-sm btn-edit",3,"routerLink","title",4,"ngSwitchCase"],["class","btn btn-outline-primary btn-sm btn-edit","placement","left",3,"disabled","ngbTooltip",4,"ngSwitchCase"],["class","btn btn-outline-danger btn-sm btn-delete",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],["placement","left",1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"disabled","ngbTooltip"],[1,"btn","btn-outline-danger","btn-sm","btn-delete",3,"title","click"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"div")(8,"button",5),e.\u0275\u0275element(9,"i",6),e.\u0275\u0275elementStart(10,"span",7),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(13,"h3",8),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"form",9),e.\u0275\u0275listener("ngSubmit",function(){return n.search(n.searchForm.value)}),e.\u0275\u0275elementStart(17,"div",10)(18,"div",11),e.\u0275\u0275element(19,"input",12),e.\u0275\u0275pipe(20,"translate"),e.\u0275\u0275pipe(21,"translate"),e.\u0275\u0275elementStart(22,"span",13)(23,"button",14),e.\u0275\u0275element(24,"i",15),e.\u0275\u0275text(25),e.\u0275\u0275pipe(26,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(27,"div")(28,"button",16),e.\u0275\u0275listener("click",function(){return n.clearFormAndResetResult()}),e.\u0275\u0275text(29),e.\u0275\u0275pipe(30,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(31,Ft,1,0,"ds-themed-loading",17),e.\u0275\u0275pipe(32,"async"),e.\u0275\u0275template(33,wt,24,25,"ds-pagination",18),e.\u0275\u0275pipe(34,"async"),e.\u0275\u0275pipe(35,"async"),e.\u0275\u0275template(36,Ot,3,3,"div",19),e.\u0275\u0275pipe(37,"async"),e.\u0275\u0275elementEnd()()()),2&t){let r,a;e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(6,12,n.messagePrefix+"head")),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction0(34,Mt)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,14,n.messagePrefix+"button.add")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(15,16,n.messagePrefix+"search.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("formGroup",n.searchForm),e.\u0275\u0275advance(3),e.\u0275\u0275property("placeholder",e.\u0275\u0275pipeBind1(21,20,n.messagePrefix+"search.placeholder")),e.\u0275\u0275attribute("aria-label",e.\u0275\u0275pipeBind1(20,18,n.messagePrefix+"search.placeholder")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(26,22,n.messagePrefix+"search.button")," "),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(30,24,n.messagePrefix+"button.see-all")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(32,26,n.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",(null==(r=e.\u0275\u0275pipeBind1(34,28,n.pageInfoState$))?null:r.totalElements)>0&&!e.\u0275\u0275pipeBind1(35,30,n.loading$)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",0==(null==(a=e.\u0275\u0275pipeBind1(37,32,n.pageInfoState$))?null:a.totalElements))}},directives:[P.rH,c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u,m.O5,_.Z,I.Q,m.sg,m.RF,m.n9,W._L],pipes:[G.X$,m.Ov],encapsulation:2}),i})();var pe=o(92414),ie=o(98655),jt=o(89141),$t=o(93498);let At=(()=>{class i extends jt.I{constructor(t,n,r,a){super(n,r,a),this.halEndpointService=t,this.authorizationService=n,this.router=r,this.authService=a,this.groupsEndpoint="groups"}getFeatureIDs(t,n){return(0,T.of)([A.i.CanManageGroup])}getObjectUrl(t,n){return this.halEndpointService.getEndpoint(this.groupsEndpoint).pipe((0,b.U)(r=>{var a;return`${r}/${null===(a=null==t?void 0:t.params)||void 0===a?void 0:a.groupId}`}))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject($t.q),e.\u0275\u0275inject(C._),e.\u0275\u0275inject(P.F0),e.\u0275\u0275inject(q.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var _e=o(20066),Ut=o(97874);let Nt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({imports:[[P.Bz.forChild([{path:"epeople",component:Ue,resolve:{breadcrumb:ie.t},data:{title:"admin.access-control.epeople.title",breadcrumbKey:"admin.access-control.epeople"},canActivate:[Ut.X]},{path:pe.CH,component:Rt,resolve:{breadcrumb:ie.t},data:{title:"admin.access-control.groups.title",breadcrumbKey:"admin.access-control.groups"},canActivate:[_e.E]},{path:`${pe.CH}/newGroup`,component:be,resolve:{breadcrumb:ie.t},data:{title:"admin.access-control.groups.title.addGroup",breadcrumbKey:"admin.access-control.groups.addGroup"},canActivate:[_e.E]},{path:`${pe.CH}/:groupId`,component:be,resolve:{breadcrumb:ie.t},data:{title:"admin.access-control.groups.title.singleGroup",breadcrumbKey:"admin.access-control.groups.singleGroup"},canActivate:[At]}])]]}),i})();var kt=o(10194);let Vt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({imports:[[m.ez,l.m,P.Bz,Nt,kt.e]]}),i})()},83772:(Z,w,o)=>{o.d(w,{a:()=>m});class m{constructor(l,x){this.text=l,this.url=x}}},98655:(Z,w,o)=>{o.d(w,{t:()=>S});var m=o(24702),P=o(78056),l=o(5e3),x=o(43001);let S=(()=>{class g{constructor(f){this.breadcrumbService=f}resolve(f,M){const $=f.data.breadcrumbKey;if((0,m.xI)($))throw new Error('You provided an i18nBreadcrumbResolver for url "'+f.url+"\" but no breadcrumbKey in the route's data");const p=(0,P.i)(f);return{provider:this.breadcrumbService,key:$,url:p}}}return g.\u0275fac=function(f){return new(f||g)(l.\u0275\u0275inject(x.d))},g.\u0275prov=l.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},43001:(Z,w,o)=>{o.d(w,{d:()=>S});var m=o(83772),P=o(39646),l=o(5e3);let S=(()=>{class g{getBreadcrumbs(f,M){return(0,P.of)([new m.a(f+".breadcrumbs",M)])}}return g.\u0275fac=function(f){return new(f||g)},g.\u0275prov=l.\u0275\u0275defineInjectable({token:g,factory:g.\u0275fac,providedIn:"root"}),g})()},93459:(Z,w,o)=>{o.d(w,{m:()=>A});var m=o(31241),P=o(93498),l=o(60602),x=o(39300),S=o(54004),g=o(40367),b=o(24702),f=o(37500),M=o(68285),$=o(47229),p=o(5e3);let H=(()=>{class C{parse(B,F){const R=F.payload,E=Object.assign(new f.Y,R);return new $.tp(F.statusCode,void 0,E)}}return C.\u0275fac=function(B){return new(B||C)},C.\u0275prov=p.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac,providedIn:"root"}),C})();var k=o(43015),K=o(40520);let A=(()=>{class C{constructor(B,F,R){this.requestService=B,this.rdbService=F,this.halService=R,this.linkPath="registrations",this.searchByTokenPath="/search/findByToken?token="}getRegistrationEndpoint(){return this.halService.getEndpoint(this.linkPath)}getTokenSearchEndpoint(B){return this.halService.getEndpoint(this.linkPath).pipe((0,x.h)(F=>(0,b.UE)(F)),(0,S.U)(F=>`${F}${this.searchByTokenPath}${B}`))}registerEmail(B,F=null){const R=new f.Y;R.email=B;const E=this.requestService.generateRequestId(),e=this.getRegistrationEndpoint(),G=Object.create({});let c=new K.WM;return F&&(c=c.append("x-recaptcha-token",F)),G.headers=c,e.pipe((0,g.s)(W=>(0,b.Uh)(W)),(0,S.U)(W=>{const U=new l.xo(E,W,R,G);this.requestService.send(U)})).subscribe(),this.rdbService.buildFromRequestUUID(E).pipe((0,M.hC)())}searchByToken(B){const F=this.requestService.generateRequestId(),R=this.getTokenSearchEndpoint(B).pipe((0,g.s)(E=>(0,b.Uh)(E)));return R.subscribe(E=>{const e=new l.Gl(F,E);Object.assign(e,{getResponseParser:()=>H}),this.requestService.send(e,!0)}),this.rdbService.buildSingle(R).pipe((0,S.U)(E=>E.hasSucceeded&&(0,b.Uh)(E.payload)?Object.assign(E,{payload:Object.assign(E.payload,{token:B})}):E))}}return C.\u0275fac=function(B){return new(B||C)(p.\u0275\u0275inject(m.s),p.\u0275\u0275inject(k.Q),p.\u0275\u0275inject(P.q))},C.\u0275prov=p.\u0275\u0275defineInjectable({token:C,factory:C.\u0275fac,providedIn:"root"}),C})()},10194:(Z,w,o)=>{o.d(w,{e:()=>re});var m=o(69808),P=o(63311),l=o(5e3),x=o(8108),S=o(66212);function g(D,V){if(1&D){const _=l.\u0275\u0275getCurrentView();l.\u0275\u0275elementStart(0,"ds-dynamic-form-control-container",1),l.\u0275\u0275listener("dfBlur",function(O){l.\u0275\u0275restoreView(_);const L=l.\u0275\u0275nextContext();return L.onCustomEvent(O,L.blur)})("dfChange",function(O){l.\u0275\u0275restoreView(_);const L=l.\u0275\u0275nextContext();return L.onCustomEvent(O,L.change)})("dfFocus",function(O){l.\u0275\u0275restoreView(_);const L=l.\u0275\u0275nextContext();return L.onCustomEvent(O,L.focus)})("ngbEvent",function(O){l.\u0275\u0275restoreView(_);const L=l.\u0275\u0275nextContext();return L.onCustomEvent(O,L.ngbEvent)}),l.\u0275\u0275elementEnd()}if(2&D){const _=V.$implicit,I=l.\u0275\u0275nextContext();l.\u0275\u0275classProp("d-none",_.hidden),l.\u0275\u0275property("formId",I.formId)("group",I.formGroup)("hasErrorMessaging",_.hasErrorMessages)("hidden",_.hidden)("layout",I.formLayout)("model",_)("templates",I.templates)("asBootstrapFormGroup",!0)}}let b=(()=>{class D extends x.rmD{constructor(_,I){super(_,I),this.blur=new l.EventEmitter,this.change=new l.EventEmitter,this.focus=new l.EventEmitter,this.ngbEvent=new l.EventEmitter}}return D.\u0275fac=function(_){return new(_||D)(l.\u0275\u0275directiveInject(l.ChangeDetectorRef),l.\u0275\u0275directiveInject(x.rJA))},D.\u0275cmp=l.\u0275\u0275defineComponent({type:D,selectors:[["ds-dynamic-form"]],contentQueries:function(_,I,O){if(1&_&&l.\u0275\u0275contentQuery(O,x.ATj,4),2&_){let L;l.\u0275\u0275queryRefresh(L=l.\u0275\u0275loadQuery())&&(I.templates=L)}},viewQuery:function(_,I){if(1&_&&l.\u0275\u0275viewQuery(S.B,5),2&_){let O;l.\u0275\u0275queryRefresh(O=l.\u0275\u0275loadQuery())&&(I.components=O)}},inputs:{formId:"formId",formGroup:"formGroup",formModel:"formModel",formLayout:"formLayout"},outputs:{blur:"dfBlur",change:"dfChange",focus:"dfFocus",ngbEvent:"ngbEvent"},features:[l.\u0275\u0275InheritDefinitionFeature],decls:1,vars:2,consts:[[3,"formId","group","hasErrorMessaging","hidden","d-none","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent",4,"ngFor","ngForOf","ngForTrackBy"],[3,"formId","group","hasErrorMessaging","hidden","layout","model","templates","asBootstrapFormGroup","dfBlur","dfChange","dfFocus","ngbEvent"]],template:function(_,I){1&_&&l.\u0275\u0275template(0,g,1,10,"ds-dynamic-form-control-container",0),2&_&&l.\u0275\u0275property("ngForOf",I.formModel)("ngForTrackBy",I.trackByFn)},directives:[m.sg,S.B],encapsulation:2}),D})();o(88766),o(21650),o(8671),o(55648),o(42803),o(28554),o(86471),o(22280),o(74043);var u=o(66319),B=o(79001),G=(o(19869),o(64204),o(53006),o(32272),o(57981)),c=o(86956),W=o(24440),ne=(o(93571),o(77410),o(29635),o(13457),o(65806)),j=o(93075),q=o(21283);let re=(()=>{class D{}return D.\u0275fac=function(_){return new(_||D)},D.\u0275mod=l.\u0275\u0275defineNgModule({type:D}),D.\u0275inj=l.\u0275\u0275defineInjector({providers:[{provide:x.y8$,useValue:S._}],imports:[[m.ez,x.H9g,ne.zj,W.t,G.m,c.aw]]}),D})();l.\u0275\u0275setComponentScope(u.i,[j.JL,j.sg,j.x0,m.mk,m.sg,S.B],[]),l.\u0275\u0275setComponentScope(B.s,[j.JL,j.sg,j.CE,m.mk,q.Wj,m.sg,q.Zt,q.Bh,j.x0,m.tP,S.B],[]),l.\u0275\u0275setComponentScope(P.U,[j._Y,j.JL,j.sg,b,x.ATj,m.O5],[c.X$,m.Ov])}}]);