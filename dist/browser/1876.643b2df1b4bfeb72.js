(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[1876],{92414:(K,R,r)=>{"use strict";r.d(R,{CH:()=>O,EV:()=>M});var _=r(23631),I=r(50503);const O="groups";function M(C){return new _.R((0,I.sr)(),O,C).toString()}},83772:(K,R,r)=>{"use strict";r.d(R,{a:()=>_});class _{constructor(O,u){this.text=O,this.url=u}}},77284:(K,R,r)=>{"use strict";r.d(R,{t:()=>x});var _=r(86362),I=r(68285),O=r(54004),u=r(24702),M=r(72839),C=r(5e3);let x=(()=>{class m{constructor(y,e){this.breadcrumbService=y,this.dataService=e}resolve(y,e){const b=y.params.id;return this.dataService.findById(b,!0,!1,...this.followLinks).pipe((0,I.hC)(),(0,I.xe)(),(0,O.U)(s=>{if((0,u.Uh)(s)){const j=e.url,T=j.substr(0,j.indexOf(b))+b;return{provider:this.breadcrumbService,key:s,url:T}}}))}}return m.\u0275fac=function(y){return new(y||m)(C.\u0275\u0275inject(_.B),C.\u0275\u0275inject(M.t))},m.\u0275prov=C.\u0275\u0275defineInjectable({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},86362:(K,R,r)=>{"use strict";r.d(R,{B:()=>b});var _=r(83772),I=r(39646),O=r(94476),u=r(93369),M=r(40367),C=r(63900),x=r(54004),m=r(24702),f=r(50503),y=r(5e3),e=r(83616);let b=(()=>{class s{constructor(T,$){this.linkService=T,this.dsoNameService=$}getBreadcrumbs(T,$){const d=this.dsoNameService.getName(T),Q=new _.a(d,$),L=T.getParentLinkKey();return this.linkService.resolveLink(T,(0,u.l)(L))[L].pipe((0,M.s)(F=>F.hasSucceeded||204===F.statusCode),(0,C.w)(F=>{if((0,m.Uh)(F.payload)){const h=F.payload;return this.getBreadcrumbs(h,(0,f.Y4)(h))}return(0,I.of)([])}),(0,x.U)(F=>[...F,Q]))}}return s.\u0275fac=function(T){return new(T||s)(y.\u0275\u0275inject(O.M),y.\u0275\u0275inject(e._))},s.\u0275prov=y.\u0275\u0275defineInjectable({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},68212:(K,R,r)=>{"use strict";r.d(R,{h:()=>O});var _=r(74307),I=r(54004);class O extends _.q{getFeatureIDs(M,C){return this.getFeatureID(M,C).pipe((0,I.U)(x=>[x]))}}},74307:(K,R,r)=>{"use strict";r.d(R,{q:()=>M});var _=r(68285),I=r(54004),O=r(24702),u=r(89141);class M extends u.I{constructor(x,m,f,y){super(m,f,y),this.resolver=x,this.authorizationService=m,this.router=f,this.authService=y}getObjectUrl(x,m){const f=this.getRouteWithDSOId(x);return this.resolver.resolve(f,m).pipe((0,_.mc)(),(0,I.U)(y=>y.self))}getRouteWithDSOId(x){let m=x;for(;(0,O.xI)(m.params.id)&&(0,O.Uh)(m.parent);)m=m.parent;return m}}},8136:(K,R,r)=>{"use strict";r.d(R,{K:()=>O});const I={RESOLVED:(0,r(79472).d)("dspace/resolver/RESOLVED")};class O{constructor(M,C){this.type=I.RESOLVED,this.payload={url:M,dso:C}}}},25226:(K,R,r)=>{"use strict";r.d(R,{a:()=>L});var _=r(39841),O=(r(33609),r(83639)),u=r(46040),M=r(82596),C=r(54004),x=r(18505),m=r(63900),f=r(50590),y=r(38030),e=r(21540),b=r(40747),s=r(68285),j=r(24702),T=r(27102),$=r(5e3),d=r(74202),Q=r(86956);let L=(()=>{class F extends y._{constructor(w,W,X,ee,te,J){super(W,ee,te),this.itemService=w,this.objectUpdatesService=W,this.router=X,this.notificationsService=ee,this.translateService=te,this.route=J}ngOnInit(){(0,j.Uh)(this.item)?this.setItem(this.item):this.itemUpdateSubscription=(0,_.a)([this.route.data,this.route.parent.data]).pipe((0,C.U)(([w,W])=>Object.assign({},w,W)),(0,C.U)(w=>w.dso),(0,x.b)(w=>{this.item=w.payload}),(0,m.w)(w=>this.itemService.findByHref(w.payload._links.self.href,!0,!0,...T.H)),(0,s.g1)()).subscribe(w=>{this.setItem(w.payload)}),this.discardTimeOut=e.N.item.edit.undoTimeout,this.url=this.router.url,this.url.indexOf("?")>0&&(this.url=this.url.substr(0,this.url.indexOf("?"))),this.hasChanges().pipe((0,f.P)()).subscribe(w=>{w?this.checkLastModified():this.initializeOriginalFields()}),this.initializeNotificationsPrefix(),this.initializeUpdates()}setItem(w){this.item=w,this.itemPageRoute=(0,b.Tt)(this.item),this.postItemInit(),this.initializeUpdates()}ngOnDestroy(){(0,j.Uh)(this.itemUpdateSubscription)&&this.itemUpdateSubscription.unsubscribe()}postItemInit(){}initializeUpdates(){}initializeNotificationsPrefix(){}initializeOriginalFields(){}submit(){}trackUpdate(w,W){return W&&W.field?W.field.uuid:void 0}isValid(){return this.objectUpdatesService.isValidPage(this.url)}checkLastModified(){const w=this.item.lastModified;this.objectUpdatesService.getLastModified(this.url).pipe((0,f.P)()).subscribe(W=>{W.getDate()!==w.getDate()&&(this.notificationsService.warning(this.getNotificationTitle("outdated"),this.getNotificationContent("outdated")),this.initializeOriginalFields())})}}return F.\u0275fac=function(w){return new(w||F)($.\u0275\u0275directiveInject(O.S),$.\u0275\u0275directiveInject(u.d),$.\u0275\u0275directiveInject(d.F0),$.\u0275\u0275directiveInject(M.T),$.\u0275\u0275directiveInject(Q.sK),$.\u0275\u0275directiveInject(d.gz))},F.\u0275cmp=$.\u0275\u0275defineComponent({type:F,selectors:[["ds-abstract-item-update"]],inputs:{item:"item"},features:[$.\u0275\u0275InheritDefinitionFeature],decls:0,vars:0,template:function(w,W){},encapsulation:2}),F})()},53018:(K,R,r)=>{"use strict";r.r(R),r.d(R,{EditItemPageModule:()=>Ai});var _=r(69808),I=r(17656),O=r(57981),u=r(74202),M=r(28652),C=r(39646),x=r(39841),m=r(54004),f=r(24702),y=r(40747),e=r(5e3),b=r(86956);const s=function(i){return{active:i}},j=function(i){return[i]};function T(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"a",17),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(5,s,t.page===n.currentPage))("routerLink",e.\u0275\u0275pureFunction1(7,j,"./"+t.page)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,3,"item.edit.tabs."+t.page+".head")," ")}}function $(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"button",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.tabs."+t.page+".head")," ")}}function d(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"li",13),e.\u0275\u0275template(1,T,3,9,"a",14),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementStart(3,"span",15),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275template(5,$,3,3,"button",16),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()()),2&i){const t=l.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(2,3,t.enabled)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbTooltip",e.\u0275\u0275pipeBind1(4,5,"item.edit.tabs.disabled.tooltip")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(6,7,t.enabled))}}let Q=(()=>{class i{constructor(t,n,a){this.route=t,this.router=n,this.injector=a,this.router.events.subscribe(()=>this.initPageParamsByRoute())}ngOnInit(){this.initPageParamsByRoute(),this.pages=this.route.routeConfig.children.filter(t=>(0,f.UE)(t.path)).map(t=>{let n=(0,C.of)(!0);return(0,f.UE)(t.canActivate)&&(n=(0,x.a)(t.canActivate.map(a=>this.injector.get(a).canActivate(this.route.snapshot,this.router.routerState.snapshot))).pipe((0,m.U)(a=>a.every(o=>!0===o)))),{page:t.path,enabled:n}}),this.itemRD$=this.route.data.pipe((0,m.U)(t=>t.dso))}getItemPage(t){return(0,y.Tt)(t)}initPageParamsByRoute(){this.currentPage=this.route.snapshot.firstChild.routeConfig.path}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(e.Injector))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-item-page"]],decls:19,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"border-bottom"],[1,"pt-2"],[1,"nav","nav-tabs","justify-content-start"],["class","nav-item",4,"ngFor","ngForOf"],[1,"tab-pane","active"],[1,"mb-4"],[1,"button-row","bottom"],[1,"text-right"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],[1,"nav-item"],["class","nav-link",3,"ngClass","routerLink",4,"ngIf"],[3,"ngbTooltip"],["class","nav-link disabled",4,"ngIf"],[1,"nav-link",3,"ngClass","routerLink"],[1,"nav-link","disabled"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div",4)(7,"ul",5),e.\u0275\u0275template(8,d,7,9,"li",6),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div",7)(10,"div",8),e.\u0275\u0275element(11,"router-outlet"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div",9)(13,"div",10)(14,"a",11),e.\u0275\u0275pipe(15,"async"),e.\u0275\u0275element(16,"i",12),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()()()()()()()),2&t){let a;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,4,"item.edit.head")),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngForOf",n.pages),e.\u0275\u0275advance(6),e.\u0275\u0275property("routerLink",n.getItemPage(null==(a=e.\u0275\u0275pipeBind1(15,6,n.itemRD$))?null:a.payload)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,8,"item.edit.return"),"")}},directives:[_.sg,_.O5,u.yS,_.mk,I._L,u.lC],pipes:[b.X$,_.Ov],encapsulation:2,data:{animation:[M.Ji,M.Ic]},changeDetection:0}),i})();var L=r(82596),F=r(83639),h=r(68285),w=r(50590),X=r(30409);const ee=function(i){return{id:i}},te=function(i){return[i,"edit"]};let J=(()=>{class i{constructor(t,n,a,o,p){this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=p}ngOnInit(){this.itemRD$=this.route.data.pipe((0,m.U)(t=>t.dso),(0,h.xw)()),this.itemRD$.pipe((0,w.P)()).subscribe(t=>{this.item=t.payload,this.itemPageRoute=(0,y.Tt)(this.item)}),this.confirmMessage="item.edit."+this.messageKey+".confirm",this.cancelMessage="item.edit."+this.messageKey+".cancel",this.headerMessage="item.edit."+this.messageKey+".header",this.descriptionMessage="item.edit."+this.messageKey+".description"}performAction(){}processRestResponse(t){t.hasSucceeded?this.itemDataService.findById(this.item.id).pipe((i=>l=>l.pipe((0,h.g1)(),(0,w.P)(i)))(this.predicate)).subscribe(()=>{this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([(0,y.tn)(this.item)])}):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,y.tn)(this.item)]))}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-simple-action"]],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,ee,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,te,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[X.E,u.rH],pipes:[b.X$],encapsulation:2}),i})();const pe=function(i){return{id:i}},N=function(i){return[i,"edit"]};let ne=(()=>{class i extends J{constructor(t,n,a,o,p){super(t,n,a,o,p),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=p,this.messageKey="withdraw",this.predicate=v=>v.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!0).pipe((0,h.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-withdraw"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,pe,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,N,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[X.E,u.rH],pipes:[b.X$],encapsulation:2}),i})();const A=function(i){return{id:i}},H=function(i){return[i,"edit"]};let B=(()=>{class i extends J{constructor(t,n,a,o,p){super(t,n,a,o,p),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=p,this.messageKey="reinstate",this.predicate=v=>!v.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!1).pipe((0,h.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-reinstate"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,A,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,H,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[X.E,u.rH],pipes:[b.X$],encapsulation:2}),i})();const k=function(i){return{id:i}},c=function(i){return[i,"edit"]};let E=(()=>{class i extends J{constructor(t,n,a,o,p){super(t,n,a,o,p),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=p,this.messageKey="private",this.predicate=v=>!v.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!1).pipe((0,h.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-private"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,k,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,c,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[X.E,u.rH],pipes:[b.X$],encapsulation:2}),i})();const g=function(i){return{id:i}},S=function(i){return[i,"edit"]};let V=(()=>{class i extends J{constructor(t,n,a,o,p){super(t,n,a,o,p),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=p,this.messageKey="public",this.predicate=v=>v.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!0).pipe((0,h.hC)()).subscribe(t=>{this.processRestResponse(t)})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(b.sK))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-public"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275elementStart(10,"div",4)(11,"button",5),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(14,"button",6),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,6,n.headerMessage,e.\u0275\u0275pureFunction1(15,g,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,9,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(13,11,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(17,S,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,n.cancelMessage)," "))},directives:[X.E,u.rH],pipes:[b.X$],encapsulation:2}),i})();var D=r(63900),P=r(95698),Z=r(46590),Y=r(39300),q=r(61135),Ve=r(51121),ae=r(46040),Ee=r(88002),Ae=r(94357),Se=r(94476),re=r(93369),me=r(98605),Me=r(91538);function dt(i,l){if(1&i&&e.\u0275\u0275element(0,"ds-listable-object-component-loader",24),2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext(6);e.\u0275\u0275property("object",t)("viewMode",n.viewMode)}}function ct(i,l){if(1&i&&e.\u0275\u0275element(0,"ds-listable-object-component-loader",24),2&i){const t=e.\u0275\u0275nextContext(2).ngVar,n=e.\u0275\u0275nextContext(6);e.\u0275\u0275property("object",t)("viewMode",n.viewMode)}}function pt(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"div")(2,"div",30),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()()()),2&i){const t=l.$implicit;e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",t.metadataField," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.metadataValue.value," ")}}function mt(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"div",25),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"button",26),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(7).closeVirtualMetadataModal()}),e.\u0275\u0275elementStart(5,"span",27),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",28),e.\u0275\u0275template(8,ct,1,2,"ds-listable-object-component-loader",18),e.\u0275\u0275template(9,pt,6,2,"div",29),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"virtual-metadata.delete-item.modal-head")," "),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(10,5,a.getVirtualMetadata(n)))}}function ut(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,dt,1,2,"ds-listable-object-component-loader",18),e.\u0275\u0275elementStart(2,"div",19)(3,"div",20)(4,"button",21),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275reference(7);return e.\u0275\u0275nextContext(6).openVirtualMetadataModal(a)}),e.\u0275\u0275element(5,"i",22),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(6,mt,11,7,"ng-template",null,23,e.\u0275\u0275templateRefExtractor),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=l.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}function ht(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div",12),e.\u0275\u0275template(1,ut,8,1,"ng-container",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&i){const t=l.$implicit,n=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.getRelatedItem(t)))}}function _t(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"div",13),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).ngVar,p=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(3).setSelected(p,!o)}),e.\u0275\u0275elementStart(2,"label"),e.\u0275\u0275element(3,"input",14),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",15)(5,"h5",16),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).ngVar,p=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext(3).setSelected(p,!o)}),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(9,ht,3,3,"div",17),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=l.ngVar,n=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",t),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(7,3,a.getRelationshipMessageKey(e.\u0275\u0275pipeBind1(8,5,a.getLabel(n))))," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(10,7,a.getRelationships(n)))}}function gt(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275template(1,_t,11,9,"div",11),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&i){const t=l.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.isSelected(t)))}}function vt(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275template(3,gt,3,3,"div",10),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,2,"virtual-metadata.delete-item.info")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t)}}function ft(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,vt,4,4,"div",8),e.\u0275\u0275elementContainerEnd()),2&i){const t=l.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t&&t.length>0)}}const bt=function(i){return{id:i}},It=function(i){return[i,"edit"]};let Ct=(()=>{class i extends J{constructor(t,n,a,o,p,v,U,G,ie,ce){super(t,n,a,o,p),this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.translateService=p,this.modalService=v,this.objectUpdatesService=U,this.relationshipService=G,this.entityTypeService=ie,this.linkService=ce,this.messageKey="delete",this.viewMode=Ve.w.ListElement,this.types$=new q.X([]),this.relationships$=new Map,this.relatedItems$=new Map,this.virtualMetadata$=new Map,this.subs=[]}ngOnInit(){super.ngOnInit(),this.url=this.router.url;const t=this.item.firstMetadataValue("dspace.entity.type");(0,f.UE)(t)&&this.subs.push(this.entityTypeService.getEntityTypeByLabel(t).pipe((0,h.xw)(),(0,h.xe)(),(0,D.w)(n=>this.entityTypeService.getEntityTypeRelationships(n.id)),(0,h.xw)(),(0,h.xe)(),(0,m.U)(n=>n.page),(0,D.w)(n=>0===n.length?(0,C.of)(n):(0,x.a)(n.map(a=>this.getRelationships(a))).pipe((0,m.U)(a=>n.reduce((o,p,v)=>o.some(U=>U.id===p.id)||0===a[v].length?o:[...o,p],[]))))).subscribe(n=>this.types$.next(n))),this.subs.push(this.types$.pipe((0,P.q)(1)).subscribe(n=>this.objectUpdatesService.initialize(this.url,n,this.item.lastModified)))}openVirtualMetadataModal(t){this.modalRef=this.modalService.open(t)}closeVirtualMetadataModal(){this.modalRef.close()}getRelationshipMessageKey(t){return(0,f.Uh)(t)&&t.indexOf("Of")>-1?`relationships.${t.substring(0,t.indexOf("Of")+2)}`:t}getLabel(t){return this.getRelationships(t).pipe((0,D.w)(n=>this.isLeftItem(n[0]).pipe((0,m.U)(a=>a?t.leftwardType:t.rightwardType))))}getRelationships(t){return this.relationships$.has(t)||this.relationships$.set(t,this.relationshipService.getItemRelationshipsArray(this.item).pipe((0,D.w)(n=>(0,x.a)(n.map(a=>this.getRelationshipType(a))).pipe((0,Z.d)([]),(0,m.U)(a=>n.filter((o,p)=>t.id===a[p].id)))))),this.relationships$.get(t)}getRelationshipType(t){return this.linkService.resolveLinks(t,(0,re.l)("relationshipType"),(0,re.l)("leftItem"),(0,re.l)("rightItem")),t.relationshipType.pipe((0,h.xw)(),(0,h.xe)(),(0,Y.h)(n=>(0,f.Uh)(n)&&(0,f.UE)(n.uuid)))}getRelatedItem(t){return this.relatedItems$.has(t)||this.relatedItems$.set(t,this.isLeftItem(t).pipe((0,D.w)(n=>n?t.rightItem:t.leftItem),(0,h.xw)(),(0,h.xe)())),this.relatedItems$.get(t)}getVirtualMetadata(t){return this.virtualMetadata$.has(t)||this.virtualMetadata$.set(t,this.getRelatedItem(t).pipe((0,m.U)(n=>Object.entries(n.metadata).map(([a,o])=>o.filter(p=>p.authority&&p.authority.endsWith(t.id)).map(p=>({metadataField:a,metadataValue:p}))).reduce((a,o)=>a.concat(o))))),this.virtualMetadata$.get(t)}isLeftItem(t){return t.leftItem.pipe((0,h.xw)(),(0,h.xe)(),(0,Y.h)(n=>(0,f.Uh)(n)&&(0,f.UE)(n.uuid)),(0,m.U)(n=>n.uuid===this.item.uuid))}isSelected(t){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.item.uuid,t.uuid)}setSelected(t,n){this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.item.uuid,t.uuid,n)}performAction(){this.subs.push(this.types$.pipe((0,D.w)(t=>(0,x.a)(t.map(n=>this.isSelected(n))).pipe((0,Z.d)([]),(0,m.U)(n=>t.filter((a,o)=>n[o])),(0,m.U)(n=>n.map(a=>a.id)))),(0,D.w)(t=>this.itemDataService.delete(this.item.id,t).pipe((0,h.hC)()))).subscribe(t=>{this.notify(t.hasSucceeded)}))}notify(t){t?(this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([""])):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,y.tn)(this.item)]))}ngOnDestroy(){this.subs.filter(t=>(0,f.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(I.FF),e.\u0275\u0275directiveInject(ae.d),e.\u0275\u0275directiveInject(Ee.U),e.\u0275\u0275directiveInject(Ae.k),e.\u0275\u0275directiveInject(Se.M))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-delete"]],inputs:{url:"url"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:19,vars:22,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[4,"ngVar"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"],["class","mb-4",4,"ngIf"],[1,"mb-4"],["class","mb-4",4,"ngFor","ngForOf"],["class","d-flex flex-row",4,"ngVar"],[1,"d-flex","flex-row"],[1,"m-2",3,"click"],["type","checkbox",3,"checked"],[1,"flex-column","flex-grow-1"],[3,"click"],["class","d-flex flex-row",4,"ngFor","ngForOf"],[3,"object","viewMode",4,"ngIf"],[1,"ml-auto"],[1,"btn-group"],[1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"fas","fa-info","fa-fw"],["virtualMetadataModal",""],[3,"object","viewMode"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"p"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(9,"ds-modify-item-overview",3),e.\u0275\u0275template(10,ft,2,1,"ng-container",4),e.\u0275\u0275pipe(11,"async"),e.\u0275\u0275elementStart(12,"div",5)(13,"button",6),e.\u0275\u0275listener("click",function(){return n.performAction()}),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"button",7),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd()()()()()),2&t&&(e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,7,n.headerMessage,e.\u0275\u0275pureFunction1(18,bt,n.item.handle))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,10,n.descriptionMessage)),e.\u0275\u0275advance(2),e.\u0275\u0275property("item",n.item),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(11,12,n.types$)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(15,14,n.confirmMessage)," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(20,It,n.itemPageRoute)),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(18,16,n.cancelMessage)," "))},directives:[X.E,me.g,_.O5,_.sg,Me.p,u.rH],pipes:[b.X$,_.Ov],encapsulation:2}),i})();class oe{constructor(l,t,n,a=!1,o=!0){this.operationKey=l,this.operationUrl=t,this.featureID=n,this.authorized=o,this.setDisabled(a)}setDisabled(l){this.disabled=l}}var fe=r(86099),Le=r(71884),ze=r(32518),ke=r(50457),se=r(19937),z=r(47235);function xt(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"span")(1,"button",5),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",t.operation.disabled)("routerLink",t.operation.operationUrl),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"item.edit.tabs.status.buttons."+t.operation.operationKey+".button")," ")}}function yt(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"span",6),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275elementStart(2,"button",7),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()),2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("ngbTooltip",e.\u0275\u0275pipeBind1(1,3,"item.edit.tabs.status.buttons.unauthorized")),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!0),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,5,"item.edit.tabs.status.buttons."+t.operation.operationKey+".button")," ")}}let Et=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-operation"]],inputs:{operation:"operation"},decls:7,vars:5,consts:[[1,"col-3","float-left","d-flex","h-100","action-label"],[1,"justify-content-center","align-self-center"],[1,"col-9","float-left","action-button"],[4,"ngIf"],[3,"ngbTooltip",4,"ngIf"],[1,"btn","btn-outline-primary",3,"disabled","routerLink"],[3,"ngbTooltip"],[1,"btn","btn-outline-primary",3,"disabled"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"span",1),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",2),e.\u0275\u0275template(5,xt,4,5,"span",3),e.\u0275\u0275template(6,yt,5,7,"span",4),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"item.edit.tabs.status.buttons."+n.operation.operationKey+".label")," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",n.operation.authorized),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.operation.authorized))},directives:[_.O5,u.rH,I._L],pipes:[b.X$],encapsulation:2}),i})();function St(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div",7)(1,"div",3),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",8),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd()()),2&i){const t=l.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,3,"item.edit.tabs.status.labels."+t),": "),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate1("id","status-",t,""),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",n.statusData[t]," ")}}function Mt(i,l){if(1&i&&e.\u0275\u0275element(0,"ds-item-operation",11),2&i){const t=e.\u0275\u0275nextContext().$implicit;e.\u0275\u0275property("operation",t)}}const Ot=function(i){return{"pt-3":i}};function Pt(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div",9),e.\u0275\u0275template(1,Mt,1,1,"ds-item-operation",10),e.\u0275\u0275elementEnd()),2&i){const t=l.$implicit;e.\u0275\u0275property("ngClass",e.\u0275\u0275pureFunction1(2,Ot,t)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}let Tt=(()=>{class i{constructor(t,n){this.route=t,this.authorizationService=n,this.operations$=new q.X([])}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,m.U)(t=>t.dso)),this.itemRD$.pipe((0,w.P)(),(0,m.U)(t=>t.payload)).subscribe(t=>{this.statusData=Object.assign({id:t.id,handle:t.handle,lastModified:t.lastModified}),this.statusDataKeys=Object.keys(this.statusData);const n=[];n.push(new oe("authorizations",this.getCurrentUrl(t)+"/authorizations",z.i.CanManagePolicies,!0)),n.push(new oe("mappedCollections",this.getCurrentUrl(t)+"/mapper",z.i.CanManageMappings,!0)),n.push(t.isWithdrawn?new oe("reinstate",this.getCurrentUrl(t)+"/reinstate",z.i.ReinstateItem,!0):new oe("withdraw",this.getCurrentUrl(t)+"/withdraw",z.i.WithdrawItem,!0)),n.push(t.isDiscoverable?new oe("private",this.getCurrentUrl(t)+"/private",z.i.CanMakePrivate,!0):new oe("public",this.getCurrentUrl(t)+"/public",z.i.CanMakePrivate,!0)),n.push(new oe("delete",this.getCurrentUrl(t)+"/delete",z.i.CanDelete,!0)),n.push(new oe("move",this.getCurrentUrl(t)+"/move",z.i.CanMove,!0)),this.operations$.next(n),(0,ke.D)(n).pipe((0,fe.z)(a=>(0,f.Uh)(a.featureID)?this.authorizationService.isAuthorized(a.featureID,t.self).pipe((0,Le.x)(),(0,m.U)(o=>new oe(a.operationKey,a.operationUrl,a.featureID,!o,o))):[a]),(0,ze.q)()).subscribe(a=>this.operations$.next(a))}),this.itemPageRoute$=this.itemRD$.pipe((0,h.mc)(),(0,m.U)(t=>(0,y.Tt)(t)))}getCurrentUrl(t){return(0,y.tn)(t)}trackOperation(t,n){return(0,f.Uh)(n)?n.operationKey:void 0}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(se._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-status"]],decls:15,vars:16,consts:[[1,"mt-2"],[1,"row"],["class","w-100",4,"ngFor","ngForOf"],[1,"col-3","float-left","status-label"],["id","status-itemPage",1,"col-9","float-left","status-data"],[3,"routerLink"],["class","w-100",3,"ngClass",4,"ngFor","ngForOf"],[1,"w-100"],[1,"col-9","float-left","status-data",3,"id"],[1,"w-100",3,"ngClass"],[3,"operation",4,"ngIf"],[3,"operation"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"p",0),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div",1),e.\u0275\u0275template(4,St,6,5,"div",2),e.\u0275\u0275elementStart(5,"div",3),e.\u0275\u0275text(6),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"div",4)(9,"a",5),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275text(11),e.\u0275\u0275pipe(12,"async"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(13,Pt,2,4,"div",6),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,6,"item.edit.tabs.status.description")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",n.statusDataKeys),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(7,8,"item.edit.tabs.status.labels.itemPage"),": "),e.\u0275\u0275advance(3),e.\u0275\u0275property("routerLink",e.\u0275\u0275pipeBind1(10,10,n.itemPageRoute$)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(12,12,n.itemPageRoute$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(14,14,n.operations$)))},directives:[_.sg,u.yS,_.mk,_.O5,Et],pipes:[b.X$,_.Ov],encapsulation:2,data:{animation:[M.Ji,M.Ic]}}),i})();var Bt=r(7803),Ke=r(25226),ve=r(62557),Dt=r(48532),We=r(58943),Ce=r(31241),Oe=r(90697),Pe=r(35598);class be{constructor(l,t,n,a,o){this.xs=l,this.sm=t,this.md=n,this.lg=a,this.xl=o}buildClasses(){return`col-${this.xs} col-sm-${this.sm} col-md-${this.md} col-lg-${this.lg} col-xl-${this.xl}`}}class Ut{constructor(l){this.columns=l}combineColumns(l,t){if(l<t&&(0,f.Uh)(this.columns[l])&&(0,f.Uh)(this.columns[t])){let n=this.columns[l].xs,a=this.columns[l].sm,o=this.columns[l].md,p=this.columns[l].lg,v=this.columns[l].xl;for(let U=l+1;U<t+1;U++)n+=this.columns[U].xs,a+=this.columns[U].sm,o+=this.columns[U].md,p+=this.columns[U].lg,v+=this.columns[U].xl;return new be(n,a,o,p,v)}}}var ue=r(59051);const Rt=["handleView"];function jt(i,l){1&i&&(e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275element(1,"i",2),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("title",e.\u0275\u0275pipeBind1(2,1,"item.edit.bitstreams.edit.buttons.drag")))}let Te=(()=>{class i{constructor(t){this.viewContainerRef=t}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.handleView)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ViewContainerRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-edit-bitstream-drag-handle"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(Rt,7),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.handleView=a.first)}},decls:2,vars:0,consts:[["handleView",""],["tabindex","0",1,"drag-handle","text-muted","float-left","p-1","mr-2"],[1,"fas","fa-grip-vertical","fa-fw",3,"title"]],template:function(t,n){1&t&&e.\u0275\u0275template(0,jt,3,3,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)},pipes:[b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();r(11221),r(33609);var Ne=r(4177),Ie=r(21283),Be=r(62697),wt=r(4900),De=r(77467),xe=r(5023);let $t=(()=>{class i{constructor(t,n,a,o){this.objectUpdatesService=t,this.elRef=n,this.objectValuesPipe=a,this.paginationService=o,this.dropObject=new e.EventEmitter,this.pageSize=10,this.options=Object.assign(new Ne.r,{id:"dad",currentPage:1,pageSize:this.pageSize}),this.currentPage$=new q.X(this.options),this.loading$=new q.X(!1),this.subs=[]}ngOnInit(){this.initializeObjectsRD(),this.initializeURL(),this.initializeUpdates(),this.initializePagination()}initializePagination(){this.paginationService.getCurrentPagination(this.options.id,this.options).subscribe(t=>{this.currentPage$.next(t)})}initializeUpdates(){this.objectsRD$.pipe((0,h.xw)(),(0,h.ZU)()).subscribe(t=>{this.objectUpdatesService.initialize(this.url,t,new Date)}),this.updates$=this.objectsRD$.pipe((0,h.g1)(),(0,h.ZU)(),(0,D.w)(t=>this.objectUpdatesService.getFieldUpdatesExclusive(this.url,t))),this.subs.push(this.updates$.pipe((0,m.U)(t=>this.objectValuesPipe.transform(t)),(0,Le.x)((0,wt.Rh)(i=>(0,f.Uh)(i)&&(0,f.Uh)(i.field)?i.field.uuid:void 0))).subscribe(t=>{this.customOrder=t.map(n=>n.field.uuid),this.loading$.next(!1)}),this.loading$.subscribe(t=>this.options.disabled=t))}drop(t){const n=t.previousIndex;let a=t.currentIndex;const o=this.currentPage$.value.currentPage-1;let p=this.currentPage$.value.currentPage-1;const v=this.elRef.nativeElement.querySelector(".page-item:hover");if((0,f.Uh)(v)&&(0,f.Uh)(v.textContent)){const ge=Number(v.textContent);(0,f.Uh)(ge)&&!Number.isNaN(ge)&&(p=ge-1,a=0)}const U=o!==p;!U&&n!==a&&(0,Ie.bA)(this.customOrder,n,a);const G=p+1,ie=o*this.pageSize+n,ce=p*this.pageSize+a;ie!==ce&&(U&&this.loading$.next(!0),this.dropObject.emit(Object.assign({fromIndex:ie,toIndex:ce,finish:()=>{U&&this.paginationComponent.doPageChange(G)}})))}ngOnDestroy(){this.subs.filter(t=>(0,f.Uh)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.options.id)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(ae.d),e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(xe.g),e.\u0275\u0275directiveInject(De.N))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-paginated-drag-drop-abstract"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(Be.Q,5),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.paginationComponent=a.first)}},outputs:{dropObject:"dropObject"},decls:0,vars:0,template:function(t,n){},encapsulation:2}),i})();var Ue=r(17489),Vt=r(50503),Re=r(83616),At=r(73579);const Lt=["bitstreamView"];function zt(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"a",14),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275pipe(2,"dsBrowserOnly"),e.\u0275\u0275element(3,"i",15),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(1,3,"item.edit.bitstreams.edit.buttons.download")),e.\u0275\u0275property("href",t.bitstreamDownloadUrl,e.\u0275\u0275sanitizeUrl),e.\u0275\u0275attribute("data-test",e.\u0275\u0275pipeBind1(2,5,"download-button"))}}const kt=function(i){return["/bitstreams/",i,"edit"]};function Kt(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275projection(1),e.\u0275\u0275elementStart(2,"div",1)(3,"span",2),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(5,"div")(6,"div",3)(7,"div",4),e.\u0275\u0275text(8),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(9,"div")(10,"div",5)(11,"span",2),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(14,"div")(15,"div",5)(16,"div",6),e.\u0275\u0275template(17,zt,4,7,"a",7),e.\u0275\u0275elementStart(18,"button",8),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275element(20,"i",9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(21,"button",10),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().remove()}),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275element(23,"i",11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(24,"button",12),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().undo()}),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275element(26,"i",13),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[0].buildClasses()," row-element d-flex"),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",t.bitstreamName," "),e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[1].buildClasses()," row-element d-flex align-items-center"),e.\u0275\u0275advance(2),e.\u0275\u0275property("tooltipClass","larger-tooltip")("ngbTooltip",null==t.bitstream?null:t.bitstream.firstMetadataValue("dc.description")),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",null==t.bitstream?null:t.bitstream.firstMetadataValue("dc.description")," "),e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[2].buildClasses()," row-element d-flex align-items-center"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",null==(n=e.\u0275\u0275pipeBind1(13,24,t.format$))?null:n.shortDescription," "),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[3].buildClasses()," row-element d-flex align-items-center"),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",null!=t.bitstreamDownloadUrl),e.\u0275\u0275advance(1),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(19,26,"item.edit.bitstreams.edit.buttons.edit")),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(32,kt,t.bitstream.id)),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(22,28,"item.edit.bitstreams.edit.buttons.remove")),e.\u0275\u0275property("disabled",!t.canRemove()),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(25,30,"item.edit.bitstreams.edit.buttons.undo")),e.\u0275\u0275property("disabled",!t.canUndo())}}const Wt=[[["","slot","drag-handle"]]],Nt=["[slot=drag-handle]"];let Gt=(()=>{class i{constructor(t,n,a){this.objectUpdatesService=t,this.dsoNameService=n,this.viewContainerRef=a}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.bitstreamView)}ngOnChanges(t){this.bitstream=(0,Ue.cloneDeep)(this.fieldUpdate.field),this.bitstreamName=this.dsoNameService.getName(this.bitstream),this.bitstreamDownloadUrl=(0,Vt.gs)(this.bitstream),this.format$=this.bitstream.format.pipe((0,h.xw)(),(0,h.xe)())}remove(){this.objectUpdatesService.saveRemoveFieldUpdate(this.bundleUrl,this.bitstream)}undo(){this.objectUpdatesService.removeSingleFieldUpdate(this.bundleUrl,this.bitstream.uuid)}canRemove(){return this.fieldUpdate.changeType!==ue.m.REMOVE}canUndo(){return this.fieldUpdate.changeType>=0}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(ae.d),e.\u0275\u0275directiveInject(Re._),e.\u0275\u0275directiveInject(e.ViewContainerRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-edit-bitstream"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(Lt,7),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.bitstreamView=a.first)}},inputs:{fieldUpdate:"fieldUpdate",bundleUrl:"bundleUrl",columnSizes:"columnSizes"},features:[e.\u0275\u0275NgOnChangesFeature],ngContentSelectors:Nt,decls:2,vars:0,consts:[["bitstreamView",""],[1,"float-left","d-flex","align-items-center","overflow-hidden"],[1,"text-truncate"],[1,"w-100"],["placement","bottom",1,"text-truncate",3,"tooltipClass","ngbTooltip"],[1,"text-center","w-100"],[1,"btn-group","relationship-action-buttons"],["class","btn btn-outline-primary btn-sm",3,"href","title",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-danger","btn-sm",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"disabled","title","click"],[1,"fas","fa-undo-alt","fa-fw"],[1,"btn","btn-outline-primary","btn-sm",3,"href","title"],[1,"fas","fa-download","fa-fw"]],template:function(t,n){1&t&&(e.\u0275\u0275projectionDef(Wt),e.\u0275\u0275template(0,Kt,27,34,"ng-template",null,0,e.\u0275\u0275templateRefExtractor))},directives:[I._L,_.O5,u.rH],pipes:[_.Ov,b.X$,At.g],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();var ye=r(48106);const Ht=function(i,l,t,n){return{"table-warning":i,"table-danger":l,"table-success":t,"bg-white":n}};function Xt(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div",7)(1,"ds-item-edit-bitstream",8)(2,"div",9),e.\u0275\u0275element(3,"ds-item-edit-bitstream-drag-handle"),e.\u0275\u0275elementEnd()()()),2&i){const t=l.$implicit,n=e.\u0275\u0275nextContext(2).ngVar,a=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("id",t)("ngClass",e.\u0275\u0275pureFunction4(5,Ht,0===n[t].changeType,2===n[t].changeType,1===n[t].changeType,void 0===n[t].changeType)),e.\u0275\u0275advance(1),e.\u0275\u0275property("fieldUpdate",n[t])("bundleUrl",a.bundle.self)("columnSizes",a.columnSizes)}}function Qt(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Xt,4,10,"div",6),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(4);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t.customOrder)}}const Jt=function(i){return{"mb-3":i}};function Zt(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",5),e.\u0275\u0275listener("cdkDropListDropped",function(a){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).drop(a)}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,Qt,2,1,"ng-container",2),e.\u0275\u0275elementEnd()}if(2&i){const t=l.ngVar,n=e.\u0275\u0275nextContext(3);let a;e.\u0275\u0275property("id",n.bundle.id)("ngClass",e.\u0275\u0275pureFunction1(5,Jt,(null==(a=e.\u0275\u0275pipeBind1(1,3,n.objectsRD$))||null==a.payload?null:a.payload.totalElements)>n.pageSize)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",t)}}function Yt(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Zt,3,7,"div",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t.updates$))}}function qt(i,l){1&i&&(e.\u0275\u0275element(0,"ds-themed-loading",10),e.\u0275\u0275pipe(1,"translate")),2&i&&e.\u0275\u0275property("message",e.\u0275\u0275pipeBind1(1,1,"loading.bitstreams"))}function en(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"ds-pagination",1),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,Yt,3,3,"ng-container",2),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,qt,2,3,"ds-themed-loading",3),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext();let n,a;e.\u0275\u0275property("hideGear",!0)("hidePagerWhenSinglePage",!0)("hidePaginationDetail",!0)("paginationOptions",t.options)("pageInfoState",null==(n=e.\u0275\u0275pipeBind1(1,8,t.objectsRD$))?null:n.payload)("collectionSize",null==(a=e.\u0275\u0275pipeBind1(2,10,t.objectsRD$))||null==a.payload?null:a.payload.totalElements),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(4,12,t.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(6,14,t.loading$))}}let tn=(()=>{class i extends $t{constructor(t,n,a,o,p,v){super(t,n,a,p),this.objectUpdatesService=t,this.elRef=n,this.objectValuesPipe=a,this.bundleService=o,this.paginationService=p,this.requestService=v}ngOnInit(){super.ngOnInit()}initializeObjectsRD(){this.objectsRD$=this.currentPage$.pipe((0,D.w)(t=>{const n=new Pe.t({pagination:Object.assign({},t)});return this.bundleService.getBitstreamsEndpoint(this.bundle.id,n).pipe((0,D.w)(a=>this.requestService.hasByHref$(a)),(0,D.w)(()=>this.bundleService.getBitstreams(this.bundle.id,n,(0,re.l)("format"))))}))}initializeURL(){this.url=this.bundle.self}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(ae.d),e.\u0275\u0275directiveInject(e.ElementRef),e.\u0275\u0275directiveInject(xe.g),e.\u0275\u0275directiveInject(Oe.b),e.\u0275\u0275directiveInject(De.N),e.\u0275\u0275directiveInject(Ce.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-paginated-drag-and-drop-bitstream-list"]],inputs:{bundle:"bundle",columnSizes:"columnSizes"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","pageInfoState","collectionSize",4,"ngIf"],[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","pageInfoState","collectionSize"],[4,"ngIf"],[3,"message",4,"ngIf"],["class","bundle-bitstreams-list","cdkDropList","",3,"id","ngClass","cdkDropListDropped",4,"ngVar"],["cdkDropList","",1,"bundle-bitstreams-list",3,"id","ngClass","cdkDropListDropped"],["class","row bitstream-row","cdkDrag","",3,"id","ngClass",4,"ngFor","ngForOf"],["cdkDrag","",1,"row","bitstream-row",3,"id","ngClass"],[3,"fieldUpdate","bundleUrl","columnSizes"],["slot","drag-handle","cdkDragHandle","","tabindex","0",1,"d-flex","align-items-center","bitstream-row-drag-handle"],[3,"message"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,en,7,16,"ds-pagination",0),e.\u0275\u0275pipe(1,"async")),2&t){let a;e.\u0275\u0275property("ngIf",null==(a=e.\u0275\u0275pipeBind1(1,1,n.objectsRD$))?null:a.payload)}},directives:[_.O5,Be.Q,me.g,Ie.Wj,_.mk,_.sg,Ie.Zt,Gt,Ie.Bh,Te,ye.Z],pipes:[_.Ov,b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();const nn=["bundleView"],an=function(i){return{name:i}},rn=function(i){return[i,"bitstreams","new"]},on=function(i){return{bundle:i}};function sn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1)(1,"div"),e.\u0275\u0275element(2,"ds-item-edit-bitstream-drag-handle"),e.\u0275\u0275elementStart(3,"div",2),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div")(7,"div",3)(8,"button",4),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275element(10,"i",5),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementStart(11,"ds-paginated-drag-and-drop-bitstream-list",6),e.\u0275\u0275listener("dropObject",function(a){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().dropObject.emit(a)}),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275classMapInterpolate1("",t.bundleNameColumn.buildClasses()," font-weight-bold row-element d-flex"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind2(5,12,"item.edit.bitstreams.bundle.name",e.\u0275\u0275pureFunction1(17,an,t.bundle.name))," "),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",t.columnSizes.columns[3].buildClasses()," text-center row-element"),e.\u0275\u0275advance(2),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(9,15,"item.edit.bitstreams.bundle.edit.buttons.upload")),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(19,rn,t.itemPageRoute))("queryParams",e.\u0275\u0275pureFunction1(21,on,t.bundle.id)),e.\u0275\u0275advance(3),e.\u0275\u0275property("bundle",t.bundle)("columnSizes",t.columnSizes)}}let ln=(()=>{class i{constructor(t){this.viewContainerRef=t,this.dropObject=new e.EventEmitter}ngOnInit(){this.bundleNameColumn=this.columnSizes.combineColumns(0,2),this.viewContainerRef.createEmbeddedView(this.bundleView),this.itemPageRoute=(0,y.Tt)(this.item)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(e.ViewContainerRef))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-edit-bitstream-bundle"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(nn,7),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.bundleView=a.first)}},inputs:{bundle:"bundle",item:"item",columnSizes:"columnSizes"},outputs:{dropObject:"dropObject"},decls:2,vars:0,consts:[["bundleView",""],[1,"row","bundle-row"],[1,"float-left","d-flex","align-items-center"],[1,"btn-group","bundle-action-buttons"],[1,"btn","btn-outline-success","btn-sm",3,"routerLink","queryParams","title"],[1,"fas","fa-upload","fa-fw"],[3,"bundle","columnSizes","dropObject"]],template:function(t,n){1&t&&e.\u0275\u0275template(0,sn,12,23,"ng-template",null,0,e.\u0275\u0275templateRefExtractor)},directives:[Te,u.rH,tn],pipes:[b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();function dn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",15),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).reinstate()}),e.\u0275\u0275element(1,"i",16),e.\u0275\u0275elementStart(2,"span",5),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.bitstreams.reinstate-button"),""))}function cn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",18),e.\u0275\u0275elementStart(3,"span",5),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())||t.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.bitstreams.discard-button"),"")}}function pn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-item-edit-bitstream-bundle",22),e.\u0275\u0275listener("dropObject",function(a){const p=e.\u0275\u0275restoreView(t).$implicit;return e.\u0275\u0275nextContext(3).dropBitstream(p,a)}),e.\u0275\u0275elementEnd()}if(2&i){const t=l.$implicit,n=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("bundle",t)("item",n.item)("columnSizes",n.columnSizes)}}function mn(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div",19)(1,"div",20)(2,"div"),e.\u0275\u0275element(3,"ds-item-edit-bitstream-drag-handle"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"div"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"div"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"div"),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(15,pn,1,3,"ds-item-edit-bitstream-bundle",21),e.\u0275\u0275elementEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[0].buildClasses()," row-element"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,17,"item.edit.bitstreams.headers.name")," "),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[1].buildClasses()," row-element"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,19,"item.edit.bitstreams.headers.description")),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[2].buildClasses()," text-center row-element"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,21,"item.edit.bitstreams.headers.format")),e.\u0275\u0275advance(2),e.\u0275\u0275classMapInterpolate1("",n.columnSizes.columns[3].buildClasses()," text-center row-element"),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,23,"item.edit.bitstreams.headers.actions")),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngForOf",t)}}function un(i,l){1&i&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.bitstreams.empty")," "))}function hn(i,l){1&i&&(e.\u0275\u0275element(0,"ds-themed-loading",24),e.\u0275\u0275pipe(1,"translate")),2&i&&e.\u0275\u0275propertyInterpolate("message",e.\u0275\u0275pipeBind1(1,1,"loading.bitstreams"))}function _n(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",15),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).reinstate()}),e.\u0275\u0275element(1,"i",16),e.\u0275\u0275elementStart(2,"span",5),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.bitstreams.reinstate-button"),""))}function gn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",17),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",18),e.\u0275\u0275elementStart(3,"span",5),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())||t.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.bitstreams.discard-button"),"")}}const vn=function(i){return[i,"bitstreams","new"]};function fn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",1)(1,"div",2)(2,"button",3),e.\u0275\u0275element(3,"i",4),e.\u0275\u0275elementStart(4,"span",5),e.\u0275\u0275text(5),e.\u0275\u0275pipe(6,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(7,dn,5,3,"button",6),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().submit()}),e.\u0275\u0275pipe(10,"async"),e.\u0275\u0275element(11,"i",8),e.\u0275\u0275elementStart(12,"span",5),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(15,cn,6,6,"button",9),e.\u0275\u0275pipe(16,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(17,mn,16,25,"div",10),e.\u0275\u0275template(18,un,3,3,"div",11),e.\u0275\u0275template(19,hn,2,3,"ds-themed-loading",12),e.\u0275\u0275elementStart(20,"div",13)(21,"div",14),e.\u0275\u0275template(22,_n,5,3,"button",6),e.\u0275\u0275pipe(23,"async"),e.\u0275\u0275elementStart(24,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().submit()}),e.\u0275\u0275pipe(25,"async"),e.\u0275\u0275element(26,"i",8),e.\u0275\u0275elementStart(27,"span",5),e.\u0275\u0275text(28),e.\u0275\u0275pipe(29,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(30,gn,6,6,"button",9),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275elementEnd()()()}if(2&i){const t=l.ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(31,vn,n.itemPageRoute)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(6,13,"item.edit.bitstreams.upload-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(8,15,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(10,17,n.hasChanges())||n.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(14,19,"item.edit.bitstreams.save-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(16,21,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",n.item&&(null==t?null:t.length)>0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===(null==t?null:t.length)),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(23,23,n.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(25,25,n.hasChanges())||n.submitting),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(29,27,"item.edit.bitstreams.save-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(31,29,n.isReinstatable()))}}let bn=(()=>{class i extends Ke.a{constructor(t,n,a,o,p,v,U,G,ie,ce,ge,$e){super(t,n,a,o,p,v),this.itemService=t,this.objectUpdatesService=n,this.router=a,this.notificationsService=o,this.translateService=p,this.route=v,this.bitstreamService=U,this.objectCache=G,this.requestService=ie,this.cdRef=ce,this.bundleService=ge,this.zone=$e,this.bundlesOptions={id:"bundles-pagination-options",currentPage:1,pageSize:9999},this.columnSizes=new Ut([new be(2,2,3,4,4),new be(2,3,3,3,3),new be(2,2,2,2,2),new be(6,5,4,3,3)]),this.submitting=!1}postItemInit(){this.bundles$=this.itemService.getBundles(this.item.id,new Pe.t({pagination:this.bundlesOptions})).pipe((0,h.xw)(),(0,h.xe)(),(0,m.U)(t=>t.page))}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.bitstreams.notifications."}submit(){this.submitting=!0,this.bundles$.pipe((0,P.q)(1)).pipe((0,D.w)(o=>(0,ve.$)(...o.map(p=>this.objectUpdatesService.getFieldUpdates(p.self,[],!0)))),(0,m.U)(o=>[].concat(...o.map(p=>Object.values(p).filter(v=>v.changeType===ue.m.REMOVE)))),(0,m.U)(o=>o.map(p=>p.field))).pipe((0,P.q)(1),(0,D.w)(o=>(0,f.UE)(o)?(0,ve.$)(...o.map(p=>this.bitstreamService.delete(p.id))):(0,C.of)(void 0))).pipe((0,P.q)(1)).subscribe(o=>{this.displayNotifications("item.edit.bitstreams.notifications.remove",o),this.submitting=!1})}dropBitstream(t,n){this.zone.runOutsideAngular(()=>{(0,f.Uh)(n)&&(0,f.Uh)(n.fromIndex)&&(0,f.Uh)(n.toIndex)&&(0,f.Uh)(n.finish)&&this.bundleService.patch(t,[{op:"move",from:`/_links/bitstreams/${n.fromIndex}/href`,path:`/_links/bitstreams/${n.toIndex}/href`}]).pipe((0,P.q)(1)).subscribe(o=>{this.zone.run(()=>{this.displayNotifications("item.edit.bitstreams.notifications.move",[o]),this.requestService.removeByHrefSubstring(t.self).pipe((0,Y.h)(p=>p),(0,P.q)(1)).subscribe(()=>n.finish())})})})}displayNotifications(t,n){if((0,f.UE)(n)){const a=n.filter(p=>(0,f.Uh)(p)&&p.hasFailed),o=n.filter(p=>(0,f.Uh)(p)&&p.hasSucceeded);a.forEach(p=>{this.notificationsService.error(this.translateService.instant(`${t}.failed.title`),p.errorMessage)}),o.length>0&&this.notificationsService.success(this.translateService.instant(`${t}.saved.title`),this.translateService.instant(`${t}.saved.content`))}}discard(){const t=this.notificationsService.info(this.getNotificationTitle("discarded"),this.getNotificationContent("discarded"),{timeOut:this.discardTimeOut});this.objectUpdatesService.discardAllFieldUpdates(this.url,t)}reinstate(){this.bundles$.pipe((0,P.q)(1)).subscribe(t=>{t.forEach(n=>{this.objectUpdatesService.reinstateFieldUpdates(n.self)})})}isReinstatable(){return this.bundles$.pipe((0,D.w)(t=>(0,ve.$)(...t.map(n=>this.objectUpdatesService.isReinstatable(n.self)))),(0,m.U)(t=>t.includes(!0)))}hasChanges(){return this.bundles$.pipe((0,D.w)(t=>(0,ve.$)(...t.map(n=>this.objectUpdatesService.hasUpdates(n.self)))),(0,m.U)(t=>t.includes(!0)))}ngOnDestroy(){this.itemUpdateSubscription&&this.itemUpdateSubscription.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(ae.d),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(Dt.J),e.\u0275\u0275directiveInject(We.a),e.\u0275\u0275directiveInject(Ce.s),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(Oe.b),e.\u0275\u0275directiveInject(e.NgZone))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-bitstreams"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:2,vars:3,consts:[["class","item-bitstreams",4,"ngVar"],[1,"item-bitstreams"],[1,"button-row","top","d-flex","mt-2","space-children-mr"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-upload"],[1,"d-none","d-sm-inline"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","container table-bordered mt-4",4,"ngIf"],["class","alert alert-info w-100 d-inline-block mt-4","role","alert",4,"ngIf"],[3,"message",4,"ngIf"],[1,"button-row","bottom"],[1,"mt-4","float-right","space-children-mr","ml-gap"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"container","table-bordered","mt-4"],[1,"row","header-row","font-weight-bold"],[3,"bundle","item","columnSizes","dropObject",4,"ngFor","ngForOf"],[3,"bundle","item","columnSizes","dropObject"],["role","alert",1,"alert","alert-info","w-100","d-inline-block","mt-4"],[3,"message"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,fn,32,33,"div",0),e.\u0275\u0275pipe(1,"async")),2&t&&e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(1,1,n.bundles$))},directives:[me.g,u.rH,_.O5,Te,_.sg,ln,ye.Z],pipes:[_.Ov,b.X$],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]}),i})();var In=r(36391),je=r(68675),we=r(95642),Cn=r(36872),Ge=r(5164),xn=r(13811),yn=r(13511);const En=["tabs"];function Sn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10)(1,"ds-collection-select",11),e.\u0275\u0275listener("confirm",function(a){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().removeMappings(a)})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onCancel()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","browse")("dsoRD$",t.itemCollectionsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,6,t.searchOptions$))?null:n.pagination)("confirmButton","item.edit.item-mapper.buttons.remove")("cancelButton","item.edit.item-mapper.cancel")("dangerConfirm",!0)}}function Mn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div")(1,"ds-collection-select",17),e.\u0275\u0275listener("confirm",function(a){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).mapCollections(a)})("cancel",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).onCancel()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(2);let n,a;e.\u0275\u0275advance(1),e.\u0275\u0275property("key","map")("dsoRD$",t.mappedCollectionsRD$)("paginationOptions",null==(n=e.\u0275\u0275pipeBind1(2,6,t.searchOptions$))?null:n.pagination)("sortOptions",null==(a=e.\u0275\u0275pipeBind1(3,8,t.searchOptions$))?null:a.sort)("confirmButton","item.edit.item-mapper.buttons.add")("cancelButton","item.edit.item-mapper.cancel")}}function On(i,l){1&i&&(e.\u0275\u0275elementStart(0,"div",18),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.item-mapper.no-search")," "))}function Pn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"div",13)(2,"ds-search-form",14),e.\u0275\u0275listener("submitSearch",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().performedSearch=!0}),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(5,Mn,4,10,"div",15),e.\u0275\u0275template(6,On,3,3,"div",16)}if(2&i){const t=e.\u0275\u0275nextContext();let n;e.\u0275\u0275advance(2),e.\u0275\u0275property("query",null==(n=e.\u0275\u0275pipeBind1(3,6,t.searchOptions$))?null:n.query)("currentUrl","./")("inPlaceSearch",!0)("searchPlaceholder",e.\u0275\u0275pipeBind1(4,8,"item.edit.item-mapper.search-form.placeholder")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",t.performedSearch),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t.performedSearch)}}const Tn=function(i){return{name:i}};let He=(()=>{class i{constructor(t,n,a,o,p,v,U,G,ie){this.route=t,this.router=n,this.searchConfigService=a,this.searchService=o,this.notificationsService=p,this.itemDataService=v,this.collectionDataService=U,this.translateService=G,this.dsoNameService=ie,this.performedSearch=!1}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,P.q)(1),(0,m.U)(t=>t.dso)),this.itemName$=this.itemRD$.pipe((0,Y.h)(t=>(0,f.Uh)(t)),(0,m.U)(t=>this.dsoNameService.getName(t.payload))),this.searchOptions$=this.searchConfigService.paginatedSearchOptions,this.loadCollectionLists()}loadCollectionLists(){this.shouldUpdate$=new q.X(!0),this.itemCollectionsRD$=(0,x.a)(this.itemRD$.pipe((0,h.Gp)()),this.shouldUpdate$).pipe((0,D.w)(([a,o])=>(!0===o&&this.shouldUpdate$.next(!1),this.collectionDataService.findListByHref(this.itemDataService.getMappedCollectionsEndpoint(a.id),void 0,!o,!1).pipe((0,h.g1)()))));const t=this.itemRD$.pipe((0,h.Gp)(),(0,D.w)(a=>this.collectionDataService.findOwningCollectionFor(a)),(0,h.g1)()),n=(0,x.a)(this.itemCollectionsRD$,t,this.searchOptions$);this.mappedCollectionsRD$=n.pipe((0,D.w)(([a,o,p])=>this.searchService.search(Object.assign(new Pe.t(p),{query:this.buildQuery([...a.payload.page,o.payload],p.query),dsoTypes:[we.h.COLLECTION]}),1e4).pipe((0,h.Ie)(),(0,je.O)(void 0))))}mapCollections(t){const a=(0,x.a)([this.itemRD$.pipe((0,h.xw)(),(0,m.U)(o=>o.payload),(0,m.U)(o=>o.id)),this.itemCollectionsRD$.pipe((0,h.xw)(),(0,m.U)(o=>o.payload.page),(0,m.U)(o=>o.map(p=>p.id)))]).pipe((0,D.w)(([o,p])=>(0,x.a)(this.filterIds(t,p).map(v=>this.itemDataService.mapToCollection(o,v).pipe((0,h.hC)())))));this.showNotifications(a,"item.edit.item-mapper.notifications.add")}removeMappings(t){const n=this.itemRD$.pipe((0,h.xw)(),(0,m.U)(a=>a.payload.id),(0,D.w)(a=>(0,x.a)(t.map(o=>this.itemDataService.removeMappingFromCollection(a,o).pipe((0,h.hC)())))));this.showNotifications(n,"item.edit.item-mapper.notifications.remove")}filterIds(t,n){return t.filter(a=>n.indexOf(a)<0)}showNotifications(t,n){t.subscribe(a=>{const o=a.filter(v=>v.hasSucceeded),p=a.filter(v=>v.hasFailed);o.length>0&&((0,x.a)([this.translateService.get(`${n}.success.head`),this.translateService.get(`${n}.success.content`,{amount:o.length})]).subscribe(([U,G])=>{this.notificationsService.success(U,G)}),this.shouldUpdate$.next(!0)),p.length>0&&(0,x.a)([this.translateService.get(`${n}.error.head`),this.translateService.get(`${n}.error.content`,{amount:p.length})]).subscribe(([U,G])=>{this.notificationsService.error(U,G)}),this.switchToFirstTab()})}tabChange(t){this.performedSearch=!1,this.router.navigateByUrl(this.getCurrentUrl())}getCurrentUrl(){return this.router.url.indexOf("?")>-1?this.router.url.substring(0,this.router.url.indexOf("?")):this.router.url}buildQuery(t,n){let a=n;for(const o of t)a=this.addExcludeCollection(o.id,a);return a}addExcludeCollection(t,n){const a=`-search.resourceid:${t}`;return(0,f.UE)(n)?`${n} AND ${a}`:a}switchToFirstTab(){this.tabs.select("browseTab")}onCancel(){this.itemRD$.pipe((0,h.xw)(),(0,h.xe)(),(0,P.q)(1)).subscribe(t=>{this.router.navigate([(0,y.Tt)(t)])})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(Cn.U),e.\u0275\u0275directiveInject(Ge.o),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(In.W),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(Re._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-collection-mapper"]],viewQuery:function(t,n){if(1&t&&e.\u0275\u0275viewQuery(En,5),2&t){let a;e.\u0275\u0275queryRefresh(a=e.\u0275\u0275loadQuery())&&(n.tabs=a.first)}},decls:25,vars:24,consts:[[1,"container"],[1,"row"],[1,"col-12"],["id","item-name",3,"innerHTML"],["ngbNav","",1,"nav-tabs",3,"destroyOnHide","navChange"],["tabs","ngbNav"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"mt-2"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","confirmButton","cancelButton","dangerConfirm","confirm","cancel"],[1,"row","mt-2"],[1,"col-12","col-lg-6"],["id","search-form",3,"query","currentUrl","inPlaceSearch","searchPlaceholder","submitSearch"],[4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[1,"mt-2",3,"key","dsoRD$","paginationOptions","sortOptions","confirmButton","cancelButton","confirm","cancel"],["role","alert",1,"alert","alert-info","w-100"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"p",3),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275elementStart(9,"p"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"ul",4,5),e.\u0275\u0275listener("navChange",function(o){return n.tabChange(o)}),e.\u0275\u0275elementStart(14,"li",6)(15,"a",7),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(18,Sn,3,8,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(19,"li",6)(20,"a",7),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(23,Pn,7,10,"ng-template",8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(24,"div",9),e.\u0275\u0275elementEnd()()()),2&t){const a=e.\u0275\u0275reference(13);e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,9,"item.edit.item-mapper.head")),e.\u0275\u0275advance(2),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind2(7,11,"item.edit.item-mapper.item",e.\u0275\u0275pureFunction1(22,Tn,e.\u0275\u0275pipeBind1(8,14,n.itemName$))),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,16,"item.edit.item-mapper.description")),e.\u0275\u0275advance(2),e.\u0275\u0275property("destroyOnHide",!0),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbNavItem","browseTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(17,18,"item.edit.item-mapper.tabs.browse")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavItem","mapTab"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(22,20,"item.edit.item-mapper.tabs.map")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavOutlet",a)}},directives:[I.Pz,I.nv,I.Vx,I.uN,xn.v,yn.o,_.O5,I.tO],pipes:[b.X$,_.Ov],styles:[""],data:{animation:[M.Ji,M.Ic]},changeDetection:0}),i})();var Bn=r(53330),Fe=r(93075);function Dn(i,l){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"item.edit.move.save-button")," "))}function Un(i,l){1&i&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",18),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"item.edit.move.processing")," "))}const Rn=function(i){return{id:i}},jn=function(){return{type:"collection"}},wn=function(i){return[i,"edit"]};let Fn=(()=>{class i{constructor(t,n,a,o,p,v,U){this.route=t,this.router=n,this.notificationsService=a,this.itemDataService=o,this.searchService=p,this.translateService=v,this.requestService=U,this.selectorType=we.h.COLLECTION,this.inheritPolicies=!1,this.canSubmit=!1,this.processing=!1,this.COLLECTIONS=[we.h.COLLECTION]}ngOnInit(){this.itemRD$=this.route.data.pipe((0,m.U)(t=>t.dso),(0,h.xw)()),this.itemPageRoute$=this.itemRD$.pipe((0,h.mc)(),(0,m.U)(t=>(0,y.Tt)(t))),this.itemRD$.subscribe(t=>{this.item=t.payload}),this.itemRD$.pipe((0,h.xw)(),(0,h.xe)(),(0,D.w)(t=>t.owningCollection),(0,h.xw)(),(0,h.xe)()).subscribe(t=>{this.originalCollection=t})}selectDso(t){this.selectedCollection=t,this.selectedCollectionName=t.name,this.canSubmit=!0}getCurrentUrl(){return this.router.url}moveToCollection(){this.processing=!0;const t=this.itemDataService.moveToCollection(this.item.id,this.selectedCollection).pipe((0,h.hC)());t.subscribe(n=>{n.hasSucceeded?this.notificationsService.success(this.translateService.get("item.edit.move.success")):this.notificationsService.error(this.translateService.get("item.edit.move.error"))}),t.pipe((0,D.w)(()=>this.requestService.setStaleByHrefSubstring(this.item.id)),(0,D.w)(()=>this.itemDataService.findById(this.item.id,!1,!0,(0,re.l)("owningCollection"))),(0,h.hC)()).subscribe(()=>{this.processing=!1,this.router.navigate([(0,y.tn)(this.item)])})}discard(){this.selectedCollection=null,this.canSubmit=!1}get canMove(){var t;return this.canSubmit&&(null===(t=this.selectedCollection)||void 0===t?void 0:t.id)!==this.originalCollection.id}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(Ge.o),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(Ce.s))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-move"]],decls:43,vars:40,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"card","mb-3"],[1,"card-header"],[1,"card-body"],[3,"types","currentDSOId","onSelect"],["type","checkbox","name","tc","id","inheritPoliciesCheckbox",3,"ngModel","ngModelChange"],["for","inheritPoliciesCheckbox"],[1,"button-row","bottom"],[1,"float-right","space-children-mr"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],[1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"fas","fa-save"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(t,n){if(1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(7,"p"),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",1)(11,"div",2)(12,"div",3)(13,"div",4),e.\u0275\u0275text(14),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",5)(17,"ds-authorized-collection-selector",6),e.\u0275\u0275listener("onSelect",function(o){return n.selectDso(o)}),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(18,"div"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(19,"div",1)(20,"div",2)(21,"p")(22,"input",7),e.\u0275\u0275listener("ngModelChange",function(o){return n.inheritPolicies=o}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(23,"label",8),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(26,"p"),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(29,"div",9)(30,"div",10)(31,"button",11),e.\u0275\u0275pipe(32,"async"),e.\u0275\u0275element(33,"i",12),e.\u0275\u0275text(34),e.\u0275\u0275pipe(35,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(36,"button",13),e.\u0275\u0275listener("click",function(){return n.moveToCollection()}),e.\u0275\u0275template(37,Dn,4,3,"span",14),e.\u0275\u0275template(38,Un,4,3,"span",14),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(39,"button",15),e.\u0275\u0275listener("click",function(){return n.discard()}),e.\u0275\u0275element(40,"i",16),e.\u0275\u0275text(41),e.\u0275\u0275pipe(42,"translate"),e.\u0275\u0275elementEnd()()()()()()),2&t){let a;e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(5,15,"item.edit.move.head",e.\u0275\u0275pureFunction1(35,Rn,null==(a=e.\u0275\u0275pipeBind1(6,18,n.itemRD$))||null==a.payload?null:a.payload.handle))),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(9,20,"item.edit.move.description")),e.\u0275\u0275advance(6),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind2(15,22,"dso-selector.placeholder",e.\u0275\u0275pureFunction0(37,jn))),e.\u0275\u0275advance(3),e.\u0275\u0275property("types",n.COLLECTIONS)("currentDSOId",n.selectedCollection?n.selectedCollection.id:n.originalCollection.id),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngModel",n.inheritPolicies),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(25,25,"item.edit.move.inheritpolicies.checkbox")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(28,27,"item.edit.move.inheritpolicies.description")," "),e.\u0275\u0275advance(4),e.\u0275\u0275property("routerLink",e.\u0275\u0275pureFunction1(38,wn,e.\u0275\u0275pipeBind1(32,29,n.itemPageRoute$))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(35,31,"item.edit.move.cancel")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!n.canMove),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!n.processing),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",n.processing),e.\u0275\u0275advance(1),e.\u0275\u0275property("disabled",!n.canSubmit),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(42,33,"item.edit.move.discard-button")," ")}},directives:[Bn.$,Fe.Wl,Fe.JJ,Fe.On,u.rH,_.O5],pipes:[b.X$,_.Ov],encapsulation:2}),i})();var $n=r(11316),Xe=r(67357),Vn=r(18505),An=(r(87917),r(86180),r(55648)),Ln=r(34780),zn=r(51117),Qe=r(63645),kn=r(49454);function Kn(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div")(1,"div",16),e.\u0275\u0275text(2),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"div"),e.\u0275\u0275text(4),e.\u0275\u0275elementEnd()()),2&i){const t=l.$implicit;e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.metadataField," "),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",t.metadataValue.value," ")}}function Wn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",10),e.\u0275\u0275listener("click",function(){const o=e.\u0275\u0275restoreView(t).ngVar,p=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext().setSelectedVirtualMetadataItem(p,!o)}),e.\u0275\u0275elementStart(1,"div",11)(2,"label"),e.\u0275\u0275element(3,"input",12),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"div",13),e.\u0275\u0275element(5,"ds-listable-object-component-loader",14),e.\u0275\u0275template(6,Kn,5,2,"div",15),e.\u0275\u0275elementEnd()()}if(2&i){const t=l.ngVar,n=e.\u0275\u0275nextContext().$implicit,a=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275property("checked",t),e.\u0275\u0275advance(2),e.\u0275\u0275property("object",n),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",a.virtualMetadata.get(n.uuid))}}function Nn(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,Wn,7,3,"div",9),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=l.$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.isSelectedVirtualMetadataItem(t)))}}let Gn=(()=>{class i{constructor(t,n){this.objectUpdatesService=t,this.appConfig=n,this.close=new e.EventEmitter,this.save=new e.EventEmitter,this.virtualMetadata=new Map,this.showThumbnails=this.appConfig.browseBy.showThumbnails}get items(){return[this.leftItem,this.rightItem]}getVirtualMetadata(t){return Object.entries(t.metadata).map(([n,a])=>a.filter(o=>!n.startsWith("relation")&&o.authority&&o.authority.endsWith(this.relationshipId)).map(o=>({metadataField:n,metadataValue:o}))).reduce((n,a)=>n.concat(a),[])}setSelectedVirtualMetadataItem(t,n){this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.relationshipId,t.uuid,n)}isSelectedVirtualMetadataItem(t){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationshipId,t.uuid)}trackItem(t,n){return n&&n.uuid}ngOnInit(){this.items.forEach(t=>{this.virtualMetadata.set(t.uuid,this.getVirtualMetadata(t))})}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(ae.d),e.\u0275\u0275directiveInject(Qe.q))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-virtual-metadata"]],inputs:{url:"url",relationshipId:"relationshipId",leftItem:"leftItem",rightItem:"rightItem"},outputs:{close:"close",save:"save"},decls:14,vars:9,consts:[[3,"ngClass"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","flex-row-reverse","m-2"],[1,"btn","btn-primary","save",3,"click"],[1,"fas","fa-save"],["class","item d-flex flex-row",3,"click",4,"ngVar"],[1,"item","d-flex","flex-row",3,"click"],[1,"m-2"],["type","checkbox",1,"select",3,"checked"],[1,"flex-column"],[3,"object"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementStart(4,"button",2),e.\u0275\u0275listener("click",function(){return n.close.emit()}),e.\u0275\u0275elementStart(5,"span",3),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",4),e.\u0275\u0275template(8,Nn,3,3,"ng-container",5),e.\u0275\u0275elementStart(9,"div",6)(10,"button",7),e.\u0275\u0275listener("click",function(){return n.save.emit()}),e.\u0275\u0275element(11,"i",8),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd()()()()),2&t&&(e.\u0275\u0275property("ngClass",n.showThumbnails?"hide-modal-thumbnail-column":""),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1("",e.\u0275\u0275pipeBind1(3,5,"virtual-metadata.delete-relationship.modal-head")," "),e.\u0275\u0275advance(6),e.\u0275\u0275property("ngForOf",n.items)("ngForTrackBy",n.trackItem),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(13,7,"item.edit.metadata.save-button")," "))},directives:[_.mk,_.sg,me.g,Me.p],pipes:[b.X$,_.Ov],encapsulation:2}),i})();function Hn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",2)(1,"div",3),e.\u0275\u0275element(2,"ds-listable-object-component-loader",4),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"div",5)(5,"div",6)(6,"button",7),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(),o=e.\u0275\u0275reference(3);return a.openVirtualMetadataModal(o)}),e.\u0275\u0275pipe(7,"translate"),e.\u0275\u0275element(8,"i",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"button",9),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().undo()}),e.\u0275\u0275pipe(10,"translate"),e.\u0275\u0275element(11,"i",10),e.\u0275\u0275elementEnd()()()()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("object",e.\u0275\u0275pipeBind1(3,7,t.relatedItem$))("viewMode",t.viewMode)("value",t.nameVariant),e.\u0275\u0275advance(4),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(7,9,"item.edit.metadata.edit.buttons.remove")),e.\u0275\u0275property("disabled",!t.canRemove()),e.\u0275\u0275advance(3),e.\u0275\u0275propertyInterpolate("title",e.\u0275\u0275pipeBind1(10,11,"item.edit.metadata.edit.buttons.undo")),e.\u0275\u0275property("disabled",!t.canUndo())}}function Xn(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-virtual-metadata",11),e.\u0275\u0275listener("close",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().closeVirtualMetadataModal()})("save",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().remove()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()}if(2&i){const t=e.\u0275\u0275nextContext();e.\u0275\u0275property("relationshipId",t.relationship.id)("leftItem",e.\u0275\u0275pipeBind1(1,4,t.leftItem$))("rightItem",e.\u0275\u0275pipeBind1(2,6,t.rightItem$))("url",t.url)}}let Qn=(()=>{class i{constructor(t,n){this.objectUpdatesService=t,this.modalService=n,this.viewMode=Ve.w.ListElement}get relationship(){return this.update.relationship}get update(){return this.fieldUpdate.field}get nameVariant(){return this.update.nameVariant}ngOnChanges(){this.relationship&&(this.relationship.leftItem||this.relationship.rightItem)?(this.leftItem$=this.relationship.leftItem.pipe((0,h.xw)(),(0,h.xe)(),(0,Y.h)(t=>(0,f.Uh)(t)&&(0,f.UE)(t.uuid))),this.rightItem$=this.relationship.rightItem.pipe((0,h.xw)(),(0,h.xe)(),(0,Y.h)(t=>(0,f.Uh)(t)&&(0,f.UE)(t.uuid))),this.relatedItem$=(0,x.a)(this.leftItem$,this.rightItem$).pipe((0,m.U)(t=>t.find(n=>n.uuid!==this.editItem.uuid)))):this.relatedItem$=(0,C.of)(this.update.relatedItem)}remove(){this.closeVirtualMetadataModal(),(0,x.a)(this.leftItem$,this.rightItem$).pipe((0,m.U)(t=>t.map(n=>this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationship.id,n.uuid))),(0,D.w)(t=>(0,x.a)(t)),(0,m.U)(t=>Object.assign({},this.fieldUpdate.field,{keepLeftVirtualMetadata:!0===t[0],keepRightVirtualMetadata:!0===t[1]})),(0,P.q)(1)).subscribe(t=>this.objectUpdatesService.saveRemoveFieldUpdate(this.url,t))}openVirtualMetadataModal(t){this.modalRef=this.modalService.open(t)}closeVirtualMetadataModal(){this.modalRef.close()}undo(){this.objectUpdatesService.removeSingleFieldUpdate(this.url,this.fieldUpdate.field.uuid)}canRemove(){return this.fieldUpdate.changeType!==ue.m.REMOVE&&this.fieldUpdate.changeType!==ue.m.ADD}canUndo(){return this.fieldUpdate.changeType>=0}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(ae.d),e.\u0275\u0275directiveInject(I.FF))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-relationship"]],inputs:{fieldUpdate:"fieldUpdate",url:"url",editItem:"editItem"},features:[e.\u0275\u0275NgOnChangesFeature],decls:4,vars:3,consts:[["class","row",4,"ngIf"],["virtualMetadataModal",""],[1,"row"],[1,"col-10","relationship"],[3,"object","viewMode","value"],[1,"col-2"],[1,"btn-group","relationship-action-buttons"],[1,"btn","btn-outline-danger","btn-sm",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"disabled","title","click"],[1,"fas","fa-undo-alt","fa-fw"],[3,"relationshipId","leftItem","rightItem","url","close","save"]],template:function(t,n){1&t&&(e.\u0275\u0275template(0,Hn,12,13,"div",0),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275template(2,Xn,3,8,"ng-template",null,1,e.\u0275\u0275templateRefExtractor)),2&t&&e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(1,1,n.relatedItem$))},directives:[_.O5,Me.p,Gn],pipes:[_.Ov,b.X$],styles:[".btn[disabled][_ngcontent-%COMP%]{color:var(--bs-gray-600);border-color:var(--bs-gray-600);z-index:0}.relationship-action-buttons[_ngcontent-%COMP%]{margin:0;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}"]}),i})();const Jn=function(){return{}},Zn=function(i,l,t){return{"alert-success":i,"alert-warning":l,"alert-danger":t}};function Yn(i,l){if(1&i&&e.\u0275\u0275element(0,"ds-edit-relationship",8),2&i){const t=l.$implicit,n=e.\u0275\u0275nextContext(4);e.\u0275\u0275property("fieldUpdate",t||e.\u0275\u0275pureFunction0(4,Jn))("url",n.url)("editItem",n.item)("ngClass",e.\u0275\u0275pureFunction3(5,Zn,1===t.changeType,0===t.changeType,2===t.changeType))}}function qn(i,l){1&i&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(2,1,"item.edit.relationships.no-relationships")))}function ei(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"ds-pagination",5),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementStart(5,"div",6),e.\u0275\u0275template(6,Yn,1,9,"ds-edit-relationship",7),e.\u0275\u0275elementEnd()(),e.\u0275\u0275template(7,qn,3,3,"div",4),e.\u0275\u0275elementContainerEnd()),2&i){const t=l.ngVar,n=e.\u0275\u0275nextContext(3);let a,o;e.\u0275\u0275advance(1),e.\u0275\u0275property("paginationOptions",n.paginationConfig)("pageInfoState",null==(a=e.\u0275\u0275pipeBind1(2,8,n.relationshipsRd$))||null==a.payload?null:a.payload.pageInfo)("collectionSize",(null==(o=e.\u0275\u0275pipeBind1(3,10,n.relationshipsRd$))||null==o.payload?null:o.payload.totalElements)+e.\u0275\u0275pipeBind1(4,12,n.nbAddedFields$))("hideGear",!0)("hidePagerWhenSinglePage",!0),e.\u0275\u0275advance(5),e.\u0275\u0275property("ngForOf",t)("ngForTrackBy",n.trackUpdate),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",0===t.length)}}function ti(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ei,8,14,"ng-container",3),e.\u0275\u0275pipe(2,"dsObjectValues"),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,t))}}function ni(i,l){1&i&&e.\u0275\u0275element(0,"ds-themed-loading")}function ii(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ti,3,3,"ng-container",4),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275template(3,ni,1,0,"ds-themed-loading",4),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=l.ngVar,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t&&!e.\u0275\u0275pipeBind1(2,2,n.loading$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(4,4,n.loading$))}}let ai=(()=>{class i{constructor(t,n,a,o,p,v,U,G){this.objectUpdatesService=t,this.linkService=n,this.relationshipService=a,this.relationshipTypeService=o,this.modalService=p,this.paginationService=v,this.selectableListService=U,this.appConfig=G,this.submit=new e.EventEmitter,this.updates$=new q.X(void 0),this.relationshipsRd$=new q.X(void 0),this.isLastPage$=new q.X(!0),this.loading$=new q.X(!0),this.nbAddedFields$=new q.X(0),this.subs=[],this.fetchThumbnail=this.appConfig.browseBy.showThumbnails}getRelationshipMessageKey(){return(0,x.a)(this.getLabel(),this.relatedEntityType$).pipe((0,m.U)(([t,n])=>{if((0,f.Uh)(t)&&t.indexOf("is")>-1&&t.indexOf("Of")>-1){const a=`${t.substring(2,t.indexOf("Of"))}`;return a!==n.label?`relationships.is${a}Of.${n.label}`:`relationships.is${a}Of`}return t}))}getLabel(){return(0,x.a)([this.relationshipType.leftType,this.relationshipType.rightType].map(t=>t.pipe((0,h.xw)(),(0,h.xe)()))).pipe((0,m.U)(t=>[this.relationshipType.leftwardType,this.relationshipType.rightwardType][t.findIndex(n=>n.id===this.itemType.id)]))}trackUpdate(t,n){return n&&n.field?n.field.uuid:void 0}openLookup(){this.modalRef=this.modalService.open(An.i,{size:"lg"});const t=this.modalRef.componentInstance;t.repeatable=!0,t.isEditRelationship=!0,t.listId=this.listId,t.item=this.item,t.relationshipType=this.relationshipType,t.currentItemIsLeftItem$=this.currentItemIsLeftItem$,t.toAdd=[],t.toRemove=[],t.isPending=!1,this.item.owningCollection.pipe((0,h.Gp)()).subscribe(n=>{t.collection=n}),t.select=(...n)=>{n.forEach(a=>{const o=a.indexableObject,p=t.toRemove.findIndex(v=>v.uuid===o.uuid);-1!==p?t.toRemove.splice(p,1):this.getRelationFromId(o).subscribe(v=>{if(v){const U=t.toRemove.findIndex(G=>G.indexableObject.uuid===o.uuid);-1!==U&&t.toRemove.splice(U,1)}else t.toAdd.push(a);this.loading$.next(!0),this.relationshipsRd$.next(this.relationshipsRd$.getValue())})})},t.deselect=(...n)=>{n.forEach(a=>{const o=a.indexableObject,p=t.toAdd.findIndex(v=>v.indexableObject.uuid===o.uuid);-1!==p?t.toAdd.splice(p,1):t.toRemove.push(a)})},t.submitEv=()=>{const n=[];t.toAdd.forEach(a=>{const o=a.indexableObject;n.push(this.relationshipService.getNameVariant(this.listId,o.uuid).pipe((0,m.U)(p=>{const v={uuid:this.relationshipType.id+"-"+a.indexableObject.uuid,nameVariant:p,type:this.relationshipType,relatedItem:o};return this.objectUpdatesService.saveAddFieldUpdate(this.url,v),v})))}),t.toRemove.forEach(a=>{n.push(this.relationshipService.getNameVariant(this.listId,a.indexableObjectuuid).pipe((0,D.w)(o=>this.getRelationFromId(a.indexableObject).pipe((0,m.U)(p=>{const v={uuid:p.id,nameVariant:o,type:this.relationshipType,relationship:p};return this.objectUpdatesService.saveRemoveFieldUpdate(this.url,v),v})))))}),(0,x.a)(n).subscribe(a=>{setTimeout(()=>{this.submit.emit()},1e3),t.isPending=!0})},t.discardEv=()=>{t.toAdd.forEach(n=>{this.selectableListService.deselectSingle(this.listId,n)}),t.toRemove.forEach(n=>{this.selectableListService.selectSingle(this.listId,n)}),t.toAdd=[],t.toRemove=[]},this.relatedEntityType$.pipe((0,P.q)(1)).subscribe(n=>{t.relationshipOptions=Object.assign(new Ln.u,{relationshipType:n.label,searchConfiguration:n.label.toLowerCase(),nameVariants:"true"})}),this.selectableListService.deselectAll(this.listId)}getRelationFromId(t){return this.currentItemIsLeftItem$.pipe((0,P.q)(1),(0,D.w)(n=>{let a;return a=n?this.relationshipService.searchByItemsAndType(this.relationshipType.id,this.item.uuid,this.relationshipType.leftwardType,[t.id]).pipe((0,h.xw)(),(0,h.xe)()):this.relationshipService.searchByItemsAndType(this.relationshipType.id,this.item.uuid,this.relationshipType.rightwardType,[t.id]).pipe((0,h.xw)(),(0,h.xe)()),a.pipe((0,m.U)(o=>o.page[0]))}))}getFieldUpdatesForRelatedItem(t){return this.updates$.pipe((0,P.q)(1),(0,m.U)(n=>Object.values(n).map(a=>a.field).filter(a=>a.relationship)),(0,fe.z)(n=>(0,x.a)(n.map(a=>this.getRelatedItem(a.relationship))).pipe((0,Z.d)([]),(0,m.U)(a=>n.filter((o,p)=>a[p].uuid===t.uuid)))))}getIsRelatedItem(t){return this.currentItemIsLeftItem$.pipe((0,P.q)(1),(0,m.U)(n=>n?!!this.item.allMetadataValues("relation."+this.relationshipType.leftwardType).find(o=>o===t.uuid):!!this.item.allMetadataValues("relation."+this.relationshipType.rightwardType).find(o=>o===t.uuid)))}getRelatedItem(t){return this.relationshipService.isLeftItem(t,this.item).pipe((0,D.w)(n=>n?t.rightItem:t.leftItem),(0,h.xw)(),(0,h.xe)())}ngOnInit(){this.relationshipLeftAndRightType$=(0,x.a)([this.relationshipType.leftType,this.relationshipType.rightType].map(a=>a.pipe((0,h.xw)(),(0,h.xe)()))),this.relatedEntityType$=this.relationshipLeftAndRightType$.pipe((0,m.U)(a=>a.find(o=>o.uuid!==this.itemType.uuid)),(0,f.tz)()),this.relatedEntityType$.pipe((0,P.q)(1)).subscribe(a=>this.listId=`edit-relationship-${this.itemType.id}-${a.id}`),this.currentItemIsLeftItem$=this.relationshipLeftAndRightType$.pipe((0,m.U)(([a,o])=>a.id===this.itemType.id||o.id!==this.itemType.id&&void console.warn(`The item ${this.item.uuid} is not on the right or the left side of relationship type ${this.relationshipType.uuid}`))),this.paginationConfig=new Ne.r,this.paginationConfig.id=`er${this.relationshipType.id}`,this.paginationConfig.pageSize=5,this.paginationConfig.currentPage=1;const t=this.paginationService.getCurrentPagination(this.paginationConfig.id,this.paginationConfig).pipe((0,Vn.b)(()=>this.loading$.next(!0)));let n=(0,kn.IX)(this.fetchThumbnail);this.subs.push((0,x.a)([t,this.currentItemIsLeftItem$]).pipe((0,D.w)(([a,o])=>this.relationshipService.getItemRelationshipsByLabel(this.item,o?this.relationshipType.leftwardType:this.relationshipType.rightwardType,{elementsPerPage:a.pageSize,currentPage:a.currentPage},!1,!0,...n))).subscribe(a=>{this.relationshipsRd$.next(a)})),this.subs.push(this.relationshipsRd$.pipe((0,f.tz)(),(0,h.g1)()).subscribe(a=>{this.isLastPage$.next((0,f.xI)(a.payload._links.next))})),this.subs.push(this.relationshipsRd$.pipe((0,f.tz)(),(0,h.g1)(),(0,D.w)(a=>(0,ke.D)(a.payload.page).pipe((0,fe.z)(o=>this.relationshipService.isLeftItem(o,this.item).pipe((0,m.U)(p=>[o,p]))),(0,m.U)(([o,p])=>({uuid:o.id,type:this.relationshipType,relationship:o,nameVariant:p?o.rightwardValue:o.leftwardValue})),(0,ze.q)(),(0,Z.d)([]))),(0,D.w)(a=>this.objectUpdatesService.getFieldUpdates(this.url,a).pipe((0,m.U)(o=>{const p={};return this.nbAddedFields$.next(0),Object.keys(o).forEach(v=>{(0,f.Uh)(o[v])&&o[v].field.type.id===this.relationshipType.id&&(o[v].changeType===ue.m.ADD?(this.nbAddedFields$.next(this.nbAddedFields$.getValue()+1),!0===this.isLastPage$.getValue()&&(p[v]=o[v])):p[v]=o[v])}),p}))),(0,je.O)({})).subscribe(a=>{this.loading$.next(!1),this.updates$.next(a)}))}ngOnDestroy(){this.subs.filter(t=>(0,f.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(ae.d),e.\u0275\u0275directiveInject(Se.M),e.\u0275\u0275directiveInject(Ee.U),e.\u0275\u0275directiveInject(Xe.X),e.\u0275\u0275directiveInject(I.FF),e.\u0275\u0275directiveInject(De.N),e.\u0275\u0275directiveInject(zn.w),e.\u0275\u0275directiveInject(Qe.q))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-edit-relationship-list"]],inputs:{item:"item",itemType:"itemType",url:"url",relationshipType:"relationshipType",hasChanges:"hasChanges"},outputs:{submit:"submit"},decls:12,vars:14,consts:[[1,"ml-2","btn","btn-success",3,"disabled","click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[4,"ngVar"],[4,"ngIf"],[3,"paginationOptions","pageInfoState","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"my-2"],["class","relationship-row d-block alert",3,"fieldUpdate","url","editItem","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"relationship-row","d-block","alert",3,"fieldUpdate","url","editItem","ngClass"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"h5"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementStart(4,"button",0),e.\u0275\u0275listener("click",function(){return n.openLookup()}),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275element(6,"i",1),e.\u0275\u0275elementStart(7,"span",2),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(10,ii,5,6,"ng-container",3),e.\u0275\u0275pipe(11,"async")),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,4,e.\u0275\u0275pipeBind1(3,6,n.getRelationshipMessageKey()))," "),e.\u0275\u0275advance(3),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(5,8,n.hasChanges)),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(9,10,"item.edit.relationships.edit.buttons.add"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(11,12,n.updates$)))},directives:[me.g,_.O5,Be.Q,_.sg,Qn,_.mk,ye.Z],pipes:[b.X$,_.Ov,xe.g],styles:[".relationship-row[_ngcontent-%COMP%]:not(.alert){padding:var(--bs-alert-padding-y) 0}.relationship-row.alert[_ngcontent-%COMP%]{margin-left:calc(-1 * var(--bs-alert-padding-x));margin-right:calc(-1 * var(--bs-alert-padding-x));margin-top:-1px;margin-bottom:-1px}"]}),i})();function ri(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",14),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function oi(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",16),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).reinstate()}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function si(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",19)(1,"ds-edit-relationship-list",20),e.\u0275\u0275listener("submit",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(5).submit()}),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()()}if(2&i){const t=l.$implicit,n=e.\u0275\u0275nextContext(5);e.\u0275\u0275advance(1),e.\u0275\u0275property("url",n.url)("item",n.item)("itemType",e.\u0275\u0275pipeBind1(2,5,n.entityType$))("relationshipType",t)("hasChanges",n.hasChanges())}}function li(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,si,3,7,"div",18),e.\u0275\u0275elementContainerEnd()),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",t)}}function di(i,l){1&i&&e.\u0275\u0275element(0,"ds-themed-loading")}function ci(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,li,2,1,"ng-container",2),e.\u0275\u0275template(2,di,1,0,"ds-themed-loading",2),e.\u0275\u0275elementContainerEnd()),2&i){const t=l.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t)}}function pi(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",21),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).discard()}),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275element(2,"i",15),e.\u0275\u0275elementStart(3,"span",9),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()()}if(2&i){const t=e.\u0275\u0275nextContext(3);e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(1,2,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}function mi(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",22),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(3).reinstate()}),e.\u0275\u0275element(1,"i",17),e.\u0275\u0275elementStart(2,"span",9),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function ui(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",4),e.\u0275\u0275template(2,ri,6,6,"button",5),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275template(4,oi,5,3,"button",6),e.\u0275\u0275pipe(5,"async"),e.\u0275\u0275elementStart(6,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).submit()}),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275element(8,"i",8),e.\u0275\u0275elementStart(9,"span",9),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275template(12,ci,3,2,"ng-container",1),e.\u0275\u0275pipe(13,"async"),e.\u0275\u0275elementStart(14,"div",10)(15,"div",11),e.\u0275\u0275template(16,pi,6,6,"button",12),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275template(18,mi,5,3,"button",13),e.\u0275\u0275pipe(19,"async"),e.\u0275\u0275elementStart(20,"button",7),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext(2).submit()}),e.\u0275\u0275pipe(21,"async"),e.\u0275\u0275element(22,"i",8),e.\u0275\u0275elementStart(23,"span",9),e.\u0275\u0275text(24),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275elementEnd()()()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275nextContext(2);e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(3,9,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(5,11,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(7,13,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(11,15,"item.edit.metadata.save-button"),""),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(13,17,t.relationshipTypes$)),e.\u0275\u0275advance(4),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(17,19,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(19,21,t.isReinstatable())),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(21,23,t.hasChanges())),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1("\xa0",e.\u0275\u0275pipeBind1(25,25,"item.edit.metadata.save-button"),"")}}function hi(i,l){1&i&&(e.\u0275\u0275elementStart(0,"div",23),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&i&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"item.edit.relationships.no-entity-type")," "))}function _i(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275template(1,ui,26,27,"ng-container",2),e.\u0275\u0275template(2,hi,3,3,"div",3),e.\u0275\u0275elementContainerEnd()),2&i){const t=l.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!t)}}let gi=(()=>{class i extends Ke.a{constructor(t,n,a,o,p,v,U,G,ie,ce,ge,$e,Li){super(t,n,a,o,p,v),this.itemService=t,this.objectUpdatesService=n,this.router=a,this.notificationsService=o,this.translateService=p,this.route=v,this.relationshipService=U,this.objectCache=G,this.requestService=ie,this.entityTypeService=ce,this.relationshipTypeService=ge,this.cdr=$e,this.modalService=Li}initializeUpdates(){const t=this.item.firstMetadataValue("dspace.entity.type");void 0!==t?(this.relationshipTypes$=this.relationshipTypeService.searchByEntityType(t,!0,!0,...this.getRelationshipTypeFollowLinks()).pipe((0,m.U)(n=>n.page)),this.entityType$=this.entityTypeService.getEntityTypeByLabel(t).pipe((0,h.xw)(),(0,h.xe)())):this.entityType$=(0,C.of)(void 0)}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.relationships.notifications."}submit(){const t=this.relationshipService.getItemRelationshipsArray(this.item).pipe((0,je.O)([]),(0,m.U)(a=>a.map(o=>Object.assign(new $n.W,o,{uuid:o.id}))),(0,D.w)(a=>this.objectUpdatesService.getFieldUpdatesExclusive(this.url,a)),(0,m.U)(a=>Object.values(a).filter(o=>o.changeType===ue.m.REMOVE).map(o=>o.field))),n=this.objectUpdatesService.getFieldUpdates(this.url,[]).pipe((0,m.U)(a=>Object.values(a).filter(o=>(0,f.Uh)(o)).filter(o=>o.changeType===ue.m.ADD).map(o=>o.field)));(0,x.a)(t,n).pipe((0,P.q)(1)).subscribe(([a,o])=>{[this.deleteRelationships(a),this.addRelationships(o)].forEach(v=>v.subscribe(U=>{U.length>0&&(this.initializeOriginalFields(),this.cdr.detectChanges(),this.displayNotifications(U),this.modalService.dismissAll())}))})}deleteRelationships(t){return(0,ve.$)(...t.map(n=>{let a;return a=n.keepLeftVirtualMetadata&&n.keepRightVirtualMetadata?"all":n.keepLeftVirtualMetadata?"left":n.keepRightVirtualMetadata?"right":"none",this.relationshipService.deleteRelationship(n.uuid,a)}))}addRelationships(t){return(0,ve.$)(...t.map(n=>this.entityType$.pipe((0,D.w)(a=>this.entityTypeService.isLeftType(n.type,a)),(0,D.w)(a=>{let o,p,v,U;return a?(o=this.item,p=n.relatedItem,v=null,U=n.nameVariant):(o=n.relatedItem,p=this.item,v=n.nameVariant,U=null),this.relationshipService.addRelationship(n.type.id,o,p,v,U)}))))}displayNotifications(t){const n=t.filter(o=>o.hasFailed),a=t.filter(o=>o.hasSucceeded);n.forEach(o=>{this.notificationsService.error(this.getNotificationTitle("failed"),o.errorMessage)}),a.length>0&&this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved"))}initializeOriginalFields(){return this.relationshipService.getRelatedItems(this.item).pipe((0,P.q)(1)).subscribe(t=>{this.objectUpdatesService.initialize(this.url,t,this.item.lastModified)})}getRelationshipTypeFollowLinks(){return[(0,re.l)("leftType"),(0,re.l)("rightType")]}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(F.S),e.\u0275\u0275directiveInject(ae.d),e.\u0275\u0275directiveInject(u.F0),e.\u0275\u0275directiveInject(L.T),e.\u0275\u0275directiveInject(b.sK),e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(Ee.U),e.\u0275\u0275directiveInject(We.a),e.\u0275\u0275directiveInject(Ce.s),e.\u0275\u0275directiveInject(Ae.k),e.\u0275\u0275directiveInject(Xe.X),e.\u0275\u0275directiveInject(e.ChangeDetectorRef),e.\u0275\u0275directiveInject(I.FF))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-relationships"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:3,vars:3,consts:[[1,"item-relationships"],[4,"ngVar"],[4,"ngIf"],["class","alert alert-info mt-2","role","alert",4,"ngIf"],[1,"button-row","top","d-flex","space-children-mr"],["class","btn btn-danger ml-auto",3,"disabled","click",4,"ngIf"],["class","btn btn-warning ml-auto",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],[1,"d-none","d-sm-inline"],[1,"button-row","bottom"],[1,"float-right","space-children-mr","ml-gap"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-danger","ml-auto",3,"disabled","click"],[1,"fas","fa-times"],[1,"btn","btn-warning","ml-auto",3,"click"],[1,"fas","fa-undo-alt"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[3,"url","item","itemType","relationshipType","hasChanges","submit"],[1,"btn","btn-danger",3,"disabled","click"],[1,"btn","btn-warning",3,"click"],["role","alert",1,"alert","alert-info","mt-2"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,_i,3,2,"ng-container",1),e.\u0275\u0275pipe(2,"async"),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("ngVar",e.\u0275\u0275pipeBind1(2,1,n.entityType$)))},directives:[me.g,_.O5,_.sg,ai,ye.Z],pipes:[_.Ov,b.X$],styles:[".button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:var(--ds-gap)}.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}@media screen and (min-width: 576px){.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:var(--ds-edit-item-button-min-width)}}.button-row.top[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-top:calc(var(--bs-spacer) / 2);margin-bottom:calc(var(--bs-spacer) / 2)}"]}),i})();var Je=r(98655),vi=r(74711),fi=r(75112);function bi(i,l){if(1&i&&e.\u0275\u0275element(0,"ds-item-versions",3),2&i){const t=e.\u0275\u0275nextContext().ngVar;e.\u0275\u0275property("item",t)("displayWhenEmpty",!0)("displayTitle",!1)("displayActions",!0)}}function Ii(i,l){if(1&i&&(e.\u0275\u0275elementStart(0,"div",1),e.\u0275\u0275template(1,bi,1,4,"ds-item-versions",2),e.\u0275\u0275elementEnd()),2&i){const t=l.ngVar;e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",t)}}let Ci=(()=>{class i{constructor(t){this.route=t,this.AlertTypeEnum=vi.N}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,m.U)(t=>t.dso)).pipe((0,h.xw)())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(u.gz))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-version-history"]],decls:2,vars:3,consts:[["class","mt-2",4,"ngVar"],[1,"mt-2"],[3,"item","displayWhenEmpty","displayTitle","displayActions",4,"ngIf"],[3,"item","displayWhenEmpty","displayTitle","displayActions"]],template:function(t,n){if(1&t&&(e.\u0275\u0275template(0,Ii,2,1,"div",0),e.\u0275\u0275pipe(1,"async")),2&t){let a;e.\u0275\u0275property("ngVar",null==(a=e.\u0275\u0275pipeBind1(1,1,n.itemRD$))?null:a.payload)}},directives:[me.g,_.O5,fi.h],pipes:[_.Ov],encapsulation:2}),i})();var Ze=r(70262),Ye=r(24789),xi=r(38605),yi=r(40195),Ei=r(86361);function Si(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-resource-policies",5),e.\u0275\u0275elementContainerEnd()),2&i){const t=l.$implicit;e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","bitstream")("resourceUUID",t.id)("resourceName",t.name)}}function Mi(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11)(1,"button",12),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext(2).$implicit;return e.\u0275\u0275nextContext().onBitstreamsLoad(a)}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,1,"collection.edit.item.authorizations.load-more-button")))}function Oi(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275elementStart(1,"div",7)(2,"div",8)(3,"button",9),e.\u0275\u0275listener("click",function(){e.\u0275\u0275restoreView(t);const a=e.\u0275\u0275nextContext().$implicit;return e.\u0275\u0275nextContext().collapseArea(a.id)}),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",10),e.\u0275\u0275template(7,Si,2,3,"ng-container",3),e.\u0275\u0275pipe(8,"async"),e.\u0275\u0275template(9,Mi,4,3,"div",4),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementContainerEnd()}if(2&i){const t=e.\u0275\u0275nextContext().$implicit,n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(3),e.\u0275\u0275attribute("aria-expanded",!1)("aria-controls",t.id),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(5,8,"collection.edit.item.authorizations.show-bitstreams-button")," ",t.name," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("id",t.id)("ngbCollapse",n.bundleBitstreamsMap.get(t.id).isCollapsed),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(8,10,n.bundleBitstreamsMap.get(t.id).bitstreams)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.bundleBitstreamsMap.get(t.id).allBitstreamsLoaded)}}function Pi(i,l){if(1&i&&(e.\u0275\u0275elementContainerStart(0),e.\u0275\u0275element(1,"ds-resource-policies",5),e.\u0275\u0275template(2,Oi,10,12,"ng-container",6),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275elementContainerEnd()),2&i){const t=l.$implicit,n=e.\u0275\u0275nextContext();let a;e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","bundle")("resourceUUID",t.id)("resourceName",t.name),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==(a=e.\u0275\u0275pipeBind1(3,4,null==(a=n.bundleBitstreamsMap.get(t.id))?null:a.bitstreams))?null:a.length)>0)}}function Ti(i,l){if(1&i){const t=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",11)(1,"button",12),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(t),e.\u0275\u0275nextContext().onBundleLoad()}),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()()}2&i&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,1,"collection.edit.item.authorizations.load-bundle-button")))}let Bi=(()=>{class i{constructor(t,n,a){this.linkService=t,this.route=n,this.nameService=a,this.bundleBitstreamsMap=new Map,this.bundles$=new q.X([]),this.subs=[],this.bundlesPerPage=6,this.bundlesPageSize=1,this.allBundlesLoaded=!1,this.bitstreamSize=4,this.bitstreamPageSize=4}ngOnInit(){this.getBundlesPerItem()}getItemUUID(){return this.item$.pipe((0,m.U)(t=>t.id),(0,w.P)(t=>(0,f.UE)(t)))}getItemName(){return this.item$.pipe((0,m.U)(t=>this.nameService.getName(t)))}getItemBundles(){return this.bundles$.asObservable()}getBundlesPerItem(t=1){this.item$=this.route.data.pipe((0,m.U)(a=>a.dso),(0,h.A6)(),(0,m.U)(a=>this.linkService.resolveLink(a,(0,re.l)("bundles",{findListOptions:{currentPage:t,elementsPerPage:this.bundlesPerPage}},(0,re.l)("bitstreams")))));const n=this.item$.pipe((0,Y.h)(a=>(0,f.UE)(a.bundles)),(0,fe.z)(a=>a.bundles),(0,h.A6)(),(0,Ze.K)(a=>(console.error(a),(0,C.of)((0,Ye.b)(null,[])))));this.subs.push(n.pipe((0,P.q)(1),(0,m.U)(a=>a.page)).subscribe(a=>{((0,Ue.isEqual)(a.length,0)||a.length<this.bundlesPerPage)&&(this.allBundlesLoaded=!0),(0,Ue.isEqual)(t,1)?this.bundles$.next(a):this.bundles$.next(this.bundles$.getValue().concat(a))}),n.pipe((0,P.q)(1),(0,fe.z)(a=>a.page),(0,m.U)(a=>({id:a.id,bitstreams:this.getBundleBitstreams(a)}))).subscribe(a=>{let o={isCollapsed:!0,allBitstreamsLoaded:!1,bitstreams:null};o.bitstreams=a.bitstreams.pipe((0,m.U)(p=>(o.allBitstreamsLoaded=(null==p?void 0:p.page.length)<this.bitstreamSize,[...p.page.slice(0,this.bitstreamSize)]))),this.bundleBitstreamsMap.set(a.id,o)}))}getBundleBitstreams(t){return t.bitstreams.pipe((0,h.Gp)(),(0,Ze.K)(n=>(console.error(n),(0,C.of)((0,Ye.b)(null,[])))))}collapseArea(t){this.bundleBitstreamsMap.get(t).isCollapsed=!this.bundleBitstreamsMap.get(t).isCollapsed}onBundleLoad(){this.bundlesPageSize++,this.getBundlesPerItem(this.bundlesPageSize)}onBitstreamsLoad(t){return this.getBundleBitstreams(t).subscribe(n=>{let a=null==n?void 0:n.page.slice(this.bitstreamPageSize,this.bitstreamPageSize+this.bitstreamSize),o=this.bundleBitstreamsMap.get(t.id).bitstreams.pipe((0,m.U)(v=>[...v,...a]));this.bitstreamPageSize=this.bitstreamPageSize+this.bitstreamSize;let p={bitstreams:o,isCollapsed:this.bundleBitstreamsMap.get(t.id).isCollapsed,allBitstreamsLoaded:(null==n?void 0:n.page.length)<=this.bitstreamPageSize};this.bundleBitstreamsMap.set(t.id,p)})}ngOnDestroy(){this.subs.filter(t=>(0,f.Uh)(t)).forEach(t=>t.unsubscribe())}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275directiveInject(Se.M),e.\u0275\u0275directiveInject(u.gz),e.\u0275\u0275directiveInject(Re._))},i.\u0275cmp=e.\u0275\u0275defineComponent({type:i,selectors:[["ds-item-authorizations"]],decls:8,vars:13,consts:[[1,"container"],[3,"type","content"],[3,"resourceType","resourceName","resourceUUID"],[4,"ngFor","ngForTrackById","ngForOf"],["class","row justify-content-center",4,"ngIf"],[3,"resourceType","resourceUUID","resourceName"],[4,"ngIf"],[1,"card","auth-bitstream-container"],[1,"card-header"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"card-body",3,"id","ngbCollapse"],[1,"row","justify-content-center"],["type","button",1,"btn","btn-link",3,"click"]],template:function(t,n){1&t&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275element(1,"ds-alert",1)(2,"ds-resource-policies",2),e.\u0275\u0275pipe(3,"async"),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275template(5,Pi,4,6,"ng-container",3),e.\u0275\u0275pipe(6,"async"),e.\u0275\u0275template(7,Ti,4,3,"div",4),e.\u0275\u0275elementEnd()),2&t&&(e.\u0275\u0275advance(1),e.\u0275\u0275property("type","alert-info")("content","item.edit.authorizations.heading"),e.\u0275\u0275advance(1),e.\u0275\u0275property("resourceType","item")("resourceName",e.\u0275\u0275pipeBind1(3,7,n.getItemName()))("resourceUUID",e.\u0275\u0275pipeBind1(4,9,n.getItemUUID())),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",e.\u0275\u0275pipeBind1(6,11,n.bundles$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!n.allBundlesLoaded))},directives:[xi.w,yi.F,_.sg,Ei.$,_.O5,I._D],pipes:[_.Ov,b.X$],styles:[".auth-bitstream-container[_ngcontent-%COMP%]{margin-top:-1em;margin-bottom:1.5em}"]}),i})();var qe=r(66765),et=r(48739),Di=r(34981),Ui=r(86527),Ri=r(43001),he=r(84254),_e=r(68212),le=r(59508),de=r(24755);let tt=(()=>{class i extends _e.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,C.of)(z.i.ReinstateItem)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(le.o),e.\u0275\u0275inject(se._),e.\u0275\u0275inject(u.F0),e.\u0275\u0275inject(de.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),nt=(()=>{class i extends _e.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,C.of)(z.i.WithdrawItem)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(le.o),e.\u0275\u0275inject(se._),e.\u0275\u0275inject(u.F0),e.\u0275\u0275inject(de.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),it=(()=>{class i extends _e.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,C.of)(z.i.CanEditMetadata)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(le.o),e.\u0275\u0275inject(se._),e.\u0275\u0275inject(u.F0),e.\u0275\u0275inject(de.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var ji=r(7056),wi=r(74307);let at=(()=>{class i extends wi.q{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureIDs(t,n){return(0,C.of)([z.i.CanManageMappings,z.i.WithdrawItem,z.i.ReinstateItem,z.i.CanManagePolicies,z.i.CanMakePrivate,z.i.CanDelete,z.i.CanMove])}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(le.o),e.\u0275\u0275inject(se._),e.\u0275\u0275inject(u.F0),e.\u0275\u0275inject(de.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),rt=(()=>{class i extends _e.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,C.of)(z.i.CanManageBitstreamBundles)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(le.o),e.\u0275\u0275inject(se._),e.\u0275\u0275inject(u.F0),e.\u0275\u0275inject(de.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),ot=(()=>{class i extends _e.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,C.of)(z.i.CanManageRelationships)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(le.o),e.\u0275\u0275inject(se._),e.\u0275\u0275inject(u.F0),e.\u0275\u0275inject(de.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),st=(()=>{class i extends _e.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,C.of)(z.i.CanManageVersions)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(le.o),e.\u0275\u0275inject(se._),e.\u0275\u0275inject(u.F0),e.\u0275\u0275inject(de.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),lt=(()=>{class i extends _e.h{constructor(t,n,a,o){super(t,n,a,o),this.resolver=t,this.authorizationService=n,this.router=a,this.authService=o}getFeatureID(t,n){return(0,C.of)(z.i.CanManageMappings)}}return i.\u0275fac=function(t){return new(t||i)(e.\u0275\u0275inject(le.o),e.\u0275\u0275inject(se._),e.\u0275\u0275inject(u.F0),e.\u0275\u0275inject(de.e8))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),Fi=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({providers:[Je.t,Ri.d,et.b,qe.a,tt,nt,ji.F,it,at,rt,ot,st,lt],imports:[[u.Bz.forChild([{path:"",resolve:{breadcrumb:Je.t},data:{breadcrumbKey:"item.edit"},children:[{path:"",component:Q,children:[{path:"",redirectTo:"status",pathMatch:"full"},{path:"status",component:Tt,data:{title:"item.edit.tabs.status.title",showBreadcrumbs:!0},canActivate:[at]},{path:"bitstreams",component:bn,data:{title:"item.edit.tabs.bitstreams.title",showBreadcrumbs:!0},canActivate:[rt]},{path:"metadata",component:Bt.ItemMetadataComponent,data:{title:"item.edit.tabs.metadata.title",showBreadcrumbs:!0},canActivate:[it]},{path:"relationships",component:gi,data:{title:"item.edit.tabs.relationships.title",showBreadcrumbs:!0},canActivate:[ot]},{path:"versionhistory",component:Ci,data:{title:"item.edit.tabs.versionhistory.title",showBreadcrumbs:!0},canActivate:[st]},{path:"mapper",component:He,data:{title:"item.edit.tabs.item-mapper.title",showBreadcrumbs:!0},canActivate:[lt]}]},{path:"mapper",component:He},{path:he.M0,component:ne,canActivate:[nt]},{path:he.Pu,component:B,canActivate:[tt]},{path:he.X$,component:E},{path:he.dI,component:V},{path:he.kJ,component:Ct},{path:he.Gr,component:Fn,data:{title:"item.edit.move.title"}},{path:he.N,children:[{path:"create",resolve:{resourcePolicyTarget:qe.a},component:Di.v,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:et.b},component:Ui.x,data:{title:"resource-policies.edit.page.title"}},{path:"",component:Bi,data:{title:"item.edit.authorizations.title"}}]}]}])]]}),i})();var $i=r(98190),Vi=r(94337);let Ai=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.\u0275\u0275defineNgModule({type:i}),i.\u0275inj=e.\u0275\u0275defineInjector({providers:[Oe.b,xe.g],imports:[[_.ez,O.m,I.HK,Fi,$i.q,Ie._t,Vi.q,I.IJ]]}),i})()},76487:(K,R,r)=>{"use strict";r.d(R,{I:()=>H});var _=r(68285),I=r(24702),O=r(45879),u=r(17489),C=r(61135),x=r(39646),m=r(54004),f=r(46040),e=(r(79300),r(93369)),b=r(59051),s=r(5e3),j=r(69808),T=r(5468),$=r(30668),d=r(93075),Q=r(90059),L=r(34159),F=r(86956);const h=["ds-edit-in-place-field",""];function w(B,k){if(1&B&&(s.\u0275\u0275elementStart(0,"div")(1,"span"),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()()),2&B){const c=s.\u0275\u0275nextContext();s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(null==c.metadata||null==c.metadata.key?null:c.metadata.key.split(".").join(".\u200b"))}}const W=function(){return{standalone:!0}};function X(B,k){if(1&B){const c=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",15)(1,"ds-validation-suggestions",16,17),s.\u0275\u0275listener("ngModelChange",function(g){return s.\u0275\u0275restoreView(c),s.\u0275\u0275nextContext().metadata.key=g})("submitSuggestion",function(){s.\u0275\u0275restoreView(c);const g=s.\u0275\u0275reference(2);return s.\u0275\u0275nextContext().update(g)})("clickSuggestion",function(){s.\u0275\u0275restoreView(c);const g=s.\u0275\u0275reference(2);return s.\u0275\u0275nextContext().update(g)})("typeSuggestion",function(){s.\u0275\u0275restoreView(c);const g=s.\u0275\u0275reference(2);return s.\u0275\u0275nextContext().update(g)})("dsClickOutside",function(){s.\u0275\u0275restoreView(c);const g=s.\u0275\u0275reference(2);return s.\u0275\u0275nextContext().checkValidity(g)})("findSuggestions",function(g){return s.\u0275\u0275restoreView(c),s.\u0275\u0275nextContext().findMetadataFieldSuggestions(g)}),s.\u0275\u0275pipe(3,"async"),s.\u0275\u0275pipe(4,"async"),s.\u0275\u0275elementEnd()()}if(2&B){const c=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("disable",1!=c.fieldUpdate.changeType)("suggestions",s.\u0275\u0275pipeBind1(3,7,c.metadataFieldSuggestions))("ngModel",c.metadata.key)("url",c.url)("metadata",c.metadata)("valid",!1!==s.\u0275\u0275pipeBind1(4,9,c.valid))("ngModelOptions",s.\u0275\u0275pureFunction0(11,W))}}function ee(B,k){1&B&&(s.\u0275\u0275elementStart(0,"small",18),s.\u0275\u0275text(1),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275elementEnd()),2&B&&(s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate(s.\u0275\u0275pipeBind1(2,1,"item.edit.metadata.metadatafield.invalid")))}function te(B,k){if(1&B&&(s.\u0275\u0275elementStart(0,"div")(1,"span",19),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()()),2&B){const c=s.\u0275\u0275nextContext();s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(null==c.metadata?null:c.metadata.value)}}function J(B,k){if(1&B){const c=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",15)(1,"textarea",20),s.\u0275\u0275listener("ngModelChange",function(g){return s.\u0275\u0275restoreView(c),s.\u0275\u0275nextContext().metadata.value=g})("onDebounce",function(){return s.\u0275\u0275restoreView(c),s.\u0275\u0275nextContext().update()}),s.\u0275\u0275elementEnd()()}if(2&B){const c=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("ngModel",c.metadata.value)}}function pe(B,k){if(1&B&&(s.\u0275\u0275elementStart(0,"div")(1,"span"),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()()),2&B){const c=s.\u0275\u0275nextContext();s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate(null==c.metadata?null:c.metadata.language)}}function N(B,k){if(1&B){const c=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",15)(1,"input",21),s.\u0275\u0275listener("ngModelChange",function(g){return s.\u0275\u0275restoreView(c),s.\u0275\u0275nextContext().metadata.language=g})("onDebounce",function(){return s.\u0275\u0275restoreView(c),s.\u0275\u0275nextContext().update()}),s.\u0275\u0275elementEnd()()}if(2&B){const c=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("ngModel",c.metadata.language)}}function ne(B,k){if(1&B){const c=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"button",22),s.\u0275\u0275listener("click",function(){return s.\u0275\u0275restoreView(c),s.\u0275\u0275nextContext().setEditable(!0)}),s.\u0275\u0275pipe(1,"async"),s.\u0275\u0275pipe(2,"translate"),s.\u0275\u0275element(3,"i",23),s.\u0275\u0275elementEnd()}if(2&B){const c=s.\u0275\u0275nextContext();s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(2,4,"item.edit.metadata.edit.buttons.edit")),s.\u0275\u0275property("disabled",!s.\u0275\u0275pipeBind1(1,2,c.canSetEditable()))}}function A(B,k){if(1&B){const c=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"button",24),s.\u0275\u0275listener("click",function(){return s.\u0275\u0275restoreView(c),s.\u0275\u0275nextContext().setEditable(!1)}),s.\u0275\u0275pipe(1,"async"),s.\u0275\u0275pipe(2,"async"),s.\u0275\u0275pipe(3,"translate"),s.\u0275\u0275element(4,"i",25),s.\u0275\u0275elementEnd()}if(2&B){const c=s.\u0275\u0275nextContext();s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(3,6,"item.edit.metadata.edit.buttons.unedit")),s.\u0275\u0275property("disabled",!s.\u0275\u0275pipeBind1(1,2,c.canSetUneditable())||!1===s.\u0275\u0275pipeBind1(2,4,c.valid))}}let H=(()=>{class B{constructor(c,E){this.registryService=c,this.objectUpdatesService=E,this.metadataFieldSuggestions=new C.X([])}ngOnInit(){this.editable=this.objectUpdatesService.isEditable(this.url,this.metadata.uuid),this.valid=this.objectUpdatesService.isValid(this.url,this.metadata.uuid)}update(c){this.objectUpdatesService.saveChangeFieldUpdate(this.url,(0,u.cloneDeep)(this.metadata)),(0,I.Uh)(c)&&this.checkValidity(c)}checkValidity(c){c.control.setValue(c.viewModel),c.control.updateValueAndValidity(),this.objectUpdatesService.setValidFieldUpdate(this.url,this.metadata.uuid,c.control.valid)}setEditable(c){this.objectUpdatesService.setEditableFieldUpdate(this.url,this.metadata.uuid,c)}remove(){this.objectUpdatesService.saveRemoveFieldUpdate(this.url,(0,u.cloneDeep)(this.metadata))}removeChangesFromField(){this.objectUpdatesService.removeSingleFieldUpdate(this.url,this.metadata.uuid)}ngOnChanges(){this.metadata=(0,u.cloneDeep)(this.fieldUpdate.field)}findMetadataFieldSuggestions(c){if((0,I.UE)(c))return this.registryService.queryMetadataFields(c,null,!0,!1,(0,e.l)("schema")).pipe((0,_.xw)(),(0,_.EB)()).subscribe(E=>{this.setInputSuggestions(E)});this.metadataFieldSuggestions.next([])}setInputSuggestions(c){this.metadataFieldSuggestions.next(c.map(E=>({displayValue:E.split(".").join(".&#8203;"),value:E})))}canSetEditable(){return this.editable.pipe((0,m.U)(c=>!c&&this.fieldUpdate.changeType!==b.m.REMOVE))}canSetUneditable(){return this.editable}canRemove(){return(0,x.of)(this.fieldUpdate.changeType!==b.m.REMOVE&&this.fieldUpdate.changeType!==b.m.ADD)}canUndo(){return this.editable.pipe((0,m.U)(c=>this.fieldUpdate.changeType>=0||c))}isNotEmpty(c){return(0,I.UE)(c)}}return B.\u0275fac=function(c){return new(c||B)(s.\u0275\u0275directiveInject(O.k),s.\u0275\u0275directiveInject(f.d))},B.\u0275cmp=s.\u0275\u0275defineComponent({type:B,selectors:[["","ds-edit-in-place-field",""]],inputs:{fieldUpdate:"fieldUpdate",url:"url",metadata:"metadata"},features:[s.\u0275\u0275NgOnChangesFeature],attrs:h,decls:34,vars:39,consts:[[1,"metadata-field"],[4,"ngIf"],["class","field-container",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"w-100"],[1,"value-field"],[1,"text-center"],[1,"language-field"],[1,"btn-group","edit-field"],["class","btn btn-outline-primary btn-sm",3,"disabled","title","click",4,"ngIf"],["class","btn btn-outline-success btn-sm",3,"disabled","title","click",4,"ngIf"],[1,"btn","btn-outline-danger","btn-sm",3,"disabled","title","click"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"disabled","title","click"],[1,"fas","fa-undo-alt","fa-fw"],[1,"field-container"],["dsAutoFocus","","autoFocusSelector",".suggestion_input",3,"disable","suggestions","ngModel","url","metadata","valid","ngModelOptions","ngModelChange","submitSuggestion","clickSuggestion","typeSuggestion","dsClickOutside","findSuggestions"],["suggestionControl","ngModel"],[1,"text-danger"],[1,"dont-break-out","preserve-line-breaks"],["type","textarea","attr.aria-labelledby","fieldValue",1,"form-control",3,"ngModel","dsDebounce","ngModelChange","onDebounce"],["type","text","attr.aria-labelledby","fieldLang",1,"form-control",3,"ngModel","dsDebounce","ngModelChange","onDebounce"],[1,"btn","btn-outline-primary","btn-sm",3,"disabled","title","click"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-success","btn-sm",3,"disabled","title","click"],[1,"fas","fa-check","fa-fw"]],template:function(c,E){1&c&&(s.\u0275\u0275elementStart(0,"td")(1,"div",0),s.\u0275\u0275template(2,w,3,1,"div",1),s.\u0275\u0275pipe(3,"async"),s.\u0275\u0275template(4,X,5,12,"div",2),s.\u0275\u0275pipe(5,"async"),s.\u0275\u0275template(6,ee,3,3,"small",3),s.\u0275\u0275pipe(7,"async"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(8,"td",4)(9,"div",5),s.\u0275\u0275template(10,te,3,1,"div",1),s.\u0275\u0275pipe(11,"async"),s.\u0275\u0275template(12,J,2,1,"div",2),s.\u0275\u0275pipe(13,"async"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(14,"td",6)(15,"div",7),s.\u0275\u0275template(16,pe,3,1,"div",1),s.\u0275\u0275pipe(17,"async"),s.\u0275\u0275template(18,N,2,1,"div",2),s.\u0275\u0275pipe(19,"async"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(20,"td",6)(21,"div",8),s.\u0275\u0275template(22,ne,4,6,"button",9),s.\u0275\u0275pipe(23,"async"),s.\u0275\u0275template(24,A,5,8,"button",10),s.\u0275\u0275pipe(25,"async"),s.\u0275\u0275elementStart(26,"button",11),s.\u0275\u0275listener("click",function(){return E.remove()}),s.\u0275\u0275pipe(27,"async"),s.\u0275\u0275pipe(28,"translate"),s.\u0275\u0275element(29,"i",12),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(30,"button",13),s.\u0275\u0275listener("click",function(){return E.removeChangesFromField()}),s.\u0275\u0275pipe(31,"async"),s.\u0275\u0275pipe(32,"translate"),s.\u0275\u0275element(33,"i",14),s.\u0275\u0275elementEnd()()()),2&c&&(s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",!s.\u0275\u0275pipeBind1(3,13,E.editable)),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",s.\u0275\u0275pipeBind1(5,15,E.editable)),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",!1===s.\u0275\u0275pipeBind1(7,17,E.valid)),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngIf",!s.\u0275\u0275pipeBind1(11,19,E.editable)),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",s.\u0275\u0275pipeBind1(13,21,E.editable)),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngIf",!s.\u0275\u0275pipeBind1(17,23,E.editable)),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",s.\u0275\u0275pipeBind1(19,25,E.editable)),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngIf",!s.\u0275\u0275pipeBind1(23,27,E.editable)),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",s.\u0275\u0275pipeBind1(25,29,E.editable)),s.\u0275\u0275advance(2),s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(28,33,"item.edit.metadata.edit.buttons.remove")),s.\u0275\u0275property("disabled",!s.\u0275\u0275pipeBind1(27,31,E.canRemove())),s.\u0275\u0275advance(4),s.\u0275\u0275propertyInterpolate("title",s.\u0275\u0275pipeBind1(32,37,"item.edit.metadata.edit.buttons.undo")),s.\u0275\u0275property("disabled",!s.\u0275\u0275pipeBind1(31,35,E.canUndo())))},directives:[j.O5,T.e,$.h,d.JJ,d.On,Q._,d.Fj,L.q],pipes:[j.Ov,F.X$],styles:[".btn[disabled][_ngcontent-%COMP%]{color:var(--bs-gray-600);border-color:var(--bs-gray-600);z-index:0}.metadata-field[_ngcontent-%COMP%]{width:var(--ds-edit-item-metadata-field-width)}.language-field[_ngcontent-%COMP%]{width:var(--ds-edit-item-language-field-width)}"]}),B})()},7803:(K,R,r)=>{"use strict";r.r(R),r.d(R,{ItemMetadataComponent:()=>k});var _=r(83639),I=r(46040),O=r(17489),u=r(50590),M=r(63900),C=r(68285),x=r(82596),m=r(79300),f=r(25226),y=r(24702),e=r(74711);class b{constructor(E,g){this.op=E,this.field=g}}let s=(()=>{class c extends b{constructor(g,S){super(c.operationType,g),this.value=S}toOperation(){return{op:this.op,path:`/metadata/${this.field}/-`,value:this.value}}}return c.operationType="add",c})(),j=(()=>{class c extends b{constructor(g,S){super(c.operationType,g),this.place=S}toOperation(){return{op:this.op,path:`/metadata/${this.field}/${this.place}`}}}return c.operationType="remove",c})(),T=(()=>{class c extends b{constructor(g,S,V){super(c.operationType,g),this.place=S,this.value=V}toOperation(){return{op:this.op,path:`/metadata/${this.field}/${this.place}`,value:this.value}}}return c.operationType="replace",c})();var $=r(59051),d=r(5e3);let Q=(()=>{class c{fieldUpdatesToPatchOperations(g){const S=this.fieldUpdatesToMetadataPatchOperations(g),V=new Map,D=[];return S.forEach(P=>{(P.op===j.operationType||P.op===T.operationType)&&(0,y.Uh)(P.place)&&V.has(P.field)&&V.get(P.field).forEach(Z=>{Z<P.place&&P.place--}),P.op===j.operationType&&(0,y.Uh)(P.place)&&(V.has(P.field)||V.set(P.field,[]),V.get(P.field).push(P.place)),D.push(P.toOperation())}),D}fieldUpdatesToMetadataPatchOperations(g){const S=[];return Object.keys(g).forEach(V=>{const D=g[V],P=D.field,Z={value:P.value,language:P.language};let Y;switch(D.changeType){case $.m.ADD:Y=new s(P.key,[Z]);break;case $.m.REMOVE:Y=new j(P.key,P.place);break;case $.m.UPDATE:Y=new T(P.key,P.place,Z)}S.push(Y)}),S}}return c.\u0275fac=function(g){return new(g||c)},c.\u0275prov=d.\u0275\u0275defineInjectable({token:c,factory:c.\u0275fac,providedIn:"root"}),c})();var L=r(74202),F=r(86956),h=r(69808),w=r(76487),W=r(38605),X=r(5023);function ee(c,E){if(1&c){const g=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"button",13),d.\u0275\u0275listener("click",function(){return d.\u0275\u0275restoreView(g),d.\u0275\u0275nextContext().reinstate()}),d.\u0275\u0275element(1,"i",14),d.\u0275\u0275elementStart(2,"span",4),d.\u0275\u0275text(3),d.\u0275\u0275pipe(4,"translate"),d.\u0275\u0275elementEnd()()}2&c&&(d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate1("\xa0",d.\u0275\u0275pipeBind1(4,1,"item.edit.metadata.reinstate-button"),""))}function te(c,E){if(1&c){const g=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"button",15),d.\u0275\u0275listener("click",function(){return d.\u0275\u0275restoreView(g),d.\u0275\u0275nextContext().discard()}),d.\u0275\u0275pipe(1,"async"),d.\u0275\u0275element(2,"i",16),d.\u0275\u0275elementStart(3,"span",4),d.\u0275\u0275text(4),d.\u0275\u0275pipe(5,"translate"),d.\u0275\u0275elementEnd()()}if(2&c){const g=d.\u0275\u0275nextContext();d.\u0275\u0275property("disabled",!d.\u0275\u0275pipeBind1(1,2,g.hasChanges())),d.\u0275\u0275advance(4),d.\u0275\u0275textInterpolate1("\xa0",d.\u0275\u0275pipeBind1(5,4,"item.edit.metadata.discard-button"),"")}}const J=function(){return{}},pe=function(c,E,g){return{"table-warning":c,"table-danger":E,"table-success":g}};function N(c,E){if(1&c&&d.\u0275\u0275element(0,"tr",23),2&c){const g=E.$implicit,S=d.\u0275\u0275nextContext(2);d.\u0275\u0275property("fieldUpdate",g||d.\u0275\u0275pureFunction0(3,J))("url",S.url)("ngClass",d.\u0275\u0275pureFunction3(4,pe,0===g.changeType,2===g.changeType,1===g.changeType))}}function ne(c,E){if(1&c&&(d.\u0275\u0275elementStart(0,"table",17)(1,"thead")(2,"tr")(3,"th")(4,"span",18),d.\u0275\u0275text(5),d.\u0275\u0275pipe(6,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(7,"th")(8,"span",19),d.\u0275\u0275text(9),d.\u0275\u0275pipe(10,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(11,"th",20)(12,"span",21),d.\u0275\u0275text(13),d.\u0275\u0275pipe(14,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(15,"th",20),d.\u0275\u0275text(16),d.\u0275\u0275pipe(17,"translate"),d.\u0275\u0275elementEnd()()(),d.\u0275\u0275elementStart(18,"tbody"),d.\u0275\u0275template(19,N,1,8,"tr",22),d.\u0275\u0275pipe(20,"dsObjectValues"),d.\u0275\u0275pipe(21,"async"),d.\u0275\u0275elementEnd()()),2&c){const g=d.\u0275\u0275nextContext();d.\u0275\u0275advance(5),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(6,6,"item.edit.metadata.headers.field")),d.\u0275\u0275advance(4),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(10,8,"item.edit.metadata.headers.value")),d.\u0275\u0275advance(4),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(14,10,"item.edit.metadata.headers.language")),d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(17,12,"item.edit.metadata.headers.edit")),d.\u0275\u0275advance(3),d.\u0275\u0275property("ngForOf",d.\u0275\u0275pipeBind1(20,14,d.\u0275\u0275pipeBind1(21,16,g.updates$)))("ngForTrackBy",g.trackUpdate)}}function A(c,E){if(1&c&&(d.\u0275\u0275elementStart(0,"div"),d.\u0275\u0275element(1,"ds-alert",24),d.\u0275\u0275elementEnd()),2&c){const g=d.\u0275\u0275nextContext();d.\u0275\u0275advance(1),d.\u0275\u0275property("content","item.edit.metadata.empty")("type",g.AlertTypeEnum.Info)}}function H(c,E){if(1&c){const g=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"button",13),d.\u0275\u0275listener("click",function(){return d.\u0275\u0275restoreView(g),d.\u0275\u0275nextContext().reinstate()}),d.\u0275\u0275element(1,"i",14),d.\u0275\u0275text(2),d.\u0275\u0275pipe(3,"translate"),d.\u0275\u0275elementEnd()}2&c&&(d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate1(" ",d.\u0275\u0275pipeBind1(3,1,"item.edit.metadata.reinstate-button")," "))}function B(c,E){if(1&c){const g=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"button",15),d.\u0275\u0275listener("click",function(){return d.\u0275\u0275restoreView(g),d.\u0275\u0275nextContext().discard()}),d.\u0275\u0275pipe(1,"async"),d.\u0275\u0275element(2,"i",16),d.\u0275\u0275text(3),d.\u0275\u0275pipe(4,"translate"),d.\u0275\u0275elementEnd()}if(2&c){const g=d.\u0275\u0275nextContext();d.\u0275\u0275property("disabled",!d.\u0275\u0275pipeBind1(1,2,g.hasChanges())),d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate1(" ",d.\u0275\u0275pipeBind1(4,4,"item.edit.metadata.discard-button")," ")}}let k=(()=>{class c extends f.a{constructor(g,S,V,D,P,Z){super(g,S,V,D,P,Z),this.itemService=g,this.objectUpdatesService=S,this.router=V,this.notificationsService=D,this.translateService=P,this.route=Z,this.AlertTypeEnum=e.N}ngOnInit(){super.ngOnInit(),(0,y.xI)(this.updateService)&&(this.updateService=this.itemService)}initializeUpdates(){this.updates$=this.objectUpdatesService.getFieldUpdates(this.url,this.item.metadataAsList)}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.metadata.notifications."}add(g=new m.s5){this.objectUpdatesService.saveAddFieldUpdate(this.url,g)}initializeOriginalFields(){this.objectUpdatesService.initialize(this.url,this.item.metadataAsList,this.item.lastModified,Q)}submit(){this.isValid().pipe((0,u.P)()).subscribe(g=>{g?this.objectUpdatesService.createPatch(this.url).pipe((0,u.P)(),(0,M.w)(S=>this.updateService.patch(this.item,S).pipe((0,C.hC)()))).subscribe(S=>{S.hasFailed?this.notificationsService.error(this.getNotificationTitle("error"),S.errorMessage):(this.item=S.payload,this.checkAndFixMetadataUUIDs(),this.initializeOriginalFields(),this.updates$=this.objectUpdatesService.getFieldUpdates(this.url,this.item.metadataAsList),this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved")))}):this.notificationsService.error(this.getNotificationTitle("invalid"),this.getNotificationContent("invalid"))})}checkAndFixMetadataUUIDs(){const g=(0,O.cloneDeep)(this.item.metadata);Object.keys(this.item.metadata).forEach(S=>{g[S]=this.item.metadata[S].map(V=>(0,y.Uh)(V.uuid)?V:Object.assign(new m.DA,V))}),this.item.metadata=g}}return c.\u0275fac=function(g){return new(g||c)(d.\u0275\u0275directiveInject(_.S),d.\u0275\u0275directiveInject(I.d),d.\u0275\u0275directiveInject(L.F0),d.\u0275\u0275directiveInject(x.T),d.\u0275\u0275directiveInject(F.sK),d.\u0275\u0275directiveInject(L.gz))},c.\u0275cmp=d.\u0275\u0275defineComponent({type:c,selectors:[["ds-item-metadata"]],inputs:{updateService:"updateService"},features:[d.\u0275\u0275InheritDefinitionFeature],decls:35,vars:39,consts:[[1,"item-metadata"],[1,"button-row","top","d-flex","mb-2","space-children-mr"],[1,"mr-auto","btn","btn-success",3,"click"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[1,"fas","fa-save"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","table table-responsive table-striped table-bordered",4,"ngIf"],[4,"ngIf"],[1,"button-row","bottom"],[1,"mt-2","float-right","space-children-mr","ml-gap"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"btn","btn-danger",3,"disabled","click"],[1,"fas","fa-times"],[1,"table","table-responsive","table-striped","table-bordered"],["id","fieldName"],["id","fieldValue"],[1,"text-center"],["id","fieldLang"],["ds-edit-in-place-field","",3,"fieldUpdate","url","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],["ds-edit-in-place-field","",3,"fieldUpdate","url","ngClass"],[3,"content","type"]],template:function(g,S){1&g&&(d.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"button",2),d.\u0275\u0275listener("click",function(){return S.add()}),d.\u0275\u0275element(3,"i",3),d.\u0275\u0275elementStart(4,"span",4),d.\u0275\u0275text(5),d.\u0275\u0275pipe(6,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275template(7,ee,5,3,"button",5),d.\u0275\u0275pipe(8,"async"),d.\u0275\u0275elementStart(9,"button",6),d.\u0275\u0275listener("click",function(){return S.submit()}),d.\u0275\u0275pipe(10,"async"),d.\u0275\u0275pipe(11,"async"),d.\u0275\u0275element(12,"i",7),d.\u0275\u0275elementStart(13,"span",4),d.\u0275\u0275text(14),d.\u0275\u0275pipe(15,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275template(16,te,6,6,"button",8),d.\u0275\u0275pipe(17,"async"),d.\u0275\u0275elementEnd(),d.\u0275\u0275template(18,ne,22,18,"table",9),d.\u0275\u0275pipe(19,"dsObjectValues"),d.\u0275\u0275pipe(20,"async"),d.\u0275\u0275template(21,A,2,2,"div",10),d.\u0275\u0275pipe(22,"dsObjectValues"),d.\u0275\u0275pipe(23,"async"),d.\u0275\u0275elementStart(24,"div",11)(25,"div",12),d.\u0275\u0275template(26,H,4,3,"button",5),d.\u0275\u0275pipe(27,"async"),d.\u0275\u0275elementStart(28,"button",6),d.\u0275\u0275listener("click",function(){return S.submit()}),d.\u0275\u0275pipe(29,"async"),d.\u0275\u0275element(30,"i",7),d.\u0275\u0275text(31),d.\u0275\u0275pipe(32,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275template(33,B,5,6,"button",8),d.\u0275\u0275pipe(34,"async"),d.\u0275\u0275elementEnd()()()),2&g&&(d.\u0275\u0275advance(5),d.\u0275\u0275textInterpolate1("\xa0",d.\u0275\u0275pipeBind1(6,11,"item.edit.metadata.add-button"),""),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngIf",d.\u0275\u0275pipeBind1(8,13,S.isReinstatable())),d.\u0275\u0275advance(2),d.\u0275\u0275property("disabled",!d.\u0275\u0275pipeBind1(10,15,S.hasChanges())||!d.\u0275\u0275pipeBind1(11,17,S.isValid())),d.\u0275\u0275advance(5),d.\u0275\u0275textInterpolate1("\xa0",d.\u0275\u0275pipeBind1(15,19,"item.edit.metadata.save-button"),""),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngIf",!d.\u0275\u0275pipeBind1(17,21,S.isReinstatable())),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngIf",d.\u0275\u0275pipeBind1(19,23,d.\u0275\u0275pipeBind1(20,25,S.updates$)).length>0),d.\u0275\u0275advance(3),d.\u0275\u0275property("ngIf",0==d.\u0275\u0275pipeBind1(22,27,d.\u0275\u0275pipeBind1(23,29,S.updates$)).length),d.\u0275\u0275advance(5),d.\u0275\u0275property("ngIf",d.\u0275\u0275pipeBind1(27,31,S.isReinstatable())),d.\u0275\u0275advance(2),d.\u0275\u0275property("disabled",!d.\u0275\u0275pipeBind1(29,33,S.hasChanges())),d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate1(" ",d.\u0275\u0275pipeBind1(32,35,"item.edit.metadata.save-button")," "),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngIf",!d.\u0275\u0275pipeBind1(34,37,S.isReinstatable())))},directives:[h.O5,h.sg,w.I,h.mk,W.w],pipes:[F.X$,h.Ov,X.g],styles:[".button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:var(--ds-gap)}.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}@media screen and (min-width: 576px){.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:var(--ds-edit-item-button-min-width)}}.button-row.top[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-top:calc(var(--bs-spacer) / 2);margin-bottom:calc(var(--bs-spacer) / 2)}"]}),c})()},7056:(K,R,r)=>{"use strict";r.d(R,{F:()=>f});var _=r(19937),I=r(59508),O=r(68212),u=r(39646),M=r(47235),C=r(24755),x=r(5e3),m=r(74202);let f=(()=>{class y extends O.h{constructor(b,s,j,T){super(b,s,j,T),this.resolver=b,this.authorizationService=s,this.router=j,this.authService=T}getFeatureID(b,s){return(0,u.of)(M.i.AdministratorOf)}}return y.\u0275fac=function(b){return new(b||y)(x.\u0275\u0275inject(I.o),x.\u0275\u0275inject(_._),x.\u0275\u0275inject(m.F0),x.\u0275\u0275inject(C.e8))},y.\u0275prov=x.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac,providedIn:"root"}),y})()},59508:(K,R,r)=>{"use strict";r.d(R,{o:()=>f});var _=r(83639),I=r(54004),O=r(24702),u=r(40747),M=r(27102),C=r(5e3),x=r(65620),m=r(74202);let f=(()=>{class y extends M.I{constructor(b,s,j){super(b,s,j),this.itemService=b,this.store=s,this.router=j}resolve(b,s){return super.resolve(b,s).pipe((0,I.U)(j=>{if(j.hasSucceeded&&(0,O.Uh)(j.payload)){const T=s.url,$=this.router.parseUrl((0,u.Tt)(j.payload)).toString();if(!T.startsWith($)){const d=j.payload.uuid,Q=T.substring(T.indexOf(d)+d.length,T.length);this.router.navigateByUrl($+Q)}}return j}))}}return y.\u0275fac=function(b){return new(b||y)(C.\u0275\u0275inject(_.S),C.\u0275\u0275inject(x.yh),C.\u0275\u0275inject(m.F0))},y.\u0275prov=C.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac}),y})()},27102:(K,R,r)=>{"use strict";r.d(R,{H:()=>m,I:()=>f});var _=r(83639),I=r(93369),O=r(68285),u=r(8136),M=r(5e3),C=r(65620),x=r(74202);const m=[(0,I.l)("owningCollection",{},(0,I.l)("parentCommunity",{},(0,I.l)("parentCommunity"))),(0,I.l)("relationships"),(0,I.l)("version",{},(0,I.l)("versionhistory")),(0,I.l)("thumbnail")];let f=(()=>{class y{constructor(b,s,j){this.itemService=b,this.store=s,this.router=j}resolve(b,s){const j=this.itemService.findById(b.params.id,!0,!1,...m).pipe((0,O.hC)());return j.subscribe(T=>{this.store.dispatch(new u.K(s.url,T.payload))}),j}}return y.\u0275fac=function(b){return new(b||y)(M.\u0275\u0275inject(_.S),M.\u0275\u0275inject(C.yh),M.\u0275\u0275inject(x.F0))},y.\u0275prov=M.\u0275\u0275defineInjectable({token:y,factory:y.\u0275fac}),y})()},64767:(K,R,r)=>{"use strict";r.d(R,{B:()=>I});var _=r(5e3);let I=(()=>{class O{canActivate(M,C){return M.data={title:M.params.configuration+".search.title"},!0}}return O.\u0275fac=function(M){return new(M||O)},O.\u0275prov=_.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac}),O})()},96995:(K,R,r)=>{"use strict";r.r(R),r.d(R,{SearchPageComponent:()=>M});var _=r(14292),I=r(36872),O=r(5e3),u=r(30236);let M=(()=>{class C{}return C.\u0275fac=function(m){return new(m||C)},C.\u0275cmp=O.\u0275\u0275defineComponent({type:C,selectors:[["ds-search-page"]],features:[O.\u0275\u0275ProvidersFeature([{provide:_.SEARCH_CONFIG_SERVICE,useClass:I.U}])],decls:1,vars:1,consts:[[3,"trackStatistics"]],template:function(m,f){1&m&&O.\u0275\u0275element(0,"ds-themed-search",0),2&m&&O.\u0275\u0275property("trackStatistics",!0)},directives:[u.l],encapsulation:2}),C})()},98190:(K,R,r)=>{"use strict";r.d(R,{q:()=>pe});var _=r(69808),I=r(61508),O=r(57981),u=r(72312),M=r(64767),b=(r(63900),r(54004),r(58881),r(958),r(14292),r(5360),r(36872)),T=(r(5164),r(68285),r(5e3));r(13758),r(74202);var L=r(79248),h=(r(96995),r(85612)),w=r(62188),W=r(74227),X=r(84376),te=(r(93329),r(24440));let pe=(()=>{class N{}return N.\u0275fac=function(A){return new(A||N)},N.\u0275mod=T.\u0275\u0275defineNgModule({type:N}),N.\u0275inj=T.\u0275\u0275defineInjector({providers:[u.P,h.s,w.nJ,M.B,b.U],imports:[[_.ez,te.t,O.m.withEntryComponents(),I.IR.forRoot(),L.p.forRoot(),W.x.withEntryComponents(),X.a.withEntryComponents()]]}),N})()},93329:(K,R,r)=>{"use strict";r.d(R,{m:()=>u});var _=r(25330),I=r(5e3);function O(M,C){}let u=(()=>{class M extends _.F{getComponentName(){return"SearchPageComponent"}importThemedComponent(x){return r(217)(`./${x}/app/search-page/search-page.component`)}importUnthemedComponent(){return Promise.resolve().then(r.bind(r,96995))}}return M.\u0275fac=function(){let C;return function(m){return(C||(C=I.\u0275\u0275getInheritedFactory(M)))(m||M)}}(),M.\u0275cmp=I.\u0275\u0275defineComponent({type:M,selectors:[["ds-themed-search-page"]],features:[I.\u0275\u0275InheritDefinitionFeature],decls:2,vars:0,consts:[["vcr",""]],template:function(x,m){1&x&&I.\u0275\u0275template(0,O,0,0,"ng-template",null,0,I.\u0275\u0275templateRefExtractor)},encapsulation:2}),M})()},217:(K,R,r)=>{var _={"./custom/app/search-page/search-page.component":[67356,7356]};function I(O){if(!r.o(_,O))return Promise.resolve().then(()=>{var C=new Error("Cannot find module '"+O+"'");throw C.code="MODULE_NOT_FOUND",C});var u=_[O],M=u[0];return r.e(u[1]).then(()=>r(M))}I.keys=()=>Object.keys(_),I.id=217,K.exports=I}}]);