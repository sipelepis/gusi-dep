"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[3029],{98655:(F,x,r)=>{r.d(x,{t:()=>R});var e=r(24702),C=r(78056),T=r(5e3),D=r(43001);let R=(()=>{class f{constructor(i){this.breadcrumbService=i}resolve(i,B){const g=i.data.breadcrumbKey;if((0,e.xI)(g))throw new Error('You provided an i18nBreadcrumbResolver for url "'+i.url+"\" but no breadcrumbKey in the route's data");const n=(0,C.i)(i);return{provider:this.breadcrumbService,key:g,url:n}}}return f.\u0275fac=function(i){return new(i||f)(T.\u0275\u0275inject(D.d))},f.\u0275prov=T.\u0275\u0275defineInjectable({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},43001:(F,x,r)=>{r.d(x,{d:()=>R});var e=r(83772),C=r(39646),T=r(5e3);let R=(()=>{class f{getBreadcrumbs(i,B){return(0,C.of)([new e.a(i+".breadcrumbs",B)])}}return f.\u0275fac=function(i){return new(i||f)},f.\u0275prov=T.\u0275\u0275defineInjectable({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},84254:(F,x,r)=>{r.d(x,{M0:()=>e,Pu:()=>C,X$:()=>T,dI:()=>D,kJ:()=>R,Gr:()=>f,N:()=>M});const e="withdraw",C="reinstate",T="private",D="public",R="delete",f="move",M="authorizations"},34981:(F,x,r)=>{r.d(x,{v:()=>v});var e=r(61135),C=r(54004),T=r(95698),D=r(24886),R=r(82596),f=r(84254),M=r(68285),i=r(5e3),B=r(83616),g=r(74202),n=r(86956),p=r(27193);let v=(()=>{class U{constructor(y,I,t,_,u,h){this.dsoNameService=y,this.notificationsService=I,this.resourcePolicyService=t,this.route=_,this.router=u,this.translate=h,this.processing$=new e.X(!1)}ngOnInit(){this.route.data.pipe((0,C.U)(y=>y),(0,T.q)(1)).subscribe(y=>{this.targetResourceUUID=y.resourcePolicyTarget.payload.id,this.targetResourceName=this.dsoNameService.getName(y.resourcePolicyTarget.payload)})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${f.N}`],{relativeTo:this.route})}createResourcePolicy(y){let I;this.processing$.next(!0),I="eperson"===y.target.type?this.resourcePolicyService.create(y.object,this.targetResourceUUID,y.target.uuid):this.resourcePolicyService.create(y.object,this.targetResourceUUID,null,y.target.uuid),I.pipe((0,M.hC)()).subscribe(t=>{this.processing$.next(!1),t.hasSucceeded?(this.notificationsService.success(null,this.translate.get("resource-policies.create.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get("resource-policies.create.page.failure.content"))})}}return U.\u0275fac=function(y){return new(y||U)(i.\u0275\u0275directiveInject(B._),i.\u0275\u0275directiveInject(R.T),i.\u0275\u0275directiveInject(D.I),i.\u0275\u0275directiveInject(g.gz),i.\u0275\u0275directiveInject(g.F0),i.\u0275\u0275directiveInject(n.sK))},U.\u0275cmp=i.\u0275\u0275defineComponent({type:U,selectors:[["ds-resource-policy-create"]],decls:5,vars:5,consts:[[1,"container"],[1,"mb-3"],[3,"isProcessing","reset","submit"]],template:function(y,I){1&y&&(i.\u0275\u0275elementStart(0,"div",0)(1,"h4",1),i.\u0275\u0275text(2),i.\u0275\u0275pipe(3,"translate"),i.\u0275\u0275elementEnd(),i.\u0275\u0275elementStart(4,"ds-resource-policy-form",2),i.\u0275\u0275listener("reset",function(){return I.redirectToAuthorizationsPage()})("submit",function(_){return I.createResourcePolicy(_)}),i.\u0275\u0275elementEnd()()),2&y&&(i.\u0275\u0275advance(2),i.\u0275\u0275textInterpolate2("",i.\u0275\u0275pipeBind1(3,3,"resource-policies.create.page.heading")," ",I.targetResourceName,""),i.\u0275\u0275advance(2),i.\u0275\u0275property("isProcessing",I.isProcessing()))},directives:[p.Z],pipes:[n.X$],encapsulation:2}),U})()},86527:(F,x,r)=>{r.d(x,{x:()=>W});var e=r(61135),C=r(39646),T=r(39841),D=r(54004),R=r(95698),f=r(24886),M=r(82596),i=r(74648),B=r(84254),g=r(68285),n=r(5e3),p=r(74202),v=r(86956),U=r(27193);let W=(()=>{class y{constructor(t,_,u,h,O){this.notificationsService=t,this.resourcePolicyService=_,this.route=u,this.router=h,this.translate=O,this.processing$=new e.X(!1)}ngOnInit(){this.route.data.pipe((0,D.U)(t=>t),(0,R.q)(1)).subscribe(t=>{this.resourcePolicy=t.resourcePolicy.payload})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${B.N}`],{relativeTo:this.route})}updateResourcePolicy(t){this.processing$.next(!0);const _=Object.assign({},t.object,{id:this.resourcePolicy.id,type:i.A.value,_links:this.resourcePolicy._links}),u=t.updateTarget?this.resourcePolicyService.updateTarget(this.resourcePolicy.id,this.resourcePolicy._links.self.href,t.target.uuid,t.target.type).pipe((0,g.hC)(),(0,D.U)(O=>O&&O.hasSucceeded)):(0,C.of)(!0),h=this.resourcePolicyService.update(_).pipe((0,g.hC)(),(0,D.U)(O=>O&&O.hasSucceeded));(0,T.a)([u,h]).subscribe(([O,o])=>{this.processing$.next(!1),O&&o?(this.notificationsService.success(null,this.translate.get("resource-policies.edit.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get(o?"resource-policies.edit.page.target-failure.content":O?"resource-policies.edit.page.other-failure.content":"resource-policies.edit.page.failure.content"))})}}return y.\u0275fac=function(t){return new(t||y)(n.\u0275\u0275directiveInject(M.T),n.\u0275\u0275directiveInject(f.I),n.\u0275\u0275directiveInject(p.gz),n.\u0275\u0275directiveInject(p.F0),n.\u0275\u0275directiveInject(v.sK))},y.\u0275cmp=n.\u0275\u0275defineComponent({type:y,selectors:[["ds-resource-policy-edit"]],decls:5,vars:6,consts:[[1,"container"],[1,"mb-3"],[3,"resourcePolicy","isProcessing","reset","submit"]],template:function(t,_){1&t&&(n.\u0275\u0275elementStart(0,"div",0)(1,"h4",1),n.\u0275\u0275text(2),n.\u0275\u0275pipe(3,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(4,"ds-resource-policy-form",2),n.\u0275\u0275listener("reset",function(){return _.redirectToAuthorizationsPage()})("submit",function(h){return _.updateResourcePolicy(h)}),n.\u0275\u0275elementEnd()()),2&t&&(n.\u0275\u0275advance(2),n.\u0275\u0275textInterpolate2("",n.\u0275\u0275pipeBind1(3,4,"resource-policies.edit.page.heading")," ",_.resourcePolicy.id,""),n.\u0275\u0275advance(2),n.\u0275\u0275property("resourcePolicy",_.resourcePolicy)("isProcessing",_.isProcessing()))},directives:[U.Z],pipes:[v.X$],encapsulation:2}),y})()},60726:(F,x,r)=>{r.d(x,{Y:()=>y});var e=r(5e3),C=r(24702),T=r(38723),D=r(54004),R=r(68285),f=r(50503),M=r(92414),i=r(43499),B=r(83616),g=r(74202),n=r(93075),p=r(69808),v=r(86956);const U=["ds-resource-policy-entry",""];function W(I,t){if(1&I){const _=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"button",6),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(_),e.\u0275\u0275nextContext().redirectToGroupEditPage()}),e.\u0275\u0275pipe(1,"translate"),e.\u0275\u0275element(2,"i",9),e.\u0275\u0275elementEnd()}2&I&&e.\u0275\u0275property("title",e.\u0275\u0275pipeBind1(1,1,"resource-policies.table.headers.edit.group"))}let y=(()=>{class I{constructor(_,u,h,O){this.dsoNameService=_,this.groupService=u,this.route=h,this.router=O,this.toggleCheckbox=new e.EventEmitter}ngOnInit(){this.epersonName$=this.getName$(this.entry.policy.eperson),this.groupName$=this.getName$(this.entry.policy.group)}getName$(_){return _.pipe((0,R.g1)(),(0,D.U)(u=>{if((0,C.Uh)(null==u?void 0:u.payload))return this.dsoNameService.getName(u.payload)}))}formatDate(_){return(0,C.UE)(_)?(0,T.UW)((0,T.bj)(_)):""}redirectToResourcePolicyEditPage(){this.router.navigate(["./edit"],{relativeTo:this.route,queryParams:{policyId:this.entry.policy.id}})}redirectToGroupEditPage(){this.groupService.findByHref(this.entry.policy._links.group.href,!1).pipe((0,R.Gp)(),(0,D.U)(_=>_.id)).subscribe(_=>{this.router.navigate([f.QX,M.CH,_])})}}return I.\u0275fac=function(_){return new(_||I)(e.\u0275\u0275directiveInject(B._),e.\u0275\u0275directiveInject(i.O),e.\u0275\u0275directiveInject(g.gz),e.\u0275\u0275directiveInject(g.F0))},I.\u0275cmp=e.\u0275\u0275defineComponent({type:I,selectors:[["tr","ds-resource-policy-entry",""]],inputs:{entry:"entry"},outputs:{toggleCheckbox:"toggleCheckbox"},attrs:U,decls:29,vars:21,consts:[[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"id","ngModel","ngModelChange"],[1,"custom-control-label",3,"for"],["scope","row"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm",3,"title","click"],[1,"fas","fa-edit","fa-fw"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],[1,"fas","fa-users","fa-fw"]],template:function(_,u){1&_&&(e.\u0275\u0275elementStart(0,"td",0)(1,"div",1)(2,"input",2),e.\u0275\u0275listener("ngModelChange",function(O){return u.toggleCheckbox.emit(O)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(3,"label",3),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(4,"th",4),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"td"),e.\u0275\u0275text(7),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(8,"td"),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"td"),e.\u0275\u0275text(11),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"td"),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"td"),e.\u0275\u0275text(16),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(18,"td"),e.\u0275\u0275text(19),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(20,"td"),e.\u0275\u0275text(21),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(22,"td",0)(23,"div",5)(24,"button",6),e.\u0275\u0275listener("click",function(){return u.redirectToResourcePolicyEditPage()}),e.\u0275\u0275pipe(25,"translate"),e.\u0275\u0275element(26,"i",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(27,W,3,3,"button",8),e.\u0275\u0275pipe(28,"async"),e.\u0275\u0275elementEnd()()),2&_&&(e.\u0275\u0275advance(2),e.\u0275\u0275property("id",u.entry.id)("ngModel",u.entry.checked),e.\u0275\u0275advance(1),e.\u0275\u0275property("for",u.entry.id),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",u.entry.id,"\n"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(u.entry.policy.name),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(u.entry.policy.policyType),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(u.entry.policy.action),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(14,13,u.epersonName$),"\n"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(17,15,u.groupName$),"\n"),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(u.formatDate(u.entry.policy.startDate)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(u.formatDate(u.entry.policy.endDate)),e.\u0275\u0275advance(3),e.\u0275\u0275property("title",e.\u0275\u0275pipeBind1(25,17,"resource-policies.table.headers.edit.policy")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",void 0!==e.\u0275\u0275pipeBind1(28,19,u.groupName$)))},directives:[n.Wl,n.JJ,n.On,p.O5],pipes:[p.Ov,v.X$],encapsulation:2}),I})()},72044:(F,x,r)=>{r.d(x,{W:()=>u});var e=r(5e3),C=r(61135),T=r(54004),D=r(17489),f=r(4177),M=r(24702),i=r(71508),B=r(77572),g=r(28652),n=r(68285),p=r(77467),v=r(17481),U=r(21147),W=r(83616);function y(h,O){if(1&h){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-eperson-search-box",3),e.\u0275\u0275listener("search",function(c){return e.\u0275\u0275restoreView(o),e.\u0275\u0275nextContext().onSearch(c)}),e.\u0275\u0275elementEnd()}}function I(h,O){if(1&h){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-group-search-box",3),e.\u0275\u0275listener("search",function(c){return e.\u0275\u0275restoreView(o),e.\u0275\u0275nextContext().onSearch(c)}),e.\u0275\u0275elementEnd()}}function t(h,O){if(1&h){const o=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"tr"),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"td"),e.\u0275\u0275text(3),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"td"),e.\u0275\u0275text(5),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(6,"td",7)(7,"button",9),e.\u0275\u0275listener("click",function(){const m=e.\u0275\u0275restoreView(o).$implicit;return e.\u0275\u0275nextContext(2).emitSelect(m)}),e.\u0275\u0275text(8),e.\u0275\u0275pipe(9,"translate"),e.\u0275\u0275elementEnd()()()}if(2&h){const o=O.$implicit,P=e.\u0275\u0275nextContext(2);e.\u0275\u0275classProp("table-primary",e.\u0275\u0275pipeBind1(1,5,P.isSelected(o))),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(o.id),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(P.dsoNameService.getName(o)),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(9,7,"resource-policies.form.eperson-group-list.select.btn")," ")}}function _(h,O){if(1&h&&(e.\u0275\u0275elementStart(0,"ds-pagination",4),e.\u0275\u0275pipe(1,"async"),e.\u0275\u0275elementStart(2,"div",5)(3,"table",6)(4,"thead")(5,"tr",7)(6,"th"),e.\u0275\u0275text(7),e.\u0275\u0275pipe(8,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(9,"th"),e.\u0275\u0275text(10),e.\u0275\u0275pipe(11,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(12,"th"),e.\u0275\u0275text(13),e.\u0275\u0275pipe(14,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(15,"tbody"),e.\u0275\u0275template(16,t,10,9,"tr",8),e.\u0275\u0275pipe(17,"async"),e.\u0275\u0275elementEnd()()()()),2&h){const o=e.\u0275\u0275nextContext();let P,c;e.\u0275\u0275property("paginationOptions",o.paginationOptions)("collectionSize",null==(P=e.\u0275\u0275pipeBind1(1,8,o.getList()))||null==P.payload?null:P.payload.totalElements)("retainScrollPosition",!0)("hideGear",!0),e.\u0275\u0275advance(7),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(8,10,"resource-policies.form.eperson-group-list.table.headers.id")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(11,12,"resource-policies.form.eperson-group-list.table.headers.name")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(14,14,"resource-policies.form.eperson-group-list.table.headers.action")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngForOf",null==(c=e.\u0275\u0275pipeBind1(17,16,o.getList()))||null==c.payload?null:c.payload.page)}}let u=(()=>{class h{constructor(o,P,c){this.dsoNameService=o,this.parentInjector=P,this.paginationService=c,this.isListOfEPerson=!0,this.select=new e.EventEmitter,this.currentSearchQuery="",this.currentSearchScope="metadata",this.paginationOptions=new f.r,this.list$=new C.X({}),this.entrySelectedId=new C.X(""),this.subs=[]}ngOnInit(){const P=(0,U.p)(this.isListOfEPerson?i.U:B.o);this.dataService=e.Injector.create({providers:[],parent:this.parentInjector}).get(P),this.paginationOptions.id=(0,D.uniqueId)("egl"),this.paginationOptions.pageSize=5,this.initSelected&&this.entrySelectedId.next(this.initSelected),this.updateList(this.currentSearchScope,this.currentSearchQuery)}emitSelect(o){this.select.emit(o),this.entrySelectedId.next(o.id)}getList(){return this.list$.asObservable()}isSelected(o){return this.entrySelectedId.asObservable().pipe((0,T.U)(P=>(0,M.UE)(P)&&P===o.id))}onSearch(o){this.currentSearchQuery=o.query,this.currentSearchScope=o.scope,this.paginationService.resetPage(this.paginationOptions.id),this.updateList(this.currentSearchScope,this.currentSearchQuery)}updateList(o,P){(0,M.Uh)(this.pageConfigSub)&&this.pageConfigSub.unsubscribe(),this.pageConfigSub=this.paginationService.getCurrentPagination(this.paginationOptions.id,this.paginationOptions).subscribe(c=>{const m=Object.assign({},new v.R,{elementsPerPage:c.pageSize,currentPage:c.currentPage}),N=this.isListOfEPerson?this.dataService.searchByScope(o,P,m):this.dataService.searchGroups(P,m);this.subs.push(N.pipe((0,n.hC)()).subscribe($=>{(0,M.Uh)(this.list$)&&this.list$.next($)}))})}ngOnDestroy(){this.list$=null,this.subs.filter(o=>(0,M.Uh)(o)).forEach(o=>o.unsubscribe()),this.paginationService.clearPagination(this.paginationOptions.id)}}return h.\u0275fac=function(o){return new(o||h)(e.\u0275\u0275directiveInject(W._),e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(p.N))},h.\u0275cmp=e.\u0275\u0275defineComponent({type:h,selectors:[["ds-eperson-group-list"]],inputs:{isListOfEPerson:"isListOfEPerson",initSelected:"initSelected"},outputs:{select:"select"},decls:5,vars:6,consts:[[1,"mt-3"],[3,"search",4,"ngIf"],[3,"paginationOptions","collectionSize","retainScrollPosition","hideGear",4,"ngIf"],[3,"search"],[3,"paginationOptions","collectionSize","retainScrollPosition","hideGear"],[1,"table-responsive"],["id","groups",1,"table","table-sm","table-striped","table-hover","table-bordered"],[1,"text-center"],[3,"table-primary",4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-outline-primary",3,"click"]],template:function(o,P){if(1&o&&(e.\u0275\u0275elementStart(0,"div",0),e.\u0275\u0275template(1,y,1,0,"ds-eperson-search-box",1),e.\u0275\u0275template(2,I,1,0,"ds-group-search-box",1),e.\u0275\u0275template(3,_,18,18,"ds-pagination",2),e.\u0275\u0275pipe(4,"async"),e.\u0275\u0275elementEnd()),2&o){let c;e.\u0275\u0275property("@fadeInOut",void 0),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",P.isListOfEPerson),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",!P.isListOfEPerson),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",(null==(c=e.\u0275\u0275pipeBind1(4,4,P.getList()))||null==c.payload?null:c.payload.totalElements)>0)}},styles:[""],data:{animation:[g.Ic]}}),h})()},27193:(F,x,r)=>{r.d(x,{Z:()=>re});var e=r(5e3),C=r(39646),T=r(61135),D=r(39841),R=r(54004),f=r(39300),M=r(95698),i=r(8108),B=r(68720),g=r(19260),n=(()=>{return(l=n||(n={})).TYPE_SUBMISSION="TYPE_SUBMISSION",l.TYPE_WORKFLOW="TYPE_WORKFLOW",l.TYPE_INHERITED="TYPE_INHERITED",l.TYPE_CUSTOM="TYPE_CUSTOM",n;var l})(),p=(()=>{return(l=p||(p={})).READ="READ",l.WRITE="WRITE",l.DELETE="DELETE",l.ADD="ADD",l.REMOVE="REMOVE",l[l.WORKFLOW_STEP_1=5]="WORKFLOW_STEP_1",l[l.WORKFLOW_STEP_2=6]="WORKFLOW_STEP_2",l[l.WORKFLOW_STEP_3=7]="WORKFLOW_STEP_3",l[l.WORKFLOW_ABORT=8]="WORKFLOW_ABORT",l.DEFAULT_BITSTREAM_READ="DEFAULT_BITSTREAM_READ",l.DEFAULT_ITEM_READ="DEFAULT_ITEM_READ",l.ADMIN="ADMIN",l.WITHDRAWN_READ="WITHDRAWN_READ",p;var l})();const v=[{label:n.TYPE_SUBMISSION,value:n.TYPE_SUBMISSION},{label:n.TYPE_WORKFLOW,value:n.TYPE_WORKFLOW},{label:n.TYPE_INHERITED,value:n.TYPE_INHERITED},{label:n.TYPE_CUSTOM,value:n.TYPE_CUSTOM}],U=[{label:p.READ.toString(),value:p.READ},{label:p.WRITE.toString(),value:p.WRITE},{label:p.REMOVE.toString(),value:p.REMOVE},{label:p.ADMIN.toString(),value:p.ADMIN},{label:p.DELETE.toString(),value:p.DELETE},{label:p.WITHDRAWN_READ.toString(),value:p.WITHDRAWN_READ},{label:p.DEFAULT_BITSTREAM_READ.toString(),value:p.DEFAULT_BITSTREAM_READ},{label:p.DEFAULT_ITEM_READ.toString(),value:p.DEFAULT_ITEM_READ}],W={id:"name",label:"resource-policies.form.name.label",metadataFields:[],repeatable:!1,submissionId:"",hasSelectableMetadata:!1},y={id:"description",label:"resource-policies.form.description.label",metadataFields:[],repeatable:!1,rows:10,submissionId:"",hasSelectableMetadata:!1},I={id:"policyType",label:"resource-policies.form.policy-type.label",options:v,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.policy-type.required"}},t={id:"action",label:"resource-policies.form.action-type.label",options:U,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.action-type.required"}},_={id:"date",group:[]},u={element:{control:"form-row"}},h={id:"start",label:"resource-policies.form.date.start.label",placeholder:"resource-policies.form.date.start.label",inline:!1,toggleIcon:"far fa-calendar-alt"},O={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},o={id:"end",label:"resource-policies.form.date.end.label",placeholder:"resource-policies.form.date.end.label",inline:!1,toggleIcon:"far fa-calendar-alt"},P={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}};var c=r(67779),m=r(24702),N=r(28858),$=r(74648),Y=r(38723),z=r(45061),b=r(43499),K=r(68285),d=r(31241),E=r(83616),S=r(17656),j=r(69808),V=r(63311),H=r(72044),X=r(86956);const J=["content"];function Q(l,G){if(1&l&&e.\u0275\u0275element(0,"ds-form",16,17),2&l){const s=e.\u0275\u0275nextContext();e.\u0275\u0275property("formId",s.formId)("formModel",s.formModel)("displaySubmit",!1)("displayCancel",!1)}}function Z(l,G){if(1&l){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-eperson-group-list",18),e.\u0275\u0275listener("select",function(L){return e.\u0275\u0275restoreView(s),e.\u0275\u0275nextContext().updateObjectSelected(L,!0)}),e.\u0275\u0275elementEnd()}}function k(l,G){if(1&l){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"ds-eperson-group-list",19),e.\u0275\u0275listener("select",function(L){return e.\u0275\u0275restoreView(s),e.\u0275\u0275nextContext().updateObjectSelected(L,!1)}),e.\u0275\u0275elementEnd()}2&l&&e.\u0275\u0275property("isListOfEPerson",!1)}function q(l,G){1&l&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275element(1,"i",20),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd()),2&l&&(e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(3,1,"submission.workflow.tasks.generic.processing")," "))}function ee(l,G){1&l&&(e.\u0275\u0275elementStart(0,"span"),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"translate"),e.\u0275\u0275elementEnd()),2&l&&(e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(2,1,"form.submit")," "))}function te(l,G){if(1&l){const s=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",21)(1,"h4",22),e.\u0275\u0275text(2),e.\u0275\u0275pipe(3,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(4,"button",23),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(s).$implicit.close()}),e.\u0275\u0275elementStart(5,"span",24),e.\u0275\u0275text(6,"\xd7"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(7,"div",25)(8,"div",26)(9,"div",27),e.\u0275\u0275element(10,"i",28),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(11,"div"),e.\u0275\u0275element(12,"p",29),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275element(14,"p",30),e.\u0275\u0275pipe(15,"translate"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(16,"div",31)(17,"button",32),e.\u0275\u0275listener("click",function(){return e.\u0275\u0275restoreView(s).$implicit.close()}),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"translate"),e.\u0275\u0275elementEnd()()}if(2&l){const s=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(3,4,"resource-policies.form.eperson-group-list.modal.header")),e.\u0275\u0275advance(10),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind1(13,6,"eperson"===s.navActiveId?"resource-policies.form.eperson-group-list.modal.text1.toGroup":"resource-policies.form.eperson-group-list.modal.text1.toEPerson"),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(2),e.\u0275\u0275property("innerHTML",e.\u0275\u0275pipeBind1(15,8,"resource-policies.form.eperson-group-list.modal.text2"),e.\u0275\u0275sanitizeHtml),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(19,10,"resource-policies.form.eperson-group-list.modal.close"))}}let re=(()=>{class l{constructor(s,a,L,A,w,ne){this.dsoNameService=s,this.ePersonService=a,this.formService=L,this.groupService=A,this.requestService=w,this.modalService=ne,this.isProcessing=(0,C.of)(!1),this.reset=new e.EventEmitter,this.submit=new e.EventEmitter,this.resourcePolicyTargetName$=new T.X(""),this.subs=[],this.resourcePolicyTargetUpdated=!1}ngOnInit(){if(this.isActive=!0,this.formId=this.formService.getUniqueId("resource-policy-form"),this.formModel=this.buildResourcePolicyForm(),this.isBeingEdited()){const s=this.ePersonService.findByHref(this.resourcePolicy._links.eperson.href,!1).pipe((0,K.xw)()),a=this.groupService.findByHref(this.resourcePolicy._links.group.href,!1).pipe((0,K.xw)()),L=(0,D.a)([s,a]).pipe((0,R.U)(A=>A.find(w=>(0,m.UE)(w.payload))),(0,m.tz)());this.subs.push(L.pipe((0,f.h)(()=>this.isActive)).subscribe(A=>{this.resourcePolicyGrant=A.payload,this.navActiveId=String(A.payload.type),this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}))}}isFormValid(){return this.formService.isValid(this.formId).pipe((0,R.U)(s=>s&&(0,m.UE)(this.resourcePolicyGrant)))}buildResourcePolicyForm(){const s=[];s.push(new g.u(W),new c.D(y),new i.nMt(I),new i.nMt(t));const a=new i.oqv(h,O),L=new i.oqv(o,P),A=Object.assign({},_,{group:[]});return A.group.push(a,L),s.push(new i.S_O(A,u)),this.initModelsValue(s),s}initModelsValue(s){return this.resourcePolicy&&s.forEach(a=>{"date"===a.id?((0,m.Uh)(this.resourcePolicy.startDate)&&(a.get(0).value=(0,Y.bj)(this.resourcePolicy.startDate)),(0,m.Uh)(this.resourcePolicy.endDate)&&(a.get(1).value=(0,Y.bj)(this.resourcePolicy.endDate))):this.resourcePolicy.hasOwnProperty(a.id)&&this.resourcePolicy[a.id]&&(a.value=this.resourcePolicy[a.id])}),s}isBeingEdited(){return!(0,m.xb)(this.resourcePolicy)}getResourcePolicyTargetName(){return(0,m.UE)(this.resourcePolicyGrant)?this.dsoNameService.getName(this.resourcePolicyGrant):""}updateObjectSelected(s,a){this.resourcePolicyTargetUpdated=!0,this.resourcePolicyGrant=s,this.resourcePolicyGrantType=a?"eperson":"group",this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}onReset(){this.reset.emit()}onSubmit(){this.formService.getFormData(this.formId).pipe((0,M.q)(1)).subscribe(s=>{const a=Object.create({});a.object=this.createResourcePolicyByFormData(s),a.target={type:this.resourcePolicyGrantType,uuid:this.resourcePolicyGrant.id},a.updateTarget=this.resourcePolicyTargetUpdated,this.submit.emit(a)})}createResourcePolicyByFormData(s){const a=new B.A;return a.name=s.name?s.name[0].value:null,a.description=s.description?s.description[0].value:null,a.policyType=s.policyType?s.policyType[0].value:null,a.action=s.action?s.action[0].value:null,a.startDate=s.date&&s.date.start?(0,Y.iV)(s.date.start[0].value):null,a.endDate=s.date&&s.date.end?(0,Y.iV)(s.date.end[0].value):null,a.type=$.A,a}ngOnDestroy(){this.isActive=!1,this.formModel=null,this.subs.filter(s=>(0,m.Uh)(s)).forEach(s=>s.unsubscribe())}onNavChange(s){this.isBeingEdited()&&(s.preventDefault(),this.modalService.open(this.content))}}return l.\u0275fac=function(s){return new(s||l)(e.\u0275\u0275directiveInject(E._),e.\u0275\u0275directiveInject(z.k),e.\u0275\u0275directiveInject(N.o),e.\u0275\u0275directiveInject(b.O),e.\u0275\u0275directiveInject(d.s),e.\u0275\u0275directiveInject(S.FF))},l.\u0275cmp=e.\u0275\u0275defineComponent({type:l,selectors:[["ds-resource-policy-form"]],viewQuery:function(s,a){if(1&s&&e.\u0275\u0275viewQuery(J,5),2&s){let L;e.\u0275\u0275queryRefresh(L=e.\u0275\u0275loadQuery())&&(a.content=L.first)}},inputs:{resourcePolicy:"resourcePolicy",isProcessing:"isProcessing"},outputs:{reset:"reset",submit:"submit"},decls:38,vars:34,consts:[[3,"formId","formModel","displaySubmit","displayCancel",4,"ngIf"],[1,"container-fluid"],["for","ResourcePolicyObject"],["id","ResourcePolicyObject","type","text",1,"form-control","mb-3",3,"value"],["ngbNav","",1,"nav-pills",3,"activeId","activeIdChange","navChange"],["nav","ngbNav"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"form-group","row"],[1,"col","text-right"],["type","reset",1,"btn","btn-default",3,"disabled","click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],["content",""],[3,"formId","formModel","displaySubmit","displayCancel"],["formRef","formComponent"],[3,"select"],[3,"isListOfEPerson","select"],[1,"fas","fa-circle-notch","fa-spin"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"d-flex","flex-row"],[1,"mr-3"],[1,"fas","fa-info-circle","fa-2x","text-info"],[1,"font-weight-bold",3,"innerHTML"],[3,"innerHTML"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(s,a){if(1&s&&(e.\u0275\u0275elementStart(0,"div"),e.\u0275\u0275template(1,Q,2,4,"ds-form",0),e.\u0275\u0275elementStart(2,"div",1)(3,"label",2),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(6,"input",3),e.\u0275\u0275pipe(7,"async"),e.\u0275\u0275elementStart(8,"ul",4,5),e.\u0275\u0275listener("activeIdChange",function(A){return a.navActiveId=A})("navChange",function(A){return a.onNavChange(A)}),e.\u0275\u0275elementStart(10,"li",6)(11,"a",7),e.\u0275\u0275text(12),e.\u0275\u0275pipe(13,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(14,Z,1,0,"ng-template",8),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(15,"li",6)(16,"a",7),e.\u0275\u0275text(17),e.\u0275\u0275pipe(18,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(19,k,1,1,"ng-template",8),e.\u0275\u0275elementEnd()(),e.\u0275\u0275element(20,"div",9),e.\u0275\u0275elementStart(21,"div"),e.\u0275\u0275element(22,"hr"),e.\u0275\u0275elementStart(23,"div",10)(24,"div",11)(25,"button",12),e.\u0275\u0275listener("click",function(){return a.onReset()}),e.\u0275\u0275pipe(26,"async"),e.\u0275\u0275text(27),e.\u0275\u0275pipe(28,"translate"),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(29,"button",13),e.\u0275\u0275listener("click",function(){return a.onSubmit()}),e.\u0275\u0275pipe(30,"async"),e.\u0275\u0275pipe(31,"async"),e.\u0275\u0275template(32,q,4,3,"span",14),e.\u0275\u0275pipe(33,"async"),e.\u0275\u0275template(34,ee,3,3,"span",14),e.\u0275\u0275pipe(35,"async"),e.\u0275\u0275elementEnd()()()()()(),e.\u0275\u0275template(36,te,20,12,"ng-template",null,15,e.\u0275\u0275templateRefExtractor)),2&s){const L=e.\u0275\u0275reference(9);e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf",a.formModel),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(5,14,"resource-policies.form.eperson-group-list.label")),e.\u0275\u0275advance(2),e.\u0275\u0275property("value",e.\u0275\u0275pipeBind1(7,16,a.resourcePolicyTargetName$)),e.\u0275\u0275advance(2),e.\u0275\u0275property("activeId",a.navActiveId),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngbNavItem","eperson"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(13,18,"resource-policies.form.eperson-group-list.tab.eperson")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavItem","group"),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(18,20,"resource-policies.form.eperson-group-list.tab.group")),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngbNavOutlet",L),e.\u0275\u0275advance(5),e.\u0275\u0275property("disabled",e.\u0275\u0275pipeBind1(26,22,a.isProcessing)),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate(e.\u0275\u0275pipeBind1(28,24,"form.cancel")),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!e.\u0275\u0275pipeBind1(30,26,a.isFormValid())||e.\u0275\u0275pipeBind1(31,28,a.isProcessing)),e.\u0275\u0275advance(3),e.\u0275\u0275property("ngIf",e.\u0275\u0275pipeBind1(33,30,a.isProcessing)),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",!e.\u0275\u0275pipeBind1(35,32,a.isProcessing))}},directives:[j.O5,V.U,S.Pz,S.nv,S.Vx,S.uN,H.W,S.tO],pipes:[X.X$,j.Ov],encapsulation:2}),l})()},66765:(F,x,r)=>{r.d(x,{a:()=>M});var e=r(5e3),C=r(3879),T=r(24702),D=r(68285),R=r(21147),f=r(74202);let M=(()=>{class i{constructor(g,n){this.parentInjector=g,this.router=n}resolve(g,n){const p=g.queryParamMap.get("targetType"),v=g.queryParamMap.get("policyTargetId");((0,T.xb)(p)||(0,T.xb)(v))&&this.router.navigateByUrl("/404",{skipLocationChange:!0});const U=(0,R.p)(new C._(p));return this.dataService=e.Injector.create({providers:[],parent:this.parentInjector}).get(U),this.dataService.findById(v).pipe((0,D.hC)())}}return i.\u0275fac=function(g){return new(g||i)(e.\u0275\u0275inject(e.Injector),e.\u0275\u0275inject(f.F0))},i.\u0275prov=e.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})()},48739:(F,x,r)=>{r.d(x,{b:()=>M});var e=r(24702),C=r(24886),T=r(93369),D=r(68285),R=r(5e3),f=r(74202);let M=(()=>{class i{constructor(g,n){this.resourcePolicyService=g,this.router=n}resolve(g,n){const p=g.queryParamMap.get("policyId");return(0,e.xb)(p)&&this.router.navigateByUrl("/404",{skipLocationChange:!0}),this.resourcePolicyService.findById(p,!0,!1,(0,T.l)("eperson"),(0,T.l)("group")).pipe((0,D.hC)())}}return i.\u0275fac=function(g){return new(g||i)(R.\u0275\u0275inject(C.I),R.\u0275\u0275inject(f.F0))},i.\u0275prov=R.\u0275\u0275defineInjectable({token:i,factory:i.\u0275fac}),i})()},40195:(F,x,r)=>{r.d(x,{F:()=>z});var e=r(61135),C=r(50457),T=r(39300),D=r(70207),R=r(54004),f=r(71884),M=r(24351),i=r(22940),B=r(95698),g=r(68285),n=r(24886),p=r(43499),v=r(24702),U=r(45061),W=r(31241),y=r(82596),I=r(93369),t=r(5e3),_=r(83616),u=r(74202),h=r(86956),O=r(69808),o=r(60726);function P(b,K){if(1&b&&(t.\u0275\u0275elementContainerStart(0),t.\u0275\u0275text(1),t.\u0275\u0275elementContainerEnd()),2&b){const d=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275textInterpolate1(" (",d.resourceUUID,") ")}}function c(b,K){1&b&&(t.\u0275\u0275elementStart(0,"span"),t.\u0275\u0275element(1,"i",11),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()),2&b&&(t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,1,"submission.workflow.tasks.generic.processing")," "))}function m(b,K){1&b&&(t.\u0275\u0275elementStart(0,"span"),t.\u0275\u0275element(1,"i",12),t.\u0275\u0275text(2),t.\u0275\u0275pipe(3,"translate"),t.\u0275\u0275elementEnd()),2&b&&(t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(3,1,"resource-policies.delete.btn")," "))}function N(b,K){if(1&b){const d=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"tr",13)(1,"th")(2,"div",14)(3,"input",15),t.\u0275\u0275listener("change",function(S){return t.\u0275\u0275restoreView(d),t.\u0275\u0275nextContext().selectAllCheckbox(S)}),t.\u0275\u0275elementEnd(),t.\u0275\u0275element(4,"label",16),t.\u0275\u0275elementEnd()(),t.\u0275\u0275elementStart(5,"th"),t.\u0275\u0275text(6),t.\u0275\u0275pipe(7,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(8,"th"),t.\u0275\u0275text(9),t.\u0275\u0275pipe(10,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(11,"th"),t.\u0275\u0275text(12),t.\u0275\u0275pipe(13,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(14,"th"),t.\u0275\u0275text(15),t.\u0275\u0275pipe(16,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(17,"th"),t.\u0275\u0275text(18),t.\u0275\u0275pipe(19,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(20,"th"),t.\u0275\u0275text(21),t.\u0275\u0275pipe(22,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(23,"th"),t.\u0275\u0275text(24),t.\u0275\u0275pipe(25,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(26,"th"),t.\u0275\u0275text(27),t.\u0275\u0275pipe(28,"translate"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(29,"th"),t.\u0275\u0275text(30),t.\u0275\u0275pipe(31,"translate"),t.\u0275\u0275elementEnd()()}if(2&b){const d=t.\u0275\u0275nextContext();t.\u0275\u0275advance(3),t.\u0275\u0275property("id","selectAll_"+d.resourceUUID),t.\u0275\u0275advance(1),t.\u0275\u0275property("for","selectAll_"+d.resourceUUID),t.\u0275\u0275advance(2),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(7,11,"resource-policies.table.headers.id")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(10,13,"resource-policies.table.headers.name")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(13,15,"resource-policies.table.headers.policyType")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(16,17,"resource-policies.table.headers.action")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(19,19,"resource-policies.table.headers.eperson")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(22,21,"resource-policies.table.headers.group")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(25,23,"resource-policies.table.headers.date.start")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(28,25,"resource-policies.table.headers.date.end")),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate(t.\u0275\u0275pipeBind1(31,27,"resource-policies.table.headers.edit"))}}function $(b,K){if(1&b){const d=t.\u0275\u0275getCurrentView();t.\u0275\u0275elementStart(0,"tr",18),t.\u0275\u0275listener("toggleCheckbox",function(S){const V=t.\u0275\u0275restoreView(d).$implicit;return t.\u0275\u0275nextContext(2).selectCheckbox(V,S)}),t.\u0275\u0275elementEnd()}2&b&&t.\u0275\u0275property("entry",K.$implicit)}function Y(b,K){if(1&b&&(t.\u0275\u0275elementStart(0,"tbody"),t.\u0275\u0275template(1,$,1,1,"tr",17),t.\u0275\u0275pipe(2,"async"),t.\u0275\u0275elementEnd()),2&b){const d=t.\u0275\u0275nextContext();t.\u0275\u0275advance(1),t.\u0275\u0275property("ngForOf",t.\u0275\u0275pipeBind1(2,1,d.getResourcePolicies()))}}let z=(()=>{class b{constructor(d,E,S,j,V,H,X,J,Q,Z){this.cdr=d,this.dsoNameService=E,this.ePersonService=S,this.groupService=j,this.notificationsService=V,this.requestService=H,this.resourcePolicyService=X,this.route=J,this.router=Q,this.translate=Z,this.processingDelete$=new e.X(!1),this.resourcePoliciesEntries$=new e.X([]),this.subs=[]}ngOnInit(){this.isActive=!0,this.initResourcePolicyList()}canDelete(){return(0,C.D)(this.resourcePoliciesEntries$.value).pipe((0,T.h)(d=>d.checked),(0,D.u)((d,E)=>[...d,E],[]),(0,R.U)(d=>(0,v.UE)(d)),(0,f.x)())}deleteSelectedResourcePolicies(){this.processingDelete$.next(!0);const d=this.resourcePoliciesEntries$.value.filter(E=>E.checked);this.subs.push((0,C.D)(d).pipe((0,M.b)(E=>this.resourcePolicyService.delete(E.policy.id)),(0,i.R)((E,S)=>[...E,S],[]),(0,T.h)(E=>E.length===d.length),(0,B.q)(1)).subscribe(E=>{const S=E.filter(j=>!j);(0,v.xb)(S)?this.notificationsService.success(null,this.translate.get("resource-policies.delete.success.content")):this.notificationsService.error(null,this.translate.get("resource-policies.delete.failure.content")),this.processingDelete$.next(!1)}))}getResourcePolicies(){return this.resourcePoliciesEntries$.asObservable()}initResourcePolicyList(){this.subs.push(this.resourcePolicyService.searchByResource(this.resourceUUID,null,!1,!0,(0,I.l)("eperson"),(0,I.l)("group")).pipe((0,T.h)(()=>this.isActive),(0,g.g1)()).subscribe(d=>{const E=d.payload.page.map(S=>({id:S.id,policy:S,checked:!1}));this.resourcePoliciesEntries$.next(E),this.cdr.detectChanges()}))}isProcessingDelete(){return this.processingDelete$.asObservable()}redirectToResourcePolicyCreatePage(){this.router.navigate(["./create"],{relativeTo:this.route,queryParams:{policyTargetId:this.resourceUUID,targetType:this.resourceType}})}selectAllCheckbox(d){const E=d.target.checked;this.resourcePoliciesEntries$.value.forEach(S=>S.checked=E)}selectCheckbox(d,E){d.checked=E}ngOnDestroy(){this.isActive=!1,this.resourcePoliciesEntries$=null,this.subs.filter(d=>(0,v.Uh)(d)).forEach(d=>d.unsubscribe())}}return b.\u0275fac=function(d){return new(d||b)(t.\u0275\u0275directiveInject(t.ChangeDetectorRef),t.\u0275\u0275directiveInject(_._),t.\u0275\u0275directiveInject(U.k),t.\u0275\u0275directiveInject(p.O),t.\u0275\u0275directiveInject(y.T),t.\u0275\u0275directiveInject(W.s),t.\u0275\u0275directiveInject(n.I),t.\u0275\u0275directiveInject(u.gz),t.\u0275\u0275directiveInject(u.F0),t.\u0275\u0275directiveInject(h.sK))},b.\u0275cmp=t.\u0275\u0275defineComponent({type:b,selectors:[["ds-resource-policies"]],inputs:{resourceUUID:"resourceUUID",resourceType:"resourceType",resourceName:"resourceName"},decls:31,vars:34,consts:[[1,"table-responsive"],[1,"table","table-striped","table-bordered","table-hover"],["colspan","10"],[1,"d-flex","justify-content-between","align-items-center","m-0"],[1,"text-info"],[4,"ngIf"],[1,"space-children-mr","flex-shrink-0"],[1,"btn","btn-danger","p-1",3,"disabled","title","click"],[1,"btn","btn-success","p-1",3,"disabled","title","click"],[1,"fas","fa-plus"],["class","text-center",4,"ngIf"],[1,"fas","fa-circle-notch","fa-spin"],[1,"fas","fa-trash-alt","fa-fw"],[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"id","change"],[1,"custom-control-label",3,"for"],["ds-resource-policy-entry","",3,"entry","toggleCheckbox",4,"ngFor","ngForOf"],["ds-resource-policy-entry","",3,"entry","toggleCheckbox"]],template:function(d,E){if(1&d&&(t.\u0275\u0275elementStart(0,"div",0)(1,"table",1)(2,"thead")(3,"tr")(4,"th",2)(5,"div",3)(6,"span"),t.\u0275\u0275text(7),t.\u0275\u0275pipe(8,"translate"),t.\u0275\u0275elementStart(9,"span",4),t.\u0275\u0275text(10),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(11,P,2,1,"ng-container",5),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(12,"div",6)(13,"button",7),t.\u0275\u0275listener("click",function(){return E.deleteSelectedResourcePolicies()}),t.\u0275\u0275pipe(14,"async"),t.\u0275\u0275pipe(15,"async"),t.\u0275\u0275pipe(16,"translate"),t.\u0275\u0275template(17,c,4,3,"span",5),t.\u0275\u0275pipe(18,"async"),t.\u0275\u0275template(19,m,4,3,"span",5),t.\u0275\u0275pipe(20,"async"),t.\u0275\u0275elementEnd(),t.\u0275\u0275elementStart(21,"button",8),t.\u0275\u0275listener("click",function(){return E.redirectToResourcePolicyCreatePage()}),t.\u0275\u0275pipe(22,"async"),t.\u0275\u0275pipe(23,"translate"),t.\u0275\u0275element(24,"i",9),t.\u0275\u0275text(25),t.\u0275\u0275pipe(26,"translate"),t.\u0275\u0275elementEnd()()()()(),t.\u0275\u0275template(27,N,32,29,"tr",10),t.\u0275\u0275pipe(28,"async"),t.\u0275\u0275elementEnd(),t.\u0275\u0275template(29,Y,3,3,"tbody",5),t.\u0275\u0275pipe(30,"async"),t.\u0275\u0275elementEnd()()),2&d){let S,j;t.\u0275\u0275advance(7),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(8,12,"resource-policies.table.headers.title.for."+E.resourceType)," "),t.\u0275\u0275advance(3),t.\u0275\u0275textInterpolate1(" ",E.resourceName," "),t.\u0275\u0275advance(1),t.\u0275\u0275property("ngIf","item"!=E.resourceType),t.\u0275\u0275advance(2),t.\u0275\u0275property("disabled",!t.\u0275\u0275pipeBind1(14,14,E.canDelete())||t.\u0275\u0275pipeBind1(15,16,E.isProcessingDelete()))("title",t.\u0275\u0275pipeBind1(16,18,"resource-policies.delete.btn.title")),t.\u0275\u0275advance(4),t.\u0275\u0275property("ngIf",t.\u0275\u0275pipeBind1(18,20,E.isProcessingDelete())),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",!t.\u0275\u0275pipeBind1(20,22,E.isProcessingDelete())),t.\u0275\u0275advance(2),t.\u0275\u0275property("disabled",t.\u0275\u0275pipeBind1(22,24,E.isProcessingDelete()))("title",t.\u0275\u0275pipeBind1(23,26,"resource-policies.add.for."+E.resourceType)),t.\u0275\u0275advance(4),t.\u0275\u0275textInterpolate1(" ",t.\u0275\u0275pipeBind1(26,28,"resource-policies.add.button")," "),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",(null==(S=t.\u0275\u0275pipeBind1(28,30,E.getResourcePolicies()))?null:S.length)>0),t.\u0275\u0275advance(2),t.\u0275\u0275property("ngIf",(null==(j=t.\u0275\u0275pipeBind1(30,32,E.getResourcePolicies()))?null:j.length)>0)}},directives:[O.O5,O.sg,o.Y],pipes:[h.X$,O.Ov],styles:["td[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]:focus{box-shadow:none!important}"]}),b})()},94337:(F,x,r)=>{r.d(x,{q:()=>O});var e=r(69808),C=r(86956),M=(r(40195),r(27193),r(86527),r(34981),r(10194)),i=r(48739),B=r(66765),g=r(72044),n=r(5e3),p=r(24702),v=r(93075);let U=(()=>{class o{constructor(c){this.formBuilder=c,this.labelPrefix="admin.access-control.groups.",this.subs=[],this.search=new n.EventEmitter,this.searchForm=this.formBuilder.group({query:""})}reset(){this.searchForm=this.formBuilder.group({query:""})}submit(c){const m={scope:"",query:(0,p.K0)(c)?c.query:""};this.search.emit(m)}}return o.\u0275fac=function(c){return new(c||o)(n.\u0275\u0275directiveInject(v.qu))},o.\u0275cmp=n.\u0275\u0275defineComponent({type:o,selectors:[["ds-group-search-box"]],outputs:{search:"search"},decls:13,vars:7,consts:[[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],["type","button",1,"search-button","btn","btn-secondary",3,"click"]],template:function(c,m){1&c&&(n.\u0275\u0275elementStart(0,"form",0),n.\u0275\u0275listener("ngSubmit",function($){return m.submit(m.searchForm.value),$.stopImmediatePropagation()}),n.\u0275\u0275elementStart(1,"div",1)(2,"div",2),n.\u0275\u0275element(3,"input",3),n.\u0275\u0275elementStart(4,"span",4)(5,"button",5),n.\u0275\u0275element(6,"i",6),n.\u0275\u0275text(7),n.\u0275\u0275pipe(8,"translate"),n.\u0275\u0275elementEnd()()()(),n.\u0275\u0275elementStart(9,"div")(10,"button",7),n.\u0275\u0275listener("click",function(){return m.submit(null),m.reset()}),n.\u0275\u0275text(11),n.\u0275\u0275pipe(12,"translate"),n.\u0275\u0275elementEnd()()()),2&c&&(n.\u0275\u0275property("formGroup",m.searchForm),n.\u0275\u0275advance(7),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(8,3,m.labelPrefix+"search.button")," "),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(12,5,m.labelPrefix+"button.see-all")," "))},directives:[v._Y,v.JL,v.sg,v.Fj,v.JJ,v.u],pipes:[C.X$],encapsulation:2}),o})(),W=(()=>{class o{constructor(c){this.formBuilder=c,this.labelPrefix="admin.access-control.epeople.",this.subs=[],this.search=new n.EventEmitter,this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}reset(){this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}submit(c){const m={scope:(0,p.K0)(c)?c.scope:"metadata",query:(0,p.K0)(c)?c.query:""};this.search.emit(m)}}return o.\u0275fac=function(c){return new(c||o)(n.\u0275\u0275directiveInject(v.qu))},o.\u0275cmp=n.\u0275\u0275defineComponent({type:o,selectors:[["ds-eperson-search-box"]],outputs:{search:"search"},decls:21,vars:13,consts:[[1,"d-flex","justify-content-between",3,"formGroup","ngSubmit"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],["type","button",1,"search-button","btn","btn-secondary",3,"click"]],template:function(c,m){1&c&&(n.\u0275\u0275elementStart(0,"form",0),n.\u0275\u0275listener("ngSubmit",function($){return m.submit(m.searchForm.value),$.stopImmediatePropagation()}),n.\u0275\u0275elementStart(1,"div")(2,"select",1)(3,"option",2),n.\u0275\u0275text(4),n.\u0275\u0275pipe(5,"translate"),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(6,"option",3),n.\u0275\u0275text(7),n.\u0275\u0275pipe(8,"translate"),n.\u0275\u0275elementEnd()()(),n.\u0275\u0275elementStart(9,"div",4)(10,"div",5),n.\u0275\u0275element(11,"input",6),n.\u0275\u0275elementStart(12,"span",7)(13,"button",8),n.\u0275\u0275element(14,"i",9),n.\u0275\u0275text(15),n.\u0275\u0275pipe(16,"translate"),n.\u0275\u0275elementEnd()()()(),n.\u0275\u0275elementStart(17,"div")(18,"button",10),n.\u0275\u0275listener("click",function(){return m.submit(null),m.reset()}),n.\u0275\u0275text(19),n.\u0275\u0275pipe(20,"translate"),n.\u0275\u0275elementEnd()()()),2&c&&(n.\u0275\u0275property("formGroup",m.searchForm),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(5,5,m.labelPrefix+"search.scope.metadata")),n.\u0275\u0275advance(3),n.\u0275\u0275textInterpolate(n.\u0275\u0275pipeBind1(8,7,m.labelPrefix+"search.scope.email")),n.\u0275\u0275advance(8),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(16,9,m.labelPrefix+"search.button")," "),n.\u0275\u0275advance(4),n.\u0275\u0275textInterpolate1(" ",n.\u0275\u0275pipeBind1(20,11,m.labelPrefix+"button.see-all")," "))},directives:[v._Y,v.JL,v.sg,v.EJ,v.JJ,v.u,v.YN,v.Kr,v.Fj],pipes:[C.X$],encapsulation:2}),o})();var y=r(17656),I=r(57981),_=(r(60726),r(62697));const h=[i.b,B.a];let O=(()=>{class o{}return o.\u0275fac=function(c){return new(c||o)},o.\u0275mod=n.\u0275\u0275defineNgModule({type:o}),o.\u0275inj=n.\u0275\u0275defineInjector({providers:[...h],imports:[[y.IJ,e.ez,M.e,C.aw,I.m]]}),o})();n.\u0275\u0275setComponentScope(g.W,[e.O5,W,U,_.Q,e.sg],[e.Ov,C.X$])}}]);